(window["webpackJsonp_joinsoft-v9"]=window["webpackJsonp_joinsoft-v9"]||[]).push([["app~57aaee5f"],{"01a2":function(t,e,r){"use strict";r("354a")},"01fa":function(t,e,r){},"038b":function(t,e,r){},"0791":function(t,e,r){},"09b3":function(t,e,r){},"0da7":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"projEvaluate"},[r("content-view",{attrs:{title:"基本信息"}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("项目描述")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.describe))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("申报小区")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.communityName))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("项目类型")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.getBaseTypeText(t.projInfo.baseType)))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("分摊方式")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[r("j-d-dict-select-tag",{attrs:{readOnly:"",align:"left",type:"select",dictCode:"allocation_method"},model:{value:t.projInfo.allotMode,callback:function(e){t.$set(t.projInfo,"allotMode",e)},expression:"projInfo.allotMode"}})],1),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("联系人")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.reqMan))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("联系电话")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.reqPhone))]),"1"==t.projInfo.comparAble&&"1"!=t.projInfo.hisFlag?[r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("维修范围")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._l(t.repairRange,(function(e){return[e.value===t.projInfo.projScope?r("span",[t._v(t._s(e.text))]):t._e()]}))],2),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("施工单位")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.biddingCorpName))])]:t._e()],2)],1),t.myEvaluateData&&t.myEvaluateData.length>0&&t.evaluateFlag&&(!t.corpInfo.baseType||"03"!=t.corpInfo.baseType)?r("content-view",{attrs:{title:"我的评价"}},[r("div",{staticClass:"myEvaluate"},[t.myEvaluateData.length>1?r("a-tabs",{model:{value:t.myEvaluateDataActiveKey,callback:function(e){t.myEvaluateDataActiveKey=e},expression:"myEvaluateDataActiveKey"}},t._l(t.myEvaluateData,(function(t,e){return r("a-tab-pane",{key:e,attrs:{tab:t.title}})})),1):t._e(),r("a-row",{attrs:{type:"flex"}},[t._l(t.myEvaluateData[t.myEvaluateDataActiveKey].children,(function(e,n){return[r("a-col",{key:"label"+n,attrs:{span:4,xxl:2}},[t._v("\n            "+t._s(e.title)+"\n          ")]),r("a-col",{key:"rate"+n,attrs:{span:20,xxl:22}},[r("el-rate",{attrs:{colors:["#99A9BF","#F7BA2A","#FF9900"]},model:{value:e.grade,callback:function(r){t.$set(e,"grade",r)},expression:"item.grade"}})],1)]}))],2),r("a-textarea",{attrs:{placeholder:"其他意见和建议"},model:{value:t.myEvaluateModel.content,callback:function(e){t.$set(t.myEvaluateModel,"content",e)},expression:"myEvaluateModel.content"}}),r("a-upload",{staticClass:"uploadButtonStyle",attrs:{customRequest:t.uploadFile,"before-upload":t.onBeforeUploadImage,multiple:!0,"list-type":"picture-card","file-list":t.showList,action:t.url.fileUploadImg,headers:t.headers,showUploadList:!0,remove:t.deleteFile},on:{preview:function(e){return t.handlePreview(e)}}},[r("div",{staticStyle:{display:"flex",gap:"6px"}},[r("div",{staticClass:"typeListButton"},[[r("i",{staticClass:"vxe-icon--plus typeListAddIcon"}),r("div",[t._v("上传图片")])]],2)])])],1),r("div",{staticClass:"myEvaluateFooter"},[r("a-button",{attrs:{type:"primary",disabled:0==t.projInfo.completionFlag},on:{click:t.saveEvaluate}},[t._v("保存评价")])],1)]):t._e(),t.projEvaluateIList.myRepair&&t.projEvaluateIList.myRepair.length>0&&!t.evaluateFlag?r("content-view",{attrs:{title:"我的评价"}},[r("div",{staticClass:"myEvaluate"},[r("a-row",{attrs:{type:"flex",align:"middle"}},[t._l(t.projEvaluateIList.myRepair[0].evaluateList,(function(e,n){return[r("a-col",{key:"label"+n,attrs:{span:4,xxl:2}},[t._v("\n            "+t._s(t.getNameByEvaItem(e.evaItem))+"\n          ")]),r("a-col",{key:"rate"+n,attrs:{span:20,xxl:22}},[r("el-rate",{attrs:{colors:["#99A9BF","#F7BA2A","#FF9900"],disabled:!0,value:Number(e.grade)}})],1)]}))],2),r("a-textarea",{attrs:{readOnly:"",value:t.projEvaluateIList.myRepair[0].content,placeholder:"其他意见和建议"}}),r("img-list",{attrs:{imgList:t.projEvaluateIList.myRepair[0].fileList,isDetail:!0}})],1)]):t._e(),[r("content-view",{attrs:{title:"评价列表"}},[r("div",{staticClass:"commentsSection"},[t.projEvaluateIList.complaints&&t.projEvaluateIList.complaints.length>0?t._l(t.projEvaluateIList.complaints,(function(e){return r("div",{key:e.id,staticClass:"commentItem",on:{click:function(r){return t.showDetail(e,t.projEvaluateIList.complaints)}}},[r("div",{staticClass:"commentItem_content"},[r("div",[r("span",{staticClass:"commentItem_user"},[t._v(t._s(e.sendUser))]),r("span",{staticClass:"commentItem_date"},[t._v(t._s(e.createTime))]),r("div",{staticClass:"commentItem_text"},[t._v(t._s(e.content))])]),e.loading?r("a-icon",{attrs:{type:"loading"}}):r("a",{staticClass:"commentItem_descBtn"},[t._v("\n                "+t._s(e.showFlag?"收起":"详情")+"\n              ")])],1),e.showFlag?r("div",{staticClass:"commentItem_detail",on:{click:function(t){t.stopPropagation()}}},[r("a-collapse",{attrs:{defaultActiveKey:["childRate","childFile"]}},[r("a-collapse-panel",{key:"childRate",attrs:{header:"分值评价"}},t._l(e.evaluateList,(function(e,n){return r("div",{key:"evaluate"+n,staticClass:"rateListItem"},[r("span",{staticClass:"rateListItemLabel"},[t._v(t._s(t.getNameByEvaItem(e.evaItem))+"：")]),r("el-rate",{attrs:{value:Number(e.grade)||0,colors:["#99A9BF","#F7BA2A","#FF9900"],disabled:""}})],1)})),0),r("a-collapse-panel",{key:"childFile",attrs:{header:"附件信息"}},[e.fileList&&e.fileList.length>0?r("img-list",{attrs:{size:120,imgList:e.fileList}}):r("a-empty",{attrs:{description:"暂无附件"}})],1)],1)],1):t._e()])})):r("a-empty",{attrs:{description:"暂无评价"}})],2)])],t.previewVisible?r("div",{ref:"previewBox",staticClass:"outer_box",style:{zIndex:1001}},[r("previewPicture",{ref:"previewPicture",attrs:{fileNum:t.previewNum,fileList:t.previewFileList},on:{cancel:function(e){t.previewVisible=!1}}})],1):t._e()],2)},o=[],a=r("3ed7"),i=r("2b0e"),s=r("dc9a"),l=r("0c8a"),c=r("eccd"),u=r("9fbd"),d=r("0fea"),f=r("5745"),h=r("9fb0"),p=r("4a12"),m=r("d8a5");function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function g(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=x(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function y(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */y=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",g={};function b(){}function w(){}function x(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=x.prototype=b.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==v(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===g)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(v(e)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function b(t){return I(t)||j(t)||x(t)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(t,e){if(t){if("string"==typeof t)return C(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}function j(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function I(t){if(Array.isArray(t))return C(t)}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function _(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function P(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){_(a,n,o,i,s,"next",t)}function s(t){_(a,n,o,i,s,"throw",t)}i(void 0)}))}}var k={name:"ProjEvaluate",mixins:[f["a"]],components:{TypeAttachmentUpload:u["default"],JDDictSelectTag:c["default"],ContentView:s["default"],ImgList:p["default"],initDictOptions:m["g"]},props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"维修项目信息"},projId:{type:String,default:""},proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},pageType:{type:Boolean,default:!0}},inject:["projMainData","nowNodeInfo","newEditModal","routeReload"],computed:{projInfo:{get:function(){try{return this.projMainData()}catch(t){return{}}},set:function(){}},routeReloadPage:function(){return this.routeReload}},created:function(){var t=this;this.initData(),Object(m["g"])("repair_range").then((function(e){e.success&&(t.repairRange=e.result)})),this.getCorpInfo()},data:function(){return{corpInfo:{},repairRange:[],bType:"YJ",bTypeDetail:"YJ03",projEvaluateIList:[],evaluateFlag:!0,myEvaluateData:[],myEvaluateModel:{projId:"",regionId:"",content:"",repaiList:[],type:"YJ",typeDetail:"YJ03"},myEvaluateDataActiveKey:0,pagination:{onChange:function(t){},pageSize:3},loading:!1,detailVisible:!1,detailInfo:null,detailModalTitle:"",isAdmin:!1,projEvaluationType:[],url:{queryByProjId:"/mobile/repairEvaluate/queryByProjId",queryDetailById:"/mobile/repairEvaluate/queryDetailById",loadTreeRoot:"/sys/category/loadTreeRoot",checkUserIsCorp:"/sys/sysDepart/checkUserIsCorp",saveEvaluateForPC:"/mobile/repairEvaluate/saveEvaluateNotPsn",checkReapir:"/mobile/repairComplaint/checkReapir"}}},methods:{getCorpInfo:function(){this.corpInfo=i["default"].ls.get("Login_CorpInfo")},getBaseTypeText:l["getBaseTypeText"],getFilePathList:function(t){return t.map((function(t){return t.filePath}))},initData:function(){var t=P(y().mark((function t(){var e,r=this;return y().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Object(d["e"])(this.url.queryByProjId,{projId:this.projMainData().id}).then((function(t){t.success&&(r.projEvaluateIList=t.result)})),t.next=3,Object(d["e"])(this.url.checkUserIsCorp);case 3:return this.isAdmin=!t.sent.success,t.prev=4,t.next=7,Object(d["j"])(this.url.checkReapir,{projectId:this.projInfo.id,createBy:this.isAdmin?"主管单位":"物业"});case 7:this.evaluateFlag=t.sent.result,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](4),this.evaluateFlag=!1;case 13:this.evaluateFlag&&(this.myEvaluateModel.projId=this.projInfo.id,this.myEvaluateModel.regionId=this.projInfo.regionId,this.myEvaluateModel.name=i["default"].ls.get(h["J"]).realname,this.myEvaluateModel.createBy=this.isAdmin?"主管单位":"物业"),e=this,Object(d["e"])(e.url.loadTreeRoot,{async:!1,pcode:"proj_evaluation_type"}).then((function(t){t.success&&(t.result.forEach((function(t){var r;(r=e.projEvaluationType).push.apply(r,b(t.children))})),e.evaluateFlag&&(e.myEvaluateData=t.result.filter((function(t){return t.children&&t.children.length>0&&(t.children=t.children.filter((function(t){var r=JSON.parse(t.remark);return e.isAdmin?"admin"===r.evaluator:"other"===r.evaluator}))),["03"].includes(t.code)}))))}));case 16:case"end":return t.stop()}}),t,this,[[4,10]])})));function e(){return t.apply(this,arguments)}return e}(),getNameByEvaItem:function(t){var e=this.projEvaluationType.find((function(e){return e.code===t}));return e?e.title:""},saveEvaluate:function(){var t=this;this.myEvaluateModel.repaiList=[];var e,r=g(this.myEvaluateData);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.children&&n.children.length>0){var o,a=g(n.children);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(!i.grade)return void this.$message.warning("请对".concat(i.title,"进行评价！"));this.myEvaluateModel.repaiList.push({name:i.title,grade:i.grade||0,id:this.projInfo.construction.corpId,evaItem:i.code})}}catch(s){a.e(s)}finally{a.f()}}}}catch(s){r.e(s)}finally{r.f()}this.myEvaluateModel.content?(this.myEvaluateModel.fileIdList=this.fileList.map((function(t){return t.id})),Object(d["j"])(this.url.saveEvaluateForPC,this.myEvaluateModel).then((function(e){e.success?t.$message.success(e.message):t.$message.error(e.message)})).finally((function(){setTimeout((function(){t.routeReloadPage()}),800)}))):this.$message.warning("请输入您的意见和建议！")},showDetail:function(t,e){var r=this;t.showFlag?t.showFlag=!1:t.fileList&&0!==t.fileList.length?(e.forEach((function(e){e.id!==t.id&&r.$set(e,"showFlag",!1)})),this.$nextTick((function(){r.$set(t,"showFlag",!0)}))):(this.$set(t,"loading",!0),Object(d["e"])(this.url.queryDetailById,{id:t.id}).then((function(e){e.success&&r.$set(t,"fileList",e.result)})).finally((function(){e.forEach((function(e){e.id!==t.id&&r.$set(e,"showFlag",!1)})),r.$set(t,"loading",!1),r.$set(t,"showFlag",!0)})))},getRateTextColor:function(t){},atOnceEvaluate:function(){var t=this;Object(d["e"])("/sys/quartzJob/execute",{id:"1660544733268615170"}).then((function(e){e&&e.success?t.$message.success(e.message):t.$message.warning(e.message)}))}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(a["g"])(t):"0.00"}}},L=k,D=(r("451c"),r("2877")),T=Object(D["a"])(L,n,o,!1,null,"57d7d7c4",null);e["default"]=T.exports},1077:function(t,e,r){},"17c4":function(t,e,r){},"19e2":function(t,e,r){},"1b6c":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"projectReview"},[r("content-view",{attrs:{title:"项目预算",showIcon:!1}},[r("j-form-container",{ref:"baseMsg",attrs:{rules:t.insureRules,model:t.projInfo,disabled:!1,border:!1}},[r("a-row",{staticClass:"houseInfo",attrs:{slot:"edit",type:"flex"},slot:"edit"},[r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("项目描述")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t.projInfo.describe))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("项目预算")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t._f("getAmount")(t.projInfo.budgetCost))+"元")]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("审核结果")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t._f("getAmount")(t.projInfo.contractCost)))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("保单号")]),r("a-col",{attrs:{xxl:8,xl:9,span:12,"data-prop":"insureCode"}},[r("a-input",{attrs:{placeholder:"请输入保单号"},model:{value:t.projInfo.insureCode,callback:function(e){t.$set(t.projInfo,"insureCode",e)},expression:"projInfo.insureCode"}})],1)],1)],1)],1),r("content-view",{attrs:{title:"保险明细",showIcon:!1}},[r("v-table",{ref:"fundTable",attrs:{toolbar:!1,bordered:"",stripe:!0,data:t.loadData,tableColumn:t.fundColumns,expand:!0,"expand-config":{lazy:!0,loadMethod:t.loadContentMethod},childTableHeight:null,tableHeight:null,showPagination:!1,"row-style":t.setRowStyle,rowId:"id",reload:t.queryPage,"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,footerCellStyle:{textAlign:"right"},ifInitQuery:!1,tableColumnChild:t.fundColumnsChild,resizable:"",editConfigChild:{trigger:"click",mode:"cell",showStatus:!0}}})],1),t.showModel?r("content-view",{attrs:{title:"审核流程","show-icon":!1}},[r("a-table",{ref:"table",attrs:{rowKey:"id",size:"middle",bordered:"",columns:t.columns,dataSource:t.dataSource,pagination:!1}})],1):t._e(),t.showModel?r("content-view",{attrs:{title:"审批结果","show-icon":!1}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.projInfo,disabled:!1,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批结果")])]),r("a-col",{attrs:{span:20,"data-prop":"flag"}},[r("j-dict-radio-button",{attrs:{disabled:!t.disabled,options:t.option},on:{change:t.onChange},model:{value:t.projInfo.flag,callback:function(e){t.$set(t.projInfo,"flag",e)},expression:"projInfo.flag"}})],1),r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批意见")])]),r("a-col",{attrs:{span:20,"data-prop":"comment"}},[r("a-textarea",{attrs:{disabled:!t.disabled,autoSize:{minRows:5,maxRows:8}},model:{value:t.projInfo.comment,callback:function(e){t.$set(t.projInfo,"comment",e)},expression:"projInfo.comment"}},[t._v(">")])],1)],1)],1)],1):t._e(),t.disabled&&t.showModel?r("a-row",{},[r("a-button",{staticStyle:{margin:"10px auto",display:"block"},attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确定")])],1):t._e(),t.previewVisible?r("div",{staticClass:"outer_box"},[r("preview-picture",{ref:"previewPicture",attrs:{fileNum:0,fileList:t.previewFileList},on:{cancel:function(e){t.previewVisible=!1}}})],1):t._e()],1)},o=[],a=r("3ed7"),i=r("7d9a"),s=r("0fea"),l=r("6ff6"),c=r("4aae"),u=r("d8a5"),d=r("b7a8"),f=r("dc9a"),h=r("f32b"),p=r("0a5e"),m=r("c695"),v=r.n(m);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function y(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */y=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function b(){}function w(){}function x(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=x.prototype=b.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==g(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(g(e)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function b(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function w(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){b(a,n,o,i,s,"next",t)}function s(t){b(a,n,o,i,s,"throw",t)}i(void 0)}))}}var x={name:"SerProjectReviewInsure",components:{ContentView:f["default"],PreviewPicture:d["default"],JDictRadioButton:i["default"],SerCostReModal:l["default"],AmountInput:c["default"]},inject:{projMainData:{default:null},closeCurrent:{}},mixins:[p["a"]],created:function(){this.projMainData&&this.initData()},data:function(){var t=this;return{insuranceType:[],projInfo:{},hisTaskInst:[],chCostList:[],disabled:!0,url:{queryProActHiTaskinst:"/use/serviceProj/queryProActHiTaskinst",getProjCostType:"/use/fundProgress/getProjInsureFund/",costList:"/use/serviceCost/getProAndCost",auditPro:"/use/serviceProj/serPoAudit",queryProInfoById:"/use/serviceProj/queryProInfoById",getReqById:"/use/serviceProj/getReqById/",getInusreList:"/use/serviceProj/getInusreList/",loadTreeData:"/sys/category/buildTree"},rules:{comment:[{required:!0,message:"请输入意见描述",trigger:"change"}],flag:[{required:!0,message:"请勾选审批意见",trigger:"change"}]},insureRules:{insureCode:[{required:!0,message:"请输入保单号",trigger:"change"}]},processImg:"",previewVisible:!1,columns:[{title:"序号",dataIndex:"",key:"rowIndex",width:50,align:"center",customRender:function(t,e,r){return parseInt(r)+1}},{title:"任务名称",align:"center",width:160,dataIndex:"name",ellipsis:!0},{title:"处理人",align:"center",dataIndex:"assigneeName",ellipsis:!0,customRender:function(t,e){return t||e.assignee}},{title:"耗时",align:"center",width:110,dataIndex:"duration",customRender:function(t,e){var r=e.duration,n="";if(null!=r){var o=Math.floor(r/864e5);0!==o&&(n+=o+"天");var a=r%864e5,i=Math.floor(a/36e5);0!==i&&(n+=i+"小时");var s=a%36e5,l=Math.floor(s/6e4);if(0!==l&&(n+=l+"分"),!n){var c=Math.round(s%6e4/1e3);n+=c+"秒"}}return n}},{title:"开始时间",align:"center",width:160,dataIndex:"startTime"},{title:"结束时间",align:"center",width:160,dataIndex:"endTime"},{title:"审批结果",align:"center",dataIndex:"taskFlow",width:80,customRender:function(t){return"1"==t?"通过":"0"==t?"未通过":t}},{title:"审批意见",align:"center",dataIndex:"comment"}],fundColumns:[{title:"保险描述",align:"left",headerAlign:"center",field:"describe",direction:"rtl"},{title:"险种",align:"center",headerAlign:"center",field:"insureSureDetail"},{title:"保费总金额",align:"right",headerAlign:"center",formatter:"amount",field:"insureCost"},{title:"申请总资金",align:"right",headerAlign:"center",formatter:"amount",field:"budgetCost"}],fundColumnsChild:[{title:"拨付时间",align:"left",field:"payDate"},{title:"保费金额",align:"right",field:"insureCost",formatter:"amount"},{title:"申请资金",align:"right",field:"cost",formatter:"amount"}],loadData:function(){return Object(s["j"])(t.getProjCostType).then((function(e){return t.selectedRows=[],t.tabData=e.result,t.tabData}))},dataSource:[],pageLoading:!1,showModel:!0,formKey:"",getProjCostType:"",option:[{label:"同意",value:"1"},{label:"不同意",value:"3"},{label:"打回",value:"0"}]}},computed:{previewFileList:function(){return{showList:[{originalImage:this.processImg,name:"项目流程"}]}}},methods:{getTreeData:function(){var t=this;Object(s["e"])(this.url.loadTreeData,{code:"insure_type"}).then((function(e){e.success&&e.result.length>0&&(t.insuranceType=e.result[0].children)}))},initData:function(){var t=w(y().mark((function t(e,r){var n,o,a,i=this;return y().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=8;break}return this.showModel=!1,o=r.businessKey.split(".")[r.businessKey.split(".").length-1],a=this.url.getReqById+o,t.next=6,Object(s["e"])(a).then((function(t){n=t.result.id}));case 6:t.next=9;break;case 8:n=this.projMainData().id;case 9:Object(s["j"])(this.url.queryProInfoById+"/"+n).then((function(t){t.success&&(i.projInfo=Object.assign({},t.result),i.projInfo.marginPer&&0!=i.projInfo.marginPer.length&&0!=i.projInfo.marginPer||Object(u["e"])("margin_ratio").then((function(t){i.projInfo.marginPer=t})),t.result["reqCode"]&&Object(s["e"])("/act/taskinst/history/task/b_busi_req.project_filing."+t.result["reqCode"],{}).then((function(t){t.success?i.dataSource=t.result:i.$message.error("查询审批历史记录发生错误！")})),i.disabled="8"==i.projInfo.state,Object(s["j"])(i.url.queryProActHiTaskinst+"/"+i.projInfo.reqNo+"/20/202A").then((function(t){t.success&&(i.hisTaskInst=t.result,i.formKey=i.hisTaskInst[i.hisTaskInst.length-1].formKey,-1!==i.formKey.indexOf("break")&&i.option.pop())})))})),Object(s["j"])(this.url.costList+"/"+n).then((function(t){t.success&&(i.chCostList=t.result)})),this.getProjCostType=this.url.getProjCostType+n,this.$nextTick((function(){i.$refs.fundTable.loadData()}));case 13:case"end":return t.stop()}}),t,this)})));function e(e,r){return t.apply(this,arguments)}return e}(),onChange:function(t){t&&(this.projInfo.flag=t,1===this.projInfo.flag||"1"===this.projInfo.flag?this.projInfo.comment="同意":3===this.projInfo.flag||"3"===this.projInfo.flag?this.projInfo.comment="不同意":0!==this.projInfo.flag&&"0"!==this.projInfo.flag||(this.projInfo.comment="打回"))},checkData:function(){var t=this.$refs.baseMsg.validaRowMsg(this.$refs.houseInfo),e=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow);return t.valida&&e.valida},saveCostInfo:function(t){this.chCostList=t,this.projInfo.contractCost=t.reduce((function(t,e){return t+Number(e.cost||0)}),0)},handleOk:function(){var t=this;return this.pageLoading=!0,new Promise((function(e,r){if(t.checkData()||1!=t.projInfo.flag){var n=t;n.projInfo.disabled=!0;var o=[],a=[];n.chCostList.forEach((function(t){t.children?a.push.apply(a,JSON.parse(JSON.stringify(t.children))):a.push(t)})),n.projInfo.children&&n.projInfo.children.length>0?o.push.apply(o,JSON.parse(JSON.stringify(n.projInfo.children))):o.push(JSON.parse(JSON.stringify(n.projInfo))),o.forEach((function(t){var e=a.filter((function(e){return e.projId===t.id}));t.marginFlag=n.projInfo.marginFlag,t.marginPer=n.projInfo.marginPer,t.costs=e})),Object(s["j"])(n.url.auditPro,{children:o,taskIds:n.projInfo.taskId,marginFlag:n.projInfo.marginFlag,marginPer:n.projInfo.marginPer,flag:n.projInfo.flag,contractCost:n.projInfo.contractCost,flowOpinion:n.projInfo.comment,reviewFlag:n.showModel,insureCode:n.projInfo.insureCode,baseType:n.projInfo.baseType}).then((function(o){o.success?(n.$message.success(o.result),n.showModel&&(n.$emit("ok"),t.closeCurrent()),e("")):(n.$message.warning(o.message),r(new h["default"]("")),t.closeCurrent())})).finally((function(){t.pageLoading=!1}))}else t.pageLoading=!1}))},setRowStyle:function(t){var e=t.row,r=["rgb(242 242 252)","rgb(243,255,243)","#f3faff","rgb(255,243,243)","rgb(255,255,243)"],n="";switch(e.baseType){case"02":n=r[0];break;case"03":n=r[1];break;case"04":n=r[2];break;case"05":n=r[3];break;case"06":n=r[4];break;default:}return{backgroundColor:n}},queryPage:function(){this.$refs.fundTable.refresh(),this.projMainData().state=2},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:4}:e<4?{colspan:0}:void 0},loadContentMethod:function(t){var e=t.row,r=this.url.getInusreList+e.id;return new Promise((function(t){Object(s["e"])(r).then((function(r){if(r.success){var n=r.result;e.detailList=n}t()}))}))},footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";if(["budgetCost","insureCost"].includes(t.property)){var n={style:"decimal",currency:"CNY",minimumFractionDigits:2,maximumFractionDigits:2};return["quantity","totalNum"].includes(t.property)?Number(v.a.sum(r,t.property)):Number(v.a.sum(r,t.property)).toLocaleString("zh-CN",n)}}))]}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(a["g"])(t):"0.00"}}},j=x,I=(r("6412"),r("2877")),C=Object(I["a"])(j,n,o,!1,null,"1c3766b8",null);e["default"]=C.exports},"1f7e":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a-card",{staticStyle:{height:"100%"},attrs:{bordered:!1,"body-style":{height:"100%"}}},[r("div",{staticStyle:{height:"99%"}},[r("vxe-grid",{ref:"costTable",attrs:{"row-config":{height:120},toolbar:!1,bordered:"",stripe:!0,data:t.tabData,columns:t.columnsChild,resizable:"",editConfigChild:{trigger:"click",mode:"cell",showStatus:!0},border:""},scopedSlots:t._u([{key:"stage",fn:function(e){var n=e.row;return[n.stage?r("span",[t._v("审核金额")]):t._e()]}},{key:"baseType",fn:function(e){var n=e.row;return[r("div",{staticStyle:{margin:"0 auto"}},[r("a-select",{on:{change:function(e){return t.handChange(n)}},model:{value:n.baseType,callback:function(e){t.$set(n,"baseType",e)},expression:"row.baseType"}},t._l(t.dictOptions,(function(e,n){return r("a-select-option",{key:n,attrs:{value:e.value,obj:e}},[r("span",{staticStyle:{display:"inline-block",width:"100%"},attrs:{title:e.text||e.label}},[t._v("\n                "+t._s(e.text||e.label)+"\n              ")])])})),1)],1)]}},{key:"cost",fn:function(e){var n=e.row;return[r("div",{staticStyle:{margin:"0 auto"}},[r("amount-input",{attrs:{placeholder:"请输入金额",addonAfter:"元"},model:{value:n.cost,callback:function(e){t.$set(n,"cost",e)},expression:"row.cost"}})],1)]}},{key:"chargeCorpName",fn:function(e){var n=e.row,o=e.rowIndex;return[r("a-input",{attrs:{readOnly:!0},on:{click:function(e){return t.chargeCorpFocusEvent(n,o)}},model:{value:n.chargeCorpName,callback:function(e){t.$set(n,"chargeCorpName",e)},expression:"row.chargeCorpName"}})]}},{key:"quoteCorpName",fn:function(e){var n=e.row,o=e.rowIndex;return[r("a-input",{attrs:{readOnly:!0},on:{click:function(e){return t.quoteCorpFocusEvent(n,o)}},model:{value:n.quoteCorpName,callback:function(e){t.$set(n,"quoteCorpName",e)},expression:"row.quoteCorpName"}})]}},{key:"action",fn:function(e){var n=e.row,o=e.rowIndex;return[r("a-icon",{staticStyle:{color:"#65c88d"},attrs:{type:"plus"},on:{click:function(e){return t.addCost(n)}}}),o>0&&"02"==n.stage?r("a-divider",{attrs:{type:"vertical"}}):t._e(),o>0&&"02"==n.stage?r("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return t.deleteCost(n,o)}}},[o>0&&"02"==n.stage?r("a-icon",{attrs:{type:"delete"}}):t._e()],1):t._e()]}}])})],1),r("choose-corp-comp",{ref:"cgc",attrs:{projId:t.projId},on:{getCorpInfo:t.getCorpInfo}})],1)},o=[],a=(r("6eb7"),r("0a5e")),i=r("eccd"),s=r("107e"),l=r("4aae"),c=r("d8a5"),u={name:"MaintenanceCostComp",mixins:[a["a"]],components:{JDDictSelectTag:i["default"],ChooseCorpComp:s["default"],AmountInput:l["default"]},props:{tabCostData:{type:Array,default:function(){return[]}}},data:function(){return{fileName:"MaintenanceCostComp",description:"MaintenanceCostComp维修费用维护表",dictOptions:[],costType:[],tabData:[],projId:"",dictObject:{},columnsChild:[{title:"费用类型",headerAlign:"center",field:"baseType",slots:{default:"baseType"},width:100},{title:"费用阶段",align:"center",headerAlign:"center",field:"stage",slots:{default:"stage"},minWidth:100},{title:"费用金额",align:"right",headerAlign:"center",field:"cost",slots:{default:"cost"},minWidth:150},{title:"收款单位",align:"left",headerAlign:"center",field:"chargeCorpName",minWidth:200,slots:{default:"chargeCorpName"}},{title:"操作",field:"action",align:"center",fixed:"right",minWidth:100,slots:{default:"action"}}],url:{list:"/use/serviceCost/getProAndCost"}}},created:function(){this.initDictConfig()},computed:{getValueSting:function(){return null!=this.value?this.value.toString():void 0}},methods:{initDictConfig:function(){var t=this;t.dictOptions.push({label:"请选择",value:""}),Object(c["g"])("proj_cost_type").then((function(e){e.result.forEach((function(e){var r={label:e.text,value:e.value};t.dictOptions.push(r),t.dictObject[e.value]=e.text}))}))},initData:function(t){this.tabData=[],this.projId=t,this.tabData=this.tabCostData},addCost:function(t){this.tabCostData.push({baseType:"",stage:"02",baseTypeText:"",cost:0,projId:t.projId,chargeCorpName:""})},deleteCost:function(t,e){this.tabCostData.length>0&&this.tabCostData.splice(e,1)},chargeCorpFocusEvent:function(t,e){var r=this;this.projId=t.projId,this.$nextTick((function(){r.$refs.cgc.init(r.projId,e,"chargeCorp")}))},quoteCorpFocusEvent:function(t,e){var r=this;this.projId=t.projId,this.$nextTick((function(){r.$refs.cgc.init(r.projId,e,"quoteCorp")}))},getCorpInfo:function(t){"chargeCorp"===t.chType&&(this.tabData[t.rowIndex].chargeCorpCode=t.code,this.tabData[t.rowIndex].chargeCorpName=t.name,this.tabData[t.rowIndex].chargeCorpPhone=t.phone,this.tabData[t.rowIndex].chargeCorpMan=t.linkMan)},handChange:function(t){t.baseTypeText=this.dictObject[t.baseType]}}},d=u,f=(r("c864"),r("2877")),h=Object(f["a"])(d,n,o,!1,null,"7091b2db",null);e["default"]=h.exports},"24e7":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a-card",{staticStyle:{height:"100%"},attrs:{bordered:!1,"body-style":{height:"100%",padding:"0"}}},[r("div",{staticStyle:{height:"99%"}},[r("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","show-overflow":"","class-name":"mytable-style","auto-resize":"",data:t.tabData,"tree-config":{children:"children",expandAll:!0},"valid-config":{message:"default"},"header-align":"center","footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":"","edit-config":!t.isDetail&&{trigger:"manual",mode:"row",showIcon:t.editFlag,autoClear:!0,showAsterisk:!1},"edit-rules":t.isDetail?{}:t.editRules},on:{"valid-error":t.validaError}},[r("vxe-table-column",{attrs:{"tree-node":"",width:"160px",field:"baseTypeText",title:"费用类别","edit-render":{autofocus:"myInput",type:t.isDetail||!t.editFlag?"default":"visible"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[n.editFlag?r("vxe-select",{staticStyle:{width:"100%"},attrs:{transfer:!0},on:{change:function(e){return t.costChangeEvent(n)}},model:{value:n.baseType,callback:function(e){t.$set(n,"baseType",e)},expression:"row.baseType"}},t._l(t.dictOptions,(function(e,n){return r("vxe-option",{key:n,attrs:{disabled:!!t.tabData.find((function(t){return t.baseType===e.value})),value:e.value,label:e.text||e.label}})})),1):r("span",[t._v(t._s(n.baseTypeText))])]}}])}),r("vxe-table-column",{attrs:{align:"left",title:"项目描述",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n          "+t._s(r.childFlag?r.describe:t.projMainData?t.projMainData().describe:"")+"\n        ")]}}])}),r("vxe-table-column",{attrs:{align:"right",width:"150px",field:"originalCost",title:"预算金额（元）",formatter:t.formatterNum},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(t.formatterNum({cellValue:n.originalCost})))])]}}])}),r("vxe-table-column",{attrs:{align:"right",width:"180px",field:"cost",title:"审核金额(元)","edit-render":t.isDetail?null:{autofocus:"myInput",type:t.isDetail||!t.editFlag?"default":"visible"},formatter:t.formatterNum},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row,o=e.column;return[r("div",{staticStyle:{margin:"0 auto"}},["01"==n.baseType&&Number(n.cost)>2e4?r("div",{staticClass:"warning"},[t._v("当前金额大于20000")]):"01"==n.baseType&&Number(n.cost||0)>Number(n.originalCost||0)+Number(.1*(n.originalCost||0))?r("div",{staticClass:"warning"},[t._v("当前金额超过预算金额的10%")]):t._e(),n.children&&0!=n.children.length?r("span",[t._v(t._s(t.formatterNum({cellValue:n.cost})))]):r("amount-input",{attrs:{placeholder:"请输入金额",addonAfter:"元"},on:{change:function(e){return t.getTotaltAmount(n,o)}},model:{value:n.cost,callback:function(e){t.$set(n,"cost",e)},expression:"row.cost"}})],1)]}}])}),t.projMainData()&&"02"==t.projMainData().baseType&&t.marginFlag?r("vxe-table-column",{attrs:{align:"right",width:"150px",field:"marginFee",title:"质保金金额（元）",formatter:t.formatterNum},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(t.calculateAmount(n)))])]}}],null,!1,509601763)}):t._e(),t.projMainData()&&"02"==t.projMainData().baseType&&t.marginFlag?r("vxe-table-column",{attrs:{align:"right",width:"160px",field:"amountNoMargin",title:"扣除质保金金额（元）",formatter:t.formatterNum},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s(t.amountNomarginPer(n)))])]}}],null,!1,2140035615)}):t._e(),r("vxe-table-column",{attrs:{field:"chargeCorpName",title:"收款单位","min-width":"220px",formatter:function(t){var e=t.row;return e.chargeCorpName},"edit-render":t.isDetail?null:{autofocus:"myInput",type:t.isDetail||!t.editFlag?"default":"visible"}},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n          "+t._s(r.chargeCorpName)+"\n        ")]}},{key:"edit",fn:function(e){var n=e.row;e.column,e.rowIndex;return[n.childFlag?r("span",[t._v(t._s(n.chargeCorpName))]):[r("input-search-modal",{attrs:{width:"100%",disabled:!n.baseType,placeholder:"请选择收款单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"name",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:t.getCorpTypeCode(n.baseType),extraFlag:"1"},"is-custom-modal":!1},on:{change:function(e,r){return t.getCorpInfo(n,r)}},scopedSlots:t._u([{key:"button",fn:function(){return[r("a-button",{attrs:{disabled:!n.baseType}},[t._v("选择单位")])]},proxy:!0}],null,!0),model:{value:n.chargeCorpName,callback:function(e){t.$set(n,"chargeCorpName",e)},expression:"row.chargeCorpName"}})]]}}])}),t.editFlag&&!t.isDetail?r("vxe-table-column",{attrs:{fixed:"right",align:"center",title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("a-space",[n.editFlag||!n.children||0==n.children.length?[t.$refs.xTable.isActiveByRow(n)?r("a-icon",{attrs:{type:"save"},on:{click:function(e){return t.saveRow(n)}}}):r("a-icon",{attrs:{type:"edit"},on:{click:function(e){return t.editRow(n)}}})]:t._e(),n.childFlag?t._e():r("a-icon",{attrs:{type:"plus"},on:{click:t.insertEvent}}),n.childFlag||"01"===n.baseType?t._e():r("a-popconfirm",{attrs:{title:"\n              确定删除吗?"},on:{confirm:function(){return t.deleteCost(n)}}},[r("a-icon",{staticStyle:{cursor:"pointer"},attrs:{type:"delete"}})],1)],2)]}}],null,!1,792707207)}):t._e()],1)],1)])},o=[],a=(r("6eb7"),r("0a5e")),i=r("eccd"),s=r("3ed7"),l=r("107e"),c=r("4aae"),u=r("d8a5"),d=r("da39"),f=r("aa2d");function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",m="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=x.prototype=b.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==h(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===y)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?g:m,c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=g,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(h(e)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function m(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){m(a,n,o,i,s,"next",t)}function s(t){m(a,n,o,i,s,"throw",t)}i(void 0)}))}}var g={name:"SerCostReview",mixins:[a["a"],d["FooterMethod"]],components:{InputSearchModal:f["default"],JDDictSelectTag:i["default"],ChooseCorpComp:l["default"],AmountInput:c["default"]},inject:{projMainData:{default:null}},props:{editFlag:{type:Boolean,default:!1},isDetail:{type:Boolean,default:!1},marginFlag:{type:Boolean,default:!1},marginPer:{type:Number,default:0}},data:function(){return{fileName:"SerCostReview",description:"SerCostReview审核费用表",dictOptions:[],costType:[],tabData:[],projId:"",editRules:{cost:[{required:!0,message:"请输入审核金额！",trigger:"change"},{validator:this.costVali}],chargeCorpName:[{validator:this.chargeGropNmaeVali,trigger:"change"}],baseTypeText:[{required:!0,message:"请选择费用类型！",trigger:"change"}]},columns:[{title:"单位名称",align:"left",field:"name"},{title:"地址",align:"left",field:"address"},{title:"联系人",align:"center",field:"linkMan"}]}},created:function(){this.initDictConfig()},computed:{getValueSting:function(){return null!=this.value?this.value.toString():void 0}},methods:{getCorpTypeCode:function(t){var e=[{value:"construction",label:"工程款",type:"01",corpType:"03"},{value:"priceReview",label:"审价费",type:"02",corpType:"06"},{value:"supervisor",label:"监理费",type:"03",corpType:"05"},{value:"biddingCost",label:"招标费",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测费",type:"05",corpType:"08"},{value:"makeCost",label:"造价费",type:"06",corpType:"09"}];try{return e.find((function(e){return e.type===t})).corpType}catch(r){return""}},save:function(){this.$emit("ok")},initDictConfig:function(){var t=this;t.dictOptions.push({label:"请选择",value:""}),Object(u["g"])("proj_cost_type").then((function(e){e.result.forEach((function(e){var r={label:e.text,value:e.value,disabled:t.tabData.some((function(t){return t.baseType===e.value}))};t.dictOptions.push(r)})),t.dictOptions=t.dictOptions.filter((function(t){return"07"!==t.value}))}))},checkData:function(){var t=v(p().mark((function t(){var e;return p().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=!0,t.next=3,this.$refs.xTable.validate((function(t){t&&(e=!1)}));case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),validError:function(){var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){t.$refs.xTable.clearValidate()}),2e3)},chargeCorpFocusEvent:function(t){var e=this;this.$nextTick((function(){e.$refs.cgc.init(t.id,"chargeCorp",t.baseType)}))},calculateAmount:function(t){return"01"===t.baseType?(t.cost*this.marginPer/100).toFixed(2):0},amountNomarginPer:function(t){return"01"===t.baseType?(t.cost-t.cost*this.marginPer/100).toFixed(2):t.cost},getCorpInfo:function(t,e){t.chargeCorpCode=e?e.code:"",t.chargeCorpName=e?e.name:"",t.chargeCorpPhone=e?e.phone:"",t.chargeCorpMan=e?e.linkMan:"",t.children&&t.children.length>0&&t.children.forEach((function(t){t.chargeCorpCode=e?e.code:"",t.chargeCorpName=e?e.name:"",t.chargeCorpPhone=e?e.phone:"",t.chargeCorpMan=e?e.linkMan:""}))},updateCostList:function(){var t=this;this.dictOptions.forEach((function(e){e.value&&(e.disabled=t.tabData.some((function(t){return t.baseType===e.value})))}))},costChangeEvent:function(t){var e=this;this.dictOptions.forEach((function(r){r.value&&(r.value===t.baseType&&(t.baseTypeText=r.label,t.children&&t.children.forEach((function(t){t.baseType=r.value,t.baseTypeText=r.label,t.describe=t.proName+r.label}))),r.disabled=e.tabData.some((function(t){return t.baseType===r.value})))})),this.$set(t,"chargeCorpName",""),this.getCorpInfo(t,void 0)},getTotaltAmount:function(t,e){this.tabData.forEach((function(e){e.id===t.costPid&&(e.cost=e.children.reduce((function(t,e){return t+Number(e.cost||0)}),0))})),this.$refs.xTable.updateStatus({row:t,column:e}),this.$refs.xTable.updateFooter()},chargeGropNmaeVali:function(t){var e=t.cellValue;t.row;if(!e||""==e)return Promise.reject(new Error("请选择收款单位！"))},costVali:function(t){var e=t.cellValue,r=t.row;if(!r.children||0===r.children.length){if(!e)return Promise.reject(new Error("请输入审核金额！"));try{if(isNaN(e))return Promise.reject(new Error("请输入正确的金额！"))}catch(n){return Promise.reject(new Error("请输入正确的金额！"))}if(0==Number(e))return Promise.reject(new Error("金额不能为0！"));if(Number(e)<0)return Promise.reject(new Error("金额应大于0！"))}},insertEvent:function(){var t=this,e=Object.assign({},this.tabData[0]);e&&(e.baseType="",e.baseTypeText="",e.cost=0,e.stage="02",e.editFlag=!0,e.addFlag=!0,e.originalCost=0,e.chargeCorpName="",e.chargeCorpCode="",e.id=this.guid(),e.children&&(e.children=[],this.tabData[0].children.forEach((function(r){var n={};n.projId=r.projId,n.proName=r.proName,n.baseType="",n.baseTypeText="",n.addFlag=!0,n.cost=0,n.stage="02",n.originalCost=0,n.chargeCorpCode="",n.chargeCorpName="",n.chargeCorpPhone="",n.chargeCorpMan="",n.childFlag=!0,n.costPid=e.id,n.describe="",n.id=t.guid(),e.children.push(n)})))),delete e._XID,this.tabData.push(e),this.$refs.xTable.setTreeExpand(this.tabData[this.tabData.length-1],!0),this.$nextTick((function(){t.editRow(e)}))},deleteCost:function(t){this.dictOptions.forEach((function(e){e.value===t.baseType&&(e.disabled=!1)}));var e=this.tabData.findIndex((function(e){return e.id===t.id}));this.tabData.splice(e,1)},getCostData:function(){return this.tabData},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,r="x"===t?e:3&e|8;return r.toString(16)}))},formatterNum:function(t){var e=t.cellValue;return e&&""!==e&&"undefined"!==e?Object(s["g"])(e):"0.00"},editRow:function(t){this.$refs.xTable.setActiveRow(t)},saveRow:function(t){var e=this;this.$refs.xTable.validate(t,(function(t){t||e.$refs.xTable.clearActived()}))},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:1}:e<1?{colspan:0}:void 0},footerCellStyle:function(t){var e=t.$rowIndex,r=(t.column,t.columnIndex),n="text-align:right";return 0===e&&0===r||1===r||2===r?n:void 0},validaError:function(){this.$emit("validErr")}}},y=g,b=(r("dd4b"),r("2877")),w=Object(b["a"])(y,n,o,!1,null,"1ce9b8c1",null);e["default"]=w.exports},"28e8":function(t,e,r){"use strict";r("6181")},"2a78":function(t,e,r){},"2b07":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"padding12-16"},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("项目类型："),r("j-d-dict-select-tag",{attrs:{disabled:t.isDetail,type:"radioButton",dictCode:"project_type"},on:{change:t.changeBaseType},model:{value:t.model.baseType,callback:function(e){t.$set(t.model,"baseType",e)},expression:"model.baseType"}})],1),r("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[r("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle",attrs:{"aria-label":"1"}},[t._v("\n          "+t._s(t.headerTitle)+"\n        ")])]},proxy:!0}])},[r("div",{staticClass:"flexCenter",attrs:{slot:"extra"},on:{click:function(t){t.stopPropagation()}},slot:"extra"},[t._v("\n        分摊方式："),r("j-d-dict-select-tag",{attrs:{disabled:t.isDetail,type:"radioButton",dictCode:"allocation_method"},on:{change:t.changeAllotMode},model:{value:t.model.allotMode,callback:function(e){t.$set(t.model,"allotMode",e)},expression:"model.allotMode"}})],1),r("div",{staticStyle:{width:"100%",margin:"0 auto"}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.model,disabled:t.isDetail,border:!0}},[r("a-row",{ref:"formOwnRow",staticClass:"baseInfo formRow",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{staticClass:"formRowLabel",attrs:{span:2}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("物业区域名称\n            ")]),r("a-col",{attrs:{span:22,"data-prop":"regionCode"}},[r("j-dict-region-list-select",{attrs:{disabled:t.isDetail},on:{change:t.regionChange},model:{value:t.model.regionCode,callback:function(e){t.$set(t.model,"regionCode",e)},expression:"model.regionCode"}})],1),t.showItem&&"false"!==t.showItem?r("a-col",{staticClass:"formRowLabel",attrs:{span:2}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("选择损坏区域\n            ")]):t._e(),t.showItem&&"false"!==t.showItem?r("a-col",{attrs:{span:22,"data-prop":"regionCode"}},[r("project-child-detail-comp",{ref:"dhildProj",attrs:{showTitle:!1,"proj-id":this.$route_query.id,"region-code":t.model.regionCode,isDetail:t.isDetail}})],1):t._e(),r("a-col",{staticClass:"formRowLabel",attrs:{span:2}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("维修项目描述\n            ")]),r("a-col",{attrs:{span:22,"data-prop":"describe"}},[r("a-input",{attrs:{placeholder:"请输入维修项目名称"},model:{value:t.model.describe,callback:function(e){t.$set(t.model,"describe",e)},expression:"model.describe"}})],1),r("a-col",{staticClass:"formRowLabel",attrs:{span:2}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("联系人\n            ")]),r("a-col",{attrs:{span:10,"data-prop":"reqMan"}},[r("a-input",{attrs:{placeholder:"请输入申报单位联系人"},model:{value:t.model.reqMan,callback:function(e){t.$set(t.model,"reqMan",e)},expression:"model.reqMan"}})],1),r("a-col",{staticClass:"formRowLabel",attrs:{span:2}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("联系电话\n            ")]),r("a-col",{attrs:{span:10,"data-prop":"reqPhone"}},[r("a-input",{attrs:{placeholder:"请输入申报单位联系电话"},model:{value:t.model.reqPhone,callback:function(e){t.$set(t.model,"reqPhone",e)},expression:"model.reqPhone"}})],1)],1)],1)],1)])],1)],1)},o=[],a=r("eccd"),i=r("ed2c"),s=r("bd83"),l=r("fdce"),c=r("3269"),u=r("eb36"),d=r("b7a8"),f=r("d8a5");function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",m="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=x.prototype=b.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==h(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===y)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?g:m,c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=g,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(h(e)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function m(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){m(a,n,o,i,s,"next",t)}function s(t){m(a,n,o,i,s,"throw",t)}i(void 0)}))}}var g={name:"ProjectComp",components:{EditDiv:s["default"],JDictBankListSelect:c["default"],JDictRegionListSelect:l["default"],ProjectChildDetailComp:i["default"],JDDictSelectTag:a["default"],PreviewPicture:d["default"]},mixins:[u["a"]],props:{isDetail:{type:Boolean,default:!1}},inject:["projMainData"],computed:{projObj:function(){return this.projMainData()}},watch:{"model.selectTrees":function(t){this.setTableBySelectTree(t)}},provide:function(){var t=this;return{formModel:function(){return t.model},childProjList:function(){return t.projObj.children}}},created:function(){var t=this;Object(f["e"])("damaged_picture_ere_id").then((function(e){t.damagedPictureUrl=t.url.damagedPicture+e}))},data:function(){return{showItem:"true",headerTitle:"维修对象",activeKey:["1"],model:{baseType:"01",allotMode:"01",selectTrees:[],detailTableData:[]},rules:{regionCode:[{required:!0,message:"请输入物业区域名称",trigger:"change"}],describe:[{required:!0,message:"请输入维修项目描述"}],reqMan:[{required:!0,message:"请输入申报单位联系人",trigger:"change"}],reqPhone:[{required:!0,message:"请输入申报单位联系电话",trigger:"change"}],bidType:[{required:!0,message:"请选择招标方式",trigger:"change"}]},parentCode:"utility",headers:{},comSort:0,url:{fileUploadImg:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5",damagedPicture:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId="},damagedPictureUrl:""}},methods:{changeAllotMode:function(t){this.model.allotMode=t,this.model.children&&this.model.children.map((function(e){e.allotMode=t})),this.$forceUpdate()},changeBaseType:function(t){this.model.baseType=t,this.model.children&&this.model.children.map((function(e){e.baseType=t})),this.$forceUpdate()},onFileChange:function(t,e,r){this.projObj.damagedPictureList=this.getItemByName("受损图片或视频").fileList},checkData:function(){var t=this;return new Promise(function(){var e=v(p().mark((function e(r,n){var o,a;return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.$refs.dhildProj){e.next=11;break}if(o=t.$refs.formRow.validaRowMsg(t.$refs.formOwnRow),!o){e.next=10;break}return e.next=5,t.$refs.dhildProj.checkData();case 5:a=e.sent,a?t.model.children=a.data:n(),r(),e.next=11;break;case 10:n();case 11:r();case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())},uploadRequest:function(t){var e=new FormData;e.append("busiNo","111111111111"),e.append("busiType","20"),e.append("busiTypeDetail","202A"),e.append("erecordId","1526009038391398401"),e.append("orderNo",this.showList.length),e.append("parenPath","repairProj"),this.uploadFile(t,e)},initData:function(t){var e=[{name:"受损图片或视频",fileList:this.projObj.damagedPictureList&&this.projObj.damagedPictureList.length>0?this.projObj.damagedPictureList:[]}];this.initUploadFile(e),t&&(this.comSort=t),this.$refs.dhildProj&&this.$refs.dhildProj.initDevice(),this.projObj&&this.projObj.costs&&this.projObj.costs.length>0&&this.initDeviceChoosen(this.projObj.costs),this.model=this.projObj,this.model.children||this.$set(this.model,"children",[]),this.model.id||(this.model.baseType="01",this.model.allotMode="01")},initDeviceChoosen:function(t){for(var e=[],r=0;r<t.length;r++)for(var n=0;n<t[r].costLists.length;n++)t[r].costLists[n].partId&&t[r].costLists[n].partName&&e.push({key:t[r].costLists[n].partId,title:t[r].costLists[n].partName});this.model.selectTrees=e},showModal:function(){this.$refs.transferModal.showModal()},setTableBySelectTree:function(t){this.$bus.$emit("selectTress",this.model.selectTrees)},regionChange:function(t,e){this.model.regionId=e.id,this.model.regionName=e.name}}},y=g,b=(r("c216"),r("d06b"),r("2877")),w=Object(b["a"])(y,n,o,!1,null,"7d728c40",null);e["default"]=w.exports},"33a9":function(t,e,r){"use strict";r("9f3d")},3415:function(t,e,r){},"354a":function(t,e,r){},3673:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"connet"},[r("div",{staticClass:"editCompBtnDiv"},[!t.isDetail&&t.pageType?r("a-button",{attrs:{type:"primary"},on:{click:t.changeProj}},[t._v("开启编辑")]):t._e()],1),r("content-view",{key:"1",staticClass:"connetItem",attrs:{showIcon:!1,title:"基本信息"}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.serviceProInfo,disabled:t.editFlag,border:!t.editFlag,formRef:"formRow"}},[r("a-row",{ref:"formSerProRow",staticClass:"houseInfo bidNegotiationFormRow",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("保险描述")])]),r("a-col",{attrs:{span:12,"data-prop":"describe"}},[r("a-input",{model:{value:t.serviceProInfo.describe,callback:function(e){t.$set(t.serviceProInfo,"describe",e)},expression:"serviceProInfo.describe"}})],1),r("a-col",{attrs:{span:3}},[t._v("申报状态")]),r("a-col",{attrs:{span:6}},[r("ser-pro-model-state-comp",{attrs:{state:t.serviceProInfo.state}})],1),r("a-col",{attrs:{span:3}},[t._v("申请小区")]),r("a-col",{attrs:{span:6}},[t._v("\n          "+t._s(t.serviceProInfo.communityName)+"\n        ")]),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("保单开始时间")])]),t.isHasChild?t._e():r("a-col",{attrs:{span:3,"data-prop":"insureStartTime"}},[r("j-date",{attrs:{"max-date":t.serviceProInfo.insureEndTime},on:{change:t.insureStartDateChange},model:{value:t.serviceProInfo.insureStartTime,callback:function(e){t.$set(t.serviceProInfo,"insureStartTime",e)},expression:"serviceProInfo.insureStartTime"}})],1),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("保单结束时间")])]),t.isHasChild?t._e():r("a-col",{attrs:{span:6,"data-prop":"insureEndTime"}},[r("j-date",{attrs:{"min-date":t.serviceProInfo.insureStartTime},model:{value:t.serviceProInfo.insureEndTime,callback:function(e){t.$set(t.serviceProInfo,"insureEndTime",e)},expression:"serviceProInfo.insureEndTime"}})],1),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("险种")])]),t.isHasChild?t._e():r("a-col",{attrs:{span:6,"data-prop":"insureType"}},[r("a-select",{attrs:{placeholder:"请选择保险分类"},on:{change:t.selectInsureType},model:{value:t.serviceProInfo.insureType,callback:function(e){t.$set(t.serviceProInfo,"insureType",e)},expression:"serviceProInfo.insureType"}},t._l(t.insureOptions,(function(e){return r("a-select-option",{key:e.code,attrs:{dataInsureType:e,value:e.code}},[t._v("\n              "+t._s(e.name)+"\n            ")])})),1)],1),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("险种明细")])]),t.isHasChild?t._e():r("a-col",{attrs:{span:3,"data-prop":"insureTypeDetail"}},[r("a-select",{attrs:{placeholder:"请选择保险分类明细（险种）"},on:{change:t.selectInsureTypeDetail},model:{value:t.serviceProInfo.insureTypeDetail,callback:function(e){t.$set(t.serviceProInfo,"insureTypeDetail",e)},expression:"serviceProInfo.insureTypeDetail"}},t._l(t.insureDetailOptions,(function(e){return r("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v("\n              "+t._s(e.name)+"\n            ")])})),1)],1),r("a-col",{attrs:{span:3}},[t._v("项目类型 ")]),r("a-col",{attrs:{span:t.isHasChild?3:6}},[r("j-d-dict-select-tag",{attrs:{dictCode:"project_type",disabled:!0,placeholder:""},on:{change:function(e){return t.dictChange(e,"baseType")}},model:{value:t.serviceProInfo.baseType,callback:function(e){t.$set(t.serviceProInfo,"baseType",e)},expression:"serviceProInfo.baseType"}})],1),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[t._v("分摊范围")]),t.isHasChild?t._e():r("a-col",{attrs:{span:6}},[r("a",{staticStyle:{"flex-shrink":"0"},attrs:{disabled:!t.editFlag},on:{click:function(e){return t.showShared(t.serviceProInfo)}}},[t._v(t._s(t.serviceProInfo.sharedHousings?t.serviceProInfo.sharedHousings.length:0)+"户")]),t.editFlag?t._e():r("span",{staticClass:"tagButton margin_left_10 margin_right_10",on:{click:t.openFloorModal}},[t._v("修改分摊范围")])]),r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("分摊方式")])]),r("a-col",{attrs:{span:t.isHasChild?6:3,"data-prop":"allotMode"}},[r("j-d-dict-select-tag",{attrs:{dictCode:"allocation_method",disabled:t.editFlag||t.isChild},on:{change:t.changeAllotMode},model:{value:t.serviceProInfo.allotMode,callback:function(e){t.$set(t.serviceProInfo,"allotMode",e)},expression:"serviceProInfo.allotMode"}})],1),r("a-col",{attrs:{span:3}},[r("span",{class:{required:!t.editFlag}},[t._v("保险单位")])]),r("a-col",{attrs:{span:6,"data-prop":"chargeCorpCode"}},[r("div",{staticClass:"row_col_flexDiv"},[r("input-search-modal",{attrs:{readOnly:t.editFlag,width:"250px",placeholder:"请选择保险单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:"13"},"is-custom-modal":!1},on:{change:function(e,r){return t.afterChoose([r],e)}},scopedSlots:t._u([{key:"button",fn:function(){return[r("a-button",[t._v("选择单位")])]},proxy:!0}]),model:{value:t.serviceProInfo.chargeCorpCode,callback:function(e){t.$set(t.serviceProInfo,"chargeCorpCode",e)},expression:"serviceProInfo.chargeCorpCode"}})],1)]),t.isHasChild?t._e():r("a-col",{attrs:{span:3}},[t._v("保险方案")]),t.isHasChild?t._e():r("a-col",{attrs:{span:6}},[t.editFlag?r("a",{staticClass:"cellClass",on:{click:function(e){t.handlePreview(t.getItemByName("保险方案").showList[0],t.getItemByName("保险方案"))}}},[t._v("\n            "+t._s((t.model.projectInsureFile||{}).fileName)+"\n          ")]):r("div",{staticClass:"uploadFormModelItem width100"},[!t.getItemByName("保险方案").fileList||0===t.getItemByName("保险方案").fileList.length||t.getItemByName("保险方案").loading?[r("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.insureSchemeUrl,e,t.getItemByName("保险方案"))}},on:{change:function(e){return t.uploadChange(e,t.getItemByName("保险方案"))}}},[r("a-button",{attrs:{loading:t.getItemByName("保险方案").loading,icon:"upload"}},[t._v("上传保险方案")])],1),t.getItemByName("保险方案").loading?t._e():r("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])]:t._e(),t.getItemByName("保险方案").loading?r("a-progress",{attrs:{width:32,type:"circle",percent:t.getItemByName("保险方案").percent}}):t._e(),t.getItemByName("保险方案").fileList&&t.getItemByName("保险方案").fileList.length>0&&!t.getItemByName("保险方案").loading?r("div",{staticClass:"div_upload_show"},[r("a",{staticClass:"a_upload_fileName",staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:!0,href:t.getFirstFileByName("保险方案").filePath,title:t.getFirstFileByName("保险方案").originalName}},[t._v(t._s(t.getFirstFileByName("保险方案").originalName))]),r("a-button",{staticClass:"button_upload_delete",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("保险方案"))}}})],1):t._e()],2)]),t._l(t.serviceProInfo.costAndCorpList,(function(e,n){return t.isChild?[r("a-col",{key:"label"+n,attrs:{span:4}},[t._v(t._s(e.corpTypeText))]),r("a-col",{key:"value"+n,attrs:{span:4}},[r("a",{on:{click:function(r){return t.handleDetail(e.chargeCorpCode)}}},[t._v(t._s(e.chargeCorpName))])])]:t._e()}))],2)],1)],1),t.isHasChild?t._e():r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"保险信息"}},[r("insurance-info",{ref:"InsuranceInfo",attrs:{"date-range":[t.serviceProInfo.insureStartTime,t.serviceProInfo.insureEndTime],proInfo:t.proInfo,isChild:t.isChild,isDetail:t.editFlag},on:{costChange:t.onCostChange}})],1),t.isHasChild?r("content-view",{key:"3",staticClass:"connetItem",attrs:{showIcon:!1,title:"子项目"}},[r("child-insurance",{ref:"childPro",attrs:{zIndex:t.zIndex,allotMode:t.allotMode,proInfo:t.serviceProInfo,isDetail:t.isDetail},on:{setBgCost:t.setCostMsg}})],1):t._e(),r("div",{staticClass:"saveBtnDiv"},[!t.editFlag&&t.isChild?r("a-button",{attrs:{type:"primary"},on:{click:t.addChildProj}},[t._v("保存")]):t._e()],1),r("insurance-parts-tree-modal",{ref:"insurancePartsTreeModal",attrs:{insureType:t.serviceProInfo.insureType,choosePart:t.serviceProInfo.costLists,regionId:t.serviceProInfo.regionId},on:{"update:insureType":function(e){return t.$set(t.serviceProInfo,"insureType",e)},"update:insure-type":function(e){return t.$set(t.serviceProInfo,"insureType",e)},"update:choosePart":function(e){return t.$set(t.serviceProInfo,"costLists",e)},"update:choose-part":function(e){return t.$set(t.serviceProInfo,"costLists",e)},ok:t.partChooseOk}}),r("create-pro-floor-choose",{ref:"floorChoose",attrs:{apportionType:1},on:{ok:t.getHouseId}}),r("share-detail-comp",{ref:"shareDetail"}),r("mend-amount-modal",{ref:"mendList",attrs:{projInfo:t.serviceProInfo}}),t.previewVisible?r("div",{ref:"previewDiv",staticClass:"outer_box",style:{zIndex:t.zIndex+1}},[r("preview-picture",{attrs:{fileList:t.previewFileList,fileNum:t.previewNum},on:{cancel:t.exitPreview}})],1):t._e()],1)},o=[],a=r("eccd"),i=r("0fea"),s=r("3ed7"),l=r("be6c"),c=r("dc9a"),u=r("4da9"),d=r("fdce"),f=r("2a9b"),h=r("e7a5"),p=r("d8a5"),m=r("6d5b"),v=r("f6f3"),g=r("41e5"),y=r("cf9e"),b=r("a4ee"),w=r("aa2d"),x=r("6d33"),j=r("eb36"),I=r("b7a8");function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function _(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};c(w,i,(function(){return this}));var x=Object.getPrototypeOf,j=x&&x(x(O([])));j&&j!==r&&n.call(j,i)&&(w=j);var I=b.prototype=g.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==C(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(C(e)+" is not iterable")}return y.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(I),c(I,l,"Generator"),c(I,i,(function(){return this})),c(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function P(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function k(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){P(a,n,o,i,s,"next",t)}function s(t){P(a,n,o,i,s,"throw",t)}i(void 0)}))}}var L={name:"InsuranceProAuditInfoComp",components:{PreviewPicture:I["default"],InsurancePartsTreeModal:x["default"],InputSearchModal:w["default"],CascaderSelect:b["default"],SerProModelStateComp:y["default"],ChildInsurance:g["default"],MendAmountModal:v["default"],CreateProFloorChoose:h["default"],RepairPartsTreeModal:f["default"],JDictRegionListSelect:d["default"],CreateProModal:u["default"],ContentView:c["default"],InsuranceInfo:l["default"],JDDictSelectTag:a["default"],ShareDetailComp:m["default"]},mixins:[j["a"]],props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"维修项目信息"},projId:{type:String,default:""},proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},pageType:{type:Boolean,default:!0},zIndex:{type:Number,default:1e3}},inject:["projMainData"],created:function(){var t=this;Object(p["e"])("allot_mode").then((function(e){t.allotMode=e})),Object(p["e"])("construction_plan_ere_id").then((function(e){t.insureSchemeUrl=t.url.uploadPath+e})),this.initData(),Object(i["e"])(this.url.loadTreeData,{code:"insure_type"}).then((function(e){if(e.success&&(t.insureOptions=e.result[0].children,t.serviceProInfo.insureType)){var r=t.insureOptions.find((function(e){return e.code===t.serviceProInfo.insureType}));r&&(t.insureDetailOptions=r.children)}}))},computed:{model:{get:function(){return this.serviceProInfo},set:function(t){}}},data:function(){return{serviceProInfo:{},activeKey:[],expandKeys:["1","2","3"],url:{queryProj:"/use/serviceProj/queryProj",corpInfolist:"/use/serviceCost/corpList",queryMinProj:"/use/serviceProj/queryMinProj",addProj:"/use/serviceProj/addInsureProj",queryRegionByList:"/base/rtRegion/queryRegionByList",buildRenewal:"/use/projAllotList/buildRenewal",loadTreeData:"/sys/category/buildTree",checkInsureByRuid:"/use/serviceUtility/checkInsureByRuid",uploadPath:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId="},insureSchemeUrl:"",isChild:!1,panelStyle:"background: #fff",isHasChild:!1,editFlag:this.disabled,allotMode:0,lists:[],insurancePartsFlag:!1,insurancePartCloumns:[{field:"describe",title:"保险范围描述"}],partColumns:[{field:"partDesc",title:"标准维修项目",showOverflow:!0,formatter:function(t){var e=t.row;return e.remark.split("-").pop()}},{field:"describe",title:"维修描述",showOverflow:!0},{field:"unitPrice",title:"单价",width:80,align:"right",formatter:function(t){var e=t.cellValue;return Object(s["g"])(e)},slot:!0},{field:"quantity",title:"数量",width:70,align:"center"},{field:"totalPrice",title:"总价",width:80,align:"right",formatter:function(t){var e=t.cellValue;return Object(s["g"])(e)}},{field:"remark",title:"备注",showOverflow:!0}],insureOptions:[],insureDetailOptions:[],costTypeMenu:[{value:"construction",label:"工程款",type:"01"},{value:"priceReview",label:"审价费",type:"02"},{value:"supervisor",label:"监理费",type:"03"},{value:"biddingCost",label:"招标费",type:"04"},{value:"inspectionCost",label:"检测费",type:"05"},{value:"makeCost",label:"造价费",type:"06"}],columns:[{title:"单位名称",align:"left",field:"name"},{title:"地址",align:"left",field:"address"},{title:"联系人",align:"center",field:"linkMan"}],rules:{describe:[{required:!0,message:"请输入保险描述"}],insureStartTime:[{required:!0,message:"请选择开始时间"}],insureEndTime:[{required:!0,message:"请选择结束时间"}],insureTypeDetail:[{required:!0,message:"请选择选中"}],chargeCorpCode:[{required:!0,message:"请选择保险单位"}],allotMode:[{required:!0,message:"请选择分摊方式"}]}}},methods:{onFileChange:function(){var t=this.getFirstFileByName("保险方案");this.$set(this.isChild?this.proInfo:this.projMainData(),"projectInsureFile",t&&Object.keys(t).length>0?t:void 0)},afterChoose:function(t,e){this.isChild?(this.proInfo.insureCostMsg||this.$set(this.proInfo,"insureCostMsg",{}),t&&t[0]?(this.proInfo.insureCostMsg.projId=this.proInfo.id,this.proInfo.insureCostMsg.costType="07",this.proInfo.insureCostMsg.chargeCorpCode=t[0].code,this.proInfo.insureCostMsg.chargeCorpMan=t[0].linkMan,this.proInfo.insureCostMsg.chargeCorpPhone=t[0].phone,this.proInfo.insureCostMsg.describe=this.proInfo.describe+"保险总费用"):this.$set(this.proInfo,"insureCostMsg",{})):(this.projMainData().insureCostMsg||this.$set(this.projMainData(),"insureCostMsg",{}),t&&t[0]?(this.projMainData().insureCostMsg.projId=this.projMainData().id,this.projMainData().insureCostMsg.costType="07",this.projMainData().insureCostMsg.chargeCorpCode=t[0].code,this.projMainData().insureCostMsg.chargeCorpMan=t[0].linkMan,this.projMainData().insureCostMsg.chargeCorpPhone=t[0].phone,this.projMainData().insureCostMsg.describe=this.projMainData().describe+"保险总费用"):this.$set(this.projMainData(),"insureCostMsg",{})),this.serviceProInfo.insureCostMsg.chargeCorpCode=e},onCostChange:function(t){var e=0,r=0;t&&t.length>0&&t.map((function(t){e=Number(e)+Number(t.insureCost),r=Number(r)+Number(t.cost)})),this.isChild?(this.proInfo.budgetCost=r,this.proInfo.insureCost=e):(this.projMainData().budgetCost=r,this.projMainData().insureCost=e)},initData:function(){var t=this;if(null===this.proInfo){if(this.serviceProInfo=this.projMainData(),this.serviceProInfo.insureType){var e=this.insureOptions.find((function(e){return e.code===t.serviceProInfo.insureType}));e&&(this.insureDetailOptions=e.children)}this.setCostMsg(),0==this.serviceProInfo.isHasChild&&(this.isChild=!1,this.isHasChild=!1)}else this.serviceProInfo=this.proInfo,this.isChild=!0,this.isHasChild=!1;this.serviceProInfo.chargeCorpCode=this.serviceProInfo.insureCostMsg.chargeCorpCode;var r=[{name:"保险方案",fileList:this.model.projectInsureFile?[this.model.projectInsureFile]:[]}];this.initUploadFile(r)},setCostMsg:function(){var t=this;this.serviceProInfo.isHasChild,this.$nextTick((function(){1==t.serviceProInfo.isHasChild&&t.$set(t,"isHasChild",!0)}))},handleDetail:function(t){var e=this;Object(i["e"])(this.url.corpInfolist,{code:t}).then((function(t){if(t.result){var r=t.result.records[0];e.$refs.detailForm.show(r),e.$refs.detailForm.title=r.name+" ("+r.baseType_dictText+") "}}))},unitChoose:function(t,e){var r=e.value;this.projMainData()[r]||this.$set(this.projMainData(),r,{}),this.projMainData()[r].projId=this.projMainData().id,this.projMainData()[r].chargeCorpCode=t[0].code,this.projMainData()[r].chargeCorpMan=t[0].linkMan,this.projMainData()[r].stage="01",this.projMainData()[r].baseType=e.type,this.projMainData()[r].chargeCorpPhone=t[0].phone,this.projMainData()[r].describe=this.projMainData().describe+e.label,!this.isChild&&this.isHasChild&&this.$refs.childPro.unitChoose(e)},setChooseAmount:function(t,e){var r=e.value;this.isChild?this.$set(this.proInfo[r],"cost",t||0):(this.projMainData()[r]||this.$set(this.projMainData(),r,{}),this.$set(this.projMainData()[r],"cost",t||0),this.isHasChild&&this.$refs.childPro.setChooseAmount(e)),this.setBgCost()},setBgCost:function(){this.projMainData().budgetCost=Number(this.projMainData().construction.cost)+Number(this.projMainData().priceReview&&this.projMainData().priceReview.cost?this.projMainData().priceReview.cost:0)+Number(this.projMainData().supervisor&&this.projMainData().supervisor.cost?this.projMainData().supervisor.cost:0)+Number(this.projMainData().biddingCost&&this.projMainData().biddingCost.cost?this.projMainData().biddingCost.cost:0)+Number(this.projMainData().inspectionCost&&this.projMainData().inspectionCost.cost?this.projMainData().inspectionCost.cost:0)+Number(this.projMainData().makeCost&&this.projMainData().makeCost.cost?this.projMainData().makeCost.cost:0)},delCost:function(t,e){var r;t&&(r=t.value);var n=this.projMainData()[r].cost;this.projMainData()[r]=null,this.isHasChild&&this.$refs.childPro.delCost(r),e&&this.setChooseAmount(n,e)},checkData:function(){var t=this,e=!0;return new Promise(function(){var r=k(_().mark((function r(n,o){return _().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.editFlag){r.next=7;break}if(r.t0=e,!r.t0){r.next=6;break}return r.next=5,t.$refs.formRow.validaRowMsg(t.$refs.formSerProRow);case 5:r.t0=r.sent.valida;case 6:e=r.t0;case 7:if(!e||t.isHasChild){r.next=16;break}if(r.t1=e,!r.t1){r.next=13;break}return r.next=12,t.$refs.InsuranceInfo.checkData();case 12:r.t1=r.sent;case 13:e=r.t1,r.next=25;break;case 16:if(!e||!t.isHasChild){r.next=25;break}return r.prev=17,r.next=20,t.$refs.childPro.checkData();case 20:r.next=25;break;case 22:r.prev=22,r.t2=r["catch"](17),e=!1;case 25:e?n():o(new Error("校验失败"));case 26:case"end":return r.stop()}}),r,null,[[17,22]])})));return function(t,e){return r.apply(this,arguments)}}())},changeProj:function(){var t=this;this.$confirm({title:"注意",content:"开启编辑后变更的数据将无法撤销，且编辑完成后点击保存将覆盖原数据，是否开启编辑",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){var e;t.editFlag=!1,e=t.isChild?t.proInfo:t.projMainData(),e.costLists.forEach((function(t){t.id=null}))}})},regionChange:function(t,e){this.regionInfo=e,this.initDevice(t)},editCostLists:function(){var t=this;this.$confirm({title:"注意",content:"变更标准维修项目将导致分摊范围自动更新，是否进行变更",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){if(!t.projMainData().regionCode)return t.$refs.regionSelect.focus(),t.$message.warn("请选择申报小区");t.$refs.repairPartsTreeModal.open()}})},changeAllotMode:function(t){this.model.allotMode=t,this.model.children&&this.model.children.map((function(e){e.allotMode=t})),this.$forceUpdate()},openFloorModal:function(){this.$refs.floorChoose.changeFloor(this.serviceProInfo)},getHouseId:function(){this.isChild?this.proInfo.sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})):(this.projMainData().sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})),this.projMainData().editHouseFlag="1")},addChildProj:function(){var t=k(_().mark((function t(){var e,r=this;return _().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.checkData();case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.abrupt("return");case 8:if(e=this.isChild?this.proInfo:this.projMainData(),!e.projectInsureFile&&e.damagedPictureList&&e.damagedPictureList.length>0&&(e.projectInsureFile=e.damagedPictureList[0]),e.sharedHousings&&0!==e.sharedHousings.length){t.next=12;break}return t.abrupt("return",this.$message.warning("请选择分摊范围"));case 12:Object(i["j"])(this.url.addProj,e,{"tenant-id":e.sysOrgCode}).then((function(t){t.success?(r.$message.success(t.message),r.$emit("close")):r.$message.error(t.message)}));case 13:case"end":return t.stop()}}),t,this,[[0,5]])})));function e(){return t.apply(this,arguments)}return e}(),partChooseOk:function(t){var e=this,r=t.map((function(t){return t.rangeId})).join(",");Object(i["e"])(this.url.queryRegionByList,{ids:r}).then((function(t){if(t){var r=[];if(t[0]){var n=t[0];n.children.forEach((function(t){t.children.forEach((function(t){t.children.forEach((function(t){r.push(t.id)}))}))})),e.isChild?e.proInfo.sharedHousings=r:(e.projMainData().sharedHousings=r,e.projMainData().editHouseFlag="1")}}else e.$message.error(t.message)}))},showShared:function(t){var e=t.freezeAllotLists&&t.freezeAllotLists.length>0?t.freezeAllotLists:t.allotLists;this.$refs.shareDetail.showAllotInfo(e)},buildRenewalAllot:function(){var t=this;Object(i["j"])(this.url.buildRenewal,this.serviceProInfo).then((function(e){t.$refs.mendList.initData(e.result)}))},openInsureWithFloor:function(){this.editFlag?this.insurancePartsFlag=!0:this.$refs.insurancePartsTreeModal.open()},selectInsureType:function(t,e){this.insureDetailOptions=e.data.attrs.dataInsureType.children},selectInsureTypeDetail:function(){var t=this;this.$nextTick((function(){t.validaInsureDate()}))},insureStartDateChange:function(){var t=this;this.$nextTick((function(){t.validaInsureDate()}))},validaInsureDate:function(){var t=this;return new Promise((function(e,r){var n=t;n.serviceProInfo.costLists[0]&&n.serviceProInfo.costLists[0].regionUtilityId&&n.serviceProInfo.insureTypeDetail&&n.serviceProInfo.insureStartTime?Object(i["e"])(n.url.checkInsureByRuid,{regionUtilityId:n.serviceProInfo.costLists[0].regionUtilityId,beginTime:n.serviceProInfo.insureStartTime,insureTypeDetail:n.serviceProInfo.insureTypeDetail,projId:n.serviceProInfo.id}).then((function(t){t.result?e({result:!0}):(n.serviceProInfo.insureStartTime="",n.$message.warning(t.message),e({result:!1,message:t.message}))})):e({result:!0})}))}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(s["g"])(t):"0.00"}}},D=L,T=(r("dfc2"),r("a19c"),r("2877")),M=Object(T["a"])(D,n,o,!1,null,"0c769922",null);e["default"]=M.exports},"384c":function(t,e,r){"use strict";r("5c2c")},3857:function(t,e,r){},3939:function(t,e,r){"use strict";r("9a0f")},"3ba9":function(t,e,r){"use strict";r("9761")},"3d84":function(t,e,r){"use strict";r("f228")},"3f8a":function(t,e,r){},"42b1":function(t,e,r){"use strict";r("2a78")},"447b":function(t,e,r){"use strict";r("8261")},"451c":function(t,e,r){"use strict";r("17c4")},4595:function(t,e,r){"use strict";r("c4fa")},"4cf4":function(t,e,r){},"52af":function(t,e,r){"use strict";r("01fa")},"59ad":function(t,e,r){},"5c2c":function(t,e,r){},"5da5":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.confirmLoading,expression:"confirmLoading"}],ref:"content",staticClass:"content"},[r("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[r("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},attrs:{showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle",staticStyle:{"pointer-events":"auto"}},[t._v("\n          "+t._s(t.headerTitle)),r("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKey.includes("1")?"rotate(90deg)":""},attrs:{type:"right"}})],1)]},proxy:!0}])},[r("j-form-container",{ref:"formRow",attrs:{disabled:t.editFlag,rules:t.rules,model:t.serProModel,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[t._v("维修项目描述")]),r("a-col",{attrs:{span:4}},[t._v("\n            "+t._s(t.serProModel.describe)+"\n          ")]),r("a-col",{attrs:{span:4}},[t._v("申报小区")]),r("a-col",{attrs:{span:4}},[t._v("\n            "+t._s(t.serProModel.communityName)+"\n          ")]),r("a-col",{attrs:{span:4}},[t._v("项目类型")]),r("a-col",{attrs:{span:4}},[t._v("\n            "+t._s(t.getBaseTypeText(t.serProModel.baseType))+"\n          ")]),r("a-col",{attrs:{span:4}},[t._v("项目状态")]),r("a-col",{attrs:{span:4}},[r("ser-pro-model-state-comp",{attrs:{state:t.serProModel.state}})],1),r("a-col",{attrs:{span:4}},[t._v("施工单位")]),r("a-col",{attrs:{span:4}},[t._v(" "+t._s(t.serProModel.construction?t.serProModel.construction.corpName:"")+" ")]),r("a-col",{attrs:{span:4}},[t.isDetail?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("保证金")]),r("a-col",{attrs:{span:4,"data-prop":"marginFlag"}},[r("a-space",[r("vxe-switch",{attrs:{disabled:t.isDetail||!t.WhetherThePermissionPasses("completionShow:all"),onLabel:"有",offLabel:"无",onValue:"1",offValue:"0"},model:{value:t.serProModel.marginFlag,callback:function(e){t.$set(t.serProModel,"marginFlag",e)},expression:"serProModel.marginFlag"}}),1==t.serProModel.marginFlag?r("amount-input",{attrs:{max:t.maxMarginPer,min:.01,placeholder:"请输入质保金比例",addonAfter:"%",disabled:t.isDetail||!t.WhetherThePermissionPasses("completionEdit:all")},on:{warn:t.marginPerWarn},model:{value:t.serProModel.marginPer,callback:function(e){t.$set(t.serProModel,"marginPer",e)},expression:"serProModel.marginPer"}}):t._e()],1)],1)],1)],1),r("div",{staticStyle:{height:"99%","margin-top":"10px"}},[r("vxe-grid",{ref:"costTable",attrs:{"row-config":{height:140},toolbar:!1,bordered:"",size:"small",stripe:!0,data:t.tabData.filter((function(t){return"N"!==t.state})),columns:t.columns,"edit-rules":t.tableRule,showPagination:!1,"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":"","auto-resize":"","edit-config":!t.editFlag&&!t.isDetail,border:""},scopedSlots:t._u([{key:"finalEngAmount",fn:function(e){var n=e.row;return[r("div",{staticStyle:{margin:"0 auto"}},[r("amount-input",{attrs:{min:t.getMinCost(n.id),placeholder:"请输入金额",addonAfter:"元",disabled:t.isDetail||!t.WhetherThePermissionPasses("completionEdit:all")},on:{change:t.updateFooterEvent},model:{value:n.finalEngAmount,callback:function(e){t.$set(n,"finalEngAmount",e)},expression:"row.finalEngAmount"}})],1)]}},{key:"actionDate",fn:function(e){var n=e.row;return[r("a-space",[r("j-date",{attrs:{getCalendarContainer:function(){return t.getContainer()},"max-date":n.completionDate,valueFormat:"YYYY-MM-DD",disabled:t.isDetail},on:{change:function(e){return t.handleChange(n)}},model:{value:n.actionDate,callback:function(e){t.$set(n,"actionDate",e)},expression:"row.actionDate"}})],1)]}},{key:"completionDate",fn:function(e){var n=e.row;return[r("a-space",[r("j-date",{attrs:{getCalendarContainer:function(){return t.getContainer()},"min-date":n.actionDate,valueFormat:"YYYY-MM-DD",disabled:t.isDetail},on:{change:function(e){return t.handleChange(n)}},model:{value:n.completionDate,callback:function(e){t.$set(n,"completionDate",e)},expression:"row.completionDate"}})],1)]}},{key:"termOfService",fn:function(e){var n=e.row;return[r("div",{staticClass:"termFlex"},[r("vxe-input",{attrs:{type:"integer",min:0,disabled:t.isDetail||!t.WhetherThePermissionPasses("completionEdit:all")},on:{change:function(e){return t.handleChange(n)}},model:{value:n.termOfService,callback:function(e){t.$set(n,"termOfService",e)},expression:"row.termOfService"}}),r("a-select",{staticStyle:{width:"50px"},attrs:{size:"small",getPopupContainer:function(){return t.$refs.content},disabled:t.isDetail||!t.WhetherThePermissionPasses("completionEdit:all")},on:{change:function(e){return t.handleChange(n)}},model:{value:n.termOfServiceSel,callback:function(e){t.$set(n,"termOfServiceSel",e)},expression:"row.termOfServiceSel"}},[r("a-select-option",{attrs:{value:"year"}},[t._v("年")]),r("a-select-option",{attrs:{value:"mon"}},[t._v("月")]),r("a-select-option",{attrs:{value:"day"}},[t._v("日")])],1)],1)]}},{key:"marginDate",fn:function(e){var n=e.row;return[r("a-date-picker",{attrs:{valueFormat:"YYYY-MM-DD",disabled:t.isDetail},model:{value:n.marginDate,callback:function(e){t.$set(n,"marginDate",e)},expression:"row.marginDate"}})]}},{key:"action",fn:function(e){var n=e.row;return[r("get-table-action-buttons",[t.showJsfthz?r("a",{on:{click:function(e){return t.jsfthzPrint(n)}}},[r("a-icon",{attrs:{type:"file-text"}}),t._v("决算分摊汇总")],1):t._e(),t.WhetherThePermissionPasses("completionShow:all")?r("a",{on:{click:function(e){return t.handlePrint(n.id)}}},[t._v("决算分摊清册")]):t._e(),t.WhetherThePermissionPasses("completionShow:all")?r("a",{on:{click:function(e){return t.costReview(n.id)}}},[t._v("费用审核证明")]):t._e(),t.WhetherThePermissionPasses("completionShow:all")?r("a",{on:{click:function(e){return t.acceptance(n.id)}}},[t._v("验收报告")]):t._e()])]}}])})],1)],1),r("a-collapse-panel",{key:"2",staticStyle:{"background-color":"#fff"},attrs:{forceRender:"",showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle",staticStyle:{"pointer-events":"auto"}},[t._v("\n          附件上传"),r("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKey.includes("2")?"rotate(90deg)":""},attrs:{type:"right"}})],1)]},proxy:!0}])},[r("type-attachment-upload",{ref:"fileupload",attrs:{"is-show-header":!1,busiType:"20",busiTypeDetail:"202G",busiNo:t.serProModel.id,isDetail:t.editFlag||"2"==t.projMainData().completionFlag},on:{change:t.getFileList}})],1)],1),"0"!=t.projMainData().completionFlag?r("content-view",{attrs:{title:"审核流程","show-icon":!1}},[r("a-table",{ref:"table",attrs:{rowKey:"id",size:"middle",bordered:"",columns:t.columnsCheck,dataSource:t.dataSource,pagination:!1}})],1):t._e(),"2"===t.projMainData().completionFlag&&t.isShowAcceptance?r("content-view",{key:"2",staticClass:"connetItem",attrs:{"show-icon":!1,title:"审核意见信息"}},[r("j-form-container",{attrs:{disabled:!t.isDetail}},[r("a-form-model",{ref:"formModel",attrs:{slot:"edit",model:t.auditModel,rules:t.auRules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol},slot:"edit"},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{class:{required:t.isDetail},attrs:{span:4}},[t._v("审批选项")]),r("a-col",{attrs:{span:20}},[r("a-form-model-item",{staticClass:"width-100",attrs:{prop:"flow"}},[r("a-radio-group",{on:{change:t.flagChange},model:{value:t.auditModel.flow,callback:function(e){t.$set(t.auditModel,"flow",e)},expression:"auditModel.flow"}},[r("a-radio",{attrs:{value:1}},[t._v("通过")]),r("a-radio",{attrs:{value:0}},[t._v("驳回")])],1)],1)],1),r("a-col",{class:{required:t.isDetail},attrs:{span:4}},[t._v("审批意见")]),r("a-col",{attrs:{span:20}},[r("a-form-model-item",{staticClass:"width100",attrs:{prop:"advice"}},[r("a-textarea",{staticClass:"width100",attrs:{placeholder:"请输入审核意见"},model:{value:t.auditModel.advice,callback:function(e){t.$set(t.auditModel,"advice",e)},expression:"auditModel.advice"}})],1)],1)],1)],1)],1),r("a-row",{},[r("a-button",{staticStyle:{margin:"10px auto",display:"block"},attrs:{type:"primary"},on:{click:function(){return t.handleOkAu(t.auditModel.advice)}}},[t._v("确定")])],1)],1):[t.isDetail||"2"==t.projMainData().completionFlag?t._e():r("div",{staticClass:"drawer-bootom"},[t.WhetherThePermissionPasses("completionShow:all")?r("a-button",{attrs:{type:"primary",disabled:t.editFlag},on:{click:t.handleOk}},[t._v("确定")]):t._e()],1),t.isDetail&&"2"!=t.projMainData().completionFlag?r("div",{staticClass:"drawer-bootom",staticStyle:{"text-align":"center"}},[t.WhetherThePermissionPasses("completionShow:all")?r("a-button",{attrs:{type:"primary"},on:{click:t.handleWithdrawalSerPo}},[t._v("竣工验收撤回")]):t._e()],1):t._e(),"2"==t.projMainData().completionFlag?r("div",{staticClass:"drawer-bootom",staticStyle:{"text-align":"center"}},[r("a-button",{attrs:{type:"primary",disabled:!0}},[t._v("验收待审核")])],1):t._e()],r("print-report-comp",{ref:"print"})],2)},o=[],a=r("4aae"),i=r("c1df"),s=r.n(i),l=r("dc9a"),c=r("0fea"),u=r("d8a5"),d=r("9fbd"),f=r("cf9e"),h=r("3ed7"),p=r("9bed"),m=r("c695"),v=r.n(m),g=r("0c8a"),y=r("fdcf"),b=r("2b0e"),w=r("9fb0"),x=r("2d4c"),j=r("4ec3");function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function C(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */C=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};c(w,i,(function(){return this}));var x=Object.getPrototypeOf,j=x&&x(x(O([])));j&&j!==r&&n.call(j,i)&&(w=j);var _=b.prototype=g.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==I(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(I(e)+" is not iterable")}return y.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=P(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function P(t,e){if(t){if("string"==typeof t)return k(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function L(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function D(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){L(a,n,o,i,s,"next",t)}function s(t){L(a,n,o,i,s,"throw",t)}i(void 0)}))}}var T={name:"WarrantyInfoComp",components:{GetTableActionButtons:x["default"],PrintReportComp:p["default"],AmountInput:a["default"],TypeAttachmentUpload:d["default"],SerProModelStateComp:f["default"],ContentView:l["default"]},props:{headerTitle:{type:String,default:"竣工验收信息"}},inject:["projMainData","getContainer","nowNodeInfo","routeReload"],created:function(){this.initData()},data:function(){return{dataSource:[],isShowAcceptance:!1,auditModel:{advice:"同意",flow:1},labelCol:{span:0},wrapperCol:{span:24},showJsfthz:!1,completionInspectionFlag:!1,verifyProcess:!1,serProModel:{},activeKey:["1","2"],confirmLoading:!1,disableSubmit:!1,editFlag:!0,isDetail:!0,minCostList:[],maxMarginPer:100,auRules:{flow:[{required:!0,message:"请选择预审选项！"}],advice:[{required:!0,message:"请输入预审意见！"}]},rules:{marginPer:[{required:!0,message:"请输入质保金比例",trigger:"change"},{validator:this.vailFinalEngAmount}]},tableRule:{completionDate:[{required:!0,message:"请选择竣工日期",trigger:"change"}],marginDate:[{required:!0,message:"请选择质保到期日",trigger:"change"}]},tabData:[],columnsCheck:[{title:"序号",dataIndex:"",key:"rowIndex",width:18==b["default"].ls.get(w["w"])?60:50,align:"center",customRender:function(t,e,r){return parseInt(r)+1}},{title:"任务名称",align:"center",width:160,dataIndex:"name",ellipsis:!0},{title:"处理人",align:"center",dataIndex:"assigneeName",ellipsis:!0,customRender:function(t,e){return t||e.assignee}},{title:"耗时",align:"center",width:110,dataIndex:"duration",customRender:function(t,e){var r=e.duration,n="";if(null!=r){var o=Math.floor(r/864e5);0!==o&&(n+=o+"天");var a=r%864e5,i=Math.floor(a/36e5);0!==i&&(n+=i+"小时");var s=a%36e5,l=Math.floor(s/6e4);if(0!==l&&(n+=l+"分"),!n){var c=Math.round(s%6e4/1e3);n+=c+"秒"}}return n}},{title:"开始时间",align:"center",width:160,dataIndex:"startTime"},{title:"结束时间",align:"center",width:160,dataIndex:"endTime"},{title:"审批结果",align:"center",dataIndex:"taskFlow",width:18==b["default"].ls.get(w["w"])?90:80,customRender:function(t){return"1"==t?"通过":"0"==t?"未通过":t}},{title:"审批意见",align:"center",dataIndex:"comment"}],columns:[{title:"维修项目描述",align:"left",headerAlign:"center",field:"describe",minWidth:180},{title:"工程款预算金额（元）",align:"right",field:"bgEngAmount",width:this.isWidth(),formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"工程款审核金额（元）",align:"right",field:"conEngAmount",width:this.isWidth(),formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"工程款决算金额（元）",align:"right",field:"finalEngAmount",editRender:{type:"visible"},slots:{edit:"finalEngAmount"},width:this.isWidth(),formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"开工日期",align:"right",editRender:{type:"visible"},field:"actionDate",slots:{edit:"actionDate"},width:140},{title:"竣工日期",align:"right",editRender:{type:"visible"},field:"completionDate",slots:{edit:"completionDate"},width:140},{title:"保修期限",align:"right",editRender:{type:"visible"},field:"termOfService",slots:{edit:"termOfService"},visible:this.isDetail,width:140},{title:"质保到期日",align:"right",field:"marginDate",editRender:{type:"visible"},slots:{edit:"marginDate"},width:140,formatter:function(t){var e=t.cellValue;return e?s()(e).format("YYYY-MM-DD"):""}},{title:"操作",align:"center",visible:this.isDetail,field:"action",slots:{default:"action"},width:18==b["default"].ls.get(w["w"])?320:280,fixed:"right"}],url:{proCostList:"/use/serviceProj/getCostInfoByPid",serProBatchComplete:"/use/serviceProj/serProBatchComplete",queryCostList:"/use/serviceCost/queryProCostList",queryProInfoById:"/use/serviceProj/queryProInfoById",withdrawalUrl:"/use/serviceProj/withdrawalSerPro",checkWarrState:"/use/serviceProj/checkWarrState/",getConcludeMinCost:"/use/serviceProj/getConcludeMinCost/",getFundEndRatio:"/use/fundProgress/getFundFirstRatio",getProInfoById:"/use/serviceProj/queryProj",verifyProcessIsAll:"/use/processSupervision/verifyProcessIsAll",startFinalAcceptance:"/use/serviceProj/startFinalAcceptance",getShowAcceptance:"/use/serviceProj/getShowAcceptance",checkAcceptance:"/use/serviceProj/checkAcceptance"},formatterAmount:h["g"],getBaseTypeText:g["getBaseTypeText"]}},methods:{getShowJsfthz:function(){var t=this;Object(u["e"])("ureport2_show_appropriation_allocation_list").then((function(e){t.showJsfthz="1"==e}))},getCompletionInspectionFlag:function(){var t=this;Object(j["l"])("is_completion_inspection_enabled").then((function(e){t.completionInspectionFlag=e.success?e.result:"0"}))},jsfthzPrint:function(t){this.$refs.print.type="print",this.$refs.print.print("appropriation_allocation_list",{projId:t.id})},WhetherThePermissionPasses:y["a"],isWidth:function(){return 18==b["default"].ls.get(w["w"])?180:140},initData:function(){var t=this;this.getShowJsfthz(),this.getCompletionInspectionFlag(),this.getShowAcceptance(),this.getShowCheck(),Object(u["e"])("verify_process_is_all").then((function(e){t.verifyProcess="1"==e}));var e=this.projMainData().id;this.editFlag=!("0"==this.projMainData().state||"1"==this.projMainData().state||"2"==this.projMainData().state||"7"==this.projMainData().state);var r=[];Object(c["e"])(this.url.getFundEndRatio,{projId:e}).then((function(e){e.success&&e.result&&(t.maxMarginPer=Object(h["f"])(e.result,.01))})),Object(c["j"])(this.url.queryProInfoById+"/"+e).then((function(e){e.success&&(t.serProModel=Object.assign({},e.result),"0"===t.serProModel.completionFlag&&(t.isDetail=!1,t.columns[8].visible=t.isDetail),t.columns[6].visible=!t.isDetail,t.columns.forEach((function(e){e.editRender&&e.editRender.type&&(e.editRender.type=t.isDetail?"default":"visible")})),t.$nextTick((function(){t.$refs.costTable.reloadColumn(t.columns)})),t.$nextTick((function(){t.$refs.fileupload.initData()})))})),r.push(e),Object(c["j"])(this.url.queryCostList,{projIds:r}).then((function(r){r.success&&r.result.forEach((function(r){r.projId==e&&(t.serProModel.conEngAmount=r.cost,t.serProModel.finalEngAmount=r.cost,"01"==r.baseType&&(t.serProModel.construction=r),"02"==r.baseType&&(t.serProModel.priceReview=r),"03"==r.baseType&&(t.serProModel.supervisor=r))}))})),this.serProModel.marginPer&&0!=this.serProModel.marginPer.length&&0!=this.serProModel.marginPer||Object(u["e"])("margin_ratio").then((function(e){t.$set(t.serProModel,"marginPer",e)})),this.queryPage(),Object(c["j"])(this.url.getConcludeMinCost+this.projMainData().id).then((function(e){e.success&&(t.minCostList=e.result)}))},getShowAcceptance:function(){var t=this;Object(c["e"])(this.url.getShowAcceptance,{getUserListByKey:this.$route_query.busiKey}).then((function(e){e&&e.success&&(t.isShowAcceptance=e.result)}))},getShowCheck:function(){var t=this;Object(c["e"])("/common/bBusiReq/selectBusiReqByExtId",{extId:this.projMainData().id,busiType:"20",busiTypeDetail:"202G",state:"2"==this.projMainData().completionFlag?"2":"0"}).then((function(e){Object(c["e"])("/act/taskinst/history/task/"+e.result.flowId,{}).then((function(e){if(e.success){t.dataSource=e.result;b["default"].ls.get(w["J"])}else t.$message.error("查询审批历史记录发生错误！")}))}))},queryPage:function(){var t=this,e=this.projMainData().id;Object(c["j"])(this.url.proCostList+"/"+e+"/02").then((function(e){e.success&&(t.tabData=e.result)}))},checkData:function(){var t=D(C().mark((function t(){var e,r,n,o,a,i,s,l,u,d;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=!0,r=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow),r.valida){t.next=4;break}return t.abrupt("return",!1);case 4:return n=this.getProInfo(),t.next=7,Object(c["j"])(this.url.checkAcceptance,n,{"tenant-id":n.sysOrgCode});case 7:if(o=t.sent,o.success){t.next=11;break}return this.$message.warning(o.message),t.abrupt("return",!1);case 11:t.prev=11,a=_(this.tabData),t.prev=13,a.s();case 15:if((i=a.n()).done){t.next=22;break}if(s=i.value,"6"!==s.state){t.next=20;break}return this.$message.warn("".concat(s.describe,"项目待办结，请完成后再进行操作！")),t.abrupt("return",!1);case 20:t.next=15;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t["catch"](13),a.e(t.t0);case 27:return t.prev=27,a.f(),t.finish(27);case 30:return t.next=32,this.$refs.costTable.validate(this.tabData.filter((function(t){return!["N"].includes(t.state)})));case 32:t.next=37;break;case 34:t.prev=34,t.t1=t["catch"](11),e=!1;case 37:if(e){t.next=39;break}return t.abrupt("return",!1);case 39:if(!this.verifyProcess){t.next=56;break}return t.prev=40,t.next=43,Object(c["e"])(this.url.verifyProcessIsAll,{ids:this.tabData.map((function(t){return t.id})).join(",")});case 43:if(l=t.sent,!l.success||!l.result){t.next=50;break}return u=this.tabData.filter((function(t){return l.result.indexOf(t.id)>-1})),d=u.map((function(t){return t.describe})).join("、"),this.$message.warning("".concat(d,"项目有缺失的维修过程监督环节，暂不可进行竣工验收！")),t.abrupt("return",!1);case 50:t.next=56;break;case 52:return t.prev=52,t.t2=t["catch"](40),t.abrupt("return",!1);case 56:return t.abrupt("return",!0);case 57:case"end":return t.stop()}}),t,this,[[11,34],[13,24,27,30],[40,52]])})));function e(){return t.apply(this,arguments)}return e}(),getProInfo:function(){var t=this;return this.tabData.forEach((function(e){["N"].includes(e.state)&&(e.finalEngAmount=t.getMinCost(e.id))})),this.serProModel.children=this.tabData.filter((function(t){return!["N"].includes(t.state)})),this.serProModel},vailFinalEngAmount:function(t,e,r){e?0==e&&r("质保金比例不能为0"):r()},vailTermOfService:function(t){var e=t.cellValue;return e?Promise.resolve():0==e?Promise.reject(new Error("请选择保修期限")):void 0},vailFinalMarginPer:function(t,e,r){e?0==e?r(new Error("保证金比例不能为0")):e>100&&r(new Error("保证金比例已超过100")):r()},vailAcDateAmount:function(t,e,r){this.serProModel.actionDate&&this.serProModel.completionDate&&this.serProModel.actionDate>this.serProModel.completionDate&&r("开工日期不能大于竣工日期！")},vailEnDateAmount:function(t,e,r){this.serProModel.actionDate&&this.serProModel.completionDate&&this.serProModel.actionDate>this.serProModel.completionDate&&r("竣工日期不能小于开工日期！")},handleChange:function(t){if(t.completionDate)switch(t.termOfServiceSel){case"year":t.marginDate=s()(t.completionDate).add(t.termOfService,"y").format("YYYY-MM-DD");break;case"mon":t.marginDate=s()(t.completionDate).add(t.termOfService,"M").format("YYYY-MM-DD");break;case"day":t.marginDate=s()(t.completionDate).add(t.termOfService,"d").format("YYYY-MM-DD");break;default:break}},getFileList:function(t){if(this.fileIdList=[],t){var e=this;t.forEach((function(t){e.fileIdList.push(t.id)}))}},handleOkAu:function(t){var e=this;this.$refs.formModel.validate().then((function(r){e.commitFLow(t)}))},commitFLow:function(){var t=D(C().mark((function t(e){var r;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=this,r.confirmLoading=!0,t.next=4,Object(c["i"])("/handle/task/complete/"+this.nowNodeInfo().id+"/"+this.auditModel.flow+"/"+e+"/0/0/0/0",{},"post").then((function(t){return t.success?(r.getShowAcceptance(),r.routeReload(),r.$message.success(t.message),r.confirmLoading=!1,r.close(),Promise.resolve()):(r.$message.warning(t.message),r.confirmLoading=!1,Promise.reject(t.message))}));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleOk:function(){var t=D(C().mark((function t(){var e;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.checkData();case 2:if(!t.sent){t.next=7;break}e=this,e.$confirm({title:"是否竣工验收？",onOk:function(){if(e.confirmLoading=!0,e.disableSubmit=!0,!e.$refs.fileupload.checkData())return e.confirmLoading=!1,e.disableSubmit=!1,!1;var t=e.getProInfo();t.fileIdList=e.fileIdList,t.completionFlag="2",t.marginPer=t.marginPer||0,t.marginFee=t.marginFee||0;var r=e.completionInspectionFlag&&"1"==e.completionInspectionFlag?e.url.startFinalAcceptance:e.url.serProBatchComplete;Object(c["j"])(r,t,{"tenant-id":t.sysOrgCode}).then((function(t){t.success?(e.confirmLoading=!1,e.columns[6].visible=!1,e.columns[8].visible=!0,e.columns.forEach((function(t){t.editRender&&t.editRender.type&&(t.editRender.type="default")})),Object(c["e"])(e.url.getProInfoById,{id:e.projMainData().id}).then((function(t){t.success&&t.result&&e.$emit("updateProInfo",t.result)})),e.$nextTick((function(){e.routeReload(),e.$message.success("操作成功！")}))):(e.$message.warning(t.message),e.disableSubmit=!1,e.confirmLoading=!1)}))},onCancel:function(){}}),t.next=9;break;case 7:this.confirmLoading=!1,this.disableSubmit=!1;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handlePrint:function(t){this.$refs.print.print("proj_final_ccounts_allot",{id:t})},acceptance:function(t){this.$refs.print.print("proj_acceptance_certificate",{id:t})},costReview:function(t){this.$refs.print.print("proj_cost_review",{id:t})},handleWithdrawalSerPo:function(){var t=D(C().mark((function t(){var e;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.checkProjState();case 2:if(!t.sent){t.next=7;break}e=this,this.$confirm({title:"确定撤回["+e.serProModel.describe+"]吗?",onOk:function(){Object(c["j"])(e.url.withdrawalUrl+"/"+e.serProModel.id).then((function(t){t.success?(e.isDetail=!1,e.columns[8].visible=!1,e.columns[6].visible=!0,e.columns.forEach((function(t){t.editRender&&t.editRender.type&&(t.editRender.type="visible")})),e.$nextTick((function(){e.$refs.costTable.reloadColumn(e.columns)})),e.$message.success(t.message),e.projMainData().completionFlag="0"):e.$message.warning(t.message)}))},onCancel:function(){}}),t.next=8;break;case 7:this.$message.info("项目已有在途进度或尾款拨付完成，无法进行竣工验收撤回");case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),checkProjState:function(){var t=D(C().mark((function t(){var e;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.url.checkWarrState+this.serProModel.id,t.next=3,Object(c["e"])(e).then((function(t){if(t.success)return t.result}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),updateFooterEvent:function(){var t=this.$refs.costTable;t.updateFooter()},footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";if(["finalEngAmount","finalCost","contractCost","budgetCost","conEngAmount","bgEngAmount"].includes(t.property)){var n={style:"decimal",currency:"CNY",minimumFractionDigits:2,maximumFractionDigits:2};return Number(v.a.sum(r,t.property)).toLocaleString("zh-CN",n)}}))]},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;if(0===e)return{colspan:1}},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;if(0===e)return"text-align: right"},marginPerWarn:function(t){"min"===t?this.$message.warning("保证金拨付比例应大于0%"):"max"===t&&this.$message.warning("保证金拨付比例最大值为".concat(this.maxMarginPer,"%"))},getMinCost:function(t){return this.minCostList[t]},flagChange:function(t){1===t.target.value&&(this.auditModel.advice="同意"),0===t.target.value&&(this.auditModel.advice="不同意")}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(h["g"])(t):"0.00"},formatDate:function(t){return t&&""!==t&&"undefined"!==t?s()(t).format("YYYY-MM-DD"):""}}},M=T,S=(r("d7d11"),r("eb82"),r("2877")),O=Object(S["a"])(M,n,o,!1,null,"19df7644",null);e["default"]=O.exports},"5e2e7":function(t,e,r){"use strict";r("3857")},"5f67":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"connet"},[r("div",{staticClass:"editCompBtnDiv"},[!t.isDetail&&t.pageType?r("a-button",{attrs:{type:"primary"},on:{click:t.changeProj}},[t._v("修改信息")]):t._e()],1),r("content-view",{key:"1",staticClass:"connetItem",attrs:{showIcon:!1,title:"项目信息"}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.ProjPlaInfo,disabled:t.editFlag,border:!1,formRef:"formRow"}},[r("a-row",{ref:"formSerProRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("维修计划描述")])]),r("a-col",{attrs:{span:12,"data-prop":"describe"}},[r("a-input",{model:{value:t.ProjPlaInfo.describe,callback:function(e){t.$set(t.ProjPlaInfo,"describe",e)},expression:"ProjPlaInfo.describe"}})],1),r("a-col",{attrs:{span:4}},[t._v("申报状态")]),r("a-col",{attrs:{span:4}},[r("ser-pro-model-state-comp",{attrs:{state:t.ProjPlaInfo.state}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag&&!t.isChild}},[t._v("分摊方式")])]),r("a-col",{attrs:{span:4,"data-prop":"allotMode"}},[r("j-d-dict-select-tag",{attrs:{dictCode:"allocation_method",disabled:t.editFlag||t.isChild},on:{change:t.changeAllotMode},model:{value:t.ProjPlaInfo.allotMode,callback:function(e){t.$set(t.ProjPlaInfo,"allotMode",e)},expression:"ProjPlaInfo.allotMode"}})],1),r("a-col",{attrs:{span:4}},[t._v("申请小区")]),r("a-col",{attrs:{span:4}},[t._v("\n          "+t._s(t.ProjPlaInfo.communityName)+"\n        ")]),t.isHasChild?t._e():r("a-col",{attrs:{span:4}},[t._v("分摊范围")]),t.isHasChild?t._e():r("a-col",{attrs:{span:4,"data-prop":"sharedHousings"}},[r("a",{staticStyle:{"flex-shrink":"0"},attrs:{disabled:!t.editFlag},on:{click:function(e){return t.showShared(t.ProjPlaInfo)}}},[t._v("\n            "+t._s(t.ProjPlaInfo.sharedHousings?t.ProjPlaInfo.sharedHousings.length:0)+"户\n          ")]),t.editFlag?t._e():r("span",{staticClass:"tagButton margin_left_10 margin_right_10",on:{click:t.openFloorModal}},[t._v("\n            修改分摊范围\n          ")])]),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("联系人")])]),r("a-col",{attrs:{span:4,"data-prop":"reqMan"}},[r("a-input",{model:{value:t.ProjPlaInfo.reqMan,callback:function(e){t.$set(t.ProjPlaInfo,"reqMan",e)},expression:"ProjPlaInfo.reqMan"}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("联系电话")])]),r("a-col",{attrs:{span:4,"data-prop":"reqPhone"}},[r("a-input",{model:{value:t.ProjPlaInfo.reqPhone,callback:function(e){t.$set(t.ProjPlaInfo,"reqPhone",e)},expression:"ProjPlaInfo.reqPhone"}})],1),r("a-col",{attrs:{span:4}},[t._v("申报单位")]),r("a-col",{attrs:{span:4}},[t._v("\n          "+t._s(t.ProjPlaInfo.reqCodeName?t.ProjPlaInfo.reqCodeName:"暂无")+"\n        ")])],1)],1),t.isChild?r("vxe-grid",{staticStyle:{"margin-top":"10px"},attrs:{size:"small",border:"",data:t.ProjPlaInfo.costLists,columns:t.partColumns}}):t._e(),t.editFlag||t.isHasChild?t._e():r("div",{staticClass:"align-center"},[r("a-button",{attrs:{type:"primary"},on:{click:t.editCostLists}},[t._v(" 编辑维修对象")])],1)],1),t.isHasChild?t._e():r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"计划明细"}},[r("plan-detail-list-modal",{staticClass:"width100",attrs:{isDetail:t.editFlag||t.isDetail,auditFlag:"7"==t.ProjPlaInfo.state,planDetailList:t.ProjPlaInfo.projPlanLists,proInfo:t.ProjPlaInfo},on:{"update:planDetailList":function(e){return t.$set(t.ProjPlaInfo,"projPlanLists",e)},"update:plan-detail-list":function(e){return t.$set(t.ProjPlaInfo,"projPlanLists",e)}}})],1),t.isHasChild?r("content-view",{key:"3",staticClass:"connetItem",attrs:{showIcon:!1,title:"子计划"}},[r("child-plan",{ref:"childPro",attrs:{pageType:t.pageType,allotMode:t.allotMode,proInfo:t.ProjPlaInfo,isDetail:t.isDetail}})],1):t._e(),r("div",{staticClass:"saveBtnDiv"},[!t.editFlag&&t.isChild?r("a-button",{attrs:{type:"primary",loading:t.isLoading},on:{click:t.addChildProj}},[t._v("保存")]):t._e()],1),r("corp-info-detail",{ref:"detailForm"}),r("repair-parts-tree-modal",{ref:"repairPartsTreeModal",attrs:{choosePart:t.ProjPlaInfo.costLists,regionId:t.ProjPlaInfo.regionId},on:{"update:choosePart":function(e){return t.$set(t.ProjPlaInfo,"costLists",e)},"update:choose-part":function(e){return t.$set(t.ProjPlaInfo,"costLists",e)},ok:t.partChooseOk}}),r("create-pro-floor-choose",{ref:"floorChoose",attrs:{apportionType:1},on:{ok:t.getHouseId}}),r("share-detail-comp",{ref:"shareDetail"}),r("mend-amount-modal",{ref:"mendList",attrs:{projInfo:t.ProjPlaInfo}})],1)},o=[],a=r("eccd"),i=r("3ed7"),s=r("cf9e"),l=r("779d"),c=r("0fea"),u=r("9b3d"),d=r("b88f"),f=r("d9e8"),h=r("dc9a"),p=r("4da9"),m=r("fdce"),v=r("2a9b"),g=r("e7a5"),y=r("d8a5"),b=r("6d5b"),w=r("f6f3"),x=r("c493"),j=r("79ae");function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function C(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */C=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};c(w,i,(function(){return this}));var x=Object.getPrototypeOf,j=x&&x(x(O([])));j&&j!==r&&n.call(j,i)&&(w=j);var _=b.prototype=g.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==I(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(I(e)+" is not iterable")}return y.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function P(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){_(a,n,o,i,s,"next",t)}function s(t){_(a,n,o,i,s,"throw",t)}i(void 0)}))}}var k={name:"ProjPlanAuditInfoComp",components:{ChildPlan:j["default"],PlanDetailListModal:x["default"],MendAmountModal:w["default"],CreateProFloorChoose:g["default"],RepairPartsTreeModal:v["default"],JDictRegionListSelect:m["default"],CreateProModal:p["default"],ContentView:h["default"],ChildPro:f["default"],CostManage:u["default"],JDDictSelectTag:a["default"],SerProModelStateComp:s["default"],CorpInfoDetail:l["default"],cards:d["default"],ShareDetailComp:b["default"]},props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"维修项目信息"},projId:{type:String,default:""},proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},pageType:{type:Boolean,default:!0}},inject:["projMainData"],created:function(){var t=this;Object(y["e"])("allot_mode").then((function(e){t.allotMode=e})),this.initData()},data:function(){var t=function(t,e){return new Promise(function(){var t=P(C().mark((function t(r){return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",r());case 2:Object(c["j"])("/drools/droolsData/exeDrools",{type:"verifyPhoneNumber",name:"verify",data:{phone:e}}).then((function(t){return t.success?r():r(t.result)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())};return{ProjPlaInfo:{},rules:{allotMode:[{required:!0,message:"请选择分摊方式",trigger:"change"}],baseType:[{required:!0,message:"请选择项目类别",trigger:"change"}],describe:[{required:!0,message:"请输入项目描述",trigger:"change"}],choosePart:[{required:!0,message:"请选择标准维修项目",trigger:"change"}],sharedHousings:[{required:!0,message:"请选择分摊范围",trigger:"change"}],preTime:[{required:!0,message:"请输入预估工期",trigger:"change"}],reqMan:[{required:!0,message:"请输入联系人",trigger:"change"}],reqPhone:[{required:!0,message:"请输入联系电话",trigger:"change"},{validator:t,type:"Promise"}]},activeKey:[],expandKeys:["1","2","3"],isLoading:!1,url:{queryProj:"/use/serviceProj/queryProj",corpInfolist:"/use/serviceCost/corpList",queryMinProj:"/use/serviceProj/queryMinProj",addProj:"/use/serviceProj/addProj",queryRegionByList:"/base/rtRegion/queryRegionByList",buildRenewal:"/use/projAllotList/buildRenewal"},isChild:!1,panelStyle:"background: #fff",isHasChild:!1,editFlag:this.disabled,allotMode:0,lists:[],partColumns:[{field:"partDesc",title:"标准维修项目",showOverflow:!0,formatter:function(t){var e=t.row;return e.remark.split("-").pop()}},{field:"describe",title:"描述",showOverflow:!0},{field:"unitPrice",title:"单价",width:80,align:"right",formatter:function(t){var e=t.cellValue;return Object(i["g"])(e)},slot:!0},{field:"quantity",title:"数量",width:70,align:"center"},{field:"totalPrice",title:"总价",width:80,align:"right",formatter:function(t){var e=t.cellValue;return Object(i["g"])(e)}},{field:"remark",title:"备注",showOverflow:!0}],costTypeMenu:[{value:"construction",label:"工程款",type:"01"},{value:"priceReview",label:"审价费",type:"02"},{value:"supervisor",label:"监理费",type:"03"},{value:"biddingCost",label:"招标费",type:"04"},{value:"inspectionCost",label:"检测费",type:"05"},{value:"makeCost",label:"造价费",type:"06"}]}},methods:{initData:function(){var t=this;null===this.proInfo?(this.ProjPlaInfo=this.projMainData(),0==this.ProjPlaInfo.isHasChild?(this.isChild=!1,this.isHasChild=!1):this.isHasChild=!0):(this.ProjPlaInfo=this.proInfo,this.isChild=!0,this.isHasChild=!1,this.$nextTick((function(){t.$refs.cost.tableData.push({type:"01",unitCode:t.ProjPlaInfo.construction.chargeCorpCode,cost:t.ProjPlaInfo.construction.cost}),t.$refs.cost.gridOptions.columns.splice(4,2)})))},handleDetail:function(t){var e=this;Object(c["e"])(this.url.corpInfolist,{code:t}).then((function(t){if(t.result){var r=t.result.records[0];e.$refs.detailForm.show(r),e.$refs.detailForm.title=r.name+" ("+r.baseType_dictText+") "}}))},unitChoose:function(t,e){var r=e.value;this.projMainData()[r]||this.$set(this.projMainData(),r,{}),this.projMainData()[r].projId=this.projMainData().id,this.projMainData()[r].chargeCorpCode=t[0].code,this.projMainData()[r].chargeCorpMan=t[0].linkMan,this.projMainData()[r].stage="01",this.projMainData()[r].baseType=e.type,this.projMainData()[r].chargeCorpPhone=t[0].phone,this.projMainData()[r].describe=this.projMainData().describe+e.label,!this.isChild&&this.isHasChild&&this.$refs.childPro.unitChoose(e)},delCost:function(t,e){var r;t&&(r=t.value);var n=this.projMainData()[r].cost;this.projMainData()[r]=null,this.isHasChild&&this.$refs.childPro.delCost(r),e&&this.setChooseAmount(n,e)},changeProj:function(){var t=this;this.$confirm({title:"注意",content:"开启编辑后变更的数据将无法撤销，且编辑完成后点击保存将覆盖原数据，是否开启编辑",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){var e;t.editFlag=!1,e=t.isChild?t.proInfo:t.projMainData(),e.costs.forEach((function(t){t.id=null}))}})},regionChange:function(t,e){this.regionInfo=e,this.initDevice(t)},editCostLists:function(){var t=this;this.$confirm({title:"注意",content:"变更标准维修项目将导致分摊范围自动更新，是否进行变更",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){if(!t.projMainData().regionCode)return t.$refs.regionSelect.focus(),t.$message.warn("请选择申报小区");t.$refs.repairPartsTreeModal.open()}})},changeAllotMode:function(t){this.ProjPlaInfo.allotMode=t,this.ProjPlaInfo.children&&this.ProjPlaInfo.children.map((function(e){e.allotMode=t})),this.$forceUpdate()},openFloorModal:function(){this.$refs.floorChoose.changeFloor(this.ProjPlaInfo)},getHouseId:function(){this.isChild?this.proInfo.sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})):(this.projMainData().sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})),this.projMainData().editHouseFlag="1")},addChildProj:function(){var t=this;this.$refs.formRow.validaRowMsgPro(this.$refs.formSerProRow).then((function(e){if(e.valida){t.isLoading=!0;var r=t.isChild?t.proInfo:t.projMainData();Object(c["j"])(t.url.addProj,r,{"tenant-id":r.sysOrgCode}).then((function(e){e.success?(t.$message.success(e.message),t.$emit("close")):t.$message.error(e.message)})).finally((function(){t.isLoading=!1}))}}))},partChooseOk:function(t){var e=this,r=t.map((function(t){return t.rangeId})).join(",");Object(c["e"])(this.url.queryRegionByList,{ids:r}).then((function(t){if(t){var r=[];if(t[0]){var n=t[0];n.children.forEach((function(t){t.children.forEach((function(t){t.children.forEach((function(t){r.push(t.id)}))}))})),e.isChild?e.proInfo.sharedHousings=r:(e.projMainData().sharedHousings=r,e.projMainData().editHouseFlag="1")}}else e.$message.error(t.message)}))},showShared:function(t){var e=t.freezeAllotLists&&t.freezeAllotLists.length>0?t.freezeAllotLists:t.allotLists;this.$refs.shareDetail.showAllotInfo(e)},buildRenewalAllot:function(){var t=this;Object(c["j"])(this.url.buildRenewal,this.ProjPlaInfo).then((function(e){t.$refs.mendList.initData(e.result)}))},checkData:function(){return new Promise(function(){var t=P(C().mark((function t(e,r){return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e();case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(i["g"])(t):"0.00"}}},L=k,D=(r("28e8"),r("2877")),T=Object(D["a"])(L,n,o,!1,null,"0c294b98",null);e["default"]=T.exports},6181:function(t,e,r){},6412:function(t,e,r){"use strict";r("d380")},"6ac8":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[r("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[r("div",{staticClass:"title marginTop10"},[r("span",{staticClass:"collapseTitle"},[t._v("\n            "+t._s(t.headerTitle)+"\n          ")])])]},proxy:!0}])},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.reqInfo,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[t.disabled&&t.dateAndNameIsRequired?r("span",{staticClass:"requiredText"},[t._v("*")]):t._e(),t._v("申请日期")]),r("a-col",{attrs:{span:8}},[r("a-date-picker",{attrs:{valueFormat:"YYYY-MM-DD",disabled:""},model:{value:t.reqInfo.reqDate,callback:function(e){t.$set(t.reqInfo,"reqDate",e)},expression:"reqInfo.reqDate"}})],1),r("a-col",{attrs:{span:4}},[t.disabled&&t.dateAndNameIsRequired?r("span",{staticClass:"requiredText"},[t._v("*")]):t._e(),t._v("申请人")]),r("a-col",{attrs:{span:8}},[r("a-input",{staticClass:"disabledText",attrs:{disabled:!0},model:{value:t.reqInfo.realname,callback:function(e){t.$set(t.reqInfo,"realname",e)},expression:"reqInfo.realname"}})],1),r("a-col",{staticClass:"height-200",attrs:{span:4}},[t.disabled?r("span",{staticClass:"requiredText"},[t._v("*")]):t._e(),t._v("原因")]),r("a-col",{staticClass:"height-200",attrs:{span:20,"data-prop":"reason"}},[r("a-textarea",{attrs:{rows:8,disabled:!t.disabled,placeholder:"请填写申请原因"},model:{value:t.reqInfo.reason,callback:function(e){t.$set(t.reqInfo,"reason",e)},expression:"reqInfo.reason"}})],1)],1)],1)],1)],1)],1)},o=[],a=r("c1df"),i=r.n(a),s=r("2b0e"),l=r("9fb0"),c={name:"RollBackComp",props:{headerTitle:{type:String,default:"申请信息"},disabled:{type:Boolean,default:!0},dateAndNameIsRequired:{type:Boolean,default:!0}},data:function(){return{reqInfo:{},activeKey:["1"],rules:{reason:[{required:!0,message:"请输入原因",trigger:"change"}]}}},methods:{initData:function(t){var e=this;this.reqInfo=t,this.$nextTick((function(){t&&t.reqDate&&t.reqName||(e.$set(e.reqInfo,"reqDate",i()(new Date).format("YYYY-MM-DD hh:mm:ss")),e.$set(e.reqInfo,"reqName",s["default"].ls.get(l["J"]).realname),e.$set(e.reqInfo,"realname",s["default"].ls.get(l["J"]).realname))}))},checkData:function(){var t=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow);return t.valida},getReqInfo:function(){return this.reqInfo}}},u=c,d=(r("01a2"),r("2877")),f=Object(d["a"])(u,n,o,!1,null,"7be608d2",null);e["default"]=f.exports},"6d5b":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:{"height-100":"modal"!==t.showType}},["modal"===t.showType?r("j-modal",{attrs:{title:t.title,width:t.width,visible:t.visible,"z-index":t.zIndex,switchFullscreen:""},on:{cancel:t.handleCancel},scopedSlots:t._u([{key:"title",fn:function(){return[r("div",[r("span",[t._v(t._s(t.title)+" ")]),r("span",{staticStyle:{color:"#faad14","font-size":"12px"}},[r("a-icon",{attrs:{type:"exclamation-circle"}}),t._v(" 当前展示的账户余额基于项目申报时的状态！")],1)])]},proxy:!0},{key:"footer",fn:function(){return[r("a-button",{on:{click:t.handleCancel}},[t._v("关闭")])]},proxy:!0}],null,!1,1652030224)},[""!=t.tabLIst&&null!=t.tabLIst&&void 0!=t.tabLIst?r("a-tabs",{on:{change:t.changeTab}},t._l(t.tabLIst,(function(e){return r("a-tab-pane",{key:e.value,attrs:{tab:e.title,"v-model":t.chooseTab}})})),1):t._e(),r("vxe-table",{ref:"xTable",staticClass:"vxeTable",attrs:{data:t.dataSource,"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":"",border:"",resizable:"","header-align":"center","show-overflow":"tooltip","auto-resize":"","max-height":"400px"}},[r("vxe-table-column",{attrs:{type:"seq","show-overflow":!1,title:"序号","header-align":"center",align:"center",width:"60px"}}),r("vxe-table-column",{attrs:{field:"psnInfoName",title:"业主姓名","header-align":"center",align:"center",width:"100px"}}),r("vxe-table-column",{attrs:{field:"houseAddress","class-name":"vxe-table--rtl",title:"房屋位置","header-align":"left",minWidth:"160px",align:"left"}}),r("vxe-table-column",{attrs:{field:"struArea",title:"建筑面积 (㎡)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r,3):"0.000"}}}),r("vxe-table-column",{attrs:{field:"allotArea",title:"分摊面积 (㎡)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r,3):"0.000"}}}),r("vxe-table-column",{attrs:{field:"bankCode",title:"承办银行",width:"130px",align:"left",formatter:function(e){var r=e.cellValue;return r?t.getBankNameByCode(r):""}}}),r("vxe-table-column",{attrs:{field:"amount",title:"分摊金额 (元)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}}}),r("vxe-table-column",{attrs:{field:"accAmount",title:"资金支付 (元)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}}}),r("vxe-table-column",{attrs:{field:"cashAmount",title:"补交现金 (元)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",{class:n.cashAmount&&0!=n.cashAmount?"colorOrange":""},[t._v("\n              "+t._s(n.cashAmount?t.formatterAmount(n.cashAmount):"0.00")+"\n            ")])]}}],null,!1,3800319921)}),r("vxe-table-column",{attrs:{field:"balance",title:"账户余额 (元)","header-align":"right",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}}})],1)],1):r("div",{staticClass:"height-100 shareDetailTableBox"},[!t.childList||t.childList.length<=0?r("a-empty"):r("div",{staticClass:"shareDetailCollapse"},[t._l(t.childList,(function(e,n){return[r("a-collapse",{key:n+"",attrs:{bordered:!1},model:{value:t.activeKeyBatch,callback:function(e){t.activeKeyBatch=e},expression:"activeKeyBatch"}},[r("a-collapse-panel",{key:n+"",attrs:{forceRender:"",showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle"},[t._v("\n                  "+t._s(e.describe)),r("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKeyBatch.includes(n+"")?"rotate(90deg)":""},attrs:{type:"right"}})],1)]},proxy:!0}],null,!0)},[t.activeKeyBatch.includes(n+"")?[r("div",{staticClass:"showData"},[r("div",{staticClass:"dataGroup"},[r("div",{staticClass:"row_1"},[r("span",[t._v("参与表决户数/总户数"+t._s(e.projVote.notVotePercent>=100?"":"（"+t.floatSub(100,e.projVote.notVotePercent)+"%）"))]),"02"!=t.projMainData().baseType?r("span",[(t.hasDict("joinVotingHousePass")?t.checkCondition(t.floatDiv(e.projVote.inNum,e.projVote.totalNum),"joinVotingHousePass"):3*Number(e.projVote.inNum)>2*Number(e.projVote.totalNum))?r("div",{staticClass:"pass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"joinVotingHousePass").showLabel||">⅔")+"  通过\n                        ")]):r("div",{staticClass:"noPass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"joinVotingHouseNoPass").showLabel||"≤⅔")+"  不通过\n                        ")])]):t._e()]),r("div",{staticClass:"row_2"},[r("span",{staticClass:"num"},[t._v(t._s(e.projVote.inNum))]),r("span",[t._v("户/")]),r("span",{staticClass:"num"},[t._v(t._s(e.projVote.totalNum))]),r("span",[t._v("户")])]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"greenProgress",style:{width:t.floatSub(100,e.projVote.notVotePercent)+"%"}})])]),r("div",{staticClass:"row_1"},[r("span",[t._v("参与表决面积/总面积"+t._s(e.projVote.notVoteAreaPercent>=100?"":"（"+t.floatSub(100,e.projVote.notVoteAreaPercent)+"%）"))]),"02"!=t.projMainData().baseType?r("span",[(t.hasDict("joinVotingAreaPass")?t.checkCondition(t.floatDiv(e.projVote.inArea,e.projVote.totalArea),"joinVotingAreaPass"):3*Number(e.projVote.inArea)>2*Number(e.projVote.totalArea))?r("div",{staticClass:"pass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"joinVotingAreaPass").showLabel||">⅔")+"  通过\n                        ")]):r("div",{staticClass:"noPass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"joinVotingAreaNoPass").showLabel||"≤⅔")+"  不通过\n                        ")])]):t._e()]),r("div",{staticClass:"row_2"},[t._v(t._s(t.formatterAmount(e.projVote.inArea,3))+"m² / "+t._s(t.formatterAmount(e.projVote.totalArea,3))+"m²")]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"greenProgress",style:{width:t.floatSub(100,e.projVote.notVoteAreaPercent)+"%"}})])])]),r("div",{staticClass:"dataGroup"},[r("div",{staticClass:"row_1"},[r("span",[t._v("同意户数/参与表决户数"+t._s(e.projVote.agreePercent>0?"（"+e.projVote.agreePercent+"%）":""))]),"02"!=t.projMainData().baseType?r("span",[(t.hasDict("aggreeHousePass")?t.checkCondition(t.floatDiv(e.projVote.agreeNum,e.projVote.inNum),"aggreeHousePass"):2*Number(e.projVote.agreeNum)>Number(e.projVote.inNum))?r("div",{staticClass:"pass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"aggreeHousePass").showLabel||">½")+"  通过\n                        ")]):r("div",{staticClass:"noPass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"aggreeHouseNoPass").showLabel||"≤½")+"  不通过\n                        ")])]):t._e()]),r("div",{staticClass:"row_2"},[r("span",{staticClass:"num"},[t._v(t._s(e.projVote.agreeNum))]),r("span",[t._v("户/")]),r("span",{staticClass:"num"},[t._v(t._s(e.projVote.inNum))]),r("span",[t._v("户")])]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"blueProgress",style:{width:e.projVote.agreePercent+"%"}})])]),r("div",{staticClass:"row_1"},[r("span",[t._v("同意面积/参与表决面积"+t._s(e.projVote.agreeAreaPercent>0?"（"+e.projVote.agreeAreaPercent+"%）":""))]),"02"!=t.projMainData().baseType?r("span",[(t.hasDict("agreeAreaPass")?t.checkCondition(t.floatDiv(e.projVote.agreeArea,e.projVote.inArea),"agreeAreaPass"):2*Number(e.projVote.agreeArea)>Number(e.projVote.inArea))?r("div",{staticClass:"pass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"agreeAreaPass").showLabel||">½")+"  通过\n                        ")]):r("div",{staticClass:"noPass"},[t._v("\n                          "+t._s(t.getBlDictValByText(t.votingThroughDict,"agreeAreaNoPass").showLabel||"≤½")+"  不通过\n                        ")])]):t._e()]),r("div",[t._v(t._s(t.formatterAmount(e.projVote.agreeArea,3))+"m² / "+t._s(t.formatterAmount(e.projVote.inArea,3))+"m²")]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"blueProgress",style:{width:e.projVote.agreeAreaPercent+"%"}})])])]),r("div",{staticClass:"dataGroup"},[r("div",{staticClass:"row_1"},[r("span",[t._v("不同意户数"+t._s(e.projVote.notAgreePercent>0?"（"+e.projVote.notAgreePercent+"%）":""))])]),r("div",{staticClass:"row_2"},[r("span",{staticClass:"num"},[t._v(t._s(e.projVote.notAgreeNum))]),r("span",[t._v("户")])]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"redProgress",style:{width:e.projVote.notAgreePercent+"%"}})])]),r("div",{staticClass:"row_1"},[r("span",[t._v("不同意面积"+t._s(e.projVote.notAgreeAreaPercent>0?"（"+e.projVote.notAgreeAreaPercent+"%）":""))])]),r("div",[t._v(t._s(t.formatterAmount(e.projVote.notAgreeArea,3))+"m²")]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"redProgress",style:{width:e.projVote.notAgreeAreaPercent+"%"}})])])]),r("div",{staticClass:"dataGroup"},[r("div",{staticClass:"row_1"},[r("span",[t._v("未参与表决户数"+t._s(e.projVote.notVotePercent>0?"（"+e.projVote.notVotePercent+"%）":""))])]),r("div",{staticClass:"row_2"},[r("span",{staticClass:"num"},[t._v(t._s(e.projVote.notVoteNum))]),r("span",[t._v("户")])]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"originProgress",style:{width:e.projVote.notVotePercent+"%"}})])]),r("div",{staticClass:"row_1"},[r("span",[t._v("未参与表决面积"+t._s(e.projVote.notVoteAreaPercent>0?"（"+e.projVote.notVoteAreaPercent+"%）":""))])]),r("div",[t._v(t._s(t.formatterAmount(e.projVote.notVoteArea,3))+"m²")]),r("div",{staticClass:"row_4"},[r("div",{staticClass:"progress"},[r("div",{staticClass:"originProgress",style:{width:e.projVote.notVoteAreaPercent+"%"}})])])])]),"03"!=t.projMainData().baseType?r("div",{staticStyle:{display:"flex","align-items":"center","padding-bottom":"8px"}},[r("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(r){return t.openPrintReport(e.id)}}},[t._v("打印公示信息")]),r("a-button",{directives:[{name:"show",rawName:"v-show",value:t.comparAble,expression:"comparAble"}],attrs:{type:"primary",icon:"search"},on:{click:function(r){return t.openPrintComparReport(e.id)}}},[t._v("打印比选公示信息")]),r("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(r){return t.openPrintAllot(e.id)}}},[t._v("打印业主意见征询表")]),r("a-button",{attrs:{type:"primary",icon:"download"},on:{click:function(r){return t.downPrintAllot(e.id)}}},[t._v("下载业主意见征询表")]),t.isDetail?t._e():r("a-button",{attrs:{type:"primary",loading:t.loading,icon:"rollback"},on:{click:function(r){return t.reShare(e)}}},[t._v("重新分摊")]),!t.isDetail&&e.allotLists&&e.allotLists.length>0?r("a-tooltip",{attrs:{title:"通过表格导入方式，仅可替换手工签字以及未签字业主意见"}},[r("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"download"},on:{click:function(r){return t.exportVote(e.code)}}},[t._v("签名导出")])],1):t._e(),t.isDetail?t._e():r("a-tooltip",{attrs:{title:"通过表格导入方式，仅可替换手工签字以及未签字业主意见"}},[r("a-upload",{attrs:{name:"file",showUploadList:!1,multiple:!1,data:{projNo:e.code,projId:e.id},headers:t.tokenHeader,action:t.url.importVoteList,accept:".xlsx,.xls","before-upload":t.beforeUpload},on:{change:t.handleImportExcel}},[r("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"import"}},[t._v("签名导入")])],1)],1),t.isDetail?t._e():r("a-dropdown",[r("a-menu",{attrs:{slot:"overlay"},on:{click:function(r){return t.signBatch(r,e)}},slot:"overlay"},[r("a-menu-item",{key:"00"},[t._v("全部同意")]),r("a-menu-item",{key:"01"},[t._v("全部不同意")]),r("a-menu-item",{key:"99"},[t._v("全部未表决")])],1),r("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"}},[t._v("批量签名 "),r("a-icon",{attrs:{type:"down"}})],1)],1),r("span",{staticStyle:{display:"inline-block",width:"16px",height:"16px","background-color":"rgb(173 253 253)","margin-left":"10px"}}),t._v("\n                  已同意并已上传附件\n")],1):t._e()]:t._e(),r("vxe-table",{directives:[{name:"show",rawName:"v-show",value:t.activeKeyBatch.includes(n+""),expression:"activeKeyBatch.includes(index + '')"}],ref:"xTable",refInFor:!0,staticClass:"vxeTable",attrs:{"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":!0,data:t.isPreDeclaration?e.freezeAllotLists:e.allotLists,"edit-config":!(t.isDetail&&"01"!==t.projMainData().allotMode||"03"==t.projMainData().baseType)&&{trigger:"manual",mode:"row",showIcon:!1},"edit-rules":t.tableRules,"valid-config":{message:"default"},border:"",resizable:"",loading:t.loading,"header-align":"center","show-overflow":"tooltip","auto-resize":"","max-height":"400px","row-style":t.setRowStyle}},[r("vxe-table-column",{attrs:{type:"seq","show-overflow":!1,title:"序号",align:"center",width:"60px"}}),r("vxe-table-column",{attrs:{field:"psnInfoName",title:"业主姓名","header-align":"center",align:"center",width:"100px"}}),r("vxe-table-column",{attrs:{field:"houseAddress","class-name":"vxe-table--rtl",title:"房屋位置","header-align":"center",minWidth:"160px",align:"left"}}),r("vxe-table-column",{attrs:{field:"struArea",title:"建筑面积 (㎡)",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r,3):"0.000"}}}),r("vxe-table-column",{attrs:{field:"allotArea",title:"分摊面积 (㎡)",align:"right",width:"140px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r,3):"0.000"},"edit-render":{type:t.isAdmin}},scopedSlots:t._u([{key:"header",fn:function(){return[r("div",[r("span",[t._v("分摊面积（m²）")]),"01"===t.projMainData().allotMode?r("a-tooltip",{attrs:{title:"每次修改分摊面积均会重新进行分摊计算，当分摊户数过多时，不建议频繁修改"}},[r("a-icon",{staticStyle:{color:"#ff7e24"},attrs:{type:"question-circle"}})],1):t._e()],1)]},proxy:!0},{key:"edit",fn:function(o){var a=o.row,i=o.column;return["01"===t.projMainData().allotMode?r("a-input-number",{staticStyle:{width:"100%"},attrs:{disabled:t.isDetail||"0"===t.areaEnterState||0===Number(a.struArea),precision:3,max:a.struArea,min:Math.min(.01,a.struArea)},on:{change:function(){return t.allotAreaEditFlag++},blur:function(r){return t.allotAreaChoose(e,n,a.allotArea,{row:a,column:i})}},model:{value:a.allotArea,callback:function(e){t.$set(a,"allotArea",e)},expression:"row.allotArea"}}):r("span",[t._v(t._s(t.formatterAmount(a.allotArea,3)))])]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"balance",title:"账户余额 (元)",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}}}),r("vxe-table-column",{attrs:{field:"amount",title:"分摊金额 (元)",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"},"edit-render":t.WhetherThePermissionPasses("amountEdit:all")?{type:t.isAdmin}:null},scopedSlots:t._u([{key:"edit",fn:function(e){var o=e.row;e.column;return[r("a-input-number",{staticStyle:{width:"100%"},attrs:{disabled:t.isDetail,precision:2,max:o.budgetCost,min:0},on:{blur:function(){return t.$refs.xTable[n].updateFooter()}},model:{value:o.amount,callback:function(e){t.$set(o,"amount",e)},expression:"row.amount"}})]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"accAmount",title:"资金支付 (元)",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}}}),r("vxe-table-column",{attrs:{field:"cashAmount",title:"补交现金 (元)",align:"right",width:"130px",formatter:function(e){var r=e.cellValue;return r?t.formatterAmount(r):"0.00"}},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",{class:n.cashAmount&&0!=n.cashAmount?"colorOrange":""},[t._v(t._s(n.cashAmount?t.formatterAmount(n.cashAmount):"0.00"))])]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"signFlag",title:"业主意见",align:"center","min-width":"145px","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n                    "+t._s(t.getSignFlagValue(r.signFlag)?t.getSignFlagValue(r.signFlag)["label"]:"")+"\n                  ")]}},{key:"edit",fn:function(n){var o=n.row;return[r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("a-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择业主意见",disabled:t.isDetail||"00"!==o.signType&&!!o.signType},on:{change:function(r){return t.signFlagChange(e,o)}},model:{value:o.signFlag,callback:function(e){t.$set(o,"signFlag",e)},expression:"row.signFlag"}},t._l(t.signFlagOptions,(function(e){return r("a-select-option",{key:e.value},[t._v(t._s(e.label))])})),1),t._v(" \n                    ")],1)]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"signerPsnRelation",title:"签字人和业主关系",align:"center",width:"200px","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;e.column;return[r("a-input",{attrs:{disabled:t.isDetail,placeholder:"请输入签字人和业主关系"},on:{blur:function(e){return t.updateRelation(n)}},model:{value:n.signerPsnRelation,callback:function(e){t.$set(n,"signerPsnRelation",e)},expression:"row.signerPsnRelation"}})]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"phone",title:"联系方式",align:"center",width:"160px","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(e){var o=e.row,a=e.column;return[r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("a-input",{attrs:{disabled:t.isDetail,placeholder:"请输入联系方式"},on:{blur:function(e){return t.updateAllot(o)},change:function(e){return t.phoneChange(o,e,a,n)}},model:{value:o.phone,callback:function(e){t.$set(o,"phone",e)},expression:"row.phone"}}),o.remark?r("a-tooltip",[r("template",{slot:"title"},[r("span",{staticClass:"required"},[t._v(t._s(o.remark))])]),r("a-icon",{staticStyle:{color:"#ff7e24"},attrs:{type:"question-circle"}})],2):t._e()],1)]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"signType",title:"签字来源",align:"center",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n                    "+t._s(t.signTypeOptions.find((function(t){return t.value===r.signType}))?t.signTypeOptions.find((function(t){return t.value===r.signType}))["label"]:"/")+"\n                  ")]}}],null,!0)}),r("vxe-table-column",{attrs:{fixed:"right",title:"操作","header-align":"center",align:"center",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;e.column;return[n.fileList&&n.fileList.length>0?r("a-popover",{attrs:{arrowPointAtCenter:"",destroyTooltipOnHide:"",placement:"topRight"}},[r("template",{slot:"content"},[r("div",{staticStyle:{display:"flex","column-gap":"6px"}},t._l(n.fileList,(function(t,e){return r("img",{key:e,staticStyle:{width:"280px",height:"280px","object-fit":"contain"},attrs:{src:t.filePath,alt:""}})})),0)]),r("a",{staticStyle:{"font-size":"14px"},on:{click:function(e){return t.uploadShareFile(n)}}},[t._v("\n                        图档\n                      ")])],2):r("a",{staticStyle:{"font-size":"14px"},on:{click:function(e){return t.uploadShareFile(n)}}},[t._v("\n                      图档\n                    ")])]}}],null,!0)})],1)],2)],1),t.activeKeyBatch.find((function(t){return t==n}))?t._e():r("vxe-grid",{key:n+"table",staticClass:"pageFooterTable",style:{marginRight:e.allotLists.length>7?"24px":"16px"},attrs:{"auto-resize":"",resizable:"","show-header":!1,border:"",data:t.getFooterData(e),columns:t.tableTotalColumn}}),r("create-pro-floor-choose",t._g({ref:"floorChoose"+n,refInFor:!0,attrs:{apportionType:1,rangeIds:t.rangeIds,regionInfo:{},editPublicType:"05"===t.projMainData().baseType},on:{ok:function(e){return t.changeAllotNode(n)}}},t.$listeners))]}))],2),!t.isDetail&&t.isDoing&&t.currentNodeInfo.assigneeIdList.includes(t.loginUser.id)?r("div",{staticClass:"shareDetailFooter"},[r("a-space",[t.isPreDeclaration?r("a-button",{on:{click:t.cancellation}},[t._v("作废")]):t._e(),t.isPreDeclaration?t._e():r("a-button",{on:{click:t.handleCancel}},[t._v("撤回")]),r("a-button",{attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("提交")])],1)],1):t._e()],1),r("print-report-comp",{ref:"report"}),r("pro-roll-back-modal",{ref:"backModal",attrs:{dateAndNameIsRequired:!1},on:{ok:t.backModalOk}}),r("vxe-modal",{attrs:{title:"附件上传"},model:{value:t.uploadVisible,callback:function(e){t.uploadVisible=e},expression:"uploadVisible"}},[r("my-upload-file",{ref:"uploadFileRef",attrs:{"z-index":1300,isDetail:t.isDetail},on:{change:t.fileChange}})],1)],1)},o=[],a=r("0fea"),i=r("d8a5"),s=r("dc9a"),l=r("2b0e"),c=r("9fb0"),u=r("9bed"),d=r("3ed7"),f=(r("c1df"),r("da39")),h=r("4aae"),p=r("17a8"),m=r("fdcf"),v=r("8ef0"),g=r("e7a5");function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function b(t,e){return j(t)||x(t,e)||C(t,e)||w()}function w(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,s=[],l=!0,c=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}function j(t){if(Array.isArray(t))return t}function I(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=C(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function C(t,e){if(t){if("string"==typeof t)return _(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function P(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */P=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function b(){}function w(){}var x={};c(x,i,(function(){return this}));var j=Object.getPrototypeOf,I=j&&j(j(O([])));I&&I!==r&&n.call(I,i)&&(x=I);var C=w.prototype=g.prototype=Object.create(x);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==y(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(y(e)+" is not iterable")}return b.prototype=w,o(C,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,l,"GeneratorFunction")),t.prototype=Object.create(C),t},e.awrap=function(t){return{__await:t}},_(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(C),c(C,l,"Generator"),c(C,i,(function(){return this})),c(C,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function k(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function L(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){k(a,n,o,i,s,"next",t)}function s(t){k(a,n,o,i,s,"throw",t)}i(void 0)}))}}var D={name:"ShareDetailComp",mixins:[f["FooterMethod"]],components:{CreateProFloorChoose:g["default"],AmountInput:h["default"],PrintReportComp:u["default"],ContentView:s["default"],ProRollBackModal:p["default"],MyUploadFile:v["default"]},props:{isDetail:{type:Boolean,default:function(){return!1}},isDoing:{type:Boolean,default:!1},showFlag:{type:Boolean,default:function(){return!1}},zIndex:{type:Number,default:1310}},data:function(){var t=function(t){var e=t.cellValue;t._row;return new Promise(function(){var t=L(P().mark((function t(r,n){var o,a;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",r());case 2:if(o=new RegExp("^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\\d{8}$"),a=new RegExp("^0[1-9][0-9]{1,2}[-]?[1-9]\\d{6,7}|0[1-9][0-9]{1,2}\\s?[1-9][0-9]{6,7}|1[356789]\\d{9}"),o.test(e)||a.test(e)){t.next=8;break}return t.abrupt("return",n(new Error("您的手机号或座机号格式不正确！")));case 8:return t.abrupt("return",r());case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},e=function(t){var e=t.row,r=t.cellValue;return new Promise((function(t,n){return e.struArea>0&&(!r||Number(r)<=0)?n(new Error("分摊面积应大于0！")):t()}))};return{bankList:[],votingThroughDict:[],isPreDeclaration:!1,loginUser:l["default"].ls.get("Login_Userinfo"),comparAble:!1,websocketTimer:null,visible:!1,title:"分摊清册",width:"1300px",disableSubmit:!1,activeKey:["1"],activeKeyBatch:["0"],dataSource:[],freezeAllotLists:[],allotLists:[],tabLIst:[{value:"1",title:"预分摊清册"},{value:"2",title:"冻结分摊清册"}],allotAreaEditFlag:0,chooseTab:"1",showType:"modal",loading:!1,tableTotalColumn:[{title:"totalTitle",field:"totalTitle",align:"right"},{title:"建筑面积 (㎡)",width:105,field:"struAreaTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e,3)}},{title:"分摊面积 (㎡)",width:105,field:"allotAreaTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e,3)}},{title:"账户余额 (元)",width:105,field:"balanceTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e)}},{title:"分摊金额 (元)",width:105,field:"amountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e)}},{title:"资金支付 (元)",width:105,field:"accAmountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e)}},{title:"补交现金 (元)",width:105,field:"cashAmountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e)}},{title:"占位2",width:377,field:"empty"}],tableTotalData:[{}],rangeIds:[],url:{buildShared:"/use/projAllotList/buildShared",reShare:"/use/projAllotList/reShare",reShareForPlan:"/use/projAllotList/reShareForPlan",exportVoteList:"/use/projAllotList/downloadTemplate",importVoteList:"".concat(window._CONFIG["domianURL"],"/")+"use/projAllotList/importVoteExcel",saveVoteMsgBatch:"/use/votingHisList/saveVoteMsgBatch",saveVoteMsgBatchForPlan:"/use/votingHisList/saveVoteMsgBatchForPlan",getByIdUrl:"/use/serviceProj/queryProj",revokeLast:"/use/projVote/revokeLast",checkUserIsCorp:"/sys/sysDepart/checkUserIsCorp",endVote:"/use/projVote/endVote",editAllot:"/use/projAllotList/edit",queryRegionByList:"/base/rtRegion/queryRegionByList",queryDrawInfo:"/use/serviceProj/queryDrawInfo"},allotCashState:"1",areaEnterState:"0",tableRules:{phone:[{validator:t}],allotArea:[{validator:e}]},signFlagOptions:[{value:"00",label:"同意"},{value:"01",label:"不同意"},{value:"99",label:"未签名"}],signTypeOptions:[{value:"00",label:"手工签字"},{value:"01",label:"网络投票【业主自治平台】"},{value:"02",label:"身份证投票【智能图形识别】"},{value:"03",label:"身份证投票【身份证读取器】"},{value:"04",label:"移动端投票【小程序】"},{value:"05",label:"短信投票"}],timer:null,isAdmin:"default",operateRow:{},uploadVisible:!1,hasNoUploadValidaFile:null}},inject:["projMainData","newEditModal","nowNodeInfo","routeReload"],computed:{childList:{get:function(){return 1==this.projMainData().isHasChild?this.projMainData().children:[this.projMainData()]},set:function(){}},tokenHeader:function(){return{"X-Access-Token":l["default"].ls.get(c["a"]),sourceName:l["default"].ls.get(c["A"]),redisIndex:l["default"].ls.get(c["x"])}},currentNodeInfo:function(){try{return this.nowNodeInfo()}catch(t){return{}}}},watch:{childList:{deep:!0,immediate:!0,handler:function(t){var e,r=["struArea","allotArea","balance","amount","accAmount","cashAmount"],n=I(t||[]);try{for(n.s();!(e=n.n()).done;){var o,a=e.value,i=I(a.allotLists||[]);try{for(i.s();!(o=i.n()).done;){var s,l=o.value,c=I(r||[]);try{for(c.s();!(s=c.n()).done;){var u=s.value,f=Object(d["c"])(this.tableTotalData[0][u+"Total"]||0,Number(l[u]));this.$set(this.tableTotalData[0],u+"Total",f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){i.e(h)}finally{i.f()}}}catch(h){n.e(h)}finally{n.f()}}}},created:function(){var t=this;this.queryProcessOrder(),this.getPreDeclaration(),this.getComparAble(),this.getBankList(),this.showFlag&&(this.showType=""),this.initDict(),this.initWebSocket(),this.getDrawFileList(),Object(a["e"])(this.url.checkUserIsCorp).then((function(e){e.success||(t.isAdmin="visible")})),this.$emit("hide-footer",!1)},beforeDestroy:function(){this.websock&&this.websock.close()},methods:{WhetherThePermissionPasses:m["a"],formatterAmount:d["g"],floatSub:d["f"],floatDiv:d["d"],openFloorChooseModal:function(t,e){this.$set(this.projMainData(),"apportionFloors",[]);var r,n=I(e.allotLists);try{for(n.s();!(r=n.n()).done;){var o=r.value;this.projMainData().apportionFloors.push({id:o.nodeId,state:0,struArea:o.allotArea,houseArea:o.allotArea,houseUse:"",usableBalance:Object(d["f"])(o.balance,o.balanceFrozen)})}}catch(a){n.e(a)}finally{n.f()}this.$refs["floorChoose"+t][0].openModal()},getDrawFileList:function(){var t=this;this.hasNoUploadValidaFile=null,Object(a["j"])(this.url.queryDrawInfo,{id:this.projMainData().id,completionFlag:this.projMainData().completionFlag}).then((function(e){if(e&&e.success){var r=e.result.find((function(t){return"维修项目申报"===t.drawName}));if(r){var n=r.fileCategory.filter((function(t){return 1===t.isValid&&(!t.fileManageList||0===t.fileManageList.length)}));n&&n.length>0&&(t.hasNoUploadValidaFile=n[0])}}}))},changeAllotNode:function(t,e){var r=this,n={};n.houseIds=this.projMainData().apportionFloors.map((function(t){return t.id})),n.projId=this.projMainData().id,n.serviceProj=null,n.shareFlag="1",Object(a["k"])(this.url.buildShared,n,"application/json;charset=UTF-8").then((function(t){t.success&&t.result&&(r.projMainData().freezeAllotLists=t.result)}))},setRowStyle:function(t){var e=t.row;return e.fileList&&e.fileList.length>0&&"00"===e.signFlag?{backgroundColor:"rgb(231 255 255)"}:{}},uploadShareFile:function(t){var e=this;this.$set(this,"operateRow",t),this.uploadVisible=!0,this.$nextTick((function(){t.fileList||e.$set(t,"fileList",[]),e.$refs.uploadFileRef.init(t.fileList)}))},fileChange:function(t){this.$set(this.operateRow,"fileList",t)},getBankList:function(){var t=this;Object(a["e"])("/business/dBankCode/compList",{size:-1,current:1}).then((function(e){e&&e.success&&(t.bankList=e.result.records)}))},getBankNameByCode:function(t){var e=this.bankList.find((function(e){return e.code===t}));return e?e.name:""},getPreDeclaration:function(){var t=this;Object(i["e"])("pre_declaration").then((function(e){t.isPreDeclaration="1"==e}))},getComparAble:function(){var t=this;Object(i["e"])("compar_able").then((function(e){t.comparAble="1"==e}))},getSignFlagValue:function(t){return this.signFlagOptions.find((function(e){return e.value===t}))},beforeUpload:function(t){var e=this;return new Promise((function(r,n){var o=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length);["xlsx","xls"].includes(o)?r():(e.$message.warning("请选择正确的模板文件！"),n()),r()}))},initWebSocket:function(){this.websock&&this.websock.close();var t=window._CONFIG["domianURL"].replace("https://","wss://").replace("http://","ws://")+"/websocket/voteCode"+this.projMainData().id;this.websock=new WebSocket(t),this.websock.onopen=this.websocketOnopen,this.websock.onerror=this.websocketOnerror,this.websock.onmessage=this.websocketOnmessage,this.websock.onclose=this.websocketOnclose},websocketOnopen:function(){},heartCheckFun:function(){var t=this;t.heartCheck={timeout:2e4,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearTimeout(this.timeoutObj),this},start:function(){this.timeoutObj=setTimeout((function(){t.websocketSend("HeartBeat")}),this.timeout)}}},websocketOnerror:function(){this.reconnect()},reconnect:function(){var t=this;if(t.lockReconnect)return clearTimeout(this.websocketTimer),void(this.websocketTimer=null);t.lockReconnect=!0,this.websocketTimer=setTimeout((function(){t.initWebSocket(),t.lockReconnect=!1}),5e3)},websocketOnmessage:function(t){this.updateVoteInfo()},queryProcessOrder:function(){var t=this;Object(i["g"])("voting_through_proportional").then((function(e){e&&e.success&&e.result.length>0&&(t.votingThroughDict=e.result)}))},checkCondition:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.getBlDictValByText(this.votingThroughDict,e),n=r.flag,o=r.val,a=o.split("/"),i=b(a,2),s=i[0],l=i[1];switch(n){case"≥":return t>=Object(d["d"])(s,l);case">":return t>Object(d["d"])(s,l);case"<":return t<Object(d["d"])(s,l);case"≤":return t<=Object(d["d"])(s,l);default:return!1}},getBlDictValByText:function(t,e){try{if(t&&t.length>0){var r=t.find((function(t){return t.text===e}));if(r){var n=r.value.split(",");return{showLabel:n[0]+n[2],flag:n[0],val:n[1]}}}}catch(o){}return{showLabel:"",flag:"",val:""}},websocketOnclose:function(t){},updateVoteInfo:function(){var t=this;Object(a["e"])(this.url.getByIdUrl,{id:this.projMainData().id}).then((function(e){if(e.success){var r=t.childList.findIndex((function(t){return t.id===e.result.id}));-1!==r&&(t.$set(t.childList,r,e.result),t.countVoteMsg(t.childList[r].allotLists,t.childList[r].projVote,void 0,"数据更新中...")),t.projMainData().allotLists=e.result.allotLists,t.projMainData().votingHisLists=e.result.votingHisLists}}))},websocketSend:function(t){try{this.websock.send(t)}catch(e){}},getFooterData:function(t){for(var e=["struArea","balance","allotArea","amount","accAmount","cashAmount"],r={totalTitle:"总计："},n=0,o=e;n<o.length;n++){var a=o[n];r[a+"Total"]=0}var i,s=I(t.allotLists);try{for(s.s();!(i=s.n()).done;){var l,c=i.value,u=I(e);try{for(u.s();!(l=u.n()).done;){var f=l.value;r[f+"Total"]=Object(d["c"])(r[f+"Total"],Number(c[f]))}}catch(h){u.e(h)}finally{u.f()}}}catch(h){s.e(h)}finally{s.f()}return[r]},exportVote:function(t){var e=this.url.exportVoteList+"/"+t;Object(a["d"])(e,"业主签名"+(new Date).getTime()+".xls")},handleImportExcel:function(t){if(this.loading=!0,"done"===t.file.status)if(this.loading=!1,t.file.response.success){this.$message.success(t.file.response.message||"".concat(t.file.name," 文件上传成功"));var e=t.file.response.result;this.childList.forEach((function(t){t.id==e.id&&(t.allotLists=e.allotLists,t.projVote=e.projVote)}))}else this.$message.error("文件导入失败: ".concat(t.file.response.message," "));else"error"===t.file.status&&(this.loading=!1,this.$message.error("文件导入失败: ".concat(t.file.response.message," ")))},allotAreaChoose:function(t,e,r,n){var o=n.row,a=n.column;this.countVoteMsg(t.allotLists,t.projVote,e,"正在更新分摊面积..."),this.$refs.xTable[e].updateStatus({row:o,column:a})},amountWarn:function(t,e,r){var n=this;return"min"===t&&!1===e&&n.$message.warning("分摊面积不可小于等于0，已为您默认修改为建筑面积！"),r.struArea},reShare:function(t){var e,r=this;this.$store.commit("SET_PAGE_LOAD_STATE",{state:!0,text:"重新分摊中，请稍等..."}),e=-1!==this.$route_query.busiKey.indexOf("plan_process")?this.url.reShareForPlan:this.url.reShare,Object(a["j"])(e,t).then((function(e){e.success&&e.result?(t.allotLists=e.result,r.countVoteMsg(t.allotLists,t.projVote,void 0,"重新分摊中，请稍等...")):r.$store.commit("SET_PAGE_LOAD_STATE",{state:!1})})).catch((function(t){r.$message.error(t)}))},checkData:function(){var t=this,e=this;return new Promise((function(r,n){function o(t,e){return i.apply(this,arguments)}function i(){return i=L(P().mark((function t(r,n){var o,i,s,l,c,u,f,h,p,v;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:v=function(){return v=L(P().mark((function t(){var r;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(a["j"])("/use/projAllotList/delAndSaveBatch",e.projMainData());case 3:return r=t.sent,t.abrupt("return",r&&r.success);case 7:return t.prev=7,t.t0=t["catch"](0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),v.apply(this,arguments)},p=function(){return v.apply(this,arguments)},e.activeKeyBatch=[],o=0;case 5:if(!(o<e.childList.length)){t.next=39;break}if("1"===e.childList[o].planFlag||"03"==e.childList[o].baseType){t.next=14;break}if(e.activeKeyBatch=[o+""],i=e.isPreDeclaration?e.childList[o].freezeAllotLists:e.childList[o].allotLists,s=i.reduce((function(t,e){return Object(d["c"])(t,e.amount)}),0),s===Number(e.childList[o].budgetCost)){t.next=14;break}return e.$message.warn("分摊金额总和与预算成本不相等，请检查！"),n(),t.abrupt("return");case 14:return l=!1,t.prev=15,t.next=18,e.$refs.xTable[o].validate();case 18:l=!0,t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](15),l=!1;case 24:if(l){t.next=27;break}return n(),t.abrupt("return");case 27:return c=e.childList[o],u=void 0,t.next=31,e.checkVote(c.projVote.totalNum,c.projVote.inNum,c.projVote.agreeNum,c.projVote.totalArea,c.projVote.inArea,c.projVote.agreeArea,c.describe,c.baseType);case 31:if(u=t.sent,u){t.next=36;break}return n(),t.abrupt("return");case 36:o++,t.next=5;break;case 39:if(f=e.childList.map((function(t){return t.voteId})),"0"!==e.allotCashState){t.next=61;break}if(h=0,e.childList.map((function(t){t.allotLists&&t.allotLists.length>0&&t.allotLists.map((function(t){h+=Number(t.cashAmount)}))})),!(h>0)){t.next=48;break}e.$message.warn("当前项目不允许补交现金，请续交后再进行处理！"),n(),t.next=59;break;case 48:if(t.t1=!Object(m["a"])("amountEdit:all"),t.t1){t.next=53;break}return t.next=52,p();case 52:t.t1=t.sent;case 53:if(!t.t1){t.next=58;break}e.endVote(f),r(),t.next=59;break;case 58:n();case 59:t.next=72;break;case 61:if(t.t2=!Object(m["a"])("amountEdit:all"),t.t2){t.next=66;break}return t.next=65,p();case 65:t.t2=t.sent;case 66:if(!t.t2){t.next=71;break}e.endVote(f),r(),t.next=72;break;case 71:n();case 72:case"end":return t.stop()}}),t,null,[[15,21]])}))),i.apply(this,arguments)}t.allotAreaEditFlag>0?e.$confirm({title:"修改分摊面积后请点击重新分摊，以确保数据已保存，否则新输入的信息将丢失",icon:"info-circle",onOk:function(){o(r,n)},onCancel:function(){n()}}):o(r,n)}))},endVote:function(t){var e=this;Object(a["j"])(this.url.endVote,t).then((function(t){t.success||e.$message.error("投票失败，请联系管理员")}))},hasDict:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.votingThroughDict&&this.votingThroughDict.length>0&&!!this.votingThroughDict.find((function(e){return e.text===t}))},revocation:function(){var t=this;return new Promise((function(e,r){Object(a["j"])(t.url.revokeLast+"/"+t.projMainData().voteId).then((function(t){t.success?e():r()}))}))},initDict:function(){var t=this;Object(i["e"])("cash_allotment_allowed").then((function(e){e&&(t.allotCashState=e)})),Object(i["e"])("area_enter_state").then((function(e){e&&(t.areaEnterState=e)}))},showModal:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.$nextTick((function(){Object(a["j"])(e.url.reShare,t).then((function(t){t.success&&t.result&&(e.dataSource=t.result,e.loading=!1)}))}))},openPrintReport:function(t){this.$refs.report.type="print","04"!=this.projMainData().baseType?-1!==this.$route_query.busiKey.indexOf("plan_process")?this.$refs.report.print("plan_proj_project_report",{id:t}):this.$refs.report.print("proj_project_report",{id:t}):this.$refs.report.print("proj_insure_publicity",{id:t})},openPrintComparReport:function(t){this.$refs.report.type="print",this.$refs.report.print("compar_publicity",{proj_id:t})},openPrintAllot:function(t){this.$refs.report.type="print",-1!==this.$route_query.busiKey.indexOf("plan_process")?this.$refs.report.print("plan_sign_list",{planId:t}):this.$refs.report.print("proj_sign_list",{projId:t})},downPrintAllot:function(t){-1!==this.$route_query.busiKey.indexOf("plan_process")?this.$refs.report.print("plan_sign_list",{planId:t}):this.$refs.report.print("proj_sign_list",{projId:t})},handleOk:function(){if("modal"===this.showType)this.visible=!1;else if(this.newEditModal){if(this.hasNoUploadValidaFile)return this.$message.warning("项目附件-维修项目申报-".concat(this.hasNoUploadValidaFile.name,"未上传！"));this.newEditModal().handleOk(!0)}},cancellation:function(){var t=this.projMainData(),e=t.describe+"表决作废",r={projNo:t.code,id:t.reqId,reqDescribe:e,reqNo:t.reqNo,extId:t.id};this.$refs.backModal.title=e,this.$refs.backModal.initViews(r)},backModalOk:function(){this.routeReload()},handleCancel:function(){"modal"===this.showType?this.visible=!1:this.newEditModal&&this.newEditModal().revokeNode()},phoneChange:function(t,e,r,n){var o=this;this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){o.$refs.xTable[n].updateStatus({row:t,column:r})}),600)},updateAllot:function(){var t=L(P().mark((function t(e){var r,n;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["j"])("/drools/droolsData/exeDrools",{type:"verifyPhoneNumber",name:"verify",data:{phone:e.phone}});case 2:r=t.sent,r.success&&(n={id:e.id,phone:e.phone},Object(a["l"])(this.url.editAllot,n).then((function(t){})));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),updateRelation:function(){var t=L(P().mark((function t(e){var r;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r={id:e.id,signerPsnRelation:e.signerPsnRelation},Object(a["l"])(this.url.editAllot,r).then((function(t){}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),signFlagChange:function(t,e){var r=t.allotLists,n=t.freezeAllotLists,o=t.projVote;t.votingHisLists;this.projMainData().voteProjId=e.projId,this.projMainData().signFlag=e.signFlag,this.projMainData().voteNodeId=e.nodeId,this.isPreDeclaration?this.countVoteMsg(n,o,void 0,"正在保存签名结果..."):this.countVoteMsg(r,o,void 0,"正在保存签名结果..."),"99"!==e.signFlag?e.signType="00":e.signType=void 0},countVoteMsg:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"批量签名中，请稍等...";this.$store.commit("SET_PAGE_LOAD_STATE",{state:!0,text:n});var o={"00":[],"01":[],99:[]};t.forEach((function(t){o[t["signFlag"]].push(t)}));var a=o["00"].length,i=o["01"].length,s=o["00"].reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0),l=o["01"].reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0),c=t.length,u=t.reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0);e.inNum=Object(d["c"])(a,i),e.inArea=Object(d["c"])(s,l),e.inNumPercent=(100*Object(d["d"])(e.inNum,c)).toFixed(2),e.inAreaPercent=(100*Object(d["d"])(e.inArea,u)).toFixed(2),e.agreeNum=a,e.agreeArea=s,e.agreePercent=(100*Object(d["d"])(a,e.inNum)).toFixed(2),e.agreeAreaPercent=(100*Object(d["d"])(s,e.inArea)).toFixed(2),e.notAgreeNum=i,e.notAgreeArea=l,e.notAgreePercent=0===i?0:Object(d["f"])(100,e.agreePercent),e.notAgreeAreaPercent=0===i?0:Object(d["f"])(100,e.agreeAreaPercent),e.notVoteNum=Object(d["f"])(c,e.inNum),e.notVoteArea=Object(d["f"])(u,e.inArea),e.notVotePercent=Object(d["f"])(100,e.inNumPercent),e.notVoteAreaPercent=Object(d["f"])(100,e.inAreaPercent),e.totalArea=u,this.$forceUpdate(),void 0!=r&&this.$refs.xTable[r].updateFooter(),this.saveVoteMsg()},checkVote:function(){var t=L(P().mark((function t(e,r,n,o,i,s,l,c){var u=this;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["j"])("/drools/droolsData/exeDrools",{type:"ProjVote",name:"vote",data:{totalNum:e.toString(),inNum:r.toString(),agreeNum:n.toString(),totalArea:o.toString(),inArea:i.toString(),agreeArea:s.toString(),baseType:c?c.toString():"03",votingThroughDict:this.votingThroughDict}}).then((function(t){return t.success||u.$message.error(l+"项目"+t.result),t.success}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));function e(e,r,n,o,a,i,s,l){return t.apply(this,arguments)}return e}(),signBatch:function(t,e){this.isPreDeclaration?e.freezeAllotLists.forEach((function(e){"00"!==e.signType&&e.signType||(e.signFlag=t.key,"99"===t.key?e.signType=void 0:e.signType="00")})):e.allotLists.forEach((function(e){"00"!==e.signType&&e.signType||(e.signFlag=t.key,"99"===t.key?e.signType=void 0:e.signType="00")})),this.projMainData().voteProjId=e.id,this.projMainData().signFlag=t.key,this.isPreDeclaration?this.countVoteMsg(e.freezeAllotLists,e.projVote):this.countVoteMsg(e.allotLists,e.projVote)},saveVoteMsg:function(){var t,e=this;t=-1!==this.$route_query.busiKey.indexOf("plan_process")?this.url.saveVoteMsgBatchForPlan:this.url.saveVoteMsgBatch,Object(a["j"])(t,this.projMainData()).then((function(t){t.success||e.$message.error(t.message),e.projMainData().voteProjId=void 0,e.projMainData().signFlag=void 0,e.projMainData().voteNodeId=void 0,e.$store.commit("SET_PAGE_LOAD_STATE",{state:!1})}))},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;return 8===e?"color:#ff7f67":0===e?"text-align: right":void 0},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:3}:e<3?{colspan:0}:void 0},showAllotInfo:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.$nextTick((function(){e.tabLIst=[],e.dataSource=t,e.loading=!1}))},showAllotInfoAll:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.freezeDateSource=[],this.$nextTick((function(){e.allotLists=t.allotLists,e.dataSource=t.allotLists,null!=t.freezeAllotLists&&t.freezeAllotLists.length>0?e.freezeAllotLists=t.freezeAllotLists:e.tabLIst=[{value:"1",title:"预分摊清册"}],e.loading=!1}))},changeTab:function(t){this.dataSource="1"==t?this.allotLists:this.freezeAllotLists}}},T=D,M=(r("c440"),r("384c"),r("2877")),S=Object(M["a"])(T,n,o,!1,null,"62022e92",null);e["default"]=S.exports},7649:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.showState?r("div",{staticClass:"height100"},[r("a-collapse",{staticClass:"height100 feeCompCollapse",attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[r("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},attrs:{showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle",staticStyle:{"pointer-events":"auto"}},[t._v("\n          "+t._s(t.headerTitle)),r("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKey.includes("1")?"rotate(90deg)":""},attrs:{type:"right"}})],1)]},proxy:!0}],null,!1,2311005995)},[r("div",{staticClass:"width100 tableDiv"},[r("vxe-table",{ref:"xTable",staticClass:"vxeTable",attrs:{data:t.tableData,border:"",resizable:"",height:"auto","header-align":"center","show-overflow":"tooltip","auto-resize":"","row-style":t.setRowStyle,"tree-config":{},"checkbox-config":{labelField:"describe",checkStrictly:!1,checkMethod:t.checkFlag},"footer-method":t.footerMethodContract,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":""},on:{"checkbox-change":t.selectChangeEvent,"checkbox-all":t.selectAllEvent},scopedSlots:t._u([{key:"empty",fn:function(){return[r("div",{staticClass:"tableEmpty"},[r("a-empty",[r("span",{attrs:{slot:"description"},slot:"description"},[t._v("暂无数据")])])],1)]},proxy:!0}],null,!1,4179633735)},[r("vxe-table-column",{attrs:{"header-align":"left",type:(t.isDetail,""),"tree-node":"",field:"describe",title:"维修项目"}}),r("vxe-table-column",{attrs:{field:"baseType",width:"150px",title:"费用类型"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[r("j-d-dict-select-tag",{staticStyle:{width:"100%"},attrs:{"read-only":!0,type:"select",value:e.baseType,dictCode:"proj_cost_type"}})]}}],null,!1,426165132)}),r("vxe-table-column",{attrs:{align:"right",field:"cost",title:"预算金额（元）",width:"120px",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)}}}),r("vxe-table-column",{attrs:{align:"right",field:"contractCost",title:"合同金额（元）",width:"120px",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)}}}),t.isDetail?t._e():r("vxe-table-column",{attrs:{title:"操作","show-overflow":!1,width:"200px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return r("a",{attrs:{disabled:n.signFlag||t.cprpInfo.id&&t.cprpInfo.baseType!=n.corpType},on:{click:function(e){return t.signingContract(n)}}},[r("a-icon",{attrs:{type:"highlight"}}),t._v(" 签订")],1)}}],null,!1,852964565)})],1)],1)])],1),r("contract-preview-comp",{ref:"preview",on:{ok:t.signOk}})],1):t._e()},o=[],a=(r("6eb7"),r("0a5e")),i=r("ac0d"),s=r("6fa9"),l=r("eccd"),c=r("4aae"),u=r("bd75"),d=r("d8a5"),f=r("da39"),h=r("c695"),p=r.n(h),m=r("ca00"),v=r("2b0e"),g=r("9fb0"),y=r("3ed7");function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=w(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function w(t,e){if(t){if("string"==typeof t)return x(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var j={name:"ProjectFeeComp",components:{ContractPreviewComp:u["default"],AmountInput:c["default"],MESSuperQuery:s["default"],JDDictSelectTag:l["default"]},mixins:[a["a"],i["b"],f["FooterMethod"]],inject:["projMainData"],props:{isDetail:{type:Boolean,default:!1}},data:function(){return{activeKey:["0","1"],headerTitle:"维修费用",tableHeight:"200px",showState:!0,childProj:[],comSort:0,deviceList:[],url:{list:"/ServiceCost/serviceCost/list",getByType:"/business/contractTemplate/getByType"},tableData:[],childData:[],deviceData:[],editRules:{cost:[{required:!0,message:"请填写金额",trigger:"change"}]},modifyFeeState:"true",modifyContract:"false",feeAllocation:"",modelCost:{},cprpInfo:{},formatterAmount:y["g"]}},computed:{projObj:function(){return this.projMainData()}},mounted:function(){var t=this;this.$bus.$on("selectTress",(function(e){e&&(t.deviceList=e)}))},created:function(){var t=this;Object(d["e"])("fee_allocation").then((function(e){t.feeAllocation=e})),this.cprpInfo=v["default"].ls.get(g["e"]),this.initData("")},methods:{signingContract:function(t){this.$refs.preview.initData(t)},initData:function(t){var e=this;if(t&&(this.comSort=t),this.projObj&&this.projObj.costs&&this.projObj.costs.length>0){this.tableData=this.projObj.costs.filter((function(t){return t.projId==e.projObj.id})),this.tableData.sort((function(t,e){return Number(t.baseType)-Number(e.baseType)}));var r=this.projObj.costs.filter((function(t){return t.projId!=e.projObj.id&&"01"===t.baseType})),n=this.tableData.findIndex((function(t){return"01"===t.baseType}));n>=0&&(this.tableData[n].children=r.filter((function(t){return"01"===t.baseType})))}this.$nextTick((function(){e.$refs.xTable.setAllTreeExpand(!0)}));var o,a=b(this.tableData);try{var i=function(){var t=o.value;if(t.contractId&&"1"==t.contractId)return(t.children||[]).forEach((function(t){t.signFlag=!0})),1;(t.children||[]).forEach((function(e){e.contractId&&"1"==e.contractId&&(t.signFlag=!0)}))};for(a.s();!(o=a.n()).done;)i()}catch(s){a.e(s)}finally{a.f()}},afterChoose:function(t){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.projObj.construction.projId=this.projObj.id,this.projObj.construction.chargeCorpCode=t[0].code,this.projObj.construction.chargeCorpMan=t[0].linkMan,this.projObj.construction.chargeCorpPhone=t[0].phone},signOk:function(t,e){var r=this;t.contractCost=e,t.children?t.children.forEach((function(t){r.$set(t,"signFlag",!0)})):this.tableData.forEach((function(e){e.children.forEach((function(n){n.id==t.id&&r.$set(e,"signFlag",!0)}))})),this.$refs.xTable.loadData(this.tableData)},checkFlag:function(t){return!t.row.signFlag},setRowStyle:function(t){var e=t.row,r=["rgb(242 242 252)","rgb(243,255,243)","#f3faff","rgb(255,243,243)","rgb(255,255,243)"],n="";switch(e.baseType){case"02":n=r[0];break;case"03":n=r[1];break;case"04":n=r[2];break;case"05":n=r[3];break;case"06":n=r[4];break;default:}return{backgroundColor:n}},batchSigning:function(){},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:2}:e<2?{colspan:0}:void 0},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;if(0===e)return"text-align: right"},footerMethodContract:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";if(["cost","contractCost"].includes(t.property)){if(r[0].children&&r[0].children.length>0){var n=r[0].children,o=Object(m["c"])(r);return o[0].cost=0,Object(y["g"])(Number(p.a.sum(n,t.property)))}return Object(y["g"])(Number(p.a.sum(r,t.property)))}}))]}}},I=j,C=(r("52af"),r("2877")),_=Object(C["a"])(I,n,o,!1,null,"145cd680",null);e["default"]=_.exports},"788f":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"projectInfo"},[r("div",{staticClass:"tableDiv"},[r("vxe-table",{directives:[{name:"show",rawName:"v-show",value:!t.isDetailPage,expression:"!isDetailPage"}],attrs:{border:"inner",height:"auto",data:t.projectTable}},[r("vxe-table-column",{attrs:{width:"60",title:"序号",type:"seq"}}),r("vxe-table-column",{attrs:{width:"40%",title:"维修项目",field:"name"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("a",[t._v(t._s(n.name))])]}}])}),r("vxe-table-column",{attrs:{width:"30%",title:"生成时间",field:"date"}}),r("vxe-table-column",{attrs:{title:"下载记录",field:"down"}}),r("vxe-table-column",{attrs:{title:"操作"}},[[r("a",[t._v("下载")])]],2)],1)],1)])},o=[],a={name:"ProjectInfo",data:function(){return{projectTable:[{name:"预算分摊清册",date:"2022-06-21 12:25:36",down:"13"},{name:"预算分摊清册",date:"2022-06-21 12:25:36",down:"13"}],isDetailPage:!1}}},i=a,s=(r("d883"),r("2877")),l=Object(s["a"])(i,n,o,!1,null,"f8e743ea",null);e["default"]=l.exports},"7a0f":function(t,e,r){"use strict";r("0791")},"7b9c":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"grantManage"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isFinish,expression:"!isFinish"}],staticClass:"height100"},[r("content-view",{attrs:{"show-icon":!1,title:"项目信息"}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{attrs:{xxl:2,xl:4,span:6}},[t._v("维修项目描述")]),r("a-col",{attrs:{xxl:22,xl:20,span:18}},[t._v(t._s(t.model.describe))]),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("申报小区")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.model.communityName))]),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("项目类型")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.getBaseTypeText(t.model.baseType)))]),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("预算金额")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t._f("getAmount")(t.model.budgetCost))+"元")]),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("审核金额")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t._f("getAmount")(t.model.contractCost))+"元")]),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("决算金额")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t._f("getAmount")(t.model.finalCost))+"元")])],1)],1),t._l(t.costTypeList,(function(e,n){return r("content-view",{key:"costType"+e.costType,attrs:{"show-icon":!1,title:e.costTypeText}},[r("vxe-table",{ref:"table",refInFor:!0,attrs:{"cell-style":t.setCellStyle,border:"","auto-resize":"",data:e.data,align:"center","footer-align":"right","show-footer":"","footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"edit-config":{showIcon:!1}}},[r("vxe-table-column",{attrs:{width:"160",field:"fundType",title:"拨款类型","header-align":"center"}}),r("vxe-table-column",{attrs:{width:"100",field:"orderNum",title:"拨款序号","header-align":"center"}}),r("vxe-table-column",{attrs:{field:"progressInfo",title:"进度描述","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[r("a-input",{attrs:{placeholder:"描述"},model:{value:n.progressInfo,callback:function(e){t.$set(n,"progressInfo",e)},expression:"row.progressInfo"}})]}}],null,!0)}),r("vxe-table-column",{attrs:{width:"180",field:"ratio",title:"拨款比例","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(o){var a=o.row;return[r("div",{staticClass:"inputNumberUnit"},[r("a-input-number",{staticClass:"width100",attrs:{min:1,max:100,precision:2,placeholder:"比例",disabled:"01"!==a.costType},on:{change:function(r){return t.ratioChangeEvent(a,e.data,n)}},model:{value:a.ratio,callback:function(e){t.$set(a,"ratio",e)},expression:"row.ratio"}}),r("span",{staticClass:"amountUnit"},[t._v("%")])],1)]}}],null,!0)}),r("vxe-table-column",{attrs:{width:"200",field:"preAmount",formatter:t.formaAmount,align:"right"},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",[t._v("计划拨款金额（元）")]),"01"===e.costType?r("a-tooltip",{attrs:{title:"当总金额与审核金额不一致时，系统会自动对差额进行调平处理。"}},[r("a-icon",{staticClass:"color-orange",attrs:{type:"question-circle"}})],1):t._e()]},proxy:!0}],null,!0)}),"01"===e.costType?[r("vxe-table-column",{attrs:{width:"150",field:"isPay",title:"是否决算后支付","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(n){var o=n.row;return[r("a-switch",{attrs:{"checked-children":"是","un-checked-children":"否",checked:"0"!=o.isFinalPay,disabled:o.orderNum>1||o.disabledSwitch||!t.WhetherThePermissionPasses("fundProgress:all")},on:{change:function(r){return t.onChange(o,e.data)}}})]}}],null,!0)}),r("vxe-table-column",{attrs:{title:"操作",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(n){var o=n.row,a=n.rowIndex;return["0"==o.isMargin&&"01"==o.costType&&t.WhetherThePermissionPasses("fundProgress:all")?r("a",{on:{click:function(r){return t.addFundProgress(o,e,e.costType)}}},[r("a-icon",{attrs:{type:"plus"}}),t._v(" 新增")],1):t._e(),a>0&&o.orderNum>1&&"0"==o.isMargin?r("a-divider",{attrs:{type:"vertical"}}):t._e(),a>0&&o.orderNum>1&&"0"==o.isMargin&&"01"==o.costType&&t.WhetherThePermissionPasses("fundProgress:all")?r("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return t.deleteFundProgress(o,a,e,e.costType)}}},[r("a",[r("a-icon",{attrs:{type:"delete"}}),t._v(" 删除")],1)]):t._e()]}}],null,!0)})]:t._e()],2)],1)})),r("div",{directives:[{name:"show",rawName:"v-show",value:"finish"==this.nodeId(),expression:"this.nodeId() == 'finish'"}],staticClass:"grantFooter"},[t.WhetherThePermissionPasses("fundProgress:all")?r("a-button",{attrs:{loading:t.saveLoading,icon:"check",type:"primary",disabled:t.isConfirm},on:{click:t.handleConfirm}},[t._v("确认")]):t._e()],1),r("maint-fund-progress-modal",{ref:"mFunProModal",on:{ok:t.resOk}})],2),r("mini-fund-prog-list",{directives:[{name:"show",rawName:"v-show",value:t.isFinish,expression:"isFinish"}],ref:"miniList",on:{shiftPage:t.shiftPage}})],1)},o=[],a=r("3ed7"),i=r("0fea"),s=r("412c"),l=r("387b"),c=r("7916"),u=r("dc9a"),d=r("c695"),f=r.n(d),h=r("0c8a"),p=r("fdcf");function m(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=v(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function v(t,e){if(t){if("string"==typeof t)return g(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var y={name:"FundProgressManage",components:{ContentView:u["default"],MiniFundProgList:c["default"],BaseInfo:l["default"],MaintFundProgressModal:s["default"]},inject:["projMainData","nodeId"],computed:{model:{get:function(){return this.projMainData?this.projMainData():{}},set:function(){}}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(a["g"])(t):"0.00"}},data:function(){return{proModel:{},loading:!1,dictOptions:{},projId:"",isFinish:!0,url:{getFundInfo:"/use/fundProgress/getFundInfo",confirmFundProgressInfo:"/use/fundProgress/confirmFundProgressInfo",checkState:"/use/fundProgress/checkState"},isConfirm:!1,costTypeList:[],saveLoading:!1,formatterAmount:a["g"],getBaseTypeText:h["getBaseTypeText"]}},created:function(){this.checkState()},methods:{WhetherThePermissionPasses:p["a"],footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){return 0===e?"总计：":"ratio"===t.property?Number(f.a.sum(r,t.property))+"%":"preAmount"===t.property?Object(a["g"])(Number(f.a.sum(r,t.property))):void 0}))]},footerSpanMethod:function(t){var e=t._columnIndex;return 0===e?{colspan:3}:e<3?{colspan:0}:void 0},getCountAmount:function(t){var e=0;return t.forEach((function(t){e=Object(a["c"])(e,t.preAmount)})),e},checkState:function(){var t=this;this.isConfirm="7"!=this.projMainData().state;var e=[];this.projMainData().children&&this.projMainData().children.length>0?this.projMainData().children.forEach((function(t){e.push(t.id)})):e.push(this.projMainData().id),Object(i["e"])(this.url.checkState+"/"+[e]).then((function(e){e.success?(t.isFinish=e.result,e.result?t.$refs.miniList.initData(t.projMainData().id):t.initData()):t.$message.warning("操作失败，请检查项目状态")}))},initData:function(){this.isFinish=!1;var t=this;t.projId=this.projMainData().id,t.loading=!0,t.costTypeList=[],Object(i["j"])(t.url.getFundInfo+"/"+t.projId).then((function(e){e.success?(t.proModel=e.result,t.proModel&&(t.proModel.fundProgresses.forEach((function(e){var r=t.costTypeList.findIndex((function(t){return t.costType===e.costType}));-1===r?t.costTypeList.push({costType:e.costType,costTypeText:t.getCostTypeText(e.costType),data:[e]}):t.costTypeList[r].data.push(e)})),t.getCostProgressInfo(),t.$forceUpdate())):t.$message.warning(e.message)})).finally((function(){t.loading=!1}))},getCostTypeText:function(t){switch(t){case"01":return"工程款";case"02":return"审价费";case"03":return"监理费";case"04":return"招标费";case"05":return"检测费";case"06":return"造价费";default:return""}},getCostProgressInfo:function(){var t,e=this,r=m(e.costTypeList);try{var n=function(){var r=t.value,n=[];if(r.data.forEach((function(t){if("01"!==r.costType)return t.progressInfo="".concat(e.getCostTypeText(t.costType),"拨付"),void(t.fundType="".concat(e.getCostTypeText(t.costType),"支付"));"1"!==t.isMargin?(t.fundType="维修费支付",n.push(t)):(t.fundType="保证金支付",t.progressInfo="保证金拨付")})),"01"!==r.costType)return 1;n.forEach((function(t,e){if(1===n.length)t.progressInfo="工程款决算款拨付";else if(2===n.length)0===e&&(t.progressInfo="工程款首款拨付"),1===e&&(t.progressInfo="工程款尾款拨付");else switch(e){case 0:t.progressInfo="工程款首款拨付";break;case n.length-1:t.progressInfo="工程款尾款拨付";break;default:t.progressInfo="工程款第".concat(e+1,"次拨付")}}))};for(r.s();!(t=r.n()).done;)n()}catch(o){r.e(o)}finally{r.f()}},formaAmount:function(t){var e=t.cellValue;return Object(a["g"])(e)},handleChildDetail:function(){var t=[];this.projId&&t.push(this.projId),this.$refs.mFunProModal.initData(t)},ratioChangeEvent:function(t,e,r){t.ratio>=0&&t.ratio<=100&&(t.preAmount=(t.contractCost*t.ratio/100).toFixed(2)),this.$refs.table[r].updateFooter()},addFundProgress:function(t,e,r){var n=[];e.data.forEach((function(t){"0"==t.isMargin&&n.push(t)}));var o=0;n.length>0&&(o=Math.max.apply(Math,n.map((function(t){return t.orderNum}))));var a=e.data.findIndex((function(e){return e.orderNum==o&&e.costType==t.costType})),i={costType:t.costType,orderNum:2,amount:0,isMargin:t.isMargin,contractId:t.contractId,costId:t.costId,projId:t.projId,isFinalPay:t.isFinalPay,ratio:1,preAmount:Number(this.proModel.construction.cost)/100,contractCost:t.contractCost};if(-1==a?e.data.push(i):e.data.splice(1,0,i),e.data.length>0)for(var s=2;s<e.data.length;s++)e.data[s].orderNum++;this.costIsFinplay("0",!1,e,r),this.getCostProgressInfo()},deleteFundProgress:function(t,e,r,n){if(r.data.length>0){r.data.splice(e,1);for(var o=e;o<r.data.length;o++)r.data[o].orderNum--;this.costIsFinplay("1",!0,r,n),this.getCostProgressInfo()}},costIsFinplay:function(t,e,r,n){var o=r.data.findIndex((function(t){return"1"==t.isMargin})),a=r.data?r.data.length:0;r.data.forEach((function(r){e?(a===r.orderNum||a-1===r.orderNum&&o>=0)&&(r.isFinalPay=t,r.disabledSwitch=e):1===r.orderNum||a-1>r.orderNum||a-1===r.orderNum&&o<0?(r.isFinalPay=t,r.disabledSwitch=e):(r.isFinalPay="1",r.disabledSwitch=!e)}))},resOk:function(){this.initData()},handleConfirm:function(){var t=this,e=this;e.proModel.fundProgresses=e.costTypeList.reduce((function(t,e){return t.concat(e.data||[])}),[]),e.saveLoading=!0,Object(i["j"])(e.url.confirmFundProgressInfo,Object.assign({},e.proModel)).then((function(r){return r.success?(e.$message.success(r.result),e.isFinish=!0,e.$refs.miniList.initData(t.projMainData().id),!0):(e.$message.warning(r.message),!1)})).finally((function(){e.loading=!1,e.saveLoading=!1}))},onChange:function(t,e){"0"===t.isFinalPay?(t.isFinalPay="1",1===t.orderNum&&e.forEach((function(t){1!==t.orderNum&&(t.isFinalPay="1")}))):(t.isFinalPay="0",1===t.orderNum&&e.forEach((function(t){1===t.orderNum||"0"!==t.isMargin||t.disabledSwitch||(t.isFinalPay="0")})))},shiftPage:function(){this.initData()},checkData:function(){var t=this;return new Promise((function(e,r){var n=t;n.loading=!0,t.proModel.fundProgresses=t.costTypeList.reduce((function(t,e){return t.concat(e.data||[])}),[]),Object(i["j"])(n.url.confirmFundProgressInfo,Object.assign({},n.proModel)).then((function(r){r.success?(n.$message.success(r.result),t.isFinish=!0,e()):n.$message.warning(r.message)}))}))},setCellStyle:function(t){if("ratio"===t.column.property&&100==t.row.ratio&&"01"!==t.row.costType)return{backgroundColor:"#f5f5f5"}}}},b=y,w=(r("fc393"),r("2877")),x=Object(w["a"])(b,n,o,!1,null,"205bda79",null);e["default"]=x.exports},"7c3f":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content",attrs:{"element-loading-text":"正在加载中..."}},[t._l(t.data,(function(e,n){return[r("a-collapse",{key:n+"",attrs:{bordered:!1},model:{value:t.activeKeyBatch,callback:function(e){t.activeKeyBatch=e},expression:"activeKeyBatch"}},[r("a-collapse-panel",{key:n+"",attrs:{forceRender:"",showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",{staticClass:"collapseTitle"},[t._v("\n            "+t._s(e.describe)),r("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKeyBatch.includes(n+"")?"rotate(90deg)":""},attrs:{type:"right"}})],1)]},proxy:!0}],null,!0)},[r("div",{staticClass:"collapseBody"},[r("a-steps",{attrs:{direction:"vertical"},model:{value:t.current,callback:function(e){t.current=e},expression:"current"}},t._l(e.processSupervision,(function(n,o){return r("a-step",{key:o,scopedSlots:t._u([{key:"icon",fn:function(){return[r("span",{staticClass:"stepIcon",class:{active:t.current===Object.keys(e.processSupervision).indexOf(o)}},[t._v("\n                  "+t._s(Object.keys(e.processSupervision).length-Object.keys(e.processSupervision).indexOf(o))+"\n                ")])]},proxy:!0},{key:"title",fn:function(){return[t._v("\n                "+t._s(o)+"  "),r("a-tooltip",{attrs:{placement:"top"}},[r("template",{slot:"title"},[r("span",[t._v("点击添加监督信息")])]),t.WhetherThePermissionPasses("superviceDetail:third,superviceDetail:all")?r("a-icon",{attrs:{type:"plus-circle"},on:{click:function(r){return t.handleUpload(o,e.id)}}}):t._e()],2)]},proxy:!0},n&&n.length>0?{key:"description",fn:function(){return t._l(n,(function(n,a){return r("div",{key:a,staticClass:"descriptionText"},[r("span",[t._v(t._s(n.supervisionBy))]),t._v("  "),r("span",[t._v(t._s(n.supervisionDate))]),t._v("  "),r("span",{staticStyle:{color:"#8CD7A8"}},[t._v(t._s(n.describe)+" ")]),t._v("   "),t.checkShow(n)?r("a-icon",{staticStyle:{"font-size":"18px"},attrs:{type:"edit"},on:{click:function(r){return t.editUpload(n,o,e.id)}}}):t._e(),t.loading?t._e():r("img-list",{attrs:{"is-thumbnail":!0,"img-list":n.fileManageList}})],1)}))},proxy:!0}:null],null,!0)})})),1)],1)])],1)]})),r("field-site-upload",{ref:"fSiteUp",attrs:{zindexNumber:t.zIndex,isLoad:!0},on:{ok:t.modelLoad}})],2)},o=[],a=r("eccd"),i=r("9fbd"),s=r("0fea"),l=r("4a12"),c=r("be8c"),u=r("4ec3"),d=r("dc9a"),f=r("fdcf"),h={name:"FieldSiteInfoComp",components:{ContentView:d["default"],JDDictSelectTag:a["default"],TypeAttachmentUpload:i["default"],ImgList:l["default"],FieldSiteUpload:c["default"]},props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"现场勘察记录"},projId:{type:String,default:""},zIndex:{type:Number,default:1400}},inject:["projMainData"],provide:function(){return{projMainData:function(){return{}}}},created:function(){this.initData()},data:function(){return{data:[],current:0,fileuploadIds:[],activeKey:["1"],activeKeyBatch:["0"],url:{queryProList:"/use/processSupervision/getBpSurByProjId"},loading:!1}},methods:{WhetherThePermissionPasses:f["a"],initData:function(){var t,e=this;this.loading=!0,t=""===this.projId?this.url.queryProList+"/"+this.projMainData().id:this.url.queryProList+"/"+this.projId,this.activeChildKey=[],this.fileuploadIds=[],Object(s["j"])(t).then((function(t){t.success&&(e.data=t.result)})).finally((function(){e.loading=!1}))},handleUpload:function(t,e){var r=this,n=Object(u["C"])("process_stage");if(n&&n.length>0){var o=n.filter((function(e){return t==e.text})),a=Object.assign({},{projId:""!==this.projId?this.projId:e,processStage:o.length>0?o[0].value:""});this.$refs.fSiteUp.add(a)}else Object(u["i"])("process_stage",null).then((function(e){if(e.success&&e.result&&e.result.length>0){var n=e.result.filter((function(e){return t==e.text})),o=Object.assign({},{projId:""!==r.projId?r.projId:r.projMainData().id,processStage:n.length>0?n[0].value:""});r.$refs.fSiteUp.add(o)}}))},editUpload:function(t,e,r){var n=this,o=Object(u["C"])("process_stage");if(o&&o.length>0){var a=o.filter((function(t){return e==t.text})),i=Object.assign(t,{projId:""!==this.projId?this.projId:r,processStage:a.length>0?a[0].value:""});this.$refs.fSiteUp.add(i)}else Object(u["i"])("process_stage",null).then((function(r){if(r.success&&r.result&&r.result.length>0){var o=r.result.filter((function(t){return e==t.text})),a=Object.assign(t,{projId:""!==n.projId?n.projId:n.projMainData().id,processStage:o.length>0?o[0].value:""});n.$refs.fSiteUp.add(a)}}))},modelLoad:function(){var t=this;this.$nextTick((function(){t.initData()}))},checkShow:function(t){return"01"==t.processStage?"9"==this.projMainData().state:"01"!=t.processStage?"0"==this.projMainData().completionFlag:void 0}}},p=h,m=(r("d6ec"),r("2877")),v=Object(m["a"])(p,n,o,!1,null,"658a9504",null);e["default"]=v.exports},8261:function(t,e,r){},"96af":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"transferTable"},[r("a-transfer",{ref:"transfer",staticClass:"transfer",attrs:{rowKey:function(t){return t.id},disabled:t.disabled,"show-search":t.showSearch,"show-select-all":!1,listStyle:{flex:1,width:0}},on:{change:t.onChange},scopedSlots:t._u([{key:"children",fn:function(e){var n=e.props,o=n.direction,a=(n.filteredItems,n.selectedKeys,n.disabled),i=e.on,s=i.itemSelectAll,l=i.itemSelect;return[r("div",{staticClass:"transferBody"},["right"===o?r("div",[r("a-button",{attrs:{type:"primary"},on:{click:t.openModal}},[t._v("合并选中项")]),r("a-button",{on:{click:t.unMergeSelected}},[t._v("拆分选中项")])],1):t._e(),"right"===o?r("div",{staticClass:"tableBox"},[r("vxe-table",{ref:"projTable",attrs:{"auto-resize":"",height:"auto",data:t.rightProjData,"checkbox-config":{trigger:"row",showHeader:!1,checkStrictly:!0},"tree-config":{children:"children"}},on:{"checkbox-all":function(e){var r=e.records,n=e.checked;return t.tableChoose({records:r,tableData:t.rightProjData,direction:o,checked:n,itemSelectAll:s,desc:!0})},"checkbox-change":function(e){var r=e.row,n=e.checked;return t.tableChoose({row:r,checked:n,direction:o,itemSelect:l,isAll:!1,desc:!0})}}},[r("vxe-table-column",{attrs:{type:"checkbox","tree-node":""}}),r("vxe-table-column",{attrs:{field:"describe",title:"项目描述"}}),r("vxe-table-column",{attrs:{field:"communityName",title:"小区名称"}}),r("vxe-table-column",{attrs:{field:"allotMode",title:"分摊方式"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s("01"==n.allotMode?"面积分摊":"按户均摊"))])]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"cost",title:"cost"}})],1)],1):t._e(),"left"===o?r("div",{staticClass:"tableBox"},[r("vxe-table",{key:o+"table"+t.tableKey,ref:o+"Table",style:{pointerEvents:a?"none":null},attrs:{"auto-resize":"",height:"auto",data:t.leftData,"tree-config":{children:"children"},"check-config":{},"expand-config":{accordion:!0,labelField:"describe"}}},[r("vxe-table-column",{attrs:{"tree-node":"",width:"40px",align:"center"}}),r("vxe-table-column",{attrs:{type:"expand",field:"describe",title:"计划描述"},scopedSlots:t._u([{key:"content",fn:function(e){var n=e.row;return[r("vxe-table",{attrs:{"auto-resize":"","max-height":"400px","row-id":"id",data:n.projPlanLists,"checkbox-config":{trigger:"row",reserve:!1,checkRowKeys:t.selectedProjLeft.map((function(t){return t.id}))}},on:{"checkbox-all":function(e){var r=e.records,a=e.checked;return t.tableChoose({records:r,tableData:n.projPlanLists,parentRow:n,direction:o,checked:a,itemSelectAll:s})},"checkbox-change":function(e){var r=e.row,a=e.checked;return t.tableChoose({row:r,parentRow:n,checked:a,direction:o,itemSelect:l,isAll:!1})}}},[r("vxe-table-column",{attrs:{type:"checkbox"}}),r("vxe-table-column",{attrs:{field:"startTime",title:"开始时间"}}),r("vxe-table-column",{attrs:{field:"cost",title:"本次费用"}})],1)]}}],null,!0)}),r("vxe-table-column",{attrs:{field:"communityName",title:"小区名称"}}),r("vxe-table-column",{attrs:{field:"allotMode",title:"分摊方式"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("span",[t._v(t._s("01"==n.allotMode?"面积分摊":"按户均摊"))])]}}],null,!0)})],1)],1):t._e()])]}}])}),r("vxe-modal",{attrs:{width:"800px","z-index":t.zIndex,"show-footer":""},scopedSlots:t._u([{key:"footer",fn:function(){return[r("a-button",[t._v("取消")]),r("a-button",{attrs:{type:"primary"},on:{click:t.modalOk}},[t._v("确认")])]},proxy:!0}]),model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[r("a-form-model",{ref:"formModel",attrs:{model:t.model,labelCol:{span:0},wrapperCol:{spanb:0}}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{attrs:{span:4}},[t._v("上级节点")]),r("a-col",{attrs:{span:8}},[r("a-tree-select")],1),r("a-col",{attrs:{span:4}},[t._v("describe")]),r("a-col",{attrs:{span:8}},[r("a-form-model-item",[r("a-input",{model:{value:t.model.describe,callback:function(e){t.$set(t.model,"describe",e)},expression:"model.describe"}})],1)],1),r("a-col",{attrs:{span:4}},[t._v("communityName")]),r("a-col",{attrs:{span:8}},[r("a-input",{model:{value:t.model.communityName,callback:function(e){t.$set(t.model,"communityName",e)},expression:"model.communityName"}})],1)],1)],1)],1)],1)},o=[],a=r("ceac"),i=r.n(a),s=r("3ed7");function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t){return h(t)||f(t)||d(t)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){if(t){if("string"==typeof t)return p(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function f(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function h(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return(e=y(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function y(t){var e=b(t,"string");return"symbol"==l(e)?e:e+""}function b(t,e){if("object"!=l(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var w={name:"TransferTable",props:{zIndex:{type:Number,default:1300}},data:function(){return{isEdit:!1,visible:!1,model:{},sourceData:[],leftData:[],sourceTreeToArr:[],rightData:[],rightProjData:[],rightProjSelectedKeys:new Set,rightProjSelectedRows:[],selectedRows:[],selectedProjLeft:[],selectedProjRight:[],disabled:!1,showSearch:!1,tableKey:0}},mounted:function(){},methods:{initDate:function(t){var e=this;this.sourceData=t,this.leftData=[],this.sourceData.forEach((function(t){e.leftData.push(JSON.parse(JSON.stringify(t)))})),this.sourceTreeToArr=this.getArrayByTree(this.leftData),this.tableKey++},getArrayByTree:function(t){var e=[];return t.forEach((function(t){e.push(JSON.parse(JSON.stringify(t))),t.child?(t.child||[]).forEach((function(t){e.push(JSON.parse(JSON.stringify(t))),t.projPlanLists=t.projPlanLists||[],t.projPlanLists.forEach((function(t){e.push(JSON.parse(JSON.stringify(t)))}))})):(t.projPlanLists=t.projPlanLists||[],t.projPlanLists.forEach((function(t){e.push(JSON.parse(JSON.stringify(t)))})))})),e},onChange:function(t,e,r){var n=this;this.selectedRows=[];var o=[];o="right"===e?this.selectedProjLeft:this.rightProjSelectedRows,o.forEach((function(t){n.getRightTableData(t.id,e)})),"left"===e&&(this.rightProjData=this.rightProjData.filter((function(t){return!r.includes(t.id)}))),this["right"===e?"leftData":"rightData"]=this["right"===e?"leftData":"rightData"].filter((function(t){return t.children&&0!==t.children.length?(t.children=(t.children||[]).filter((function(t){return t.projPlanLists=t.projPlanLists.filter((function(t){return!r.includes(t.id)})),0!==t.projPlanLists.length})),"right"===e||0!==t.children.length):(t.projPlanLists=(t.projPlanLists||[]).filter((function(t){return!r.includes(t.id)})),"right"===e||t.projPlanLists&&0!==t.projPlanLists.length)})),this.selectedRows=[],this["left"===e?"selectedProjRight":"selectedProjLeft"]=[]},triggerDisable:function(t){this.disabled=t},tableChoose:function(t){var e=this,r=t.checked,n=t.records,o=t.tableData,a=t.row,s=t.direction,l=t.itemSelectAll,c=t.itemSelect,u=t.isAll,d=void 0===u||u,f=t.desc;if("left"===s)if(d){var h=this["selectedProjLeft"],p=n.map((function(t){var e=t.id;return e})),m=r?i()(p,h.map((function(t){return t.id}))):i()(h.map((function(t){return t.id})),p);l(m,r),o.forEach((function(t){e.setSelectedProjList(r,t,s)}))}else c(a.id,r),this.setSelectedProjList(r,a,s);else if(!0===f&&a.id&&a.planId){c(a.id,r);var v=this.rightProjSelectedRows.findIndex((function(t){return t.id===a.id}));r?(this.rightProjSelectedKeys.add(a.id),-1===v&&this.rightProjSelectedRows.push(a)):(this.rightProjSelectedKeys.delete(a.id),-1!==v&&this.rightProjSelectedRows.splice(v,1))}},setSelectedProjList:function(t,e,r){var n=this["left"===r?"selectedProjLeft":"selectedProjRight"],o=n.findIndex((function(t){return t.id===e.id}));t&&-1===o?n.push(e):t||-1===o||n.splice(o,1)},openModal:function(t){this.isEdit=!1,t&&(this.isEdit=!0,this.model=JSON.parse(JSON.stringify(t))),0===this.rightProjSelectedKeys.size?this.$message.warning("请至少选择一条数据！"):this.checkDataMarge()&&(this.visible=!0)},checkDataMarge:function(){var t=this,e=[];this.rightProjSelectedKeys.forEach((function(r){e.push(t.rightProjData.find((function(t){return t.id===r})))}));for(var r=e[0].allotMode,n=e[0].regionCode,o=0,a=e;o<a.length;o++){var i=a[o];if(r!=i.allotMode)return this.$message.warning("不同分摊方式的项目不可合并到一个大项目下"),!1;if(n!=i.regionCode)return this.$message.warning("不同小区的项目不可合并到一个大项目下"),!1}return!0},modalOk:function(){var t=this,e=this.$refs.projTable.getCheckboxRecords(),r=[];e.forEach((function(e){t.getBottomLayer(e).forEach((function(t){r.find((function(e){return e.id===t.id}))||r.push(t)})),e.children=void 0})),this.rightProjData=this.rightProjData.filter((function(t){if(t.children=(t.children||[]).filter((function(t){return!r.find((function(e){return e.id===t.id}))})),(t.planId||t.children.length>0)&&!r.find((function(e){return e.id===t.id})))return!0})),this.rightProjData=this.rightProjData.filter((function(e){return!t.rightProjSelectedKeys.has(e.id)})),this.rightProjData.push(v(v({},this.model),{},{children:r,cost:r.reduce((function(t,e){return Object(s["c"])(t,e.cost)}),0)})),this.model={},this.rightProjSelectedKeys.clear(),this.rightProjSelectedRows=this.rightProjSelectedRows.filter((function(e){return t.$refs.projTable.setCheckboxRow(e,!1),!1})),this.$refs.transfer.targetSelectedKeys=[],this.visible=!1},unMergeSelected:function(){var t,e=this,r=this.$refs.projTable.getCheckboxRecords();if(0===r.length)return this.$message.warning("请至少选择一条数据！");var n=r.find((function(t){return!t.child||0===t.child.length}));if(n)return this.$message.warning("当前选中数据中，".concat(n.describe,"没有子项目，不可进行拆分！"));var o=[];r.forEach((function(t){var r;o=(r=o).concat.apply(r,c(e.getBottomLayer(t))),t.isDelete=!0})),this.rightProjData=this.rightProjData.filter((function(t){return!t.isDelete})),(t=this.rightProjData).push.apply(t,c(o))},getBottomLayer:function(t){var e=this;if(t.planId)return[t];var r=[];return(t.children||[]).forEach((function(t){r.push.apply(r,c(e.getBottomLayer(t)))})),r},getTopRowId:function(t){return t.pid?t.pid:t.id},getRightTableData:function(t,e){var r=this,n=JSON.parse(JSON.stringify(this.sourceTreeToArr.find((function(e){return e.id===t})))),o=JSON.parse(JSON.stringify(this.sourceTreeToArr.find((function(t){return t.id===n.planId}))));if("right"===e)n["planListId"]=n["id"],n["planId"]=o["id"],n["communityName"]=o["communityName"],n["describe"]=o["describe"],n["isProj"]=!0,n["regionCode"]=o["regionCode"],n["isReserve"]=o["isReserve"],n["reserveRate"]=o["reserveRate"],n["isReserve"]=o["isReserve"],n["allotMode"]=o["allotMode"],n["sharedHousings"]=o["sharedHousings"],n["planCostList"]=n["costList"],this.rightProjData.push(n);else{var a=this.leftData,i=a.find((function(t){return t.id===r.getTopRowId(o)}));if(!i)return a.push(this.generateRightNewRow(n,o));if(o.pId){i.child=i.child||[];var s=i.child.findIndex((function(t){return t.id===o.id})),l=i.child[s];if(l){l.projPlanLists=l.projPlanLists||[];var c=l.projPlanLists.findIndex((function(t){return t.id===n.id}));-1===c&&l.projPlanLists.push(n)}else l||i.child.push(v(v({},o),{},{projPlanLists:[n]}))}else{i.projPlanLists=i.projPlanLists||[];var u=i.projPlanLists.findIndex((function(t){return t.id===n.id}));-1===u&&i.projPlanLists.push(n)}}},generateRightNewRow:function(t,e){var r,n=this,o=this.rightData.find((function(t){return t.id===n.getTopRowId(e)})),a=this.leftData.find((function(t){return t.id===n.getTopRowId(e)}));if(e.pId){var i=v(v({},e),{},{projPlanLists:[t],isAll:e.projPlanLists.length<=1});r=v(v({},a),{},{child:[i]})}else o||(r=v(v({},a),{},{projPlanLists:[t],isAll:a.projPlanLists.length<=1}));return JSON.parse(JSON.stringify(r))}}},x=w,j=(r("ba39"),r("3ba9"),r("2877")),I=Object(j["a"])(x,n,o,!1,null,"b732e0ea",null);e["default"]=I.exports},9742:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.proInfo,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[t._v(" 项目描述")]),r("a-col",{attrs:{span:8}},[t._v("\n        "+t._s(t.proInfo.describe)+"\n      ")]),r("a-col",{attrs:{span:4}},[t._v("小区名称")]),r("a-col",{attrs:{span:8}},[t._v("\n        "+t._s(t.proInfo.communityName)+"\n      ")]),r("a-col",{staticClass:"height-200",attrs:{span:4}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("办结原因")]),r("a-col",{staticClass:"height-200",attrs:{span:20,"data-prop":"reason"}},[r("a-textarea",{attrs:{rows:8,disabled:t.disabled,placeholder:"请填写办结原因"},model:{value:t.proInfo.reason,callback:function(e){t.$set(t.proInfo,"reason",e)},expression:"proInfo.reason"}})],1)],1)],1),t.proInfo.reqNo?r("type-attachment-upload",{ref:"fileupload",attrs:{busiNo:t.proInfo.reqNo,busiType:"20",busiTypeDetail:"202B",isDetail:t.disabled}}):t._e()],1)},o=[],a=r("0fea"),i=r("9fbd"),s=r("2b0e"),l=r("9fb0"),c={name:"TransferredSerProApplyComp",components:{TypeAttachmentUpload:i["default"]},props:{disabled:{type:Boolean,default:!1}},data:function(){return{proInfo:{},activeKey:["1"],rules:{reason:[{required:!0,message:"请输入办结原因",trigger:"change"}]},url:{getProInfo:"/use/serviceProj/queryByReqId"}}},methods:{initViews:function(t){this.proInfo=Object.assign({},t),this.proInfo.reqName&&""!==this.proInfo.reqName||this.$set(this.proInfo,"reqName",s["default"].ls.get(l["J"]).realname)},initData:function(t,e){var r=this;this.disabled=!0;var n=e.tableId;Object(a["e"])(this.url.getProInfo+"/"+n).then((function(t){t.success&&(r.proInfo=Object.assign({},t.result),r.$nextTick((function(){r.proInfo.reqNo&&r.$refs.fileupload.initData(),r.proInfo.reqName&&""!==r.proInfo.reqName||r.$set(r.proInfo,"reqName",s["default"].ls.get(l["J"]).realname)})))}))},checkData:function(){var t=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow);return t.valida},getReqInfo:function(){return this.proInfo}}},u=c,d=(r("4595"),r("2877")),f=Object(d["a"])(u,n,o,!1,null,"09ed4517",null);e["default"]=f.exports},9761:function(t,e,r){},9847:function(t,e,r){},"9a0f":function(t,e,r){},"9f3d":function(t,e,r){},a19c:function(t,e,r){"use strict";r("3f8a")},a1a0:function(t,e,r){"use strict";r("19e2")},a27c:function(t,e,r){},a65f:function(t,e,r){"use strict";r("fd14")},aae9:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vxe-modal",t._b({ref:"modal",attrs:{height:"90vh",position:{top:9,left:"center"},"show-footer":"","destroy-on-close":"",loading:t.modalLoading,title:"新增计划维修项目",width:"1200"},on:{close:t.close},scopedSlots:t._u([{key:"footer",fn:function(){return[r("a-button",{attrs:{loading:t.modalLoading,type:"primary"},on:{click:t.addChild}},[t._v("提交")])]},proxy:!0}]),model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},"vxe-modal",t.bindAttr,!1),[r("content-view",{staticClass:"connetItem",attrs:{showIcon:!0,title:"基本信息"}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.model,border:!1}},[r("a-row",{ref:"faRow",staticClass:"houseInfo",attrs:{slot:"edit",type:"flex"},slot:"edit"},[r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("维修项目描述")])]),r("a-col",{attrs:{span:21,"data-prop":"describeProj"}},[r("a-textarea",{attrs:{placeholder:"请输入维修项目描述"},model:{value:t.model.describeProj,callback:function(e){t.$set(t.model,"describeProj",e)},expression:"model.describeProj"}})],1),r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("联系人")])]),r("a-col",{attrs:{span:9,"data-prop":"reqMan"}},[r("a-input",{attrs:{placeholder:"请输入联系人"},model:{value:t.model.reqMan,callback:function(e){t.$set(t.model,"reqMan",e)},expression:"model.reqMan"}},[r("a-icon",{attrs:{slot:"addonAfter",type:"contacts"},slot:"addonAfter"})],1)],1),r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("联系电话")])]),r("a-col",{attrs:{span:9,"data-prop":"reqPhone"}},[r("a-input",{attrs:{type:"text",name:"modelPhone",placeholder:"请输入联系电话"},model:{value:t.model.reqPhone,callback:function(e){t.$set(t.model,"reqPhone",e)},expression:"model.reqPhone"}},[r("a-icon",{attrs:{slot:"addonAfter",type:"phone"},slot:"addonAfter"})],1)],1)],1)],1),r("bidding-method-comp",{ref:"bid",attrs:{isChild:t.model.hasChild}})],1),t._l(t.list,(function(e,n){return r("content-view",{key:e.id,staticClass:"connetItem planInfoItem",attrs:{showIcon:!0,title:e.title}},[r("a-space",{staticClass:"width-100",attrs:{direction:"vertical"}},[r("j-form-container",{ref:"formRow"+n,refInFor:!0,attrs:{rules:t.rules,model:e,border:!1}},[r("a-row",{ref:"row"+n,refInFor:!0,staticClass:"houseInfo",attrs:{slot:"edit",type:"flex"},slot:"edit"},[t.list.length>1?r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("请输入维修项目描述")])]):t._e(),t.list.length>1?r("a-col",{attrs:{span:21,"data-prop":"describe"}},[r("a-textarea",{attrs:{placeholder:"请输入维修项目描述"},model:{value:e.describe,callback:function(r){t.$set(e,"describe",r)},expression:"item.describe"}})],1):t._e(),r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("受损图片或视频")])]),r("a-col",{attrs:{span:21,"data-prop":"damagedPictureList"}},[r("a-upload",{staticClass:"uploadButtonStyle",attrs:{allowClick:"",accept:".jpg, .png, .jpeg, .bmp, .mp4,.JPG","before-upload":t.beforeUpload,customRequest:function(e){t.uploadFile(t.damagedPictureUrl,e,t.getItemByName("附件"+n))},multiple:!0,listType:"picture-card","file-list":t.getItemByName("附件"+n).showList,remove:function(e){return t.onRemove(e,t.getItemByName("附件"+n))}},on:{preview:function(e){return t.handlePreview(e,t.getItemByName("附件"+n))},change:function(r){return t.fileChange(e,n)}}},[r("div",[r("a-icon",{attrs:{type:"upload"}}),r("div",{staticClass:"ant-upload-text"},[t._v("\n                  上传\n                ")])],1)])],1),r("a-col",{attrs:{span:3}},[r("span",{staticClass:"required"},[t._v("工程款")])]),r("a-col",{attrs:{span:21,"data-prop":"construction.cost"}},[r("amount-input",{attrs:{min:0,max:e.singleMaxCost,placeholder:"请输入工程款"},model:{value:e.construction.cost,callback:function(r){t.$set(e.construction,"cost",r)},expression:"item.construction.cost"}})],1),t._l(e.costType,(function(o,a){return[r("a-col",{key:o.value+"unitLabel"+n,attrs:{span:3}},[r("span",[t._v(t._s(o.label)+"单位")])]),r("a-col",{key:o.value+"unitValue"+n,attrs:{span:9,"data-prop":o.value+"Code"}},[r("div",{staticClass:"row_col_flexDiv"},[r("input-search-modal",{attrs:{width:"100%",placeholder:"请选择"+o.label+"单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:o.corpType},"is-custom-modal":!1},on:{change:function(e,r){return t.costUnitChoose(o,r,n)}},scopedSlots:t._u([{key:"button",fn:function(){return[r("a-button",[t._v("选择单位")])]},proxy:!0}],null,!0),model:{value:e[o.value+"Code"],callback:function(r){t.$set(e,o.value+"Code",r)},expression:"item[costItem.value + 'Code']"}})],1)]),r("a-col",{key:o.value+"amountLabel",attrs:{span:3}},[r("span",[t._v(t._s(o.label)+"费")])]),r("a-col",{key:o.value+"amountValue",attrs:{span:9,"data-prop":"costType."+a+".cost","data-rules":[{required:!0,message:"请输入费用！"}]}},[r("amount-input",{attrs:{min:0,placeholder:"请输入审价费"},model:{value:o.cost,callback:function(e){t.$set(o,"cost",e)},expression:"costItem.cost"}})],1)]}))],2)],1),r("vxe-table",{attrs:{size:"small",border:"",data:e.costLists}},[r("vxe-table-column",{attrs:{title:"设施设备/标准维修项目",field:"remark"}}),r("vxe-table-column",{attrs:{title:"维修描述",field:"describeInfo"}}),r("vxe-table-column",{attrs:{title:"单价",align:"right",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)},field:"unitPrice"}}),r("vxe-table-column",{attrs:{title:"数量",align:"right",field:"quantity"}}),r("vxe-table-column",{attrs:{title:"总价",align:"right",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)},field:"totalPrice"}})],1)],1)],1)}))],2)},o=[],a=r("dc9a"),i=r("156e"),s=r("0d99"),l=r("f337"),c=r("834e"),u=r("d35e"),d=r("e4d8"),f=r("e06d"),h=r("d717"),p=r("eb36"),m=r("67ae"),v=r("0fea"),g=r("d8a5"),y=r("4aae"),b=r("aa2d"),w=r("3ed7");function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function j(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */j=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};c(w,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(w=C);var _=b.prototype=g.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==x(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(x(e)+" is not iterable")}return y.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function I(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function C(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){I(a,n,o,i,s,"next",t)}function s(t){I(a,n,o,i,s,"throw",t)}i(void 0)}))}}function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){k(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function k(t,e,r){return(e=L(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function L(t){var e=D(t,"string");return"symbol"==x(e)?e:e+""}function D(t,e){if("object"!=x(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var T={name:"PlanStartProjModal",components:{InputSearchModal:b["default"],AmountInput:y["default"],BiddingListComp:m["default"],InsuranceCreateChild:f["default"],ProjCreateInseureInfo:h["default"],ProCreateChild:d["default"],BiddingMethodComp:u["default"],BiddingMethod:c["default"],SvnIcon:l["default"],ProCreateWordUnit:s["default"],ProCreateBaseInfo:i["default"],ContentView:a["default"]},mixins:[p["a"]],data:function(){var t=function(t,e){return new Promise((function(t){if(!e)return t();Object(v["j"])("/drools/droolsData/exeDrools",{type:"verifyPhoneNumber",name:"verify",data:{phone:e}}).then((function(e){return e.success?t():t(e.result)}))}))};return{visible:!1,url:{damagedPicture:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId=",planToProj:"/use/serviceProj/planToProj"},list:[],sysOrgCode:"",damagedPictureUrl:"",model:{},baseRules:{describeProj:[{required:!0,message:"请输入维修项目描述！"}],reqMan:[{required:!0,message:"请输入联系人！"}],reqPhone:[{required:!0,message:"请输入联系电话！"},{validator:t,type:"Promise"}],damagedPictureList:[{required:!0,message:"请上传受损图片或视频！",type:"Array"}],"construction.cost":[{required:!0,message:"请输入工程款！"}]},modalLoading:!1,costTypeMenu:[{value:"priceReview",label:"审价",type:"02",corpType:"06"},{value:"supervisor",label:"监理",type:"03",corpType:"05"},{value:"biddingCost",label:"招标",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测",type:"05",corpType:"08"},{value:"makeCost",label:"造价",type:"06",corpType:"09"}],columns:[{title:"单位名称",align:"left",field:"name"},{title:"地址",align:"left",field:"address"},{title:"联系人",align:"center",field:"linkMan"}],modelCost:[],formatterAmount:w["g"]}},computed:{bindAttr:function(){var t=P({zIndex:1e3},this.$attrs);return t},rules:function(){var t={};return this.costTypeMenu.forEach((function(e){t[e.value+"Code"]=[{required:!0,message:"请选择".concat(e.label,"单位！")}]})),Object.assign(this.baseRules,t)}},provide:function(){var t=this;return{projMainData:function(){return t.model}}},created:function(){var t=this;Object(g["e"])("damaged_picture_ere_id").then((function(e){t.damagedPictureUrl=t.url.damagedPicture+e}))},methods:{open:function(t,e){var r=this;this.visible=!0;var n=[];this.list=t,t&&(this.model.hasChild=!0),this.list=t.map((function(t,e){var o=JSON.parse(JSON.stringify(t));return"01"===o.planType?o.planCostList.forEach((function(t){if("01"!=t.baseType){var e=r.costTypeMenu.find((function(e){return e.type===t.baseType}));r.$set(e,"cost",t.cost),r.addCostForPlan(e,o)}else o.construction={baseType:"01",cost:t.cost}})):o.construction={baseType:"01",cost:o.singleMaxCost},n.push({name:"附件"+e,fileList:o.damagedPictureList||[]}),o})),this.sysOrgCode=e,this.$nextTick((function(){r.$refs.bid.initData(),r.initUploadFile(n)})),this.$forceUpdate()},close:function(){this.list=[],this.model={hasChild:!0,reqMan:""},this.visible=!1},addCostForPlan:function(t,e){e["costType"]||this.$set(e,"costType",[]),e[t.value]||this.$set(e,t.value,{cost:t.cost}),this.rules[t.value+"Amount"]=[{required:!0,message:"请输入".concat(t.label,"费"),trigger:"change"},{validator:this.validaAmount}],this.rules[t.value+"Code"]=[{required:!0,message:"请选择".concat(t.label,"单位"),trigger:"change"}],e.costType.push(t)},addChild:function(){var t=C(j().mark((function t(){var e,r,n,o,a=this;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.formRow.validaRowMsgPro(this.$refs.faRow);case 2:if(e=t.sent,e.valida){t.next=5;break}return t.abrupt("return");case 5:if(this.$refs.bid.checkData().valida){t.next=7;break}return t.abrupt("return");case 7:r=0;case 8:if(!(r<this.list.length)){t.next=17;break}return t.next=11,this.$refs["formRow"+r][0].validaRowMsgPro(this.$refs["row"+r][0]);case 11:if(n=t.sent,n.valida){t.next=14;break}return t.abrupt("return");case 14:r++,t.next=8;break;case 17:this.list.length>1?(this.model.isHasChild=1,this.model.allotMode=this.list[0].allotMode,this.model.regionCode=this.list[0].regionCode,this.model.children=this.list):(this.model.isHasChild=0,Object.assign(this.model,this.list[0])),this.model.baseType="03",this.list.forEach((function(t){var e=JSON.parse(JSON.stringify(a.model.construction));e.cost=t.construction.cost,t.construction=e,t.baseType="03",t.createBy=null,t.createTime=null,t.updateBy=null,t.updateTime=null,t.id=null,t.reqMan=a.model.reqMan,t.reqPhone=a.model.reqPhone,t.costLists.forEach((function(t){t.id=null})),o=Object(w["c"])(o,t.construction.cost)})),this.model.describe=this.model.describeProj,this.model.construction.describe=this.model.describe+"工程总费用",this.model.construction.cost=o,this.model.construction.baseType="01",this.model.createTime=null,this.model.updateTime=null,this.model.pid=null,this.model.state=null,Object(v["j"])(this.url.planToProj,this.model,{"tenant-id":this.sysOrgCode}).then((function(t){t.message?a.$message.success(t.message):a.$message.error(t.message),a.modalLoading=!1,a.$emit("ok"),a.close()})).finally((function(){a.isLoading=!1}));case 29:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),beforeUpload:function(t){var e=this;return new Promise((function(r){t.type.includes("image")||t.type.includes("video")?r():e.$message.warning("请上传图片或视频！")}))},fileChange:function(t,e){this.$set(t,"damagedPictureList",this.getItemByName("附件"+e).fileList)},costUnitChoose:function(t,e,r){e&&(this.list[r][t.value].projId=this.projObj.id,this.list[r][t.value].chargeCorpCode=e.code,this.list[r][t.value].chargeCorpMan=e.linkMan,this.list[r][t.value].stage="01",this.list[r][t.value].baseType=t.type,this.list[r][t.value].chargeCorpPhone=e.phone,this.list[r][t.value].cost=this.modelCost[t.value+"Amount"]?this.modelCost[t.value+"Amount"]:0)}}},M=T,S=(r("7a0f"),r("ecbf"),r("2877")),O=Object(S["a"])(M,n,o,!1,null,"b82e74c8",null);e["default"]=O.exports},ad05:function(t,e,r){},b32e:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"projectReview"},[r("content-view",{attrs:{title:"项目信息",showIcon:!1}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("项目描述")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.describe))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("申报小区")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.projInfo.communityName))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("项目类型")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t.getBaseTypeText(t.projInfo.baseType)))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("分摊方式")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[r("j-d-dict-select-tag",{attrs:{readOnly:"",align:"left",type:"select",dictCode:"allocation_method"},model:{value:t.projInfo.allotMode,callback:function(e){t.$set(t.projInfo,"allotMode",e)},expression:"projInfo.allotMode"}})],1),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("预算金额")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t._f("getAmount")(t.projInfo.budgetCost))+" 元")]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("审核金额")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[t._v(t._s(t._f("getAmount")(t.projInfo.contractCost))+" 元")]),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("保证金")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[r("a-space",[r("el-switch",{attrs:{disabled:"doneList"===t.formPage||!(t.disabled&&t.showModel&&!t.doneFlag),"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"有","inactive-text":"无","active-value":"1","inactive-value":"0"},model:{value:t.projInfo.marginFlag,callback:function(e){t.$set(t.projInfo,"marginFlag",e)},expression:"projInfo.marginFlag"}}),1==t.projInfo.marginFlag?r("amount-input",{attrs:{min:.01,max:100,"read-only":"doneList"===t.formPage||!(t.disabled&&t.showModel&&!t.doneFlag),placeholder:"请输入质保金比例",addonAfter:"%"},model:{value:t.projInfo.marginPer,callback:function(e){t.$set(t.projInfo,"marginPer",e)},expression:"projInfo.marginPer"}}):t._e(),t.disabled&&t.showModel&&!t.doneFlag?t._e():r("span",[t._v("%")])],1)],1),"05"!==t.projInfo.baseType||"0"!==t.projInfo.publicFlag&&"2"!==t.projInfo.publicFlag?[r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}},[t._v("分摊户数")]),r("a-col",{attrs:{xxl:4,xl:8,span:12}},[r("a-space",[1!=t.proModel.isHasChild?r("span",[t._v(t._s(t.proModel&&(t.proModel.allotLists||[]).length)+"户")]):t._e(),"1"==t.proModel.isHasChild?[r("a-dropdown",[r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},t._l(t.proModel.children,(function(e){return r("a-menu-item",{key:e.id,on:{click:function(r){return t.showShared(e,"1")}}},[t._v("\n                    "+t._s(e.describe)+"\n                  ")])})),1),r("a",[t._v("冻结分摊清册")])],1),r("a-dropdown",[r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},t._l(t.proModel.children,(function(e){return r("a-menu-item",{key:e.id,on:{click:function(r){return t.showShared(e,"2")}}},[t._v("\n                    "+t._s(e.describe)+"\n                  ")])})),1),r("a",[t._v("预分摊清册")])],1)]:[r("a",{on:{click:function(e){return t.showShared(t.proModel,"1")}}},[t._v("冻结分摊清册")]),r("a",{on:{click:function(e){return t.showShared(t.proModel,"2")}}},[t._v("预分摊清册")])]],2)],1)]:[r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}}),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:8,span:12}}),r("a-col",{staticClass:"formLabel",attrs:{xxl:2,xl:4,span:12}}),r("a-col",{attrs:{xxl:2,xl:4,span:12}},[t._v("      "+t._s("0"===t.projInfo.publicFlag?"分摊单位":"分摊自然幢"))]),r("a-col",{attrs:{span:12}},[r("div",{staticClass:"width100"},[r("vxe-table",{attrs:{"max-height":"160px","auto-resize":"",size:"small",border:"",data:t.projInfo.allotLists}},[r("vxe-table-column",{attrs:{field:"name",title:"名称",formatter:function(t){var e=t.row;return e.name||e.bldName||e.corpName}}}),r("vxe-table-column",{attrs:{field:"amount",title:"金额",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)}}})],1)],1)])]],2)],1),r("content-view",{attrs:{title:"审核结果"},scopedSlots:t._u([{key:"title",fn:function(){return[r("div",{staticClass:"serCostReviewTitle"},[r("span",{staticClass:"collapseTitle"},[t._v("审核结果")]),"doneList"!==t.formPage&&t.disabled&&t.showModel&&!t.doneFlag?r("a-button",{attrs:{size:"small",type:"primary"},on:{click:t.editCostReview}},[t._v("维护")]):t._e()],1)]},proxy:!0}])},[r("ser-cost-review",{ref:"serCostReview",attrs:{marginFlag:1==t.projInfo.marginFlag,marginPer:t.projInfo.marginPer,isDetail:"doneList"===t.formPage,editFlag:t.disabled&&t.costReviewEditFlag&&t.showModel&&!t.doneFlag},on:{validErr:t.editCostReview}}),r("div",{staticClass:"serCostReviewFooter"},["doneList"!==t.formPage&&t.disabled&&t.costReviewEditFlag?r("a-button",{attrs:{type:"primary"},on:{click:t.closeEditCostReview}},[t._v("确认")]):t._e()],1)],1),t.showModel?r("content-view",{attrs:{title:"审核流程","show-icon":!1}},[r("a-table",{ref:"table",attrs:{rowKey:"id",size:"middle",bordered:"",columns:t.columns,dataSource:t.dataSource,pagination:!1}})],1):t._e(),"doneList"!==t.formPage&&t.showModel&&!t.doneFlag?r("content-view",{attrs:{title:"审批结果","show-icon":!1}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.projInfo,disabled:!1,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批结果")])]),r("a-col",{attrs:{span:20,"data-prop":"flag"}},[r("j-dict-radio-button",{attrs:{disabled:!t.disabled,options:t.option},on:{change:t.onChange},model:{value:t.projInfo.flag,callback:function(e){t.$set(t.projInfo,"flag",e)},expression:"projInfo.flag"}})],1),r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批意见")])]),r("a-col",{attrs:{span:20,"data-prop":"comment"}},[r("a-textarea",{attrs:{disabled:!t.disabled,autoSize:{minRows:5,maxRows:8}},model:{value:t.projInfo.comment,callback:function(e){t.$set(t.projInfo,"comment",e)},expression:"projInfo.comment"}},[t._v(">")])],1)],1)],1)],1):t._e(),"doneList"!==t.formPage&&t.disabled&&t.showModel&&!t.doneFlag?r("a-row",{},[r("a-button",{staticStyle:{margin:"10px auto",display:"block"},attrs:{type:"primary"},on:{click:function(){return t.handleOk(!1)}}},[t._v("确定")])],1):t._e(),r("ser-cost-re-modal",{ref:"scrm",on:{saveCostInfo:t.saveCostInfo}}),r("share-detail-comp",{ref:"shareDetail"}),t.previewVisible?r("div",{staticClass:"outer_box"},[r("preview-picture",{ref:"previewPicture",attrs:{fileNum:0,fileList:t.previewFileList},on:{cancel:function(e){t.previewVisible=!1}}})],1):t._e()],1)},o=[],a=r("7d9a"),i=r("0fea"),s=r("6ff6"),l=r("4aae"),c=r("d8a5"),u=r("3ed7"),d=r("b7a8"),f=r("dc9a"),h=r("f32b"),p=r("eccd"),m=r("24e7"),v=r("6d5b"),g=r("0c8a"),y=r("2b0e"),b=r("9fb0");function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function x(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */x=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=b.prototype=g.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==w(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(w(e)+" is not iterable")}return y.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function j(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function I(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){j(a,n,o,i,s,"next",t)}function s(t){j(a,n,o,i,s,"throw",t)}i(void 0)}))}}var C={name:"SerProjectReview",components:{SerCostReview:m["default"],JDDictSelectTag:p["default"],ContentView:f["default"],PreviewPicture:d["default"],JDictRadioButton:a["default"],SerCostReModal:s["default"],AmountInput:l["default"],ShareDetailComp:v["default"]},inject:{projMainData:{default:null},closeCurrent:{},routeReload:{}},created:function(){this.formPage=this.$route_query?this.$route_query.from:"",this.projMainData&&this.initData()},data:function(){return{projInfo:{},hisTaskInst:[],chCostList:[],disabled:!0,costReviewEditFlag:!1,url:{queryProActHiTaskinst:"/use/serviceProj/queryProActHiTaskinst",costList:"/use/serviceCost/getProAndCost",auditPro:"/use/serviceProj/serPoAudit",queryProInfoById:"/use/serviceProj/queryProInfoById",getReqById:"/use/serviceProj/getReqById/"},rules:{comment:[{required:!0,message:"请输入审批意见",trigger:"change"}],flag:[{required:!0,message:"请勾选审批结果",trigger:"change"}]},processImg:"",previewVisible:!1,columns:[{title:"序号",dataIndex:"",key:"rowIndex",width:18==y["default"].ls.get(b["w"])?60:50,align:"center",customRender:function(t,e,r){return parseInt(r)+1}},{title:"任务名称",align:"center",width:160,dataIndex:"name",ellipsis:!0},{title:"处理人",align:"center",dataIndex:"assigneeName",ellipsis:!0,customRender:function(t,e){return t||e.assignee}},{title:"耗时",align:"center",width:110,dataIndex:"duration",customRender:function(t,e){var r=e.duration,n="";if(null!=r){var o=Math.floor(r/864e5);0!==o&&(n+=o+"天");var a=r%864e5,i=Math.floor(a/36e5);0!==i&&(n+=i+"小时");var s=a%36e5,l=Math.floor(s/6e4);if(0!==l&&(n+=l+"分"),!n){var c=Math.round(s%6e4/1e3);n+=c+"秒"}}return n}},{title:"开始时间",align:"center",width:160,dataIndex:"startTime"},{title:"结束时间",align:"center",width:160,dataIndex:"endTime"},{title:"审批结果",align:"center",dataIndex:"taskFlow",width:18==y["default"].ls.get(b["w"])?90:80,customRender:function(t){return"1"==t?"通过":"0"==t?"未通过":t}},{title:"审批意见",align:"center",dataIndex:"comment"}],dataSource:[],pageLoading:!1,showModel:!0,formKey:"",formPage:"",option:[{label:"同意",value:"1"},{label:"不同意",value:"3"},{label:"打回",value:"0"}],resultEditFlag:!1,formatterAmount:u["g"],getBaseTypeText:g["getBaseTypeText"],doneFlag:!1}},computed:{previewFileList:function(){return{showList:[{originalImage:this.processImg,name:"项目流程"}]}},proModel:function(){try{return this.projMainData()||{}}catch(t){return{}}}},methods:{showShared:function(t,e){"1"===e?this.$refs.shareDetail.showAllotInfo(t.freezeAllotLists):this.$refs.shareDetail.showAllotInfo(t.allotLists)},editCostReview:function(){this.costReviewEditFlag=!0},closeEditCostReview:function(){var t=I(x().mark((function t(){var e,r=this;return x().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.serCostReview.checkData();case 2:e=t.sent,e&&(this.costReviewEditFlag=!1,this.showModel=!1,this.handleOk(!0).then((function(){r.routeReload()})));case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),initData:function(){var t=I(x().mark((function t(e,r){var n,o,a,s=this;return x().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=8;break}return this.showModel=!1,o=r.businessKey.split(".")[r.businessKey.split(".").length-1],a=this.url.getReqById+o,t.next=6,Object(i["e"])(a).then((function(t){n=t.result.id}));case 6:t.next=9;break;case 8:n=this.projMainData().id;case 9:Object(i["j"])(this.url.queryProInfoById+"/"+n).then((function(t){t.success&&(s.projInfo=Object.assign({},t.result),s.projInfo.marginFlag||Object(c["e"])("is_default_margin").then((function(t){s.projInfo.marginFlag=t&&"1"==t?"1":"0"})),s.projInfo.marginPer&&0!=s.projInfo.marginPer.length&&0!=s.projInfo.marginPer||Object(c["e"])("margin_ratio").then((function(t){s.projInfo.marginPer=t})),t.result["reqCode"]&&Object(i["e"])("/act/taskinst/history/task/b_busi_req.project_filing."+t.result["reqCode"],{}).then((function(t){if(t.success){s.dataSource=t.result;var e=y["default"].ls.get(b["J"]);s.doneFlag=!1,t.result&&t.result.length>0&&-1===t.result[t.result.length-1].assigneeIds.indexOf(e.id)&&(s.doneFlag=!0)}else s.$message.error("查询审批历史记录发生错误！")})),s.disabled="8"==s.projInfo.state,Object(i["j"])(s.url.queryProActHiTaskinst+"/"+s.projInfo.reqNo+"/20/202A").then((function(t){t.success&&(s.hisTaskInst=t.result,s.formKey=s.hisTaskInst[s.hisTaskInst.length-1].formKey,-1!==s.formKey.indexOf("break")&&s.option.pop())})))})),Object(i["j"])(this.url.costList+"/"+n).then((function(t){t.success&&(s.chCostList=t.result,s.$refs.serCostReview.tabData=s.chCostList.map((function(t){var e=t;return e.children&&e.children.length>0&&!e.chargeCorpCode&&(e.chargeCorpCode=e.children[0].chargeCorpCode,e.chargeCorpName=e.children[0].chargeCorpName,e.chargeCorpPhone=e.children[0].chargeCorpPhone,e.chargeCorpMan=e.children[0].chargeCorpMan),e})))}));case 11:case"end":return t.stop()}}),t,this)})));function e(e,r){return t.apply(this,arguments)}return e}(),onChange:function(t){t&&(this.projInfo.flag=t,1===this.projInfo.flag||"1"===this.projInfo.flag?this.projInfo.comment="同意":3===this.projInfo.flag||"3"===this.projInfo.flag?this.projInfo.comment="不同意":0!==this.projInfo.flag&&"0"!==this.projInfo.flag||(this.projInfo.comment="打回"))},checkData:function(){var t=I(x().mark((function t(){var e,r;return x().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow),"1"==this.projInfo.flag){t.next=5;break}t.t0=!0,t.next=8;break;case 5:return t.next=7,this.$refs.serCostReview.checkData();case 7:t.t0=t.sent;case 8:return r=t.t0,t.abrupt("return",e.valida&&r);case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),saveCostInfo:function(t){this.chCostList=t,this.projInfo.contractCost=t.reduce((function(t,e){return t+Number(e.cost||0)}),0)},handleOk:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.pageLoading=!0,new Promise(function(){var r=I(x().mark((function r(n,o){var a,s,l;return x().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.t0=!t.showModel,r.t0){r.next=5;break}return r.next=4,t.checkData();case 4:r.t0=r.sent;case 5:if(!r.t0){r.next=17;break}a=t,a.projInfo.disabled=!0,s=[],l=[],a.chCostList=t.$refs.serCostReview.tabData,a.chCostList.forEach((function(t){t.children?l.push.apply(l,JSON.parse(JSON.stringify(t.children))):l.push(t)})),a.projInfo.children&&a.projInfo.children.length>0?s.push.apply(s,JSON.parse(JSON.stringify(a.projInfo.children))):s.push(JSON.parse(JSON.stringify(a.projInfo))),s.forEach((function(t){var e=l.filter((function(e){return e.projId===t.id}));t.marginFlag=a.projInfo.marginFlag,t.marginPer=a.projInfo.marginPer,t.costs=e})),Object(i["j"])(a.url.auditPro,{children:s,taskIds:a.projInfo.taskId,marginFlag:a.projInfo.marginFlag,marginPer:a.projInfo.marginPer,flag:e?"1":a.projInfo.flag,contractCost:a.projInfo.contractCost,flowOpinion:e?"审核结果维护":a.projInfo.comment,reviewFlag:a.showModel}).then((function(e){e.success?(a.$message.success(e.result),a.showModel&&(a.$emit("ok"),t.closeCurrent(),t.$route.params&&t.$route.params._FromRoute?t.$router.replace({path:t.$route.params._FromRoute.path}):t.$router.replace({path:"/use/servicebusiNew"})),t.$store.commit("UPDATE_PROJECT_AUDIT_FLAG"),n("")):(a.$message.warning(e.message),o(new h["default"]("")),t.closeCurrent(),t.$route.params&&t.$route.params._FromRoute?t.$router.replace({path:t.$route.params._FromRoute.path}):t.$router.replace({path:"/use/servicebusiNew"}))})).finally((function(){t.pageLoading=!1})),r.next=18;break;case 17:t.pageLoading=!1;case 18:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(u["g"])(t):"0.00"}}},_=C,P=(r("a65f"),r("2877")),k=Object(P["a"])(_,n,o,!1,null,"e536f526",null);e["default"]=k.exports},b58f:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"projectReview"},[r("content-view",{attrs:{title:"项目预算",showIcon:!1}},[r("j-form-container",{ref:"baseMsg",attrs:{rules:t.insureRules,model:t.planInfo,disabled:!1,border:!1}},[r("a-row",{staticClass:"houseInfo"},[r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("维修计划描述")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t.planInfo.describe))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("分摊方式")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[r("j-d-dict-select-tag",{attrs:{dictCode:"allocation_method",disabled:!0},model:{value:t.planInfo.allotMode,callback:function(e){t.$set(t.planInfo,"allotMode",e)},expression:"planInfo.allotMode"}})],1),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("申请小区")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t.planInfo.communityName))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("联系人")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t.planInfo.reqMan))]),r("a-col",{staticClass:"formLabel",attrs:{xxl:4,xl:3,span:12}},[t._v("联系电话")]),r("a-col",{attrs:{xxl:8,xl:9,span:12}},[t._v(t._s(t.planInfo.reqPhone))])],1)],1)],1),r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"计划明细"}},[0==t.planInfo.isHasChild?r("plan-detail-list-modal",{staticClass:"width100",attrs:{isDetail:!0,planDetailList:t.planInfo.projPlanLists},on:{"update:planDetailList":function(e){return t.$set(t.planInfo,"projPlanLists",e)},"update:plan-detail-list":function(e){return t.$set(t.planInfo,"projPlanLists",e)}}}):t._e(),1==t.planInfo.isHasChild?r("child-plan",{ref:"childPro",attrs:{review:!0,pageType:!0,allotMode:0,proInfo:t.planInfo,isDetail:!0}}):t._e()],1),t.showModel?r("content-view",{attrs:{title:"审核流程","show-icon":!1}},[r("a-table",{ref:"table",attrs:{rowKey:"id",size:"middle",bordered:"",columns:t.columns,dataSource:t.dataSource,pagination:!1}})],1):t._e(),t.showModel?r("content-view",{attrs:{title:"审核意见","show-icon":!1}},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.planInfo,disabled:!1,border:!1}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审核意见")])]),r("a-col",{attrs:{span:20,"data-prop":"flag"}},[r("j-dict-radio-button",{attrs:{disabled:!t.disabled,options:t.option},on:{change:t.onChange},model:{value:t.planInfo.flag,callback:function(e){t.$set(t.planInfo,"flag",e)},expression:"planInfo.flag"}})],1),r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("意见描述")])]),r("a-col",{attrs:{span:20,"data-prop":"comment"}},[r("a-textarea",{attrs:{disabled:!t.disabled,autoSize:{minRows:5,maxRows:8}},model:{value:t.planInfo.comment,callback:function(e){t.$set(t.planInfo,"comment",e)},expression:"planInfo.comment"}},[t._v(">")])],1)],1)],1)],1):t._e(),t.disabled&&t.showModel?r("a-row",{},[r("a-button",{staticStyle:{margin:"10px auto",display:"block"},attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确定")])],1):t._e()],1)},o=[],a=r("3ed7"),i=r("7d9a"),s=r("0fea"),l=r("6ff6"),c=r("4aae"),u=r("d8a5"),d=r("b7a8"),f=r("dc9a"),h=r("f32b"),p=r("0a5e"),m=r("c695"),v=r.n(m),g=r("c493"),y=r("eccd"),b=r("79ae");function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function x(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */x=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=b.prototype=g.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==w(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(w(e)+" is not iterable")}return y.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function j(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function I(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){j(a,n,o,i,s,"next",t)}function s(t){j(a,n,o,i,s,"throw",t)}i(void 0)}))}}var C={name:"SerPlanReview",components:{ChildPlan:b["default"],JDDictSelectTag:y["default"],PlanDetailListModal:g["default"],ContentView:f["default"],PreviewPicture:d["default"],JDictRadioButton:i["default"],SerCostReModal:l["default"],AmountInput:c["default"]},inject:{projMainData:{default:null},closeCurrent:{}},mixins:[p["a"]],created:function(){this.projMainData&&this.initData()},data:function(){var t=this;return{insuranceType:[],planInfo:{},hisTaskInst:[],chCostList:[],disabled:!0,url:{queryProActHiTaskinst:"/use/serviceProj/queryProActHiTaskinst",getProjCostType:"/use/fundProgress/getProjInsureFund/",costList:"/use/serviceCost/getProAndCost",auditPlan:"/use/projPlan/planAudit",getReqById:"/use/serviceProj/getReqById/",loadTreeData:"/sys/category/buildTree"},rules:{comment:[{required:!0,message:"请输入意见描述",trigger:"change"}],flag:[{required:!0,message:"请勾选审核意见",trigger:"change"}]},insureRules:{insureCode:[{required:!0,message:"请输入保单号",trigger:"change"}]},processImg:"",previewVisible:!1,columns:[{title:"序号",dataIndex:"",key:"rowIndex",width:50,align:"center",customRender:function(t,e,r){return parseInt(r)+1}},{title:"任务名称",align:"center",width:160,dataIndex:"name",ellipsis:!0},{title:"处理人",align:"center",dataIndex:"assigneeName",ellipsis:!0,customRender:function(t,e){return t||e.assignee}},{title:"耗时",align:"center",width:110,dataIndex:"duration",customRender:function(t,e){var r=e.duration,n="";if(null!=r){var o=Math.floor(r/864e5);0!==o&&(n+=o+"天");var a=r%864e5,i=Math.floor(a/36e5);0!==i&&(n+=i+"小时");var s=a%36e5,l=Math.floor(s/6e4);if(0!==l&&(n+=l+"分"),!n){var c=Math.round(s%6e4/1e3);n+=c+"秒"}}return n}},{title:"开始时间",align:"center",width:160,dataIndex:"startTime"},{title:"结束时间",align:"center",width:160,dataIndex:"endTime"},{title:"审批结果",align:"center",dataIndex:"taskFlow",width:80,customRender:function(t){return"1"==t?"通过":"0"==t?"未通过":t}},{title:"审批意见",align:"center",dataIndex:"comment"}],fundColumns:[{title:"保险描述",align:"left",headerAlign:"center",field:"describe",direction:"rtl"},{title:"险种",align:"center",headerAlign:"center",field:"insureSureDetail"},{title:"保费总金额",align:"right",headerAlign:"center",formatter:"amount",field:"budgetCost"},{title:"申请总资金",align:"right",headerAlign:"center",formatter:"amount",field:"contractCost"}],fundColumnsChild:[{title:"拨付时间",align:"left",field:"payDate"},{title:"保费金额",align:"right",field:"insureCost",formatter:"amount"},{title:"申请资金",align:"right",field:"cost",formatter:"amount"}],loadData:function(){return Object(s["j"])(t.getProjCostType).then((function(e){return t.selectedRows=[],t.tabData=e.result,t.tabData}))},dataSource:[],pageLoading:!1,showModel:!0,formKey:"",getProjCostType:"",option:[{label:"同意",value:"1"},{label:"不同意",value:"3"},{label:"打回",value:"0"}]}},computed:{previewFileList:function(){return{showList:[{originalImage:this.processImg,name:"项目流程"}]}}},methods:{getTreeData:function(){var t=this;Object(s["e"])(this.url.loadTreeData,{code:"insure_type"}).then((function(e){e.success&&e.result.length>0&&(t.insuranceType=e.result[0].children)}))},initData:function(){var t=I(x().mark((function t(e,r){var n,o,a=this;return x().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=8;break}return this.showModel=!1,n=r.businessKey.split(".")[r.businessKey.split(".").length-1],o=this.url.getReqById+n,t.next=6,Object(s["e"])(o).then((function(t){t.result.id}));case 6:t.next=9;break;case 8:this.projMainData().id;case 9:this.planInfo=this.projMainData(),this.planInfo.marginPer&&0!=this.planInfo.marginPer.length&&0!=this.planInfo.marginPer||Object(u["e"])("margin_ratio").then((function(t){a.planInfo.marginPer=t})),this.planInfo.reqCode&&Object(s["e"])("/act/taskinst/history/task/"+this.planInfo.flowId,{}).then((function(t){t.success?a.dataSource=t.result:a.$message.error("查询审批历史记录发生错误！")})),this.disabled="8"==this.planInfo.state,Object(s["j"])(this.url.queryProActHiTaskinst+"/"+this.planInfo.reqNo+"/20/202A").then((function(t){t.success&&(a.hisTaskInst=t.result,a.formKey=a.hisTaskInst[a.hisTaskInst.length-1].formKey,-1!==a.formKey.indexOf("break")&&a.option.pop())}));case 14:case"end":return t.stop()}}),t,this)})));function e(e,r){return t.apply(this,arguments)}return e}(),onChange:function(t){t&&(this.planInfo.flag=t,1===this.planInfo.flag||"1"===this.planInfo.flag?this.planInfo.comment="同意":3===this.planInfo.flag||"3"===this.planInfo.flag?this.planInfo.comment="不同意":0!==this.planInfo.flag&&"0"!==this.planInfo.flag||(this.planInfo.comment="打回"))},checkData:function(){var t=this.$refs.baseMsg.validaRowMsg(this.$refs.houseInfo),e=this.$refs.formRow.validaRowMsg(this.$refs.formOwnRow);return t.valida&&e.valida},saveCostInfo:function(t){this.chCostList=t,this.planInfo.contractCost=t.reduce((function(t,e){return t+Number(e.cost||0)}),0)},handleOk:function(){var t=this;return this.planInfo.flowOpinion=this.planInfo.comment,this.pageLoading=!0,new Promise((function(e,r){t.checkData()?(t.planInfo.disabled=!0,Object(s["j"])(t.url.auditPlan,t.planInfo).then((function(e){e.success?(t.$message.success(e.result),t.closeCurrent()):(t.$message.warning(e.message),r(new h["default"]("")),t.closeCurrent())})).finally((function(){t.pageLoading=!1}))):t.pageLoading=!1}))},setRowStyle:function(t){var e=t.row,r=["rgb(242 242 252)","rgb(243,255,243)","#f3faff","rgb(255,243,243)","rgb(255,255,243)"],n="";switch(e.baseType){case"02":n=r[0];break;case"03":n=r[1];break;case"04":n=r[2];break;case"05":n=r[3];break;case"06":n=r[4];break;default:}return{backgroundColor:n}},queryPage:function(){this.$refs.fundTable.refresh(),this.projMainData().state=2},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:4}:e<4?{colspan:0}:void 0},loadContentMethod:function(t){var e=t.row,r=this.url.getInusreList+e.id;return new Promise((function(t){Object(s["e"])(r).then((function(r){if(r.success){var n=r.result;e.detailList=n}t()}))}))},footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";if(["budgetCost","contractCost"].includes(t.property)){var n={style:"decimal",currency:"CNY",minimumFractionDigits:2,maximumFractionDigits:2};return["quantity","totalNum"].includes(t.property)?Number(v.a.sum(r,t.property)):Number(v.a.sum(r,t.property)).toLocaleString("zh-CN",n)}}))]}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(a["g"])(t):"0.00"}}},_=C,P=(r("cdc9"),r("2877")),k=Object(P["a"])(_,n,o,!1,null,"56e00a3a",null);e["default"]=k.exports},be6c:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("vxe-grid",{key:"grid"+t.isDetail,ref:"table",attrs:{border:"",size:"small",columns:t.columns,"footer-method":t.footerMethod,data:t.projInsureList,"valid-config":{message:"default"},"show-footer":"","edit-config":!t.isDetail,"edit-rules":t.isDetail?{}:t.tableRule},scopedSlots:t._u([{key:"payDateEdit",fn:function(e){var n=e.row,o=(e.rowIndex,e.column);return[r("a-date-picker",{staticStyle:{width:"200px"},attrs:{valueFormat:"YYYY-MM-DD"},on:{change:function(e,r){return t.setValue(n,"payDate",r,o)}},model:{value:n["payDate"],callback:function(e){t.$set(n,"payDate",e)},expression:"row['payDate']"}})]}},{key:"insureCostEdit",fn:function(e){var n=e.row,o=(e.rowIndex,e.column);return[r("amount-input",{attrs:{width:"170px"},on:{change:function(e){return t.setValue(n,"insureCost",e,o)}},model:{value:n["insureCost"],callback:function(e){t.$set(n,"insureCost",e)},expression:"row['insureCost']"}})]}},{key:"costEdit",fn:function(e){var n=e.row,o=(e.rowIndex,e.column);return[r("amount-input",{attrs:{width:"170px"},on:{change:function(e){return t.setValue(n,"cost",e,o)}},model:{value:n["cost"],callback:function(e){t.$set(n,"cost",e)},expression:"row['cost']"}})]}},{key:"action",fn:function(e){var n=e.row,o=e.rowIndex;return[r("a-space",[r("a",[r("a-icon",{attrs:{type:"plus"},on:{click:function(e){return t.addToTable(n,o)}}})],1),r("a",[0!==o?r("a-icon",{staticStyle:{color:"red"},attrs:{type:"delete"},on:{click:function(e){return t.deleteRow(n,o)}}}):t._e()],1)])]}}])})],1)},o=[],a=r("cf20"),i=r("4aae"),s=r("aa2d"),l=r("3ed7"),c=r("da39"),u=r("c695"),d=r.n(u),f=r("c1df"),h=r.n(f),p={name:"InsuranceInfo",mixins:[c["FooterMethod"]],components:{InputSearchModal:s["default"],JSelectCorp:a["default"],AmountInput:i["default"]},watch:{isDetail:function(){var t=this.$refs.table.getColumnByField("action");this.isDetail?this.$refs.table.showColumn(t):this.$refs.table.hideColumn(t)}},props:{proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},isHasChild:{type:Boolean,default:!1},isChild:{type:Boolean,default:!1},dateRange:{type:Array,default:function(){return[]}}},computed:{projInsureList:function(){return this.isChild?this.proInfo.projInsureList:this.projMainData().projInsureList}},inject:["projMainData"],mounted:function(){var t=this;this.$nextTick((function(){var e=t.$refs.table.getColumnByField("action");t.$refs.table.hideColumn(e)}))},data:function(){var t=this,e=function(e){var r=e.cellValue,n=e.rowIndex;return new Promise((function(e,o){if(!r)return o(new Error("请输入日期"));var a=t.dateRange[0],i=t.dateRange[1];return h()(r).isBefore(a)?o(new Error("缴费日期不能早于开始日期")):h()(r).isAfter(i)?o(new Error("缴费日期不能晚于结束日期")):void t.$nextTick((function(){for(var a=!1,i=0;i<t.projInsureList.length;i++){var s=t.projInsureList[i];if(r&&s&&s.payDate===r&&i!==n){o(new Error("缴费日期不能重复！")),a=!0;break}}a||e()}))}))},r=function(e){var r=e.cellValue,n=e.rowIndex;return new Promise((function(e,o){if(!r||Number(r)<.01)return o(new Error("申请资金应大于0"));var a=t.projInsureList[n],i=a.insureCost;return i<r?o(new Error("申请资金不能大于保费金额")):e()}))},n=function(t){var e=t.cellValue;t.rowIndex;return new Promise((function(t,r){return!e||Number(e)<.01?r(new Error("保费金额应大于0")):t()}))};return{columns:[{title:"缴费时间",align:"center",field:"payDate",slots:{edit:"payDateEdit"},editRender:{type:"visible"}},{headerAlign:"center",title:"保费金额（元）",align:"right",field:"insureCost",formatter:function(t){return Object(l["g"])(t.cellValue)},slots:{edit:"insureCostEdit"},editRender:{type:"visible",autofocus:".amountInput"}},{headerAlign:"center",title:"申请资金（元）",align:"right",field:"cost",formatter:function(t){return Object(l["g"])(t.cellValue)},slots:{edit:"costEdit"},editRender:{type:"visible"}},{field:"action",title:"操作",slots:{default:"action"},width:60,align:"center"}],tableRule:{payDate:[{validator:e,trigger:"change"}],insureCost:[{validator:n,trigger:"change"}],cost:[{validator:r,maxWidth:"100%",trigger:"change"}]}}},methods:{addToTable:function(t,e){var r=this;void 0!==e?this.$refs.table.validate(t).then((function(){r.projInsureList.push({method:"0",type:void 0})})).catch((function(t){return t})):r.projInsureList.push({method:"0",type:void 0})},deleteRow:function(t,e){this.projInsureList.splice(e,1),this.$emit("costChange",this.projInsureList)},setValue:function(t,e,r,n){this.$set(t,e,r),this.$refs.table.updateFooter(),this.$refs.table.updateStatus({row:t,column:n}),this.$emit("costChange",this.projInsureList)},footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";if(["insureCost","cost"].includes(t.property)){var n={style:"decimal",currency:"CNY",minimumFractionDigits:2,maximumFractionDigits:2};return["quantity","totalNum"].includes(t.property)?Number(d.a.sum(r,t.property)):Number(d.a.sum(r,t.property)).toLocaleString("zh-CN",n)}}))]},checkData:function(){var t=this;return new Promise((function(e,r){t.$refs.table.validate(t.projInsureList,(function(t){e(!t)}))}))}}},m=p,v=r("2877"),g=Object(v["a"])(m,n,o,!1,null,"7a6c03e6",null);e["default"]=g.exports},be8c:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("j-modal",{attrs:{title:t.title,visible:t.visible,confirmLoading:t.confirmLoading,width:t.modelWidth,zIndex:t.zindexNumber,switchFullscreen:""},on:{cancel:t.handleCancel},scopedSlots:t._u([{key:"header",fn:function(){return[r("div",{staticClass:"title marginTop10"},[r("span",{staticClass:"collapseTitle"},[t._v(" 附件上传 ")])])]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}])},[r("div",{ref:"modalBody"},[r("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[r("a-collapse-panel",{key:"2",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[r("div",{staticClass:"title marginTop10"},[r("span",{staticClass:"collapseTitle"},[t._v(" 维修过程监督 ")])])]},proxy:!0}])},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.supervisionInfo,disabled:t.disabled,border:!1,formRef:"formRow"}},[r("a-row",{ref:"formBpSurRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:3}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("维修过程阶段")]),r("a-col",{attrs:{span:5,"data-prop":"processStage"}},[r("j-d-dict-select-tag",{attrs:{"get-popup-container":t.getPopupContainer,title:"维修过程阶段",dictCode:"process_stage",placeholder:t.disabled?"":"请选择维修过程阶段"},on:{change:function(e){return t.dictChange(e,"processStage")}},model:{value:t.supervisionInfo.processStage,callback:function(e){t.$set(t.supervisionInfo,"processStage",e)},expression:"supervisionInfo.processStage"}})],1),r("a-col",{attrs:{span:3}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("监督人")]),r("a-col",{attrs:{span:5,"data-prop":"supervisionBy"}},[r("a-input",{attrs:{placeholder:t.disabled?"":"请输入监督人"},model:{value:t.supervisionInfo.supervisionBy,callback:function(e){t.$set(t.supervisionInfo,"supervisionBy",e)},expression:"supervisionInfo.supervisionBy"}})],1),r("a-col",{attrs:{span:3}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("监督日期")]),r("a-col",{attrs:{span:5,"data-prop":"supervisionDate"}},[r("a-date-picker",{attrs:{format:"YYYY-MM-DD",placeholder:"请选择监督日期",disabled:t.disabled,"disabled-date":t.disabledDate,getCalendarContainer:t.getParentContainer},model:{value:t.supervisionInfo.supervisionDate,callback:function(e){t.$set(t.supervisionInfo,"supervisionDate",e)},expression:"supervisionInfo.supervisionDate"}})],1),"0"==t.supervisionInfo.state?r("a-col",{attrs:{span:3}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("异常")]):r("a-col",{attrs:{span:3}},[t.disabled?t._e():r("span",{staticClass:"requiredText"},[t._v("*")]),t._v("正常")]),r("a-col",{attrs:{span:5}},[r("el-switch",{attrs:{"active-color":"#ff4949","inactive-color":"#13ce66","active-value":"0","inactive-value":"1"},model:{value:t.supervisionInfo.state,callback:function(e){t.$set(t.supervisionInfo,"state",e)},expression:"supervisionInfo.state"}})],1),r("a-col",{attrs:{span:3}}),r("a-col",{attrs:{span:5}}),r("a-col",{attrs:{span:3}}),r("a-col",{attrs:{span:5}}),r("a-col",{staticClass:"height-120",attrs:{span:3}},[t.disabled?t._e():r("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("监督描述")]),r("a-col",{staticClass:"height-120",attrs:{span:21,"data-prop":"describe"}},[r("a-textarea",{staticClass:"height-108",attrs:{placeholder:"请输入监督描述"},model:{value:t.supervisionInfo.describe,callback:function(e){t.$set(t.supervisionInfo,"describe",e)},expression:"supervisionInfo.describe"}})],1)],1)],1)],1)],1),r("type-attachment-upload",{ref:"fileupload",attrs:{busiType:"20",busiTypeDetail:"2030",busiNo:t.supervisionInfo.id,isDetail:t.disabled},on:{change:t.getFileList}}),r("div",{staticClass:"drawer-bootom-button"},[t.supervisionInfo.id&&t.supervisionInfo.id.length>0?r("a-button",{staticStyle:{"margin-right":"0.8rem"},attrs:{loading:t.confirmLoading,type:"primary"},on:{click:t.submitForm}},[r("i",{staticClass:"el-icon-finished textIcon"}),t._v("变更")]):r("a-button",{staticStyle:{"margin-right":"0.8rem"},attrs:{loading:t.confirmLoading,type:"primary"},on:{click:t.submitForm}},[r("i",{staticClass:"el-icon-finished textIcon"}),t._v("保存")]),r("a-button",{on:{click:t.handleCancel}},[r("i",{staticClass:"el-icon-circle-close textIcon"}),t._v("关闭")])],1)],1)])},o=[],a=r("eccd"),i=r("9fbd"),s=r("0fea"),l=r("2b0e"),c=r("9fb0"),u=r("c1df"),d=r.n(u),f={name:"FieldSiteUpload",components:{JDDictSelectTag:a["default"],TypeAttachmentUpload:i["default"]},props:{disabled:{type:Boolean,default:!1},zindexNumber:{type:Number,default:1200},id:{type:String,default:""},isLoad:{type:Boolean,default:!1}},provide:function(){return{previewZIndex:1201}},data:function(){return{supervisionInfo:{},activeKey:["2"],visible:!1,confirmLoading:!1,modelWidth:1200,title:"添加监督信息",modelHeight:380,rules:{processStage:[{required:!0,message:"请选择维修过程阶段",trigger:"change"}],supervisionBy:[{required:!0,message:"请输入监督人",trigger:"change"}],supervisionDate:[{required:!0,message:"请选择监督日期",trigger:"change"}],describe:[{required:!0,message:"请输入监督描述",trigger:"change"}]},url:{add:"/use/processSupervision/saveBpSurInfo",queryById:"/use/processSupervision/getBpSurById/"+this.id}}},methods:{disabledDate:function(t){return t&&t>d()().endOf("day")},getPopupContainer:function(){return this.$refs.modalBody},dictChange:function(t,e){this.supervisionInfo[e]=t},checkData:function(){var t=this.$refs.formRow.validaRowMsg(this.$refs.formBpSurRow);return t.valida},getParentContainer:function(){return this.$refs.modalBody},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1},add:function(t){var e=this;this.visible=!0,this.supervisionInfo=JSON.parse(JSON.stringify(t)),this.supervisionInfo.supervisionBy||this.$set(this.supervisionInfo,"supervisionBy",l["default"].ls.get(c["J"]).realname),this.$nextTick((function(){e.$refs.fileupload.initData()}))},getFileList:function(t){if(this.fileIdList=[],t){var e=this;t.forEach((function(t){e.fileIdList.push(t.id)}))}},submitForm:function(){if(this.changeInfoList=[],this.checkData()){if(!this.$refs.fileupload.checkData())return!1;this.saveData()}},saveData:function(){var t=this;t.confirmLoading=!0,t.supervisionInfo.fileIdList=t.fileIdList,Object(s["j"])(t.url.add,t.supervisionInfo).then((function(e){e.success?(t.$message.success(e.result),t.isLoad&&t.$emit("ok",t.supervisionInfo.projId),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))}}},h=f,p=(r("a1a0"),r("2877")),m=Object(p["a"])(h,n,o,!1,null,"3c572c71",null);e["default"]=m.exports},c216:function(t,e,r){"use strict";r("eb68")},c440:function(t,e,r){"use strict";r("a27c")},c4fa:function(t,e,r){},c864:function(t,e,r){"use strict";r("09b3")},cdc9:function(t,e,r){"use strict";r("ad05")},ce7b:function(t,e,r){},cf9e:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",["7"==t.state?r("a-badge",{attrs:{status:"success",text:"审核通过"}}):"8"==t.state?r("a-badge",{attrs:{status:"processing",text:"待审核"}}):"2"==t.state?r("a-badge",{attrs:{status:"processing",text:"拨付申请"}}):"5"==t.state?r("a-badge",{attrs:{status:"warning",text:"待撤销"}}):"X"==t.state?r("a-badge",{attrs:{status:"error",text:"已撤销"}}):"N"==t.state?r("a-badge",{attrs:{status:"error",text:"项目办结"}}):"6"==t.state?r("a-badge",{attrs:{status:"warning",text:"待办结"}}):"0"==t.state?r("a-badge",{attrs:{status:"success",text:"全部拨付"}}):"1"==t.state?r("a-badge",{attrs:{status:"success",text:"部分拨付"}}):"9"==t.state||"R"==t.state?r("a-badge",{attrs:{status:"processing",text:"新建项目"}}):t._e()],1)},o=[],a={name:"SerProModelStateComp",props:{state:{type:String,default:""}},data:function(){return{fileName:"SerProModelStateComp",description:"SerProModelStateComp"}}},i=a,s=(r("3939"),r("2877")),l=Object(s["a"])(i,n,o,!1,null,"565b81c0",null);e["default"]=l.exports},d06b:function(t,e,r){"use strict";r("1077")},d137:function(t,e,r){"use strict";r("3415")},d380:function(t,e,r){},d6ec:function(t,e,r){"use strict";r("038b")},d883:function(t,e,r){"use strict";r("9847")},dd4b:function(t,e,r){"use strict";r("ce7b")},e42c:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"preTrial"},[r("content-view",{key:"1",staticClass:"connetItem",attrs:{showIcon:!1,title:"预审信息"},scopedSlots:t._u([{key:"title",fn:function(){return[r("span",{staticClass:"collapseTitle"},[t._v("\n        预审信息\n      ")]),r("span",{staticClass:"headerMessage"},[t._v("详情请查看基本信息及项目附件")])]},proxy:!0}])},[r("a-row",{ref:"formSerProRow",staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{attrs:{span:4}},[t._v("申请人")]),r("a-col",{attrs:{span:8}},[t._v("\n        "+t._s(t.model.beforeExamine.submitter)+"\n      ")]),r("a-col",{attrs:{span:4}},[t._v("申请时间")]),r("a-col",{attrs:{span:8}},[t._v("\n        "+t._s(t.model.beforeExamine.submitTime)+"\n      ")])],1)],1),[r("content-view",{key:"2",staticClass:"connetItem",attrs:{"show-icon":!1,title:"预审意见信息"}},[r("j-form-container",{attrs:{disabled:t.isDetail}},[r("a-form-model",{ref:"formModel",attrs:{slot:"edit",model:t.model.beforeExamine,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol},slot:"edit"},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{class:{required:!t.isDetail},attrs:{span:4}},[t._v("预审选项")]),r("a-col",{attrs:{span:20}},[r("a-form-model-item",{staticClass:"width-100",attrs:{prop:"flow"}},[r("a-radio-group",{attrs:{disabled:!(t._editModal.isSave&&!t._editModal.isWorkflow&&t.currentNodeInfo.formKey&&"preTrial"===t.currentNodeInfo.formKey&&t.currentNodeInfo.assigneeIdList.includes(t.loginUser.id))},model:{value:t.model.beforeExamine.flow,callback:function(e){t.$set(t.model.beforeExamine,"flow",e)},expression:"model.beforeExamine.flow"}},[r("a-radio",{attrs:{value:"1"}},[t._v("通过")]),r("a-radio",{attrs:{value:"0"}},[t._v("驳回")])],1)],1)],1),r("a-col",{class:{required:!t.isDetail},attrs:{span:4}},[t._v("预审意见")]),r("a-col",{attrs:{span:20}},[r("a-form-model-item",{staticClass:"width-100",attrs:{prop:"advice"}},[r("a-textarea",{attrs:{placeholder:"请输入预审意见",readOnly:!(t._editModal.isSave&&!t._editModal.isWorkflow&&t.currentNodeInfo.formKey&&"preTrial"===t.currentNodeInfo.formKey&&t.currentNodeInfo.assigneeIdList.includes(t.loginUser.id))},model:{value:t.model.beforeExamine.advice,callback:function(e){t.$set(t.model.beforeExamine,"advice",e)},expression:"model.beforeExamine.advice"}})],1)],1)],1)],1)],1)],1)],r("div",{staticClass:"preTrialFooter"},[t._editModal.isSave&&!t._editModal.isWorkflow&&t.currentNodeInfo.formKey&&"preTrial"===t.currentNodeInfo.formKey&&t.currentNodeInfo.assigneeIdList.includes(t.loginUser.id)?r("a-button",{attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确定")]):t._e()],1)],2)},o=[],a=r("dc9a"),i=r("2b0e"),s=r("c1df"),l=r.n(s),c={name:"PreTrial",components:{ContentView:a["default"]},props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"维修项目信息"},projId:{type:String,default:""},proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},pageType:{type:Boolean,default:!0}},inject:["projMainData","nowNodeInfo","newEditModal"],computed:{model:{get:function(){try{return this.projMainData()}catch(t){return{}}},set:function(){}},_editModal:function(){try{return this.newEditModal()}catch(t){return{}}},currentNodeInfo:function(){try{return this.nowNodeInfo()}catch(t){return{}}}},data:function(){return{loginUser:i["default"].ls.get("Login_Userinfo"),labelCol:{span:0},wrapperCol:{span:24},rules:{flow:[{required:!0,message:"请选择预审选项！"}],advice:[{required:!0,message:"请输入预审意见！"}]}}},methods:{initData:function(){try{this.model.beforeExamine.aduitor&&!this.isDetail&&(this.model.beforeExamine.advice="",this.model.beforeExamine.flow="")}catch(t){}},handleOk:function(){var t=this,e=i["default"].ls.get("Login_Userinfo")||{};this.$refs.formModel.validate().then((function(r){delete t.model.beforeExamine.id,delete t.model.beforeExamine.createBy,delete t.model.beforeExamine.createTime,delete t.model.beforeExamine.updateBy,delete t.model.beforeExamine.updateTime,t.model.beforeExamine.aduitTime=l()().format("YYYY-MM-DD HH:mm:ss"),t.model.beforeExamine.aduitor=e.realname,"1"===t.model.beforeExamine.flow?t._editModal.handleOk():"0"===t.model.beforeExamine.flow&&t._editModal.revokeNode(!1)}))}}},u=c,d=(r("7030"),r("3d84"),r("2877")),f=Object(d["a"])(u,n,o,!1,null,"4a91cf38",null);e["default"]=f.exports},e612:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:{"height-100":"modal"!==t.showType}},["modal"===t.showType?r("j-modal",{attrs:{title:t.title,width:t.width,visible:t.visible,"z-index":t.zIndex,switchFullscreen:""},on:{cancel:t.handleCancel},scopedSlots:t._u([{key:"footer",fn:function(){return[r("a-button",{on:{click:t.handleCancel}},[t._v("关闭")])]},proxy:!0}],null,!1,4061544804)},[""!=t.tabLIst&&null!=t.tabLIst&&void 0!=t.tabLIst?r("a-tabs",{on:{change:t.changeTab}},t._l(t.tabLIst,(function(e){return r("a-tab-pane",{key:e.value,attrs:{tab:e.title,"v-model":t.chooseTab}})})),1):t._e(),r("vxe-table",{ref:"xTable",staticClass:"vxeTable",attrs:{data:t.dataSource,"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":"",border:"",resizable:"","header-align":"center","show-overflow":"tooltip","auto-resize":"","max-height":"400px"}},[r("vxe-table-column",{attrs:{type:"seq","show-overflow":!1,title:"序号","header-align":"center",align:"center",width:"60px"}}),r("vxe-table-column",{attrs:{field:"corpName",title:"单位名称","header-align":"center",align:"center",width:"350px"}}),r("vxe-table-column",{attrs:{field:"amount",title:"金额 (元)","header-align":"right",align:"right",width:"242px",formatter:function(t){var e=t.cellValue;return e?Number(e).toFixed(2):"0.00"}}})],1)],1):t._e(),r("print-report-comp",{ref:"report"})],1)},o=[],a=r("0fea"),i=r("d8a5"),s=r("dc9a"),l=r("2b0e"),c=r("9fb0"),u=r("9bed"),d=r("3ed7"),f=(r("c1df"),r("da39")),h=r("4aae"),p=r("17a8");function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function v(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function g(t,e){if(t){if("string"==typeof t)return y(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */b=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof y?e:y,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",v="completed",g={};function y(){}function w(){}function x(){}var j={};c(j,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(O([])));C&&C!==r&&n.call(C,i)&&(j=C);var _=x.prototype=y.prototype=Object.create(j);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==m(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function L(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=D(s,n);if(l){if(l===g)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?v:h,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=v,n.method="throw",n.arg=c.arg)}}}function D(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(m(e)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},P(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(_),c(_,l,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function w(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function x(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){w(a,n,o,i,s,"next",t)}function s(t){w(a,n,o,i,s,"throw",t)}i(void 0)}))}}var j={name:"ShareDetailCompPublic",mixins:[f["FooterMethod"]],components:{AmountInput:h["default"],PrintReportComp:u["default"],ContentView:s["default"],ProRollBackModal:p["default"]},props:{isDetail:{type:Boolean,default:function(){return!1}},isDoing:{type:Boolean,default:!1},showFlag:{type:Boolean,default:function(){return!1}},zIndex:{type:Number,default:1310}},data:function(){var t=function(t){var e=t.cellValue;t._row;return new Promise(function(){var t=x(b().mark((function t(r,n){var o,a;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",r());case 2:if(o=new RegExp("^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\\d{8}$"),a=new RegExp("^0[1-9][0-9]{1,2}[-]?[1-9]\\d{6,7}|0[1-9][0-9]{1,2}\\s?[1-9][0-9]{6,7}|1[356789]\\d{9}"),o.test(e)||a.test(e)){t.next=8;break}return t.abrupt("return",n(new Error("您的手机号或座机号格式不正确！")));case 8:return t.abrupt("return",r());case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},e=function(t){var e=t.cellValue;return new Promise((function(t,r){return!e||Number(e)<=0?r(new Error("分摊面积应大于0！")):t()}))};return{isPreDeclaration:!1,loginUser:l["default"].ls.get("Login_Userinfo"),comparAble:!1,websocketTimer:null,visible:!1,title:"分摊清册",width:"700px",disableSubmit:!1,activeKey:["1"],activeKeyBatch:["0"],dataSource:[],freezeAllotLists:[],allotLists:[],tabLIst:[{value:"1",title:"预分摊清册"},{value:"2",title:"冻结分摊清册"}],allotAreaEditFlag:0,chooseTab:"1",showType:"modal",loading:!1,tableTotalColumn:[{title:"totalTitle",field:"totalTitle",align:"right"},{title:"金额 (元)",width:105,field:"amountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(d["g"])(e)}},{title:"占位2",width:377,field:"empty"}],tableTotalData:[{}],url:{buildShared:"/use/projAllotList/buildShared",reShare:"/use/projAllotList/reShare",reShareForPlan:"/use/projAllotList/reShareForPlan",exportVoteList:"/use/projAllotList/downloadTemplate",importVoteList:"".concat(window._CONFIG["domianURL"],"/")+"use/projAllotList/importVoteExcel",saveVoteMsgBatch:"/use/votingHisList/saveVoteMsgBatch",saveVoteMsgBatchForPlan:"/use/votingHisList/saveVoteMsgBatchForPlan",getByIdUrl:"/use/serviceProj/queryProj",revokeLast:"/use/projVote/revokeLast",checkUserIsCorp:"/sys/sysDepart/checkUserIsCorp",endVote:"/use/projVote/endVote",editAllot:"/use/projAllotList/edit"},allotCashState:"1",areaEnterState:"0",tableRules:{phone:[{validator:t}],allotArea:[{validator:e}]},timer:null,isAdmin:"default"}},inject:["projMainData","newEditModal","nowNodeInfo","routeReload"],computed:{childList:{get:function(){return 1==this.projMainData().isHasChild?this.projMainData().children:[this.projMainData()]},set:function(){}},tokenHeader:function(){return{"X-Access-Token":l["default"].ls.get(c["a"]),sourceName:l["default"].ls.get(c["A"]),redisIndex:l["default"].ls.get(c["x"])}},currentNodeInfo:function(){try{return this.nowNodeInfo()}catch(t){return{}}}},watch:{childList:{deep:!0,immediate:!0,handler:function(t){var e,r=["struArea","allotArea","amount","accAmount","cashAmount"],n=v(t||[]);try{for(n.s();!(e=n.n()).done;){var o,a=e.value,i=v(a.allotLists||[]);try{for(i.s();!(o=i.n()).done;){var s,l=o.value,c=v(r||[]);try{for(c.s();!(s=c.n()).done;){var u=s.value,f=Object(d["c"])(this.tableTotalData[0][u+"Total"]||0,Number(l[u]));this.$set(this.tableTotalData[0],u+"Total",f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){i.e(h)}finally{i.f()}}}catch(h){n.e(h)}finally{n.f()}}}},created:function(){var t=this;this.getPreDeclaration(),this.getComparAble(),this.showFlag&&(this.showType=""),this.initDict(),this.initWebSocket(),Object(a["e"])(this.url.checkUserIsCorp).then((function(e){e.success||(t.isAdmin="visible")})),this.$emit("hide-footer",!1)},methods:{getPreDeclaration:function(){var t=this;Object(i["e"])("pre_declaration").then((function(e){t.isPreDeclaration="1"==e}))},getComparAble:function(){var t=this;Object(i["e"])("compar_able").then((function(e){t.comparAble="1"==e}))},beforeUpload:function(t){var e=this;return new Promise((function(r,n){var o=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length);["xlsx","xls"].includes(o)?r():(e.$message.warning("请选择正确的模板文件！"),n()),r()}))},initWebSocket:function(){this.websock&&this.websock.close();var t=window._CONFIG["domianURL"].replace("https://","wss://").replace("http://","ws://")+"/websocket/voteCode"+this.projMainData().id;this.websock=new WebSocket(t),this.websock.onopen=this.websocketOnopen,this.websock.onerror=this.websocketOnerror,this.websock.onmessage=this.websocketOnmessage,this.websock.onclose=this.websocketOnclose},websocketOnopen:function(){},heartCheckFun:function(){var t=this;t.heartCheck={timeout:2e4,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearTimeout(this.timeoutObj),this},start:function(){this.timeoutObj=setTimeout((function(){t.websocketSend("HeartBeat")}),this.timeout)}}},websocketOnerror:function(){this.reconnect()},reconnect:function(){var t=this;if(t.lockReconnect)return clearTimeout(this.websocketTimer),void(this.websocketTimer=null);t.lockReconnect=!0,this.websocketTimer=setTimeout((function(){t.initWebSocket(),t.lockReconnect=!1}),5e3)},websocketOnmessage:function(t){this.updateVoteInfo()},websocketOnclose:function(t){},updateVoteInfo:function(){var t=this;Object(a["e"])(this.url.getByIdUrl,{id:this.projMainData().id}).then((function(e){if(e.success){var r=t.childList.findIndex((function(t){return t.id===e.result.id}));-1!==r&&(t.$set(t.childList,r,e.result),t.countVoteMsg(t.childList[r].allotLists,t.childList[r].projVote)),t.projMainData().allotLists=e.result.allotLists,t.projMainData().votingHisLists=e.result.votingHisLists}}))},websocketSend:function(t){try{this.websock.send(t)}catch(e){}},getFooterData:function(t){for(var e=["amount"],r={totalTitle:"总计111："},n=0,o=e;n<o.length;n++){var a=o[n];r[a+"Total"]=0}var i,s=v(t.allotLists);try{for(s.s();!(i=s.n()).done;){var l,c=i.value,u=v(e);try{for(u.s();!(l=u.n()).done;){var f=l.value;r[f+"Total"]=Object(d["c"])(r[f+"Total"],Number(c[f]))}}catch(h){u.e(h)}finally{u.f()}}}catch(h){s.e(h)}finally{s.f()}return[r]},allotAreaChoose:function(t,e,r,n){var o=n.row,a=n.column;this.countVoteMsg(t.allotLists,t.projVote,e),this.$refs.xTable[e].updateStatus({row:o,column:a})},amountWarn:function(t,e,r){var n=this;return"min"===t&&!1===e&&n.$message.warning("分摊面积不可小于等于0，已为您默认修改为建筑面积！"),r.struArea},reShare:function(t){var e,r=this;this.loading=!0,e=-1!==this.$route_query.busiKey.indexOf("plan_process")?this.url.reShareForPlan:this.url.reShare,Object(a["j"])(e,t).then((function(e){e.success&&e.result&&(t.allotLists=e.result,r.countVoteMsg(t.allotLists,t.projVote),r.loading=!1)}))},checkData:function(){var t=this,e=this;return new Promise((function(r,n){function o(t,e){return a.apply(this,arguments)}function a(){return a=x(b().mark((function t(r,n){var o,a,i,s,l,c;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.activeKeyBatch=[],o=0;case 3:if(!(o<e.childList.length)){t.next=31;break}return e.activeKeyBatch=[o+""],a=!1,t.prev=7,t.next=10,e.$refs.xTable[o].validate();case 10:a=!0,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](7),a=!1;case 16:if(a){t.next=19;break}return n(),t.abrupt("return");case 19:return i=e.childList[o],s=void 0,t.next=23,e.checkVote(i.projVote.totalNum,i.projVote.inNum,i.projVote.agreeNum,i.projVote.totalArea,i.projVote.inArea,i.projVote.agreeArea,i.describe,i.baseType);case 23:if(s=t.sent,s){t.next=28;break}return n(),t.abrupt("return");case 28:o++,t.next=3;break;case 31:l=e.childList.map((function(t){return t.voteId})),"0"===e.allotCashState?(c=0,e.childList.map((function(t){t.allotLists&&t.allotLists.length>0&&t.allotLists.map((function(t){c+=Number(t.cashAmount)}))})),c>0?(e.$message.warn("当前项目不允许补交现金，请续交后再进行处理！"),n()):(e.endVote(l),r())):(e.endVote(l),r());case 33:case"end":return t.stop()}}),t,null,[[7,13]])}))),a.apply(this,arguments)}t.allotAreaEditFlag>0?e.$confirm({title:"修改分摊面积后请点击重新分摊，以确保数据已保存，否则新输入的信息将丢失",icon:"info-circle",onOk:function(){o(r,n)},onCancel:function(){n()}}):o(r,n)}))},endVote:function(t){var e=this;Object(a["j"])(this.url.endVote,t).then((function(t){t.success||e.$message.error("投票失败，请联系管理员")}))},initDict:function(){var t=this;Object(i["e"])("cash_allotment_allowed").then((function(e){e&&(t.allotCashState=e)})),Object(i["e"])("area_enter_state").then((function(e){e&&(t.areaEnterState=e)}))},showModal:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.$nextTick((function(){Object(a["j"])(e.url.reShare,t).then((function(t){t.success&&t.result&&(e.dataSource=t.result,e.loading=!1)}))}))},openPrintReport:function(t){this.$refs.report.type="print","04"!=this.projMainData().baseType?-1!==this.$route_query.busiKey.indexOf("plan_process")?this.$refs.report.print("plan_proj_project_report",{id:t}):this.$refs.report.print("proj_project_report",{id:t}):this.$refs.report.print("proj_insure_publicity",{id:t})},openPrintComparReport:function(t){this.$refs.report.type="print",this.$refs.report.print("compar_publicity",{proj_id:t})},openPrintAllot:function(t){this.$refs.report.type="print",-1!==this.$route_query.busiKey.indexOf("plan_process")?this.$refs.report.print("plan_sign_list",{planId:t}):this.$refs.report.print("proj_sign_list",{projId:t})},handleOk:function(){"modal"===this.showType?this.visible=!1:this.newEditModal&&this.newEditModal().handleOk(!0)},backModalOk:function(){this.routeReload()},handleCancel:function(){"modal"===this.showType?this.visible=!1:this.newEditModal&&this.newEditModal().revokeNode()},phoneChange:function(t,e,r,n){var o=this;this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){o.$refs.xTable[n].updateStatus({row:t,column:r})}),600)},updateAllot:function(){var t=x(b().mark((function t(e){var r,n;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["j"])("/drools/droolsData/exeDrools",{type:"verifyPhoneNumber",name:"verify",data:{phone:e.phone}});case 2:r=t.sent,r.success&&(n={id:e.id,phone:e.phone},Object(a["l"])(this.url.editAllot,n).then((function(t){})));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),countVoteMsg:function(t,e,r){var n={"00":[],"01":[],99:[]};t.forEach((function(t){n[t["signFlag"]].push(t)}));var o=n["00"].length,a=n["01"].length,i=n["00"].reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0),s=n["01"].reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0),l=t.length,c=t.reduce((function(t,e){return Object(d["c"])(t,Number(e.allotArea))}),0);e.inNum=Object(d["c"])(o,a),e.inArea=Object(d["c"])(i,s),e.inNumPercent=(100*Object(d["d"])(e.inNum,l)).toFixed(2),e.inAreaPercent=(100*Object(d["d"])(e.inArea,c)).toFixed(2),e.agreeNum=o,e.agreeArea=i,e.agreePercent=(100*Object(d["d"])(o,e.inNum)).toFixed(2),e.agreeAreaPercent=(100*Object(d["d"])(i,e.inArea)).toFixed(2),e.notAgreeNum=a,e.notAgreeArea=s,e.notAgreePercent=0===a?0:Object(d["f"])(100,e.agreePercent),e.notAgreeAreaPercent=0===a?0:Object(d["f"])(100,e.agreeAreaPercent),e.notVoteNum=Object(d["f"])(l,e.inNum),e.notVoteArea=Object(d["f"])(c,e.inArea),e.notVotePercent=Object(d["f"])(100,e.inNumPercent),e.notVoteAreaPercent=Object(d["f"])(100,e.inAreaPercent),e.totalArea=c,this.$forceUpdate(),void 0!=r&&this.$refs.xTable[r].updateFooter(),this.saveVoteMsg()},checkVote:function(){var t=x(b().mark((function t(e,r,n,o,i,s,l,c){var u=this;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["j"])("/drools/droolsData/exeDrools",{type:"ProjVote",name:"vote",data:{totalNum:e.toString(),inNum:r.toString(),agreeNum:n.toString(),totalArea:o.toString(),inArea:i.toString(),agreeArea:s.toString(),baseType:c?c.toString():"03"}}).then((function(t){return t.success||u.$message.error(l+"项目"+t.result),t.success}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e,r,n,o,a,i,s,l){return t.apply(this,arguments)}return e}(),saveVoteMsg:function(){var t,e=this;t=-1!==this.$route_query.busiKey.indexOf("plan_process")?this.url.saveVoteMsgBatchForPlan:this.url.saveVoteMsgBatch,Object(a["j"])(t,this.projMainData()).then((function(t){t.success||e.$message.error(t.message)}))},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;return 7===e?"color:#ff7f67":0===e?"text-align: right":void 0},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:2}:e<2?{colspan:0}:void 0},showAllotInfo:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.$nextTick((function(){e.tabLIst=[],e.dataSource=t,e.loading=!1}))},showAllotInfoAll:function(t){var e=this;this.visible=!0,this.loading=!0,this.dataSource=[],this.freezeDateSource=[],this.$nextTick((function(){e.allotLists=t.allotLists,e.dataSource=t.allotLists,null!=t.freezeAllotLists&&t.freezeAllotLists.length>0?e.freezeAllotLists=t.freezeAllotLists:e.tabLIst=[{value:"1",title:"预分摊单位清册"}],e.loading=!1}))},changeTab:function(t){this.dataSource="1"==t?this.allotLists:this.freezeAllotLists}}},I=j,C=(r("42b1"),r("447b"),r("2877")),_=Object(C["a"])(I,n,o,!1,null,"1983b8cd",null);e["default"]=_.exports},eb68:function(t,e,r){},eb82:function(t,e,r){"use strict";r("ee92")},ecbf:function(t,e,r){"use strict";r("59ad")},ecd4:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vxe-modal",{attrs:{title:"额度验证",width:"1000"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[r("div",[r("content-view",{attrs:{showIcon:!1,title:"项目信息"}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("项目描述")]),r("a-col",{attrs:{span:4}},[t._v(t._s(t.projInfo.describe))]),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("申报小区")]),r("a-col",{attrs:{span:4}},[t._v(t._s(t.projInfo.communityName))]),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("项目类型")]),r("a-col",{attrs:{span:4}},[t._v(t._s(t.getBaseTypeText(t.projInfo.baseType)))]),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("分摊方式")]),r("a-col",{attrs:{span:4}},[r("j-d-dict-select-tag",{attrs:{align:"left",dictCode:"allocation_method",readOnly:"",type:"select"},model:{value:t.projInfo.allotMode,callback:function(e){t.$set(t.projInfo,"allotMode",e)},expression:"projInfo.allotMode"}})],1),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("预算金额")]),r("a-col",{attrs:{span:4}},[t._v(t._s(t._f("getAmount")(t.projInfo.budgetCost))+" 元")]),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("审核金额")]),r("a-col",{attrs:{span:4}},[t._v(t._s(t._f("getAmount")(t.projInfo.contractCost))+" 元")]),r("a-col",{staticClass:"formLabel",attrs:{span:2}},[t._v("保证金")]),r("a-col",{attrs:{span:4}},[r("a-space",[r("el-switch",{attrs:{disabled:!0,"active-color":"#13ce66","active-text":"有","active-value":"1","inactive-color":"#ff4949","inactive-text":"无","inactive-value":"0"},model:{value:t.projInfo.marginFlag,callback:function(e){t.$set(t.projInfo,"marginFlag",e)},expression:"projInfo.marginFlag"}}),1==t.projInfo.marginFlag?r("amount-input",{attrs:{max:100,min:.01,"read-only":!0,addonAfter:"%",placeholder:"请输入质保金比例"},model:{value:t.projInfo.marginPer,callback:function(e){t.$set(t.projInfo,"marginPer",e)},expression:"projInfo.marginPer"}}):t._e(),r("span",[t._v("%")])],1)],1)],1)],1),r("content-view",{attrs:{"show-icon":!1,title:"拨付信息"}}),r("content-view",{attrs:{"show-icon":!1,title:"审批结果"}},[r("j-form-container",{ref:"formRow",attrs:{border:!1,disabled:!1,model:t.projInfo,rules:t.rules}},[r("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批结果")])]),r("a-col",{attrs:{span:20,"data-prop":"flag"}},[r("j-dict-radio-button",{attrs:{options:t.option},on:{change:t.onChange},model:{value:t.projInfo.flag,callback:function(e){t.$set(t.projInfo,"flag",e)},expression:"projInfo.flag"}})],1),r("a-col",{attrs:{span:4}},[r("span",{staticClass:"required"},[t._v("审批意见")])]),r("a-col",{attrs:{span:20,"data-prop":"comment"}},[r("a-textarea",{attrs:{autoSize:{minRows:5,maxRows:8}},model:{value:t.projInfo.comment,callback:function(e){t.$set(t.projInfo,"comment",e)},expression:"projInfo.comment"}})],1)],1)],1)],1)],1)])},o=[],a=r("3ed7"),i=r("eccd"),s=r("7d9a"),l=r("4aae"),c=r("dc9a"),u=r("0c8a"),d={name:"LimitVerifyModal",components:{JDictRadioButton:s["default"],AmountInput:l["default"],ContentView:c["default"],JDDictSelectTag:i["default"]},data:function(){return{visible:!1,proModel:{},projInfo:{},rules:{comment:[{required:!0,message:"请输入审批意见",trigger:"change"}],flag:[{required:!0,message:"请勾选审批结果",trigger:"change"}]},option:[{label:"同意",value:"1"},{label:"不同意",value:"3"},{label:"打回",value:"0"}]}},methods:{formatterAmount:a["g"],getBaseTypeText:u["getBaseTypeText"],onChange:function(t){t&&(this.projInfo.flag=t,1===this.projInfo.flag||"1"===this.projInfo.flag?this.projInfo.comment="同意":3===this.projInfo.flag||"3"===this.projInfo.flag?this.projInfo.comment="不同意":0!==this.projInfo.flag&&"0"!==this.projInfo.flag||(this.projInfo.comment="打回"))}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(a["g"])(t):"0.00"}}},f=d,h=r("2877"),p=Object(h["a"])(f,n,o,!1,null,"7d4e5c23",null);e["default"]=p.exports},ed2c:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"height-100"},[r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"预算审价"}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{attrs:{span:4}},[t._v("维修项目描述")]),r("a-col",{attrs:{span:20}},[t._v(t._s(t.model.describe))]),r("a-col",{attrs:{span:4}},[t._v("施工方案")]),r("a-col",{attrs:{span:8}},[t.model.constructionPlanFile?r("a",{on:{click:function(e){t.handlePreview(t.getItemByName("施工方案").showList[0],t.getItemByName("施工方案"))}}},[t._v("\n          "+t._s(t.model.constructionPlanFile.fileName)+"\n        ")]):t._e()]),r("a-col",{attrs:{span:4}},[t._v("工程预算书")]),r("a-col",{attrs:{span:8}},[t.model.projectBudgetFile?r("a",{on:{click:function(e){t.handlePreview(t.getItemByName("工程预算书").showList[0],t.getItemByName("工程预算书"))}}},[t._v("\n          "+t._s(t.model.projectBudgetFile.fileName)+"\n        ")]):t._e()])],1)],1),r("content-view",{staticClass:"detail",attrs:{showIcon:!1,title:"审价清单"}},[r("div",{staticClass:"tableWidth-100 tableDiv"},[r("vxe-table",{ref:"xTable",staticClass:"vxeTable",staticStyle:{"min-height":"300px"},attrs:{height:"auto",data:t.childList,"edit-config":t.isDetail?null:{trigger:"manual",mode:"row"},border:"",resizable:"","edit-rules":t.editRules,"header-align":"center","show-overflow":"tooltip","expand-config":{lazy:!0,loadMethod:t.loadContentMethod},"footer-method":t.footerMethod,"footer-span-method":t.footerSpanMethod,"footer-cell-style":t.footerCellStyle,"show-footer":"","auto-resize":""},scopedSlots:t._u([{key:"empty",fn:function(){return[r("div",{staticClass:"tableEmpty"},[r("a-empty",[r("span",{attrs:{slot:"description"},slot:"description"},[t._v("数据缺失，请联系管理员")])])],1)]},proxy:!0}])},[r("vxe-table-column",{attrs:{type:"expand",align:"center",width:"60px"},scopedSlots:t._u([{key:"content",fn:function(e){var n=e.row;return[r("selected-part-table",{staticStyle:{"margin-top":"10px"},attrs:{size:"small",disabledAdd:!0,data:n.costLists,isEditFlag:!1,hiddenAciton:t.isDetail,hideDelete:!0},on:{confirm:function(e){return t.handleConfirm(n,e)}},scopedSlots:t._u([{key:"empty",fn:function(){return[r("div",{staticClass:"tableEmpty"},[r("a-empty",[r("span",{attrs:{slot:"description"},slot:"description"},[t._v("数据缺失，请联系管理员")])])],1)]},proxy:!0}],null,!0)})]}}])}),r("vxe-table-column",{attrs:{type:"seq","show-overflow":!1,title:"序号",align:"center",width:"60px"}}),r("vxe-table-column",{attrs:{field:"describe",title:"维修项目描述"},scopedSlots:t._u([{key:"edit",fn:function(e){var r=e.row;e.rowIndex;return[t._v("\n            "+t._s(r.describe)+"\n          ")]}}])}),t.isDetail?t._e():r("vxe-table-column",{attrs:{align:"right",field:"construction.oldCost",title:"预算工程款",width:"190px"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n            "+t._s(t.formatterAmount(r.construction.oldCost))+"元\n          ")]}}],null,!1,1306068526)}),r("vxe-table-column",{attrs:{field:"construction.cost",align:"right",title:"审价结果",width:"190px","edit-render":{type:"visible"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[r("div",{staticStyle:{margin:"0 auto"}},[r("amount-input",{staticStyle:{padding:"1px 0"},attrs:{disabled:t.isDetail,placeholder:"请输入"},on:{change:function(e){return t.computeAmount(n,e)}},model:{value:n.construction.cost,callback:function(e){t.$set(n.construction,"cost",e)},expression:"row.construction.cost"}})],1)]}}])}),t.isDetail?t._e():r("vxe-table-column",{attrs:{align:"right",field:"d",title:"审减金额",width:"190px"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[t._v("\n            "+t._s(t.formatterAmount(t.floatSub(r.construction.oldCost,r.construction.cost)))+"元\n          ")]}}],null,!1,2868301611)})],1)],1),r("a-form-model",{ref:"formModel",attrs:{model:t.model,rules:t.modelRules}},[r("a-row",{staticClass:"houseInfo",attrs:{type:"flex"}},[r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.isDetail}},[t._v("审价结果描述")])]),r("a-col",{attrs:{span:8}},[r("a-form-model-item",{staticClass:"width-100",attrs:{prop:"construction.auditResult"}},[t.isDetail?r("span",[t._v(t._s(t.model.construction.auditResult))]):r("a-input",{attrs:{placeholder:"请输入审价结果"},model:{value:t.model.construction.auditResult,callback:function(e){t.$set(t.model.construction,"auditResult",e)},expression:"model.construction.auditResult"}})],1)],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.isDetail}},[t._v("审价方案")])]),r("a-col",{attrs:{span:8}},[r("a-form-model-item",{staticClass:"width-100",attrs:{prop:"priceReviewPlanFile.filePath"}},[-1!==t.fileUploadState?r("div",{staticClass:"row_col_flexDiv"},[t.getItemByName("审价方案").fileList&&0!==t.getItemByName("审价方案").fileList.length?r("div",[r("a",{staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:""},on:{click:function(e){t.handlePreview(t.getItemByName("审价方案").showList[0],t.getItemByName("审价方案"))}}},[t._v("\n                  "+t._s(t.getFirstFileByName("审价方案").originalName)+"\n                ")]),t.disabled||t.isDetail?t._e():r("a-button",{staticClass:"clearButton",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("审价方案"))}}})],1):r("a-space",[r("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.priceReviewPlanUrl,e,t.getItemByName("审价方案"))}}},[r("a-button",{attrs:{disabled:t.isDetail,icon:"upload"}},[t._v("上传审价方案")])],1),r("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])],1)],1):t._e()])],1)],1)],1)],1),r("share-detail-comp",{ref:"shareDetail"}),t.previewVisible?r("div",{ref:"previewDiv",staticClass:"outer_box"},[r("preview-picture",{attrs:{fileList:t.previewFileList,fileNum:t.previewNum},on:{cancel:t.exitPreview}})],1):t._e()],1)},o=[],a=r("c695"),i=r.n(a),s=r("ee6d"),l=r("0fea"),c=r("4aae"),u=r("6d5b"),d=r("eb36"),f=r("3ed7"),h=r("d8a5"),p=r("da39"),m=r("dc9a"),v=r("b7a8"),g=r("afcb");function y(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=x(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function b(t){return I(t)||j(t)||x(t)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(t,e){if(t){if("string"==typeof t)return C(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}function j(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function I(t){if(Array.isArray(t))return C(t)}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var _={name:"ProjectChildDetailComp",components:{PreviewPicture:v["default"],ContentView:m["default"],ShareDetailComp:u["default"],AmountInput:c["default"],TransferModal:s["default"],SelectedPartTable:g["default"]},mixins:[d["a"],p["FooterMethod"]],props:{isDetail:{type:Boolean,default:!1},regionCode:{type:String,default:""},projId:{type:String,default:""},showTitle:{type:Boolean,default:function(){return!0}}},inject:["projMainData"],computed:{childList:{get:function(){return 1==this.projMainData().isHasChild?this.projMainData().children:[this.projMainData()]},set:function(){}},model:{get:function(){return this.projMainData()},set:function(t){}}},mounted:function(){var t=this;this.$nextTick((function(){t.$refs.xTable.setAllRowExpand(!0)}))},watch:{regionCode:function(){this.initDevice()}},data:function(){return{activeKey:["1"],headerTitle:"预算审价",projectId:this.$route_query.id,formData:{test:""},editRules:{describe:[{required:!0,message:"请填写维修项目",trigger:"change"}]},modelRules:{"construction.auditResult":[{required:!0,message:"请输入审价结果描述"}],"priceReviewPlanFile.filePath":[{required:!0,message:"请上传审价方案！",trigger:"change"}]},showState:!0,dataSource:[],url:{evaluationResult:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId=",url_root:"/sys/category/loadTreeRoot",unilityList:"/base/regionUtility/queryUtilityList"},checkedTree:[],selectTrees:[],activeType:"add",activeIndex:void 0,disabled:!1,priceReviewPlanUrl:"",formatterAmount:f["g"],floatSub:f["f"]}},created:function(){var t=this;Object(h["e"])("budg_price_review_report_ere_id").then((function(e){t.priceReviewPlanUrl=t.url.evaluationResult+e}));var e=[{name:"审价方案",fileList:this.model.priceReviewPlanFile?[this.model.priceReviewPlanFile]:[]},{name:"施工方案",fileList:this.model.constructionPlanFile?[this.model.constructionPlanFile]:[]},{name:"工程预算书",fileList:this.model.projectBudgetFile?[this.model.projectBudgetFile]:[]}];this.initUploadFile(e)},methods:{inputWarnMsg:function(t,e){"min"===t&&this.$message.warning(e)},onFileChange:function(){var t=this;this.$set(this.model,"priceReviewPlanFile",this.getFirstFileByName("审价方案")),this.$nextTick((function(){(t.getFirstFileByName("审价方案")||{}).filePath&&t.$refs.formModel?t.$refs.formModel.clearValidate("priceReviewPlanFile.filePath"):t.$refs.formModel.validateField("priceReviewPlanFile.filePath")}))},showSupervisorAmount:function(){for(var t=0,e=0;e<this.model.children.length;e++)this.model.children[e].supervisor&&this.model.children[e].supervisor.cost&&(t+=Number(this.model.children[e].supervisor.cost));this.model.supervisor||this.$set(this.model,"supervisor",{}),this.$set(this.model.supervisor,"cost",t),this.$bus.$emit("updateSupervisorAmount",t)},computeAmount:function(t,e){var r=this;Number(e)<=0&&(this.$message.warning("审价结果应大于0"),t.construction.cost="1"),Number(t.construction.oldCost)-Number(t.construction.cost)<0?(this.$message.warning("审价结果不能大于预算工程款"),this.$nextTick((function(){t.construction.cost=t.construction.oldCost}))):(this.model.budgetCost=0,t.budgetCost=Number(t.construction.cost)+Number(t.priceReview&&t.priceReview.cost?t.priceReview.cost:0)+Number(t.supervisor&&t.supervisor.cost?t.supervisor.cost:0)+Number(t.biddingCost&&t.biddingCost.cost?t.biddingCost.cost:0)+Number(t.inspectionCost&&t.inspectionCost.cost?t.inspectionCost.cost:0)+Number(t.makeCost&&t.makeCost.cost?t.makeCost.cost:0),this.model.children&&this.model.children.length>0&&(this.model.construction.cost=0,this.model.children.forEach((function(t){r.model.budgetCost+=t.budgetCost,r.model.construction.cost=Object(f["c"])(r.model.construction.cost,t.construction.cost)}))),this.updateFooterEvent())},loadContentMethod:function(t){var e=t.row;return new Promise((function(t){Object(l["e"])("/business/repairPart/getByUtilitys/"+e.areaKeys).then((function(r){var n=[];if(r.success&&r.result){for(var o=0;o<r.result.length;o++)r.result[o]&&n.push({id:r.result[o].id,name:r.result[o].name,regionUtilityId:r.result[o].regionUtilityId});e.partListSelect=n,t()}}))}))},checkData:function(){var t=this;return new Promise((function(e,r){t.$refs.formModel.validate().then((function(){e()})).catch((function(){r(new Error("审价清单数据异常"))}))}))},initDevice:function(){var t=this,e={regionCode:this.regionCode};this.dataSource=[],Object(l["e"])(this.url.unilityList,e).then((function(e){e.success?t.dataSource=b(e.result.records):t.$message.error(e.message)}))},showShared:function(t){this.$refs.shareDetail.showModal(t)},priceChange:function(t,e){e["totalPrice"]=Object(f["e"])(e["unitPrice"],e["quantity"])},quantityChange:function(t,e){e["totalPrice"]=Object(f["e"])(e["unitPrice"],e["quantity"])},handleConfirm:function(t,e){var r,n=y(t.costLists);try{for(n.s();!(r=n.n()).done;){var o=r.value;o.longId===e[0].longId&&(this.$set(o,"materialList",e[0].materialList),this.$set(o,"checkedKeys",e[0].checkedKeys),this.$set(o,"totalPrice",e[0].totalPrice))}}catch(a){n.e(a)}finally{n.f()}},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:4}:e<4?{colspan:0}:void 0},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;if(0===e)return"text-align: right"},footerMethod:function(t){var e=t.columns,r=t.data;return[e.map((function(t,e){if(0===e)return"总计：";var n={style:"decimal",currency:"CNY",minimumFractionDigits:2,maximumFractionDigits:2};return"d"===t.property?r.reduce((function(t,e,r){return Object(f["c"])(t,Object(f["f"])(e.construction.oldCost,e.construction.cost))}),0):"construction.cost"===t.property?Number(i.a.sum(r,t.property)).toLocaleString("zh-CN",n):void 0}))]}}},P=_,k=(r("5e2e7"),r("2877")),L=Object(k["a"])(P,n,o,!1,null,"46300271",null);e["default"]=L.exports},ee6d:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("vxe-modal",{attrs:{"min-width":"800","min-height":"500","show-footer":"",width:"900",height:"600",position:{top:8},"show-zoom":"",resize:""},on:{confirm:t.modalOk,close:t.closeModal},scopedSlots:t._u([{key:"title",fn:function(){return[r("div",{staticClass:"flexCenter"},[r("span",[t._v("损坏区域")]),r("a-alert",{staticClass:"alertDiv",attrs:{type:"warning"}},[r("div",{attrs:{slot:"description"},slot:"description"},[r("a-icon",{staticStyle:{color:"#faad14","margin-right":"3px"},attrs:{theme:"filled",type:"info-circle"}}),r("span",{staticStyle:{color:"#606266"}},[t._v("请双击文字选中/取消选中")])],1)])],1)]},proxy:!0}]),model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[r("a-row",{staticClass:"treeModalRow",attrs:{gutter:20,type:"flex"}},[r("a-col",{attrs:{span:12}},[r("div",{staticClass:"leftCol"},[t._v("\n        选择：\n        "),r("div",{staticClass:"content"},[r("a-input",{attrs:{placeholder:"搜索"},on:{pressEnter:t.search},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}},[r("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1),r("div",{staticClass:"leftContentData"},[r("div",{staticClass:"treeContent"},[t._l(t.dataSourceTree,(function(e){return[r("tree-content",{key:e.id,ref:"leftTree"+e.id,refInFor:!0,attrs:{selectTrees:t.selectTrees,proSelectTree:t.checkedTree,"tree-data":e,"is-first-node":!0,type:"left"},on:{"update:selectTrees":function(e){t.selectTrees=e},"update:select-trees":function(e){t.selectTrees=e},"update:proSelectTree":function(e){t.checkedTree=e},"update:pro-select-tree":function(e){t.checkedTree=e},dblNode:t.leftTreeDbl},model:{value:t.selectKey,callback:function(e){t.selectKey=e},expression:"selectKey"}})]}))],2)])],1)])]),r("a-col",{attrs:{span:12}},[r("div",{staticClass:"rightCol"},[t._v("\n        已选：\n        "),r("div",{staticClass:"content"},[t._l(t.selectTrees,(function(e,n){return[r("tree-content",{key:e.id,ref:"rightTree",refInFor:!0,attrs:{type:"right",selectTrees:t.selectTrees,proSelectTree:t.checkedTree,"tree-data":e,"is-first-node":!0,rightIndex:n},on:{"update:selectTrees":function(e){t.selectTrees=e},"update:select-trees":function(e){t.selectTrees=e},"update:proSelectTree":function(e){t.checkedTree=e},"update:pro-select-tree":function(e){t.checkedTree=e},dblNode:t.rightTreeDbl}})]}))],2)])])],1)],1)},o=[],a=r("78ac"),i=r("eb8c"),s={name:"TransferModal",components:{JModal:a["default"],treeContent:i["default"]},props:{async:{type:Boolean,default:!1,required:!1},parentCode:{type:String,default:"",required:!1},dataSource:{type:Array,default:function(){return[]}},checkedTree:{type:Array,default:function(){return[]}},selectTrees:{type:Array,default:function(){return[]}}},computed:{dataSourceTree:{get:function(){return this.$forceUpdate(),this.searchValue?this.search():JSON.parse(JSON.stringify(this.dataSource))},set:function(t){}}},data:function(){return{targetKeys:[],visible:!1,selectKey:"",searchValue:"",type:"",editIndex:0,proSelectTree:[]}},methods:{showModal:function(){this.visible=!0},modalOk:function(){this.$emit("ok",this.selectTrees)},closeModal:function(){this.visible=!1},leftTreeDbl:function(t){this.deleteTreeNode(this.dataSourceTree,t.id,!0)},rightTreeDbl:function(t){this.deleteTreeNode(this.dataSourceTree,t.id,!1),this.$emit("delete",t.id)},deleteTreeNode:function(t,e,r,n){for(var o=0;o<t.length;o++)if(n||t[o].id===e){if(t[o].children&&0!==t[o].children.length&&this.deleteTreeNode(t[o].children,void 0,r,!0),!n)break}else t[o].children&&t[o].children.length>0&&this.deleteTreeNode(t[o].children,e,r);this.$forceUpdate()},search:function(){var t=this.treeToList(this.dataSourceTree),e=this;return t.filter((function(t){return delete t.children,-1!==t.title.indexOf(e.searchValue)}))},treeToList:function(t){var e=JSON.parse(JSON.stringify(t)),r=[],n=function(t){(t.children||(t.children=[])).map((function(t){n(t)})),delete t.children,r.push(t)};return e.map((function(t){return n(t)})),r}}},l=s,c=(r("d137"),r("2877")),u=Object(c["a"])(l,n,o,!1,null,"6c421883",null);e["default"]=u.exports},ee92:function(t,e,r){},f228:function(t,e,r){},fc393:function(t,e,r){"use strict";r("4cf4")},fd14:function(t,e,r){},ffe3:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"connet"},[r("div",{staticClass:"connet_body"},[r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"项目信息"},scopedSlots:t._u([{key:"extra",fn:function(){return[r("div",{staticClass:"editCompBtnDiv"},[!t.isDetail&&t.pageType?r("a-button",{attrs:{type:"primary",icon:"edit"},on:{click:t.changeProj}},[t._v("修改信息")]):t._e(),t.pageType?r("a-button",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"primary",icon:"pay-circle"},on:{click:t.buildRenewalAllot}},[t._v("\n              快捷续交\n            ")]):t._e()],1)]},proxy:!0}])},[r("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.serviceProInfo,disabled:t.editFlag,border:!1,formRef:"formRow"}},[r("a-row",{ref:"formSerProRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[r("a-col",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{height:"unset"},attrs:{span:0}}),r("a-col",{staticStyle:{padding:"0","min-height":"unset",border:"none"},attrs:{span:24}},[r("custom-field-form",{ref:"customFieldForm",attrs:{isDetail:t.editFlag,colSpan:t.spanObject,"p-custom-key":"proj_name"},model:{value:t.serviceProInfo.customJson,callback:function(e){t.$set(t.serviceProInfo,"customJson",e)},expression:"serviceProInfo.customJson"}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("维修项目描述")])]),r("a-col",{attrs:{span:12,"data-prop":"describe"}},[r("a-input",{model:{value:t.serviceProInfo.describe,callback:function(e){t.$set(t.serviceProInfo,"describe",e)},expression:"serviceProInfo.describe"}})],1),r("a-col",{attrs:{span:4}},[t._v("申报状态")]),r("a-col",{attrs:{span:4}},[r("ser-pro-model-state-comp",{attrs:{state:t.serviceProInfo.state}})],1),r("a-col",{attrs:{span:4}},[t._v("申请小区")]),r("a-col",{attrs:{span:4}},[t._v("\n              "+t._s(t.serviceProInfo.communityName)+"\n            ")]),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag&&!t.isChild}},[t._v("项目类型")])]),r("a-col",{attrs:{span:4,"data-prop":"baseType"}},[r("j-d-dict-select-tag",{attrs:{dictCode:"project_type",disabled:t.editFlag||t.isChild||"01"!=t.serviceProInfo.baseType&&"02"!=t.serviceProInfo.baseType,disabledOptions:t.disabledOptions,placeholder:""},model:{value:t.serviceProInfo.baseType,callback:function(e){t.$set(t.serviceProInfo,"baseType",e)},expression:"serviceProInfo.baseType"}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag&&!t.isChild}},[t._v("分摊方式")])]),r("a-col",{attrs:{span:4,"data-prop":"allotMode"}},[r("j-d-dict-select-tag",{attrs:{dictCode:"allocation_method",disabled:t.editFlag||t.isChild},on:{change:t.changeAllotMode},model:{value:t.serviceProInfo.allotMode,callback:function(e){t.$set(t.serviceProInfo,"allotMode",e)},expression:"serviceProInfo.allotMode"}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("联系人")])]),r("a-col",{attrs:{span:4,"data-prop":"reqMan"}},[r("a-input",{model:{value:t.serviceProInfo.reqMan,callback:function(e){t.$set(t.serviceProInfo,"reqMan",e)},expression:"serviceProInfo.reqMan"}})],1),r("a-col",{attrs:{span:4}},[r("span",{class:{required:!t.editFlag}},[t._v("联系电话")])]),r("a-col",{attrs:{span:4,"data-prop":"reqPhone"}},[r("a-input",{model:{value:t.serviceProInfo.reqPhone,callback:function(e){t.$set(t.serviceProInfo,"reqPhone",e)},expression:"serviceProInfo.reqPhone"}})],1),r("a-col",{attrs:{span:4}},[t._v("申报单位(个人)")]),r("a-col",{attrs:{span:4}},[r("a-select",{on:{change:t.reqCorpChange},model:{value:t.serviceProInfo.reqCode,callback:function(e){t.$set(t.serviceProInfo,"reqCode",e)},expression:"serviceProInfo.reqCode"}},t._l(t.reqCorpArr,(function(e){return r("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1),"2"===t.projMainData().publicFlag?[r("a-col",{attrs:{span:4}},[t._v("分摊自然幢")]),r("a-col",{attrs:{span:12}},[r("div",{staticClass:"width100"},[t.editFlag?t._e():r("div",{staticClass:"padding-bottom-8"},[r("a-button",{attrs:{size:"small",type:"primary"},on:{click:t.openFloorModal}},[t._v("修改分摊范围")])],1),r("vxe-table",{attrs:{"max-height":"160px","auto-resize":"",size:"small",border:"",data:t.projMainData().bldSelectedList}},[r("vxe-table-column",{attrs:{field:"name",title:"名称",formatter:function(t){var e=t.row;return e.name||e.bldName}}}),r("vxe-table-column",{attrs:{field:"publicBldAmount",title:"金额",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)}}})],1)],1)])]:"0"===t.projMainData().publicFlag?[r("a-col",{attrs:{span:4}},[t._v("分摊单位")]),r("a-col",{attrs:{span:12}},[r("div",{staticClass:"width100"},[t.editFlag?t._e():r("div",{staticClass:"padding-bottom-8"},[r("a-button",{attrs:{size:"small",type:"primary"},on:{click:t.openFloorModal}},[t._v("修改分摊范围")])],1),r("vxe-table",{attrs:{"max-height":"160px","auto-resize":"",size:"small",border:"",data:t.projMainData().publicList}},[r("vxe-table-column",{attrs:{field:"name",title:"名称",formatter:function(t){var e=t.row;return e.name||e.corpName}}}),r("vxe-table-column",{attrs:{field:"publicCorpAmount",title:"金额",formatter:function(e){var r=e.cellValue;return t.formatterAmount(r)}}})],1)],1)])]:[t.isHasChild?t._e():r("a-col",{attrs:{span:4}},[t._v("分摊范围")]),t.isHasChild?t._e():r("a-col",{staticClass:"font-style",attrs:{span:4,"data-prop":"sharedHousings"}},[r("a",{staticStyle:{"flex-shrink":"0"},attrs:{disabled:!t.editFlag},on:{click:function(e){return t.showShared(t.serviceProInfo)}}},[t._v("\n                  "+t._s(t.serviceProInfo.sharedHousings?t.serviceProInfo.sharedHousings.length:0)+"户\n                ")]),t.editFlag?t._e():r("span",{staticClass:"tagButton margin_left_10 margin_right_10",on:{click:t.openFloorModal}},[t._v("\n                  修改分摊范围\n                ")])])]],2)],1),"03"!=t.serviceProInfo.baseType?r("custom-field-form",{ref:"customFieldForm",staticStyle:{"margin-top":"6px"},attrs:{isDetail:t.editFlag,"p-custom-key":"createPro_Contract"},model:{value:t.serviceProInfo.customJson,callback:function(e){t.$set(t.serviceProInfo,"customJson",e)},expression:"serviceProInfo.customJson"}}):t._e()],1),null!=t.serviceProInfo.beforeExamine&&"0"===t.serviceProInfo.beforeExamine.flow?r("content-view",{staticClass:"connetItem",attrs:{"show-icon":!1,title:"驳回意见"}},[r("a-row",{staticClass:"houseInfo"},[r("a-col",{attrs:{span:4}},[t._v("审批人")]),r("a-col",{attrs:{span:8}},[t._v("\n            "+t._s(t.serviceProInfo.beforeExamine.aduitor)+"\n          ")]),r("a-col",{attrs:{span:4}},[t._v("审批时间")]),r("a-col",{attrs:{span:8}},[t._v("\n            "+t._s(t.serviceProInfo.beforeExamine.aduitTime)+"\n          ")]),r("a-col",{attrs:{span:4}},[t._v("驳回意见")]),r("a-col",{attrs:{span:20}},[r("a-textarea",{attrs:{readOnly:""},model:{value:t.serviceProInfo.beforeExamine.advice,callback:function(e){t.$set(t.serviceProInfo.beforeExamine,"advice",e)},expression:"serviceProInfo.beforeExamine.advice"}})],1)],1)],1):t._e(),t.isHasChild?t._e():r("content-view",{staticClass:"connetItem itemDiv",attrs:{showIcon:!1,title:"维修对象"},scopedSlots:t._u([{key:"title",fn:function(){return[r("span",{staticClass:"collapseTitle"},[t._v("维修对象")]),t.serviceProInfo.costLists&&0===t.serviceProInfo.costLists.length?r("span",{staticClass:"costListErrText"},[t._v("\n               维修对象请至少保留一条！\n          ")]):t._e()]},proxy:!0}],null,!1,1631915346)},[r("selected-part-table",{class:[18==t.font?"fonstyle":""],staticStyle:{"margin-top":"10px"},attrs:{size:"small",data:t.serviceProInfo.costLists,biddingCorpCode:t.serviceProInfo.biddingCorpCode,comparAble:t.serviceProInfo.comparAble,isEditFlag:!1,hiddenAciton:!0},on:{"update:data":function(e){return t.$set(t.serviceProInfo,"costLists",e)}}}),t.isHasChild||t.editFlag?t._e():r("div",{staticClass:"align-center"},[r("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.editCostLists(!0)}}},[t._v(t._s("编辑")+"维修对象")])],1)],1),r("content-view",{directives:[{name:"show",rawName:"v-show",value:t.getComparFlag,expression:"getComparFlag"}],staticClass:"connetItem itemDiv",attrs:{showIcon:!1,title:"预算费用明细"}},[r("cost-manage",{ref:"cost",class:[18==t.font?"fonstyle":""],attrs:{"is-has-child":t.isHasChild,"is-child":t.isChild,isDetail:t.editFlag||t.isDetail},on:{initCost:t.initCost,delCost:t.delCost,unitChoose:t.unitChoose,amountChange:t.setChooseAmount}})],1),t.isHasChild?r("content-view",{staticClass:"connetItem",attrs:{showIcon:!1,title:"子项目"}},[r("child-pro",{ref:"childPro",attrs:{zIndex:t.zIndex,pageType:t.pageType,allotMode:t.allotMode,proInfo:t.serviceProInfo,isDetail:t.isDetail,biddingCorpCode:t.serviceProInfo.biddingCorpCode,comparAble:t.serviceProInfo.comparAble},on:{setBgCost:t.setCostMsg}})],1):t._e(),!t.editFlag&&t.isChild?r("div",{staticClass:"saveBtnDiv"},[r("a-button",{attrs:{type:"primary",loading:t.isLoading},on:{click:t.addChildProj}},[t._v("\n          保存\n        ")])],1):t._e()],1),r("corp-info-detail",{ref:"detailForm",attrs:{zIndex:t.zIndex+1}}),r("repair-parts-tree-modal",{ref:"repairPartsTreeModal",attrs:{zIndex:t.zIndex+1,isDetail:t.editFlag,choosePart:t.serviceProInfo.costLists,regionId:t.serviceProInfo.regionId},on:{"update:choosePart":function(e){return t.$set(t.serviceProInfo,"costLists",e)},"update:choose-part":function(e){return t.$set(t.serviceProInfo,"costLists",e)},ok:t.partChooseOk}}),r("create-pro-floor-choose",{ref:"floorChoose",attrs:{zIndex:t.zIndex+1,apportionType:1,editPublicType:!0},on:{ok:t.getHouseId}}),r("share-detail-comp",{ref:"shareDetail",attrs:{zIndex:t.zIndex+1}}),r("mend-amount-modal",{ref:"mendList",attrs:{zIndex:t.zIndex+1,projInfo:t.serviceProInfo}}),r("share-detail-comp-public",{ref:"shareDetailPublic",attrs:{zIndex:t.zIndex+1}}),r("mend-amount-modal",{ref:"mendList",attrs:{zIndex:t.zIndex+1,projInfo:t.serviceProInfo}})],1)},o=[],a=r("eccd"),i=r("cf9e"),s=r("779d"),l=r("0fea"),c=r("9b3d"),u=r("b88f"),d=r("d9e8"),f=r("dc9a"),h=r("4da9"),p=r("fdce"),m=r("2a9b"),v=r("e7a5"),g=r("d8a5"),y=r("6d5b"),b=r("e612"),w=r("f6f3"),x=r("2b0e"),j=r("9fb0"),I=r("c1df"),C=r.n(I),_=r("afcb"),P=r("3ed7"),k=r("4aae");function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function D(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function T(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?D(Object(r),!0).forEach((function(e){M(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function M(t,e,r){return(e=S(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function S(t){var e=O(t,"string");return"symbol"==L(e)?e:e+""}function O(t,e){if("object"!=L(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function E(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */E=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new M(n||[]);return o(i,"_invoke",{value:P(t,r,s)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};c(w,i,(function(){return this}));var x=Object.getPrototypeOf,j=x&&x(x(S([])));j&&j!==r&&n.call(j,i)&&(w=j);var I=b.prototype=g.prototype=Object.create(w);function C(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,a,i,s){var l=d(t[o],t,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==L(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(u).then((function(t){c.value=t,i(c)}),(function(t){return r("throw",t,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function P(e,r,n){var o=f;return function(a,i){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var l=k(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=d(e,r,n);if("normal"===c.type){if(o=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function D(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(D,this),this.reset(!0)}function S(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(L(e)+" is not iterable")}return y.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=c(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,l,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},C(_.prototype),c(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new _(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},C(I),c(I,l,"Generator"),c(I,i,(function(){return this})),c(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=S,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:S(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function A(t,e,r,n,o,a,i){try{var s=t[a](i),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){A(a,n,o,i,s,"next",t)}function s(t){A(a,n,o,i,s,"throw",t)}i(void 0)}))}}function $(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=N(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function N(t,e){if(t){if("string"==typeof t)return R(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(t,e):void 0}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var q={name:"ServiceProAuditInfoComp",components:{AmountInput:k["default"],MendAmountModal:w["default"],CreateProFloorChoose:v["default"],RepairPartsTreeModal:m["default"],JDictRegionListSelect:p["default"],CreateProModal:h["default"],ContentView:f["default"],ChildPro:d["default"],CostManage:c["default"],JDDictSelectTag:a["default"],SerProModelStateComp:i["default"],CorpInfoDetail:s["default"],cards:u["default"],ShareDetailComp:y["default"],ShareDetailCompPublic:b["default"],SelectedPartTable:_["default"]},props:{disabled:{type:Boolean,default:!0},title:{type:String,default:"维修项目信息"},projId:{type:String,default:""},proInfo:{type:Object,default:null},isDetail:{type:Boolean,default:!1},pageType:{type:Boolean,default:!0},zIndex:{type:Number,default:1e3}},inject:["projMainData"],created:function(){var t=this;Object(g["e"])("allot_mode").then((function(e){t.allotMode=e})),this.initData()},computed:{getComparFlag:function(){if(0==this.serviceProInfo.isChild){var t=this.serviceProInfo.costs;if(!t)return!1;var e,r=0,n=$(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;r=Object(P["c"])(r,o.cost)}}catch(a){n.e(a)}finally{n.f()}return r>0}return!(!this.serviceProInfo.construction||0==this.serviceProInfo.construction.cost)}},data:function(){var t=function(t,e){return new Promise(function(){var t=F(E().mark((function t(r){return E().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",r());case 2:Object(l["j"])("/drools/droolsData/exeDrools",{type:"verifyPhoneNumber",name:"verify",data:{phone:e}}).then((function(t){return t.success?r():r(t.result)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())};return{spanObject:[{field:"proj_name",labelSpan:4,valueSpan:20}],reqCorpArr:[],font:x["default"].ls.get(j["w"]),serviceProInfo:{},disabledOptions:["03","04","05"],rules:{allotMode:[{required:!0,message:"请选择分摊方式",trigger:"change"}],baseType:[{required:!0,message:"请选择项目类别",trigger:"change"}],describe:[{required:!0,message:"请输入项目描述",trigger:"change"}],choosePart:[{required:!0,message:"请选择标准维修项目",trigger:"change"}],sharedHousings:[{required:!0,message:"请选择分摊范围",type:"array",trigger:"change"}],preTime:[{required:!1,message:"请输入预估工期",trigger:"change"}],reqMan:[{required:!0,message:"请输入联系人",trigger:"change"}],reqPhone:[{required:!0,message:"请输入联系电话",trigger:"change"},{validator:t,type:"Promise"}]},activeKey:[],expandKeys:["1","2","3"],isLoading:!1,url:{queryProj:"/use/serviceProj/queryProj",corpInfolist:"/use/serviceCost/corpList",queryMinProj:"/use/serviceProj/queryMinProj",addProj:"/use/serviceProj/addProj",addProjPublic:"/use/serviceProj/addProjForPublic",queryRegionByList:"/base/rtRegion/queryRegionByList",buildRenewal:"/use/projAllotList/buildRenewal",getReqCorp:"/base/rtRegion/getReqCorp"},isChild:!1,panelStyle:"background: #fff",isHasChild:!1,editFlag:this.disabled,allotMode:0,lists:[],partColumns:[{field:"remark",title:"设施设备-标准维修项目名称",showOverflow:!0},{field:"describe",title:"维修描述",showOverflow:!0},{title:"材料数量",align:"right",slots:{default:"materialNum"},width:100},{field:"totalPrice",title:"总价",width:80,align:"right",formatter:function(t){var e=t.cellValue;return Object(P["g"])(e)}}],costTypeMenu:[{value:"construction",label:"工程款",type:"01"},{value:"priceReview",label:"审价费",type:"02"},{value:"supervisor",label:"监理费",type:"03"},{value:"biddingCost",label:"招标费",type:"04"},{value:"inspectionCost",label:"检测费",type:"05"},{value:"makeCost",label:"造价费",type:"06"}]}},methods:{getReqCorpArr:function(){var t=this,e=x["default"].ls.get(j["J"]);Object(l["e"])(this.url.getReqCorp,{id:this.serviceProInfo.regionId,corpCode:x["default"].ls.get(j["J"]).orgCode}).then((function(r){r&&r.result&&(t.$set(t.serviceProInfo,"reqCode",t.serviceProInfo.reqCode||""),t.reqCorpArr=[{name:"暂无",code:""},{code:e.orgCode,name:e.orgCodeTxt}],r.result.forEach((function(e){t.reqCorpArr.push(e)})))}))},reqCorpChange:function(t,e){this.$set(this.serviceProInfo,"reqCode",t)},formatterAmount:P["g"],initData:function(){var t=this,e=this;null===this.proInfo?(this.serviceProInfo=this.projMainData(),this.setCostMsg(),0==this.serviceProInfo.isHasChild&&(e.isChild=!1,e.isHasChild=!1,e.$nextTick((function(){e.$refs.cost.$refs.table.refreshColumn()})),this.serviceProInfo.sharedHousings&&0!==this.serviceProInfo.sharedHousings.length||this.isDetail||!this.pageType||(this.$message.info("当前分摊户数为0，请修改！"),this.editFlag=!1))):(this.serviceProInfo=this.proInfo,this.isChild=!0,this.isHasChild=!1,this.$nextTick((function(){t.costTypeMenu.forEach((function(e){t.serviceProInfo[e.value]&&t.$refs.cost.tableData.push({type:e.type,cost:t.serviceProInfo[e.value].cost,unitCode:t.serviceProInfo[e.value].chargeCorpCode})})),t.$refs.cost.gridOptions.columns.splice(4,2)}))),this.serviceProInfo&&this.serviceProInfo.customJson&&this.$nextTick((function(){})),this.getReqCorpArr(),"05"===this.serviceProInfo.baseType&&("0"===this.projMainData().publicFlag?this.projMainData().publicList=this.serviceProInfo.allotLists.map((function(t){return T(T({},t),{},{publicCorpAmount:t.amount})})):"2"===this.projMainData().publicFlag&&(this.projMainData().bldSelectedList=this.serviceProInfo.allotLists.map((function(t){return T(T({},t),{},{publicBldAmount:t.amount,id:t.nodeId})}))))},setCostMsg:function(){var t=this,e=this;1==e.serviceProInfo.isHasChild&&e.costTypeMenu.forEach((function(t){var r=t.value;e.serviceProInfo[r]&&(e.serviceProInfo[r].cost=0),e.serviceProInfo.children.forEach((function(t){t[r]&&(e.serviceProInfo[r]?e.serviceProInfo[r].cost+=Number(t[r]?t[r].cost:0):e.$set(e.serviceProInfo,r,{cost:Number(t[r]?t[r].cost:0),baseType:t[r]?t[r].baseType:"",state:t[r]?t[r].state:"",describe:t[r]?t[r].describe:"",chargeCorpCode:t[r]?t[r].chargeCorpCode:"",chargeCorpMan:t[r]?t[r].chargeCorpMan:"",chargeCorpPhone:t[r]?t[r].chargeCorpPhone:"",projId:e.projMainData().id,stage:"01"}))}))})),this.$nextTick((function(){1==t.serviceProInfo.isHasChild&&t.$set(t,"isHasChild",!0),e.$refs.cost.tableData=[],e.costTypeMenu.forEach((function(t){e.serviceProInfo[t.value]&&e.$refs.cost.tableData.push({type:e.serviceProInfo[t.value].baseType,unitCode:e.serviceProInfo[t.value].chargeCorpCode,cost:e.serviceProInfo[t.value].cost})})),t.isDetail&&t.$refs.cost.gridOptions.columns.splice(4,2)}))},handleDetail:function(t){var e=this;Object(l["e"])(this.url.corpInfolist,{code:t}).then((function(t){if(t.result){var r=t.result.records[0];e.$refs.detailForm.show(r),e.$refs.detailForm.title=r.name+" ("+r.baseType_dictText+") "}}))},unitChoose:function(t,e){var r=e.value;this.projMainData()[r]||this.$set(this.projMainData(),r,{}),this.projMainData()[r].projId=this.projMainData().id,this.projMainData()[r].chargeCorpCode=t[0]?t[0].code:"",this.projMainData()[r].chargeCorpMan=t[0]?t[0].linkMan:"",this.projMainData()[r].stage="01",this.projMainData()[r].baseType=e.type,this.projMainData()[r].chargeCorpPhone=t[0]?t[0].phone:"",this.projMainData()[r].describe=this.projMainData().describe+e.label,!this.isChild&&this.isHasChild&&this.$refs.childPro.unitChoose(e)},setChooseAmount:function(t,e){var r=e.value;this.isChild?this.$set(this.proInfo[r],"cost",t||0):(this.projMainData()[r]||this.$set(this.projMainData(),r,{}),this.$set(this.projMainData()[r],"cost",t||0),this.projMainData()[r].stage="01",this.isHasChild&&this.$refs.childPro.allotmentAmount(e)),this.setBgCost()},setBgCost:function(){this.projMainData().budgetCost=Number(this.projMainData().construction.cost)+Number(this.projMainData().priceReview&&this.projMainData().priceReview.cost?this.projMainData().priceReview.cost:0)+Number(this.projMainData().supervisor&&this.projMainData().supervisor.cost?this.projMainData().supervisor.cost:0)+Number(this.projMainData().biddingCost&&this.projMainData().biddingCost.cost?this.projMainData().biddingCost.cost:0)+Number(this.projMainData().inspectionCost&&this.projMainData().inspectionCost.cost?this.projMainData().inspectionCost.cost:0)+Number(this.projMainData().makeCost&&this.projMainData().makeCost.cost?this.projMainData().makeCost.cost:0)},initCost:function(t){var e=t.type||"",r=t.value;this.isChild?this.proInfo[r]||this.$set(this.proInfo,r,{baseType:e}):(this.projMainData()[r]||this.$set(this.projMainData(),r,{baseType:e}),this.isHasChild&&this.$refs.childPro.addCost(r))},delCost:function(t,e){var r;t&&(r=t.value);var n=this.projMainData()[r].cost;this.projMainData()[r]=null,this.isHasChild&&this.$refs.childPro.delCost(r),e&&this.setChooseAmount(n,e)},checkData:function(){var t=this;return new Promise(function(){var e=F(E().mark((function e(r,n){var o,a,i,s,l,c,u,d,f,h,p;return E().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.editFlag){e.next=9;break}return e.next=4,t.$refs.formRow.validaRowMsgPro(t.$refs.formSerProRow);case 4:if(o=e.sent,a=o.valida,i=o.errCols,a){e.next=9;break}return e.abrupt("return",n(i));case 9:if("03"===t.projMainData().baseType){e.next=18;break}return e.next=12,t.$refs.customFieldForm.checkData();case 12:if(s=e.sent,l=s.valida,l){e.next=18;break}return e.abrupt("return",n(errCols));case 18:if(c=t.isChild?t.proInfo:t.projMainData(),0!=c.children.length||0!==c.costLists.length){e.next=24;break}return t.$message.warn(" 维修对象请至少保留一条！"),e.abrupt("return",n());case 24:if(!(c.children.length>0)){e.next=34;break}u=c.children,d=0;case 27:if(!(d<u.length)){e.next=34;break}if(0!==u[d].costLists.length){e.next=31;break}return t.$message.warn(" 每个子项目维修对象请至少保留一条！"),e.abrupt("return",n());case 31:d++,e.next=27;break;case 34:return e.next=36,t.$refs.cost.checkData();case 36:if(!t.isHasChild){e.next=39;break}return e.next=39,t.$refs.childPro.checkData();case 39:if(t.projMainData().basicFlag=!0,"0"!=t.projMainData().publicFlag){e.next=49;break}if(t.projMainData().allotLists.forEach((function(t){t.publicCorpAmount=t.amount})),f=t.projMainData().publicList.reduce((function(t,e){return t+Number(e.publicCorpAmount)}),0),f===Number(t.projMainData().budgetCost)){e.next=47;break}return t.loadingNum=0,t.$message.error("请检查预算总额是否与公房单位金额总和一致!"),e.abrupt("return",n());case 47:e.next=55;break;case 49:if("2"!=t.projMainData().publicFlag){e.next=55;break}if(h=t.projMainData().bldSelectedList.reduce((function(t,e){return t+Number(e.publicBldAmount)}),0),h===Number(t.projMainData().budgetCost)){e.next=55;break}return t.loadingNum=0,t.$message.error("请检查预算总额是否与已选自然幢金额总和一致!"),e.abrupt("return",n());case 55:t.projMainData().isSubmit="1",p=x["default"].ls.get(j["J"]),null!=t.projMainData().beforeExamine&&(t.projMainData().beforeExamine.id=null,t.projMainData().beforeExamine.submitter=p.realname,t.projMainData().beforeExamine.submitTime=C()(new Date).format("YYYY-MM-DD HH:mm:ss"),t.projMainData().beforeExamine.createBy=null,t.projMainData().beforeExamine.createTime=null,t.projMainData().beforeExamine.updateBy=null,t.projMainData().beforeExamine.updateTime=null,t.projMainData().beforeExamine.aduitor=null,t.projMainData().beforeExamine.aduitTime=null,t.projMainData().beforeExamine.advice=null),r(),e.next=64;break;case 61:e.prev=61,e.t0=e["catch"](0),n(e.t0);case 64:case"end":return e.stop()}}),e,null,[[0,61]])})));return function(t,r){return e.apply(this,arguments)}}())},changeProj:function(){var t=this;this.$confirm({title:"注意",content:"开启编辑后变更的数据将无法撤销，且编辑完成后点击保存将覆盖原数据，是否开启编辑",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){var e;t.editFlag=!1,e=t.isChild?t.proInfo:t.projMainData(),e.costLists.forEach((function(t){t.id=null})),t.$nextTick((function(){t.$refs.cost.$refs.table.refreshColumn()}))}})},regionChange:function(t,e){this.regionInfo=e,this.initDevice(t)},editCostLists:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t?this.$confirm({title:"注意",content:"变更标准维修项目将导致分摊范围自动更新，是否进行变更",okText:"确认",cancelText:"取消",zIndex:1300,onOk:function(){if(!e.projMainData().regionCode)return e.$refs.regionSelect.focus(),e.$message.warn("请选择申报小区");e.$refs.repairPartsTreeModal.open()}}):e.$refs.repairPartsTreeModal.open()},changeAllotMode:function(t){this.serviceProInfo.allotMode=t,this.serviceProInfo.children&&this.serviceProInfo.children.map((function(e){e.allotMode=t})),this.$forceUpdate()},openFloorModal:function(){this.$refs.floorChoose.changeFloor(this.serviceProInfo)},getHouseId:function(){this.projMainData().publicFlag,this.isChild?this.proInfo.sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})):(this.projMainData().sharedHousings=this.projMainData().apportionFloors.map((function(t){return t.id})),this.projMainData().editHouseFlag="1")},addChildProj:function(){var t=this;this.$refs.formRow.validaRowMsgPro(this.$refs.formSerProRow).then((function(e){var r=t.isChild?t.proInfo:t.projMainData();e.valida&&0!==r.costLists.length&&(t.isLoading=!0,Object(l["j"])(t.url.addProj,r,{"tenant-id":r.sysOrgCode}).then((function(e){e.success?(t.$message.success(e.message),t.$emit("close")):t.$message.error(e.message)})).finally((function(){t.isLoading=!1})))}))},partChooseOk:function(t){var e=this,r=t.map((function(t){return t.rangeId})).join(",");Object(l["e"])(this.url.queryRegionByList,{ids:r}).then((function(t){if(t){var r=[];if(t[0]){var n=t[0];n.children.forEach((function(t){t.children.forEach((function(t){t.children.forEach((function(t){r.push(t.id)}))}))})),e.isChild?e.proInfo.sharedHousings=r:(e.projMainData().sharedHousings=r,e.projMainData().editHouseFlag="1")}}else e.$message.error(t.message)}))},showShared:function(t){"05"!=this.serviceProInfo.baseType||this.serviceProInfo.voteId?this.$refs.shareDetail.showAllotInfoAll(t):this.$refs.shareDetailPublic.showAllotInfoAll(t)},buildRenewalAllot:function(){var t=this;this.projMainData()&&Object(l["j"])("/use/projAllotList/queryProjAloot/"+this.projMainData().id).then((function(e){e&&e.success&&(t.projMainData().allotLists=e.result,t.$refs.mendList.initData())}))}},filters:{getAmount:function(t){return t&&""!==t&&"undefined"!==t?Object(P["g"])(t):"0.00"}}},B=q,V=(r("33a9"),r("2877")),z=Object(V["a"])(B,n,o,!1,null,"66a462c8",null);e["default"]=z.exports}}]);