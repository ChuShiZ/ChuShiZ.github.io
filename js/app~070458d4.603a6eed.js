(window["webpackJsonp_joinsoft-v9"]=window["webpackJsonp_joinsoft-v9"]||[]).push([["app~070458d4"],{"003b":function(t,e,i){"use strict";i("3865")},"02eb":function(t,e,i){},"0a33":function(t,e,i){},"0cae":function(t,e,i){},"0e68":function(t,e,i){},"107e":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-modal",{attrs:{title:t.title,visible:t.visible,confirmLoading:t.confirmLoading,width:t.modelWidth,heiht:t.modelHeight,okButtonProps:{class:{"jee-hidden":!0}},switchFullscreen:""},on:{cancel:t.handleCancel}},[i("m-e-s-super-query",{attrs:{fieldList:t.queryObj,saveCode:t.fileName,type:t.showType,defaultQuery:!0},on:{ok:t.handleSuperQuery}}),i("v-table",{ref:"table",attrs:{"if-init-query":!1,"row-config":{height:120},toolbar:!0,bordered:"",stripe:!0,data:t.loadData,"table-height":"500","page-size":10,tableColumn:t.columns,serial:!1,resizable:""},on:{"cell-dblclick":t.DoubleSelect},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[i("a",{on:{click:function(e){return t.handleChoose(o)}}},[i("a-icon",{attrs:{type:"setting"}}),t._v(" 选择")],1)]}}])})],1)},s=[],r=(i("6eb7"),i("0a5e")),a=i("6fa9"),n=i("0fea"),l=i("d8a5"),c={name:"ChooseGorpComp",mixins:[r["a"]],components:{MESSuperQuery:a["default"]},props:{title:{type:String,default:"单位信息列表"},projId:{type:String,default:""}},data:function(){var t=this;return{fileName:"ChooseGorpComp",id:"",description:"ChooseGorpComp",visible:!1,confirmLoading:!1,queryParam:{state:0},corpType:"",modelWidth:1044,modelHeight:780,showType:"queryList",costTypeMenu:[{value:"construction",label:"工程款",type:"01",corpType:"03"},{value:"priceReview",label:"审价费",type:"02",corpType:"06"},{value:"supervisor",label:"监理费",type:"03",corpType:"05"},{value:"biddingCost",label:"招标费",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测费",type:"05",corpType:"08"},{value:"makeCost",label:"造价费",type:"06",corpType:"09"}],queryObj:[{label:"单位名称",value:"corp.name",type:"input",queryType:"like"},{label:"单位类型",value:"corp.base_type",type:"select",options:[]}],columns:[{title:"单位名称",headerAlign:"center",align:"left",field:"name",treeNode:!0,minWidth:300},{title:"单位类型",align:"center",headerAlign:"center",field:"baseType_dictText",direction:"rtl",minWidth:100},{title:"单位联系人",align:"center",headerAlign:"center",minWidth:80,field:"linkMan"},{title:"操作",field:"action",align:"center",fixed:"right",width:80,slot:!0}],loadData:function(e){return Object(n["e"])(t.url.list,Object.assign(e,t.queryParam)).then((function(t){return t.result}))},url:{list:"/use/serviceCost/corpList"}}},created:function(){this.initDictConfig()},methods:{initDictConfig:function(){this.queryObj.map((function(t){"corp.base_type"===t.value&&Object(l["g"])("corp_type").then((function(e){e.result.forEach((function(e){var i={label:e.text,value:e.value};t.options.push(i)}))}))}))},init:function(t,e,i){var o=this;i&&(this.queryObj.find((function(t){return"单位类型"===t.label})).val=this.costTypeMenu.find((function(t){return t.type===i})).corpType),this.id=t,this.corpType=e,this.visible=!0,this.$nextTick((function(){o.queryPage()}))},handleChoose:function(t){t.id=this.id,t.chType=this.corpType,this.$emit("getCorpInfo",t),this.close()},DoubleSelect:function(t){t.row.id=this.id,t.row.chType=this.corpType,this.$emit("getCorpInfo",t.row),this.close()},handleCancel:function(){this.close()},close:function(){this.$emit("close"),this.visible=!1,this.rowIndex="",this.corpType=""}}},u=c,d=(i("b148"),i("2877")),p=Object(d["a"])(u,o,s,!1,null,"3e1a83f0",null);e["default"]=p.exports},"11b9":function(t,e,i){},1449:function(t,e,i){"use strict";i("43bc")},"18e4":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[!t.childList||t.childList.length<=0?i("a-empty"):[t._l(t.childList,(function(e,o){return[i("a-collapse",{key:o+"",attrs:{bordered:!1},model:{value:t.activeKeyBatch,callback:function(e){t.activeKeyBatch=e},expression:"activeKeyBatch"}},[i("a-collapse-panel",{key:o+"",attrs:{forceRender:"",showArrow:!1},scopedSlots:t._u([{key:"header",fn:function(){return[i("div",{staticClass:"collapseHeaderBox"},[i("span",{staticClass:"collapseTitle"},[t._v("\n                    "+t._s(e.describe)),i("a-icon",{staticClass:"collapseIcon",style:{transform:t.activeKeyBatch.includes(o+"")?"rotate(90deg)":""},attrs:{type:"right"}})],1)])]},proxy:!0}],null,!0)},[i("div",{staticClass:"panelContent"},[i("a-button",{staticClass:"unitChoosePath",attrs:{size:"small",type:"primary"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toChooseUnitPath.apply(null,arguments)}}},[t._v("比选单位")]),i("a-row",{staticClass:"houseInfo"},[i("a-col",{attrs:{span:4}},[t._v("工程款：")]),i("a-col",{attrs:{span:20}},[t._v("\n                    "+t._s(e.construction.cost)+"\n                  ")])],1),i("a-card",{attrs:{title:"备选单位",size:"small"}},[i("vxe-grid",{attrs:{size:"mini",columns:t.columns,loading:t.loading,"auto-resize":"",border:"",data:t.tableData},on:{"cell-dblclick":t.celldclick},scopedSlots:t._u([{key:"action",fn:function(o){return[t._t("tableAction",(function(){return[i("a",{on:{click:function(i){return t.tableActionButton(o,e)}}},[i("a-icon",{attrs:{type:"setting"}}),t._v(" 选择")],1)]}),{tableData:o})]}}],null,!0)})],1)],1)])],1)]}))]],2)])},s=[],r=i("0fea"),a=i("dc9a"),n=i("3ed7"),l=i("2b0e"),c=i("9fb0"),u=i("9bed"),d=i("da39"),p=i("4ec3"),h={name:"CompanySelectComp",mixins:[d["FooterMethod"]],components:{PrintReportComp:u["default"],ContentView:a["default"]},props:{isDetail:{type:Boolean,default:function(){return!1}},showFlag:{type:Boolean,default:function(){return!1}}},data:function(){return{disableSubmit:!1,activeKey:["1"],activeKeyBatch:["0"],loading:!1,tableTotalColumn:[{title:"totalTitle",field:"totalTitle",align:"right"},{title:"建筑面积 (㎡)",width:130,field:"struAreaTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(n["g"])(e,3)}},{title:"分摊面积 (㎡)",width:130,field:"allotAreaTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(n["g"])(e,3)}},{title:"分摊金额 (元)",width:150,field:"amountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(n["g"])(e)}},{title:"资金支付 (元)",width:150,field:"accAmountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(n["g"])(e)}},{title:"补交现金 (元)",width:150,field:"cashAmountTotal",align:"right",formatter:function(t){var e=t.cellValue;return Object(n["g"])(e)}},{title:"占位2",width:530,field:"empty"}],tableTotalData:[{}],tableData:[],url:{getCorp:"/base/rCorpInfo/getCorpInfoByBaseType",synchronizeProject:"/use/serviceProj/synchronizeProject"},columns:[{type:"seq",title:"序号",width:"60px"},{title:"单位名称",align:"left",field:"name",showOverflow:"tooltip"},{title:"地址",align:"left",field:"address",showOverflow:"tooltip"},{title:"联系人",align:"center",field:"linkMan",showOverflow:"tooltip"},{title:"联系人",align:"center",field:"phone",showOverflow:"tooltip"}],tableParams:{pageNo:1,pageSize:10,field:"id,name,address,linkMan,phone",order:"desc",column:"createTime",baseType:"03"},tableTotal:0}},inject:["projMainData"],computed:{childList:{get:function(){return 1==this.projMainData().isHasChild?this.projMainData().children:[this.projMainData()]},set:function(){}},tokenHeader:function(){return{"X-Access-Token":l["default"].ls.get(c["a"]),sourceName:l["default"].ls.get(c["A"]),redisIndex:l["default"].ls.get(c["x"])}}},watch:{},created:function(){this.initData()},methods:{tableActionButton:function(t,e){var i=t.row;e.construction.chargeCorpCode=i.code,e.construction.chargeCorpMan=i.linkMan,e.construction.chargeCorpPhone=i.phone,this.$message.success("选择单位成功"),this.visible=!1},celldclick:function(t){var e=t.row[this.optionField.value];this.autoValue=e,this.visible=!1},initData:function(){var t=this;this.loading=!0,Object(r["e"])(this.url.getCorp,Object.assign({},this.tableParams)).then((function(e){e.success&&(t.tableData=(e.result.records||[]).filter((function(t,e){return e<1})),t.loading=!1),510===e.code&&t.$message.warning(e.message),t.loading=!1,t.$forceUpdate()}))},pageChange:function(){this.initData()},footerCellStyle:function(t){t.$rowIndex,t.column;var e=t.columnIndex;return 7===e?"color:#ff7f67":0===e?"text-align: right":void 0},footerSpanMethod:function(t){t._rowIndex;var e=t._columnIndex;return 0===e?{colspan:3}:e<3?{colspan:0}:void 0},toChooseUnitPath:function(){var t=this;Object(r["j"])(this.url.synchronizeProject,this.projMainData()).then((function(e){e.success?Object(p["l"])("crop_select_ip").then((function(t){if(t.result){var e=document.createElement("a");e.href=t.result,e.target="_blank",e.click()}})):t.$message.error("同步失败")}))}}},m=h,f=(i("8083"),i("4fda"),i("2877")),g=Object(f["a"])(m,o,s,!1,null,"f49c0fde",null);e["default"]=g.exports},"212c":function(t,e,i){"use strict";i("02eb")},"29b1":function(t,e,i){},"2a50":function(t,e,i){},"2d54":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.modelCost,disabled:t.disabled,border:!0}},[i("a-row",{ref:"rowContent",staticClass:"bidNegotiationFormRow",attrs:{slot:"detail",type:"flex"},slot:"detail"},[i("a-col",{attrs:{span:3}},[t.disabled?t._e():i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("施工单位\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"constructionCode"}},[i("div",{staticClass:"row_col_flexDiv"},[i("input-search-modal",{attrs:{disabled:t.disabled,width:"100%",placeholder:"请选择施工单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:"03"},"is-custom-modal":!1},on:{change:function(e,i){return t.afterChoose([i])}},scopedSlots:t._u([{key:"button",fn:function(){return[i("a-button",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}]},[t._v("选择单位")])]},proxy:!0}]),model:{value:t.modelCost.constructionCode,callback:function(e){t.$set(t.modelCost,"constructionCode",e)},expression:"modelCost.constructionCode"}})],1)]),i("a-col",{attrs:{span:3}},[i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("施工方案\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"constructionPlanFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"row_col_flexDiv"},[!t.getItemByName("施工方案").fileList||0===t.getItemByName("施工方案").fileList.length||t.getItemByName("施工方案").loading?[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.constructionPlanEreUrl,e,t.getItemByName("施工方案"))}},on:{change:function(e){return t.uploadChange(e,t.getItemByName("施工方案"))}}},[i("a-button",{attrs:{loading:t.getItemByName("施工方案").loading,icon:"upload"}},[t._v("上传文件")])],1),t.getItemByName("施工方案").loading?t._e():i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])]:t._e(),t.getItemByName("施工方案").loading?i("a-progress",{attrs:{width:32,type:"circle",percent:t.getItemByName("施工方案").percent}}):t._e(),t.getItemByName("施工方案").fileList&&t.getItemByName("施工方案").fileList.length>0&&!t.getItemByName("施工方案").loading?i("div",{staticClass:"div_upload_show"},[i("a",{staticClass:"a_upload_fileName",staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:"",href:t.getFirstFileByName("施工方案").filePath,title:t.getFirstFileByName("施工方案").originalName}},[t._v(t._s(t.getFirstFileByName("施工方案").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"button_upload_delete",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("施工方案"))}}})],1):t._e()],2):t._e()]),i("a-col",{attrs:{span:3}},[i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("工程预算书\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"projectBudgetFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"row_col_flexDiv"},[!t.getItemByName("工程预算书").fileList||0===t.getItemByName("工程预算书").fileList.length||t.getItemByName("工程预算书").loading?[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.projectbudgetEreUrl,e,t.getItemByName("工程预算书"))}},on:{change:function(e){return t.uploadChange(e,t.getItemByName("工程预算书"))}}},[i("a-button",{attrs:{loading:t.getItemByName("工程预算书").loading,icon:"upload"}},[t._v("上传文件")])],1),t.getItemByName("工程预算书").loading?t._e():i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])]:t._e(),t.getItemByName("工程预算书").loading?i("a-progress",{attrs:{width:32,type:"circle",percent:t.getItemByName("工程预算书").percent}}):t._e(),t.getItemByName("工程预算书").fileList&&t.getItemByName("工程预算书").fileList.length>0&&!t.getItemByName("工程预算书").loading?i("div",{staticClass:"div_upload_show"},[i("a",{staticClass:"a_upload_fileName",staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:!0,href:t.getFirstFileByName("工程预算书").filePath,title:t.getFirstFileByName("工程预算书").originalName}},[t._v(t._s(t.getFirstFileByName("工程预算书").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"button_upload_delete",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("工程预算书"))}}})],1):t._e()],2):t._e()]),t.isChild?t._e():i("a-col",{attrs:{span:3}},[i("span",{staticClass:"required"},[t._v("工程款")])]),t.isChild?t._e():i("a-col",{attrs:{span:9,"data-prop":"constructionAmount"}},[i("amount-input",{attrs:{min:0,placeholder:"请输入工程款"},on:{change:t.setConstructionAmount},model:{value:t.modelCost.constructionAmount,callback:function(e){t.$set(t.modelCost,"constructionAmount",e)},expression:"modelCost.constructionAmount"}})],1),t.isChild?t._e():[t._l(t.costType,(function(e){return[i("a-col",{key:e.value+"unitLabel",attrs:{span:3}},[i("span",[t._v(t._s(e.label)+"单位"+t._s(e.corpType))])]),i("a-col",{key:e.value+"unitValue",attrs:{span:9,"data-prop":e.value+"Code"}},[t._v("\n            "+t._s(e.value)+"\n            "),i("div",{staticClass:"row_col_flexDiv"},[i("input-search-modal",{attrs:{disabled:t.disabled,width:"100%",placeholder:"请选择"+e.label+"单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:e.corpType},"is-custom-modal":!1},on:{change:function(i,o){return t.costUnitChoose(e,o)}},scopedSlots:t._u([{key:"button",fn:function(){return[i("a-button",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}]},[t._v("选择单位")])]},proxy:!0}],null,!0),model:{value:t.modelCost[e.value+"Code"],callback:function(i){t.$set(t.modelCost,e.value+"Code",i)},expression:"modelCost[costItem.value + 'Code']"}})],1)]),i("a-col",{key:e.value+"amountLabel",attrs:{span:3}},[i("span",[t._v(t._s(e.label)+"费")])]),i("a-col",{key:e.value+"amountValue",attrs:{span:9,"data-prop":e.value+"Amount"}},[i("amount-input",{attrs:{min:0,placeholder:"请输入审价费"},on:{change:function(i){return t.setCostAmount(e)}},model:{value:t.modelCost[e.value+"Amount"],callback:function(i){t.$set(t.modelCost,e.value+"Amount",i)},expression:"modelCost[costItem.value+'Amount']"}})],1)]}))],i("a-col",{attrs:{span:3}},[i("span",{staticClass:"required"},[t._v("预估工期")])]),i("a-col",{attrs:{span:9,"data-prop":"preTime"}},[i("div",{staticClass:"inputNumber_addon"},[i("a-input-number",{staticClass:"numberInput",staticStyle:{width:"100%"},attrs:{min:0,precision:0,addonAfter:"天",placeholder:"请输入预估工期"},on:{change:t.setPreTime},model:{value:t.modelCost.preTime,callback:function(e){t.$set(t.modelCost,"preTime",e)},expression:"modelCost.preTime"}}),i("div",{staticClass:"numberAddonAfter"},[t._v("天")])],1)]),i("a-col",{attrs:{span:3}},[t.isChild?t._e():i("span",{staticClass:"required"},[t._v("项目预算")])]),t.isChild?t._e():i("a-col",{attrs:{readOnly:"",span:9,"data-prop":"budgetCost"}},[i("a-input",{attrs:{addonAfter:"元",readOnly:"",placeholder:"自动核算总价（工程款、审价费、监理费）"},model:{value:t.budgetAmount,callback:function(e){t.budgetAmount=e},expression:"budgetAmount"}})],1)],2)],1)],1)},s=[],r=i("4aae"),a=i("eb36"),n=i("d8a5"),l=i("aa2d"),c={name:"BidNegotiationModal",components:{InputSearchModal:l["default"],AmountInput:r["default"]},mixins:[a["a"]],props:{isDetail:{type:Boolean,default:!1},isChild:{type:Boolean,default:!1}},inject:{projMainData:{default:function(){return{}}},costMsg:{default:function(){return{}}}},computed:{projObj:function(){return this.projMainData()}},watch:{projObj:{deep:!0,handler:function(t){this.caculateAmount()}},enclosureList:{deep:!0,handler:function(t){}}},created:function(){var t=this;Object(n["e"])("construction_plan_ere_id").then((function(e){t.constructionPlanEreUrl=t.url.constructionPlanUrl+e})),Object(n["e"])("project_budget_ere_id").then((function(e){t.projectbudgetEreUrl=t.url.projectBudgetUrl+e}))},data:function(){var t=function(t,e,i){Number(e)>0?i():i(new Error("金额应大于0").message)};return{validaAmount:t,modelCost:{constructionCode:"",constructionAmount:""},engAmount:null,budgetAmount:null,disabled:!1,rules:{regionCode:[{required:!0,message:"请输入物业区域名称",trigger:"change"}],constructionPlanFile:[{required:!0,message:"请上传施工方案",trigger:"change"}],projectBudgetFile:[{required:!0,message:"请上传工程预算书",trigger:"change"}],constructionCode:[{required:!0,message:"请选择施工单位",trigger:"change"}],preTime:[{required:!0,message:"请输入预估工期",trigger:"change"}],constructionAmount:[{required:!0,message:"请输入工程款",trigger:"change"},{validator:t}]},url:{constructionPlanUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId=",projectBudgetUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId="},constructionPlanEreUrl:"",projectbudgetEreUrl:"",costType:[],columns:[{title:"单位名称",align:"left",field:"name"},{title:"地址",align:"left",field:"address"},{title:"联系人",align:"center",field:"linkMan"}]}},methods:{checkData:function(){return this.$refs.formRow.validaRowMsg(this.$refs.rowContent)},onFileChange:function(t,e,i){var o=this.getFirstFileByName("施工方案"),s=this.getFirstFileByName("工程预算书");this.projObj.constructionPlanFile=o,this.$set(this.modelCost,"constructionPlanFile",o&&Object.keys(o).length>0?o:void 0),this.projObj.projectBudgetFile=s,this.$set(this.modelCost,"projectBudgetFile",s&&Object.keys(s).length>0?s:void 0)},caculateAmount:function(){this.showEngAmount(),this.showBudgetAmount()},showEngAmount:function(){this.engAmount=this.projObj.construction&&this.projObj.construction.cost&&!isNaN(this.projObj.construction.cost)?this.projObj.construction.cost:0},showBudgetAmount:function(){this.budgetAmount=0,this.budgetAmount=Number(this.projObj.construction&&this.projObj.construction.cost?this.projObj.construction.cost:0)+Number(this.projObj.priceReview&&this.projObj.priceReview.cost?this.projObj.priceReview.cost:0)+Number(this.projObj.supervisor&&this.projObj.supervisor.cost?this.projObj.supervisor.cost:0)+Number(this.projObj.biddingCost&&this.projObj.biddingCost.cost?this.projObj.biddingCost.cost:0)+Number(this.projObj.inspectionCost&&this.projObj.inspectionCost.cost?this.projObj.inspectionCost.cost:0)+Number(this.projObj.makeCost&&this.projObj.makeCost.cost?this.projObj.makeCost.cost:0),this.budgetAmount=Number(this.budgetAmount).toFixed(2),this.$set(this.projObj,"budgetCost",this.budgetAmount)},computeFee:function(){this.projObj.construction&&this.projObj.construction.cost&&(this.modelCost.supervisorAmount=Number(Number(this.modelCost.constructionAmount)/Number(this.projObj.construction.cost)*Number(this.costMsg().supervisorAmount)).toFixed(2),this.modelCost.priceReviewAmount=Number(Number(this.modelCost.constructionAmount)/Number(this.projObj.construction.cost)*Number(this.costMsg().priceReviewAmount)).toFixed(2))},afterChoose:function(t){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.projObj.construction.projId=this.projObj.id,this.projObj.construction.chargeCorpCode=t[0].code,this.projObj.construction.chargeCorpMan=t[0].linkMan,this.projObj.construction.chargeCorpPhone=t[0].phone,this.projObj.construction.describe=this.projObj.describe+"工程总费用"},priceReviewChoose:function(t){this.projObj.priceReview||this.$set(this.projObj,"priceReview",{}),this.projObj.priceReview.projId=this.projObj.id,this.projObj.priceReview.chargeCorpCode=t[0].code,this.projObj.priceReview.chargeCorpMan=t[0].linkMan,this.projObj.priceReview.stage="01",this.projObj.priceReview.baseType="02",this.projObj.priceReview.chargeCorpPhone=t[0].phone,this.projObj.priceReview.cost=this.modelCost.priceReviewAmount?this.modelCost.priceReviewAmount:0},setPriceReviewAmount:function(){this.projObj.priceReview||this.$set(this.projObj,"priceReview",{}),this.$set(this.projObj.priceReview,"cost",this.modelCost.priceReviewAmount?this.modelCost.priceReviewAmount:0),this.caculateAmount()},supervisorChoose:function(t){this.projObj.supervisor||this.$set(this.projObj,"supervisor",{}),this.projObj.supervisor.projId=this.projObj.id,this.projObj.supervisor.chargeCorpCode=t[0].code,this.projObj.supervisor.chargeCorpMan=t[0].linkMan,this.projObj.supervisor.stage="01",this.projObj.supervisor.baseType="03",this.projObj.supervisor.chargeCorpPhone=t[0].phone,this.projObj.supervisor.cost=this.modelCost.supervisorAmount?this.modelCost.supervisorAmount:0},setSupAmount:function(){this.projObj.supervisor||this.$set(this.projObj,"supervisor",{}),this.$set(this.projObj.supervisor,"cost",this.modelCost.supervisorAmount?this.modelCost.supervisorAmount:0),this.caculateAmount()},setConstructionAmount:function(){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.$set(this.projObj.construction,"cost",this.modelCost.constructionAmount?this.modelCost.constructionAmount:0),this.caculateAmount()},setPreTime:function(){this.projObj.preTime=this.modelCost.preTime},initData:function(){this.projObj.supervisor&&(this.modelCost.supervisorCode=this.projObj.supervisor.chargeCorpCode,this.modelCost.supervisorAmount=this.projObj.supervisor.cost),this.projObj.priceReview&&(this.modelCost.priceReviewCode=this.projObj.priceReview.chargeCorpCode,this.modelCost.priceReviewAmount=this.projObj.priceReview.cost),this.projObj.construction&&(this.modelCost.constructionAmount=this.projObj.construction.cost),this.modelCost.constructionCode=this.projObj.construction?this.projObj.construction.chargeCorpCode:"",this.caculateAmount();var t=[{name:"施工方案",fileList:this.projObj.constructionPlanFile?[this.projObj.constructionPlanFile]:[]},{name:"工程预算书",fileList:this.projObj.projectBudgetFile?[this.projObj.projectBudgetFile]:[]}];this.initUploadFile(t)},addCost:function(t){this.projObj[t.value]||this.$set(this.projObj,t.value,{}),this.rules[t.value+"Amount"]=[{required:!0,message:"请输入".concat(t.label,"费"),trigger:"change"},{validator:this.validaAmount}],this.rules[t.value+"Code"]=[{required:!0,message:"请选择".concat(t.label,"单位"),trigger:"change"}],this.costType.push(t)},removeCost:function(t){this.$set(this.projObj,t.value,void 0),this.$set(this.modelCost,t.value,""),this.$set(this.modelCost,t.value+"Code",""),this.$set(this.modelCost,t.value+"Amount",0),this.$delete(this.rules,t.label+"Code"),this.$delete(this.rules,t.label+"Amount");var e=this.costType.findIndex((function(e){return e.value===t.value}));e>=0&&this.costType.splice(e,1)},setCostAmount:function(t){this.$set(this.projObj[t.value],"cost",this.modelCost[t.value+"Amount"]?this.modelCost[t.value+"Amount"]:0),this.caculateAmount()},costUnitChoose:function(t,e){e&&(this.projObj[t.value].projId=this.projObj.id,this.projObj[t.value].chargeCorpCode=e.code,this.projObj[t.value].chargeCorpMan=e.linkMan,this.projObj[t.value].stage="01",this.projObj[t.value].baseType=t.type,this.projObj[t.value].chargeCorpPhone=e.phone,this.projObj[t.value].cost=this.modelCost[t.value+"Amount"]?this.modelCost[t.value+"Amount"]:0)}},mounted:function(){var t=this;this.$bus.$on("updateReviewAmount",(function(e){t.modelCost.priceReviewAmount=e,t.caculateAmount()})),this.$bus.$on("updateSupervisorAmount",(function(e){t.modelCost.supervisorAmount=e,t.caculateAmount()}))}},u=c,d=(i("8c56"),i("003b"),i("2877")),p=Object(d["a"])(u,o,s,!1,null,"0fcf51e5",null);e["default"]=p.exports},"2df5":function(t,e,i){},"34c6":function(t,e,i){"use strict";i("8f26")},3865:function(t,e,i){},"387b":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"baseInfo"},[i("j-form-container",{staticClass:"width100"},[i("a-row",{staticClass:"houseInfo"},[i("a-col",{attrs:{xxl:2,xl:4}},[t._v("项目描述")]),i("a-col",{attrs:{xxl:22,xl:20}},[t._v(t._s("万象新天四区9号楼1单元楼顶防水，下雨漏雨严重，雨季来临尽快修复"))]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("项目类型")]),i("a-col",{attrs:{xxl:12,xl:10}},[t._v(t._s("公共部位"))]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("分摊方式")]),i("a-col",{attrs:{xxl:8,xl:6}},[t._v(t._s("自定义分摊"))]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("预计工期")]),i("a-col",{attrs:{xxl:12,xl:10}},[t._v(t._s("30")+"天")]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("申请小区")]),i("a-col",{attrs:{xxl:8,xl:6}},[t._v(t._s("万象新天四区"))]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("施工单位")]),i("a-col",{attrs:{xxl:12,xl:10}},[i("a",[t._v(t._s("山东嘉友互联"))]),i("span",{staticClass:"spanTag"},[t._v("AAA")])]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("申报状态")]),i("a-col",{attrs:{xxl:8,xl:6}},[i("span",{staticStyle:{color:"#FF7F17"}},[t._v(t._s("待初核"))])]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("审价单位")]),i("a-col",{attrs:{xxl:12,xl:10}},[i("a",[t._v(t._s("山东嘉友互联"))]),i("span",{staticClass:"spanTag"},[t._v("AAA")])]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("监理单位")]),i("a-col",{attrs:{xxl:8,xl:6}},[i("a",[t._v(t._s("山东嘉友互联"))]),i("span",{staticClass:"spanTag"},[t._v("AAA")])]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("联系人")]),i("a-col",{attrs:{xxl:12,xl:10}},[t._v(t._s("张三"))]),i("a-col",{attrs:{xxl:2,xl:4}},[t._v("联系电话")]),i("a-col",{attrs:{xxl:8,xl:6}},[t._v(t._s("15253618743917"))])],1)],1)],1)},s=[],r={name:"BaseInfo"},a=r,n=(i("ef22"),i("2877")),l=Object(n["a"])(a,o,s,!1,null,"389d9451",null);e["default"]=l.exports},"41e5":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"childPro"},[i("div",{staticClass:"childPro_header"},[i("div",{staticClass:"header_search"},[i("a-input",{staticClass:"width-200",attrs:{"allow-clear":!0,placeholder:"请输入项目描述"},model:{value:t.projDescribe,callback:function(e){t.projDescribe=e},expression:"projDescribe"}}),i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getListById(t.parentModel.id,"search")}}},[t._v("搜索")])],1),i("div",{staticClass:"header_rightAction"},[i("a-icon",{class:{active:"card"===t.showType},attrs:{type:"appstore"},on:{click:function(e){t.showType="card"}}}),i("a-icon",{class:{active:"list"===t.showType},attrs:{type:"unordered-list"},on:{click:function(e){t.showType="list"}}}),t.isDetail?t._e():i("a-button",{attrs:{type:"primary"},on:{click:t.addChild}},[t._v("新增")])],1)]),i("div",{staticClass:"childPro_content"},[t.lists.length>0?["card"===t.showType?i("cards",{attrs:{zIndex:t.zIndex,lists:t.pageList,isDetail:t.isDetail},on:{refresh:function(e){return t.getListById(t.parentModel.id)}}}):t._e(),"list"===t.showType?i("vxe-grid",{attrs:{"edit-config":t.isDetail?null:{},height:"auto",border:"",data:t.lists,columns:t.columns},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[i("get-table-action-buttons",[i("a",{on:{click:function(e){return t.proManager(o)}}},[t._v("项目管理")]),t.isDetail?t._e():i("a",{on:{click:function(e){return t.delMiniProj(o)}}},[t._v("删除")]),t.isDetail?t._e():i("a",{on:{click:function(e){return t.addChild(o)}}},[t._v("复制")])])]}},{key:"priceReview",fn:function(e){var o=e.row;return[i("div",[t._v(t._s(o.insureStartTime)+" 至 "+t._s(o.insureEndTime))])]}}],null,!1,3656431667)}):t._e()]:i("a-empty")],2),"card"===t.showType&&t.lists&&t.lists.length>0?i("div",{staticClass:"childPro_footer"},[i("a-pagination",t._b({attrs:{pageSize:t.cardPagination.pageSize,total:t.lists.length},on:{"update:pageSize":function(e){return t.$set(t.cardPagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.cardPagination,"pageSize",e)}},model:{value:t.cardPagination.current,callback:function(e){t.$set(t.cardPagination,"current",e)},expression:"cardPagination.current"}},"a-pagination",t.cardPagination,!1))],1):t._e(),i("create-pro-modal",{ref:"createProModal",on:{ok:function(e){return t.getListById(t.parentModel.id)}}}),i("child-pro-manager",{ref:"childProManager",attrs:{zIndex:t.zIndex+1,"pro-info":t.childInfo,isDetail:t.isDetail},on:{ok:function(){return t.getListById(t.parentModel.id)}}})],1)},s=[],r=i("4ef9"),a=i("4da9"),n=i("0fea"),l=i("4aae"),c=i("d8a5"),u=i("362e"),d=i("2d4c"),p=i("e67d"),h=i("3ed7");function m(t){return v(t)||b(t)||g(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,e){if(t){if("string"==typeof t)return j(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?j(t,e):void 0}}function b(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function v(t){if(Array.isArray(t))return j(t)}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}var y={name:"ChildInsurance",components:{GetTableActionButtons:d["default"],CostSetter:u["default"],AmountInput:l["default"],CreateProModal:a["default"],cards:r["default"],ChildProManager:p["default"]},inject:["projMainData"],provide:function(){var t=this;return{costMsg:function(){return t.childCostMsg}}},props:{isDetail:{type:Boolean,default:!1},allotMode:{type:[String,Number],default:""},zIndex:{type:Number,default:1e3}},data:function(){return{showType:"card",projDescribe:"",lists:[],url:{queryMinProj:"/use/serviceProj/queryMinProj",delMiniProj:"/use/serviceProj/delMiniProj/"},parentModel:{},priceReviewFlag:0,modelCost:{},childCostMsg:{},columns:[{title:"保险项目编号",field:"code",width:140},{title:"保险描述",field:"describe"},{title:"保费金额",field:"budgetCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"申请资金",field:"budgetCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"保险时间范围",field:"priceReview",slots:{default:"priceReview"}},{title:"分摊户数",field:"allotLists",align:"right",formatter:function(t){var e=t.cellValue;return e?e.length:0}},{title:"操作",slots:{default:"action"},align:"center",width:180}],costTypeMenu:[{value:"priceReview",label:"审价",type:"02"},{value:"supervisor",label:"监理",type:"03"},{value:"biddingCost",label:"招标",type:"04"},{value:"inspectionCost",label:"检测",type:"05"},{value:"makeCost",label:"造价",type:"06"}],childInfo:{},cardPagination:{current:1,defaultPageSize:6,pageSize:6,showSizeChanger:!1,pageSizeOptions:["6","12","18","24"]}}},computed:{projObj:function(){return this.projMainData()},pageList:{get:function(){var t=(this.cardPagination.current-1)*this.cardPagination.pageSize,e=this.cardPagination.pageSize*this.cardPagination.current;return this.lists.slice(t,e)},set:function(){}}},mounted:function(){var t=this;Object(c["e"])("allot_mode").then((function(e){t.modelCost.allotMode=e})),this.parentModel=this.projMainData(),"1"==this.projObj.isHasChild&&this.getListById(this.parentModel.id)},methods:{checkData:function(){var t=this;return new Promise((function(e,i){if(!t.lists||0===t.lists.length)return t.$message.warning("请创建一个子项目！"),i(new Error("请创建一个子项目！"));for(var o=0;o<t.lists.length;o++){var s=t.lists[o];s.baseType=t.projMainData().baseType,s.allotMode=t.projMainData().allotMode}if(t.priceReviewFlag)if(t.modelCost&&t.modelCost.supervisorCode&&t.modelCost.supervisorAmount&&t.modelCost.priceReviewCode&&t.modelCost.priceReviewAmount){t.projMainData().construction.cost=0;for(var r=0;r<t.lists.length;r++){var a=JSON.parse(JSON.stringify(t.projMainData().priceReview));a.cost=t.lists[r].priceReview.cost,a.describe=t.lists[r].priceReview.describe,t.lists[r].priceReview=a;var n=JSON.parse(JSON.stringify(t.projMainData().supervisor));n.cost=t.lists[r].supervisor.cost,n.describe=t.lists[r].supervisor.describe,t.lists[r].supervisor=n,t.projMainData().construction.cost=Object(h["c"])(t.projMainData().construction.cost,t.lists[r].construction.cost)}e()}else t.$message.warning("请填写审价费监理费信息"),i(new Error("请填写审价费监理费信息！"));else e()}))},getListById:function(t,e){var i=this;this.lists=[];var o={id:t};e&&"search"==e&&(o.describe=this.projDescribe),Object(n["e"])(this.url.queryMinProj,o).then((function(t){var e,o=t.success,s=t.result,r=t.message;o&&s?((e=i.lists).push.apply(e,m(s)),i.setCostMsg(),i.projMainData().children=i.lists,i.$emit("setBgCost")):i.$message.warning(r)}))},addChild:function(t){var e=JSON.parse(JSON.stringify(this.modelCost));if(0==this.allotMode&&(this.modelCost.supervisorAmount&&(e.supervisorAmount=Number(Number(e.supervisorAmount)/(this.lists.length+1)).toFixed(2)),this.modelCost.priceReviewAmount&&(e.priceReviewAmount=Number(Number(e.priceReviewAmount)/(this.lists.length+1)).toFixed(2))),this.childCostMsg=e,this.$refs.createProModal.model.regionCode=this.projMainData().regionCode,this.$refs.createProModal.model.communityName=this.projMainData().communityName,this.$refs.createProModal.model.regionId=this.projMainData().regionId,this.$refs.createProModal.model.pid=this.projMainData().id,this.$refs.createProModal.model.baseType=this.projMainData().baseType,this.$refs.createProModal.model.allotMode=this.projMainData().allotMode,this.$refs.createProModal.model.sysOrgCode=this.projMainData().sysOrgCode,this.$refs.createProModal.model.insureCostMsg=JSON.parse(JSON.stringify(this.projMainData().insureCostMsg)),this.$refs.createProModal.model.insureCostMsg.cost&&(this.$refs.createProModal.model.insureCostMsg.cost=0),t&&t.id){this.$set(this.$refs.createProModal.model,"describe",t.describe);var i=JSON.parse(JSON.stringify(t.costLists));i.map((function(t){t.partDesc=t.remark,t.id=void 0})),this.$set(this.$refs.createProModal.model,"choosePart",i),this.$set(this.$refs.createProModal.model,"reqMan",t.reqMan),this.$set(this.$refs.createProModal.model,"reqPhone",t.reqPhone);var o=[],s=JSON.parse(JSON.stringify(t.sharedHousings));s.map((function(t){o.push({id:t})})),this.$set(this.$refs.createProModal.model,"apportionFloors",o)}this.$refs.createProModal.open(!1)},setConstruction:function(t){var e=this;this.projMainData().construction||this.$set(this.projMainData(),"construction",{}),this.projMainData().construction.cost=0,this.lists.forEach((function(t){e.projMainData().construction.cost=Object(h["c"])(e.projMainData().construction.cost,Number(t.construction.cost))})),this.projMainData().construction.describe=this.projMainData().describe+"工程总费用"},setCostMsg:function(){var t=this;this.costTypeMenu.forEach((function(e){t.projMainData()[e.value]&&(t.unitChoose(e),t.setChooseAmount(e))}))},setBgCost:function(){for(var t=0;t<this.lists.length;t++)this.lists[t].budgetCost=Object(h["c"])(Number(this.lists[t].construction.cost),Number(this.lists[t].priceReview&&this.lists[t].priceReview.cost?this.lists[t].priceReview.cost:0),Number(this.lists[t].supervisor&&this.lists[t].supervisor.cost?this.lists[t].supervisor.cost:0),Number(this.lists[t].biddingCost&&this.lists[t].biddingCost.cost?this.lists[t].biddingCost.cost:0),Number(this.lists[t].inspectionCost&&this.lists[t].inspectionCost.cost?this.lists[t].inspectionCost.cost:0),Number(this.lists[t].makeCost&&this.lists[t].makeCost.cost?this.lists[t].makeCost.cost:0))},unitChoose:function(t){var e=t.value,i=JSON.parse(JSON.stringify(this.projMainData()[e]));i.cost=i.cost?i.cost:0;for(var o=0;o<this.lists.length;o++)this.lists[o][e]||this.$set(this.lists[o],e,{cost:0}),this.lists[o][e].projId=this.projMainData().id,this.lists[o][e].chargeCorpCode=i.chargeCorpCode,this.lists[o][e].chargeCorpMan=i.chargeCorpMan,this.lists[o][e].stage="01",this.lists[o][e].baseType=i.baseType,this.lists[o][e].chargeCorpPhone=i.chargeCorpPhone,this.lists[o][e].describe=this.lists[o].describe+t.label},setChooseAmount:function(t){for(var e=t.value,i=this.projMainData()[e].cost,o=0,s=0;s<this.lists.length;s++)this.lists[s][e]||this.$set(this.lists[s],e,{cost:0}),"0"===this.allotMode?this.lists[s][e].cost=Number(Object(h["d"])(i,this.lists.length)).toFixed(2):this.lists[s][e].cost=Number(Object(h["e"])(Object(h["d"])(this.lists[s].construction.cost,this.projMainData().construction.cost),i)).toFixed(2),o=Object(h["c"])(o,this.lists[s][e].cost);if(o!=i){var r=Object(h["f"])(i,o);this.lists[0][e].cost=Object(h["c"])(this.lists[0][e].cost,r)}this.setBgCost()},delCost:function(t){for(var e=0;e<this.lists.length;e++)this.$set(this.lists[e],t,null);this.setBgCost()},delMiniProj:function(t){var e=this,i=this.url.delMiniProj+t.id;Object(n["j"])(i).then((function(t){var i=t.success,o=t.result,s=t.message;i&&o?(e.getListById(e.parentModel.id),e.$forceUpdate()):e.$message.warning(s)}))},proManager:function(t){this.childInfo=t,this.$refs.childProManager.open()}}},C=y,w=(i("b22d"),i("2877")),_=Object(w["a"])(C,o,s,!1,null,"10d49937",null);e["default"]=_.exports},"43bc":function(t,e,i){},4685:function(t,e,i){"use strict";i("7447")},"4da9":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("vxe-modal",t._b({attrs:{height:"auto",position:{top:9,left:"center"},"show-footer":"",loading:t.modalLoading,title:"04"===t.model.baseType?"新增保险项目":"新增维修项目",width:"1200"},on:{close:t.close},scopedSlots:t._u([{key:"footer",fn:function(){return[i("a-button",{attrs:{loading:t.modalLoading,type:"primary"},on:{click:t.addChild}},[t._v("提交")])]},proxy:!0}]),model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},"vxe-modal",t.bindAttr,!1),[i("div",{staticStyle:{"max-height":"85vh"}},[t.visible?[i("content-view",{attrs:{title:"基本信息"}},[i("pro-create-base-info",{directives:[{name:"show",rawName:"v-show",value:t.isMain,expression:"isMain"}],ref:"baseInfo",attrs:{"z-index":t.bindAttr.zIndex},on:{changeBaseType:t.open}}),t.isMain||"04"===t.model.baseType?t._e():i("pro-create-child",{ref:"child"}),t.isMain||"04"!==t.model.baseType?t._e():i("InsuranceCreateChild",{ref:"child"})],1),t.isMain&&"04"!=t.model.baseType&&!t.comparAble?i("bidding-method-comp",{ref:"bid",attrs:{isChild:t.model.hasChild}}):t._e(),"04"==t.model.baseType?i("div",[i("content-view",{attrs:{title:"保险信息"}},[i("proj-create-inseure-info",{ref:"insure"})],1)],1):t._e()]:t._e()],2)])},s=[],r=i("dc9a"),a=i("156e"),n=i("0d99"),l=i("f337"),c=i("834e"),u=i("d35e"),d=i("0fea"),p=i("e4d8"),h=i("e06d"),m=i("2b0e"),f=i("bc3a"),g=i.n(f),b=i("9fb0"),v=i("d717"),j=i("d8a5");function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function C(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */C=function(){return e};var t,e={},i=Object.prototype,o=i.hasOwnProperty,s=Object.defineProperty||function(t,e,i){t[e]=i.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function u(t,e,i,o){var r=e&&e.prototype instanceof b?e:b,a=Object.create(r.prototype),n=new k(o||[]);return s(a,"_invoke",{value:T(t,i,n)}),a}function d(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var p="suspendedStart",h="suspendedYield",m="executing",f="completed",g={};function b(){}function v(){}function j(){}var w={};c(w,a,(function(){return this}));var _=Object.getPrototypeOf,O=_&&_(_(D([])));O&&O!==i&&o.call(O,a)&&(w=O);var M=j.prototype=b.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function i(s,r,a,n){var l=d(t[s],t,r);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==y(u)&&o.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,n)}),(function(t){i("throw",t,a,n)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return i("throw",t,a,n)}))}n(l.arg)}var r;s(this,"_invoke",{value:function(t,o){function s(){return new e((function(e,s){i(t,o,e,s)}))}return r=r?r.then(s,s):s()}})}function T(e,i,o){var s=p;return function(r,a){if(s===m)throw Error("Generator is already running");if(s===f){if("throw"===r)throw a;return{value:t,done:!0}}for(o.method=r,o.arg=a;;){var n=o.delegate;if(n){var l=N(n,o);if(l){if(l===g)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===p)throw s=f,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=m;var c=d(e,i,o);if("normal"===c.type){if(s=o.done?f:h,c.arg===g)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(s=f,o.method="throw",o.arg=c.arg)}}}function N(e,i){var o=i.method,s=e.iterator[o];if(s===t)return i.delegate=null,"throw"===o&&e.iterator.return&&(i.method="return",i.arg=t,N(e,i),"throw"===i.method)||"return"!==o&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+o+"' method")),g;var r=d(s,e.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,g;var a=r.arg;return a?a.done?(i[e.resultName]=a.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,g):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function D(e){if(e||""===e){var i=e[a];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,r=function i(){for(;++s<e.length;)if(o.call(e,s))return i.value=e[s],i.done=!1,i;return i.value=t,i.done=!0,i};return r.next=r}}throw new TypeError(y(e)+" is not iterable")}return v.prototype=j,s(M,"constructor",{value:j,configurable:!0}),s(j,"constructor",{value:v,configurable:!0}),v.displayName=c(j,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,j):(t.__proto__=j,c(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},P(x.prototype),c(x.prototype,n,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,o,s,r){void 0===r&&(r=Promise);var a=new x(u(t,i,o,s),r);return e.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},P(M),c(M,l,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var o in e)i.push(o);return i.reverse(),function t(){for(;i.length;){var o=i.pop();if(o in e)return t.value=o,t.done=!1,t}return t.done=!0,t}},e.values=D,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function s(o,s){return n.type="throw",n.arg=e,i.next=o,s&&(i.method="next",i.arg=t),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],n=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&o.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var o=i.completion;if("throw"===o.type){var s=o.arg;I(i)}return s}}throw Error("illegal catch attempt")},delegateYield:function(e,i,o){return this.delegate={iterator:D(e),resultName:i,nextLoc:o},"next"===this.method&&(this.arg=t),g}},e}function w(t,e,i,o,s,r,a){try{var n=t[r](a),l=n.value}catch(t){return void i(t)}n.done?e(l):Promise.resolve(l).then(o,s)}function _(t){return function(){var e=this,i=arguments;return new Promise((function(o,s){var r=t.apply(e,i);function a(t){w(r,o,s,a,n,"next",t)}function n(t){w(r,o,s,a,n,"throw",t)}a(void 0)}))}}function O(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?O(Object(i),!0).forEach((function(e){P(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function P(t,e,i){return(e=x(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function x(t){var e=T(t,"string");return"symbol"==y(e)?e:e+""}function T(t,e){if("object"!=y(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=y(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var N={name:"CreateProModal",components:{InsuranceCreateChild:h["default"],ProjCreateInseureInfo:v["default"],ProCreateChild:p["default"],BiddingMethodComp:u["default"],BiddingMethod:c["default"],SvnIcon:l["default"],ProCreateWordUnit:n["default"],ProCreateBaseInfo:a["default"],ContentView:r["default"]},data:function(){return{visible:!1,model:{baseType:"01",allotMode:"01",hasChild:!0},comparAble:!1,url:{addProj:"/use/serviceProj/addProj",addInsureProj:"/use/serviceProj/addInsureProj",addPublicProj:"/use/serviceProj/addProjForPublic"},isMain:!0,pid:"",modalLoading:!1,totalAmount:0,bldTotalAmount:0}},computed:{bindAttr:function(){var t=M({zIndex:1e3},this.$attrs);return t}},provide:function(){var t=this;return{projMainData:function(){return t.model}}},created:function(){this.getComparAble()},mounted:function(){},watch:{},methods:{getComparAble:function(){var t=this;Object(j["e"])("compar_able").then((function(e){t.comparAble="1"==e}))},open:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"01";this.pid=this.model.pid,this.model.hasChild=1===this.model.isHasChild||"1"===this.model.isHasChild,this.visible=!0,this.isMain=e,this.$nextTick((function(){t.isMain&&(t.comparAble||t.$refs.bid.initData(),t.model={baseType:i,allotMode:"01"}),t.$refs.child&&"function"===typeof t.$refs.child.regionChange&&t.$refs.child.regionChange(void 0,{id:t.model.regionId})}))},close:function(){this.model={hasChild:!0},this.visible=!1},addChild:function(){var t=_(C().mark((function t(){var e,i,o,s,r,a,n,l,c,u=this;return C().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.model.reqCode||(this.model.reqCode=m["default"].ls.get(b["J"]).orgCode),"04"==this.model.baseType||"05"==this.model.baseType){t.next=37;break}if(this.modalLoading=!0,this.model.hasChild?this.model.isHasChild=1:this.model.isHasChild=0,this.model.sharedHousings&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),this.model.construction&&this.model.construction.cost?(this.model.construction.id=null,this.model.construction.describe=this.model.describe+"工程款"):(e=null,this.model.construction&&this.model.construction.chargeCorpCode&&(e=this.model.construction.chargeCorpCode),this.$set(this.model,"construction",{id:null,describe:this.model.describe+"工程款",chargeCorpCode:e})),this.model.priceReview&&this.model.priceReview.cost&&(this.model.priceReview.describe=this.model.describe+"审价费"),this.model.supervisor&&this.model.supervisor.cost&&(this.model.supervisor.describe=this.model.describe+"监理费"),this.model.biddingCost&&this.model.biddingCost.cost&&(this.model.biddingCost.describe=this.model.describe+"招标费"),this.model.inspectionCost&&this.model.inspectionCost.cost&&(this.model.inspectionCost.describe=this.model.describe+"检测费"),this.model.makeCost&&this.model.makeCost.cost&&(this.model.makeCost.describe=this.model.describe+"造价费"),this.model.choosePart&&(this.model.costLists=this.model.choosePart),this.model.apportionFloors&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),this.model.pid&&(this.model.budgetCost=this.model.construction.cost),i=!0,!this.isMain){t.next=30;break}if(this.comparAble){t.next=25;break}return t.next=19,this.$refs.baseInfo.checkData();case 19:if(t.t0=t.sent.valida,!t.t0){t.next=22;break}t.t0=this.$refs.bid.checkData().valida;case 22:i=t.t0,t.next=28;break;case 25:return t.next=27,this.$refs.baseInfo.checkData();case 27:i=t.sent.valida;case 28:t.next=33;break;case 30:return t.next=32,this.$refs.child.checkData();case 32:i=t.sent.valida;case 33:this.model.bidType="01",i?(o={headers:{"X-Access-Token":m["default"].ls.get("Access-Token"),"tenant-id":this.model.sysOrgCode,sourceName:m["default"].ls.get("SOURCE_NAME"),redisIndex:m["default"].ls.get("REDIS_INDEX")}},g.a.post(window._CONFIG["domianURL"]+this.url.addProj,this.model,o).then((function(t){t.data.message?u.$message.success(t.data.message):u.$message.error(t.data.message),u.modalLoading=!1,u.$emit("ok"),u.close()})).finally((function(){u.isLoading=!1}))):this.modalLoading=!1,t.next=124;break;case 37:if("05"!=this.model.baseType){t.next=90;break}if(this.model.pid&&(this.model.budgetCost=this.model.construction.cost),this.totalAmount=0,this.bldTotalAmount=0,!("0"==this.model.publicFlag&&this.model.publicList&&this.model.publicList.length>0)){t.next=45;break}this.totalAmount=this.model.publicList.reduce((function(t,e){var i=e.publicCorpAmount.replace(/,/g,""),o=Number.parseFloat(i.replace(".",""));return t+(isNaN(o)?0:o/100)}),0),t.next=50;break;case 45:if(!("2"==this.model.publicFlag&&this.model.bldSelectedList&&this.model.bldSelectedList.length>0)){t.next=50;break}if(s=this.model.bldSelectedList.some((function(t){return""==t.publicBldAmount||0==t.publicBldAmount})),!s){t.next=49;break}return t.abrupt("return",this.$message.error("请检查已选自然幢金额是否填写!"));case 49:this.bldTotalAmount=this.model.bldSelectedList.reduce((function(t,e){var i=e.publicBldAmount.replace(/,/g,""),o=Number.parseFloat(i.replace(".",""));return t+(isNaN(o)?0:o/100)}),0);case 50:if("0"!=this.model.publicFlag||this.totalAmount===Number(this.model.budgetCost)){t.next=54;break}return t.abrupt("return",this.$message.error("请检查预算总额是否与公房单位金额总和一致!"));case 54:if("2"!=this.model.publicFlag||this.bldTotalAmount===Number(this.model.budgetCost)){t.next=56;break}return t.abrupt("return",this.$message.error("请检查预算总额是否与自然幢金额总和一致!"));case 56:if(this.modalLoading=!0,this.model.sharedHousings&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),this.model.construction&&this.model.construction.cost?(this.model.construction.id=null,this.model.construction.describe=this.model.describe+"工程款"):(r=null,this.model.construction&&this.model.construction.chargeCorpCode&&(r=this.model.construction.chargeCorpCode),this.$set(this.model,"construction",{id:null,describe:this.model.describe+"工程款",chargeCorpCode:r})),this.model.priceReview&&this.model.priceReview.cost&&(this.model.priceReview.describe=this.model.describe+"审价费"),this.model.supervisor&&this.model.supervisor.cost&&(this.model.supervisor.describe=this.model.describe+"监理费"),this.model.biddingCost&&this.model.biddingCost.cost&&(this.model.biddingCost.describe=this.model.describe+"招标费"),this.model.inspectionCost&&this.model.inspectionCost.cost&&(this.model.inspectionCost.describe=this.model.describe+"检测费"),this.model.makeCost&&this.model.makeCost.cost&&(this.model.makeCost.describe=this.model.describe+"造价费"),this.model.choosePart&&(this.model.costLists=this.model.choosePart),this.model.apportionFloors&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),a=!0,!this.isMain){t.next=82;break}if(this.comparAble){t.next=77;break}return t.next=71,this.$refs.baseInfo.checkData();case 71:if(t.t1=t.sent.valida,!t.t1){t.next=74;break}t.t1=this.$refs.bid.checkData().valida;case 74:a=t.t1,t.next=80;break;case 77:return t.next=79,this.$refs.baseInfo.checkData();case 79:a=t.sent.valida;case 80:t.next=85;break;case 82:return t.next=84,this.$refs.child.checkData();case 84:a=t.sent.valida;case 85:this.model.bidType="01",this.model.isHasChild="0",a?(n={headers:{"X-Access-Token":m["default"].ls.get("Access-Token"),"tenant-id":this.model.sysOrgCode,sourceName:m["default"].ls.get("SOURCE_NAME"),redisIndex:m["default"].ls.get("REDIS_INDEX")}},g.a.post(window._CONFIG["domianURL"]+this.url.addPublicProj,this.model,n).then((function(t){t.data.message?u.$message.success(t.data.message):u.$message.error(t.data.message),u.modalLoading=!1,u.$emit("ok"),u.close()})).finally((function(){u.isLoading=!1}))):this.modalLoading=!1,t.next=124;break;case 90:if(this.modalLoading=!0,this.model.hasChild?this.model.isHasChild=1:this.model.isHasChild=0,this.model.insureCostMsg&&this.model.insureCostMsg.cost?(this.model.insureCostMsg.id=null,this.model.insureCostMsg.describe=this.model.describe+"工程款"):(l=null,this.model.insureCostMsg&&this.model.insureCostMsg.chargeCorpCode&&(l=this.model.insureCostMsg.chargeCorpCode),this.$set(this.model,"insureCostMsg",{id:null,describe:this.model.describe+"工程款",chargeCorpCode:l})),this.model.sharedHousings&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),this.model.choosePart&&(this.model.costLists=this.model.choosePart),this.model.apportionFloors&&(this.model.sharedHousings=this.model.apportionFloors.map((function(t){return t.id}))),c=!0,!this.isMain||this.model.hasChild){t.next=108;break}return t.next=100,this.$refs.baseInfo.checkData();case 100:if(t.t2=t.sent.valida,!t.t2){t.next=105;break}return t.next=104,this.$refs.insure.checkData();case 104:t.t2=t.sent.valida;case 105:c=t.t2,t.next=123;break;case 108:if(!this.isMain||!this.model.hasChild){t.next=114;break}return t.next=111,this.$refs.baseInfo.checkData();case 111:c=t.sent.valida,t.next=123;break;case 114:if(this.isMain){t.next=123;break}return t.next=117,this.$refs.child.checkData();case 117:if(t.t3=t.sent.valida,!t.t3){t.next=122;break}return t.next=121,this.$refs.insure.checkData();case 121:t.t3=t.sent.valida;case 122:c=t.t3;case 123:c?Object(d["j"])(this.url.addInsureProj,this.model,{"tenant-id":this.model.sysOrgCode}).then((function(t){t.message?u.$message.success(t.message):u.$message.error(t.message),u.modalLoading=!1,u.$emit("ok"),u.close()})).finally((function(){u.isLoading=!1})):this.modalLoading=!1;case 124:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},A=N,I=(i("4fe1"),i("2877")),k=Object(I["a"])(A,o,s,!1,null,"df5ae938",null);e["default"]=k.exports},"4fda":function(t,e,i){"use strict";i("d31b")},"4fe1":function(t,e,i){"use strict";i("f3db")},"511b":function(t,e,i){},"5aac5":function(t,e,i){"use strict";i("8e6e")},"67ae":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bidding-method-comp",{ref:"bid",attrs:{isChild:t.model.hasChild}})},s=[],r=i("d35e"),a={name:"BiddingListComp",components:{BiddingMethodComp:r["default"]},props:{model:{type:Object}},provide:function(){var t=this;return{projMainData:function(){return t.model}}},data:function(){return{}},mounted:function(){this.initData()},methods:{initData:function(){this.$refs.bid.initData()}}},n=a,l=(i("a8fe"),i("2877")),c=Object(l["a"])(n,o,s,!1,null,"b0672e52",null);e["default"]=c.exports},"6b02":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-modal",{attrs:{title:t.title,width:t.width,visible:t.visible,switchFullscreen:"",okButtonProps:{class:{"jee-hidden":t.disableSubmit}},cancelText:"关闭"},on:{ok:t.handleOk,cancel:t.handleCancel}},[i("div",[i("div",{staticClass:"textCenter"},[i("h3",[i("strong",[t._v("维修项目审价合同")])])]),i("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.model,disabled:t.disableSubmit,border:!0}},[i("a-row",{ref:"formOwnRow",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[i("a-col",{attrs:{span:4}},[t._v("\n          aasd\n        ")]),i("a-col",{attrs:{span:8}},[t._v("\n          111\n        ")]),i("a-col",{attrs:{span:4}},[t._v("\n          aasd\n        ")]),i("a-col",{attrs:{span:8}},[t._v("\n          111\n        ")])],1)],1)],1)])},s=[],r={name:"ContractInfoComp",data:function(){return{title:"",visible:!1,width:"100vh",activeKey:["1"],disableSubmit:!1,rules:{},model:{}}},methods:{initData:function(){this.visible=!0},handleOk:function(){this.visible=!1},handleCancel:function(){this.visible=!1}}},a=r,n=(i("4685"),i("2877")),l=Object(n["a"])(a,o,s,!1,null,"2b0f0c7d",null);e["default"]=l.exports},"743d":function(t,e,i){"use strict";i("511b")},7447:function(t,e,i){},"762d":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[i("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[i("span",{staticClass:"collapseTitle"},[t._v("\n          "+t._s(t.headerTitle)+"\n          "),i("a-dropdown",{directives:[{name:"show",rawName:"v-show",value:!t.isChild,expression:"!isChild"}]},[i("a-menu",{staticClass:"amountButtonMenu",attrs:{slot:"overlay"},slot:"overlay"},t._l(t.costTypeMenu,(function(e){return i("a-menu-item",{key:e.value},[i("div",{staticClass:"amountButtonItem",on:{click:function(i){return i.stopPropagation(),t.chooseAmount(e)}}},[t._v("\n                  "+t._s(e.label)+"\n                  "),t.costType_choose.find((function(t){return t.value===e.value}))?i("a-icon",{attrs:{type:"check"}}):t._e()],1)])})),1),i("a-button",{staticStyle:{margin:"0","pointer-events":"auto"},attrs:{size:"small",type:"primary"},on:{click:function(t){t.stopPropagation()}}},[t._v("添加费用")])],1)],1)]},proxy:!0}])},[i("div",[i("bid-negotiation-modal",{directives:[{name:"show",rawName:"v-show",value:"01"===t.pageNum,expression:"pageNum==='01'"}],ref:"bidForm",attrs:{costType:t.costType_choose,isChild:t.isChild,disabled:t.isDetail}}),"02"===t.pageNum?[i("div",{staticStyle:{"margin-top":"20px"}},[t._v("1234123412412")])]:t._e(),"03"===t.pageNum?[i("vxe-grid",{staticStyle:{"margin-top":"20px"},attrs:{border:""}})]:t._e()],2)])],1)],1)},s=[],r=i("9bbe"),a=i("dc9a"),n=i("eccd"),l=i("4ec3"),c=i("2d54"),u=i("0fea"),d={name:"BiddingMethodComp",components:{BidNegotiationModal:c["default"],ContentView:a["default"],BidNegotiation:r["default"],JDDictSelectTag:n["default"]},props:{isDetail:{type:Boolean,default:!1},isChild:{type:Boolean,default:!1}},inject:["projMainData"],computed:{projObj:function(){return this.projMainData()}},watch:{"formModel.selectTrees":function(t){this.setTableBySelectTree(t)}},data:function(){return{pageNum:"01",headerTitle:"施工信息",activeKey:["1"],dictOptions:[],costTypeMenu:[{value:"priceReview",label:"审价",type:"02",corpType:"06"},{value:"supervisor",label:"监理",type:"03",corpType:"05"},{value:"biddingCost",label:"招标",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测",type:"05",corpType:"08"},{value:"makeCost",label:"造价",type:"06",corpType:"09"}],costType_choose:[],url:{synchronizeProject:"/use/serviceProj/synchronizeProject"}}},methods:{synchronizeProject:function(){var t=this;Object(u["j"])(this.url.synchronizeProject,this.projObj).then((function(e){e.success?t.$message.success("同步成功"):t.$message.error("同步失败")}))},changeMethod:function(t){this.pageNum=t},checkData:function(){return this.$refs.bidForm.checkData()},initData:function(){this.$refs.bidForm.initData(),this.initBidType()},initBidType:function(){var t=this,e=Object(l["C"])("bid_type");e?this.dictOptions=e:Object(l["i"])(this.dictCode,null).then((function(e){e.success&&(t.dictOptions=e.result)}))},chooseAmount:function(t){var e=this.costType_choose.findIndex((function(e){return t.value===e.value}));-1===e?(this.costType_choose.push(t),this.$refs.bidForm.addCost(t)):(this.costType_choose.splice(e,1),this.$refs.bidForm.removeCost(t))}}},p=d,h=(i("b1b8"),i("2877")),m=Object(h["a"])(p,o,s,!1,null,"64f500eb",null);e["default"]=m.exports},"79ae":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.searchLoading,expression:"searchLoading"}],staticClass:"childPro",attrs:{"element-loading-text":"正在查询子计划，请稍后"}},[i("div",{staticClass:"childPro_header"},[t.review?t._e():i("div",{staticClass:"header_search"},[i("a-input",{staticClass:"width-200",attrs:{"allow-clear":!0,placeholder:"请输入计划描述"},model:{value:t.projDescribe,callback:function(e){t.projDescribe=e},expression:"projDescribe"}}),i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getListById(t.parentModel.id,"search")}}},[t._v("搜索")]),t.isDetail&&!t.review?i("a-button",{attrs:{type:"primary"},on:{click:t.startProj}},[t._v("发起项目")]):t._e()],1),i("div",{staticClass:"header_rightAction"},[t.isDetail?t._e():i("a-button",{attrs:{type:"primary"},on:{click:t.addChild}},[t._v("新增")])],1)]),i("div",{staticClass:"childPro_content"},[t.lists.length>0?[i("vxe-table",{ref:"projTable",attrs:{"auto-resize":"",data:t.lists,"expand-config":{accordion:!1,labelField:"expand"}}},[i("vxe-table-column",{attrs:{type:"expand",field:"expand",width:"30px",title:""},scopedSlots:t._u([{key:"content",fn:function(e){var o=e.row;return["01"===o.planType?i("vxe-table",{attrs:{"auto-resize":"","max-height":"400px","row-id":"id",data:o.projPlanLists,"expand-config":{accordion:!1},"checkbox-config":{trigger:"row",reserve:!1,checkRowKeys:t.selectRows.map((function(t){return t.id})),checkMethod:function(e){var i=e.row;return t.checkStartFlag(o,i)}}},on:{"checkbox-change":function(e){var i=e.row,s=e.checked;return t.tableChoose(i,o,s)}}},[t.isDetail&&!t.review?i("vxe-table-column",{attrs:{type:"checkbox",width:"40px"}}):t._e(),i("vxe-table-column",{attrs:{type:"expand",field:"expand",title:"",width:"70px"},scopedSlots:t._u([{key:"content",fn:function(e){var o=e.row;return[i("vxe-table",{attrs:{"auto-resize":"","max-height":"400px","row-id":"id",data:o.costList,"expand-config":{accordion:!1}}},[i("vxe-table-column",{attrs:{field:"baseType",title:"费用类型"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",[t._v(t._s(t.getCostType(o)))])]}}],null,!0)}),i("vxe-table-column",{attrs:{field:"cost",title:"金额"}})],1)]}}],null,!0)}),i("vxe-table-column",{attrs:{field:"startTime",title:"计划维修日期"}}),i("vxe-table-column",{attrs:{field:"cost",title:"本次费用"}}),i("vxe-table-column",{attrs:{field:"orderNum",title:"计划序号"}})],1):i("vxe-table",{attrs:{"auto-resize":"","max-height":"400px","row-id":"id",data:[o],"expand-config":{accordion:!1},"checkbox-config":{trigger:"row",reserve:!1,checkRowKeys:t.selectRows.map((function(t){return t.id})),checkMethod:function(e){var i=e.row;return t.checkStartFlag(o,i)}}},on:{"checkbox-change":function(e){var i=e.row,s=e.checked;return t.tableChoose(i,o,s)}}},[t.isDetail&&!t.review?i("vxe-table-column",{attrs:{type:"checkbox",width:"40px"}}):t._e(),i("vxe-table-column",{attrs:{field:"usedCost",title:"已使用金额"}}),i("vxe-table-column",{attrs:{field:"singleMaxCost",title:"单次最大费用"}})],1)]}}],null,!1,1233122844)}),i("vxe-table-column",{attrs:{field:"describe",title:"计划描述"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",[t._v(t._s(o.code)+"【"+t._s(o.describe)+"】")])]}}],null,!1,1899988039)}),i("vxe-table-column",{attrs:{field:"communityName",title:"小区名称"}}),i("vxe-table-column",{attrs:{field:"allotMode",title:"分摊方式"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",[t._v(t._s("01"==o.allotMode?"面积分摊":"按户均摊"))])]}}],null,!1,3303027275)}),i("vxe-table-column",{attrs:{field:"countCost",title:"总费用"}}),i("vxe-table-column",{attrs:{field:"planType",title:"计划类型"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[i("span",[t._v(t._s("01"==o.planType?"年度计划":"备用金计划"))])]}}],null,!1,3427000935)}),i("vxe-table-column",{attrs:{field:"startTime",title:"开始日期"}}),i("vxe-table-column",{attrs:{field:"endTime",title:"结束日期"}})],1)]:i("a-empty")],2),"card"===t.showType&&t.lists&&t.lists.length>0?i("div",{staticClass:"childPro_footer"},[i("a-pagination",t._b({attrs:{pageSize:t.cardPagination.pageSize,total:t.lists.length},on:{"update:pageSize":function(e){return t.$set(t.cardPagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.cardPagination,"pageSize",e)}},model:{value:t.cardPagination.current,callback:function(e){t.$set(t.cardPagination,"current",e)},expression:"cardPagination.current"}},"a-pagination",t.cardPagination,!1))],1):t._e(),i("add-proj-plan-modal",{ref:"addPlanModal",on:{ok:function(e){return t.getListById(t.parentModel.id)}}}),i("plan-start-proj-modal",{ref:"startProj"})],1)},s=[],r=i("f83a"),a=i("0fea"),n=i("4aae"),l=i("d8a5"),c=i("362e"),u=i("2d4c"),d=i("bed7"),p=i("3ed7"),h=i("2bff"),m=i("aae9"),f=i("c1df"),g=i.n(f);function b(t){return C(t)||y(t)||j(t)||v()}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(t,e){if(t){if("string"==typeof t)return w(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?w(t,e):void 0}}function y(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function C(t){if(Array.isArray(t))return w(t)}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=Array(e);i<e;i++)o[i]=t[i];return o}var _={name:"ChildPlan",components:{PlanStartProjModal:m["default"],AddProjPlanModal:h["default"],GetTableActionButtons:u["default"],CostSetter:c["default"],AmountInput:n["default"],cards:r["default"],ChildProManager:d["default"]},inject:["projMainData"],provide:function(){var t=this;return{costMsg:function(){return t.childCostMsg}}},props:{isDetail:{type:Boolean,default:!1},allotMode:{type:[String,Number],default:""},pageType:{type:Boolean,default:!0},review:{type:Boolean,default:!1}},data:function(){return{showType:"card",projDescribe:"",lists:[],url:{queryMinPlan:"/use/projPlan/queryMinPlan",delMiniProj:"/use/serviceProj/delMiniProj/"},parentModel:{},priceReviewFlag:0,modelCost:{},childCostMsg:{},columns:[{title:"项目编号",field:"code",width:140},{title:"项目描述",field:"describe"},{title:"预算金额",field:"budgetCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(p["g"])(e)}},{title:"决算金额",field:"finalCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(p["g"])(e)}},{title:"审价费",field:"priceReview",editRender:{},align:"right",formatter:function(t){var e=t.cellValue;return Object(p["g"])(e?e.cost:"0")}},{title:"监理费",field:"supervisor",editRender:{},align:"right",formatter:function(t){var e=t.cellValue;return Object(p["g"])(e?e.cost:"0")}},{title:"分摊户数",field:"allotLists",align:"right",formatter:function(t){var e=t.cellValue;return e?e.length:0}},{title:"残值回收",field:"scrapValue",align:"right",formatter:function(t){t.cellValue;return"0.00"}},{title:"操作",slots:{default:"action"},align:"center",width:180}],costTypeMenu:[{value:"construction",label:"工程款",type:"01",corpType:"03"},{value:"priceReview",label:"审价费",type:"02",corpType:"06"},{value:"supervisor",label:"监理费",type:"03",corpType:"05"},{value:"biddingCost",label:"招标费",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测费",type:"05",corpType:"08"},{value:"makeCost",label:"造价费",type:"06",corpType:"09"}],childInfo:{},cardPagination:{current:1,defaultPageSize:6,pageSize:6,showSizeChanger:!1,pageSizeOptions:["6","12","18","24"]},selectRows:[],searchLoading:!1}},computed:{planObj:function(){return this.projMainData()},pageList:{get:function(){var t=(this.cardPagination.current-1)*this.cardPagination.pageSize,e=this.cardPagination.pageSize*this.cardPagination.current;return this.lists.slice(t,e)},set:function(){}}},mounted:function(){var t=this;Object(l["e"])("allot_mode").then((function(e){t.modelCost.allotMode=e})),this.parentModel=this.projMainData(),"1"==this.projMainData().isHasChild&&this.pageType?this.getListById(this.parentModel.id):"1"==this.projMainData().isHasChild&&(this.lists=this.projMainData().children)},methods:{checkData:function(){var t=this;return new Promise((function(e,i){t.lists&&0!==t.lists.length||(t.$message.warning("请创建一个子项目！"),i(new Error("请创建一个子项目！")));for(var o=0;o<t.lists.length;o++){var s=t.lists[o];s.baseType=t.projMainData().baseType,s.allotMode=t.projMainData().allotMode}if(t.priceReviewFlag)if(t.modelCost&&t.modelCost.supervisorCode&&t.modelCost.supervisorAmount&&t.modelCost.priceReviewCode&&t.modelCost.priceReviewAmount){t.projMainData().construction.cost=0;for(var r=0;r<t.lists.length;r++){var a=JSON.parse(JSON.stringify(t.projMainData().priceReview));a.cost=t.lists[r].priceReview.cost,a.describe=t.lists[r].priceReview.describe,t.lists[r].priceReview=a;var n=JSON.parse(JSON.stringify(t.projMainData().supervisor));n.cost=t.lists[r].supervisor.cost,n.describe=t.lists[r].supervisor.describe,t.lists[r].supervisor=n,t.projMainData().construction.cost=Object(p["c"])(t.projMainData().construction.cost,t.lists[r].construction.cost)}e()}else t.$message.warning("请填写审价费监理费信息"),i(new Error("请填写审价费监理费信息！"));else e()}))},getListById:function(t,e){var i=this;this.lists=[];var o={id:t};e&&"search"==e&&(o.describe=this.projDescribe),this.searchLoading=!0,Object(a["e"])(this.url.queryMinPlan,o).then((function(t){var e,o=t.success,s=t.result,r=t.message;o&&s?((e=i.lists).push.apply(e,b(s)),i.projMainData().children=i.lists):i.$message.warning(r)})).finally((function(){i.searchLoading=!1}))},addChild:function(t){this.$refs.addPlanModal.model.allotMode=this.projMainData().allotMode,this.$refs.addPlanModal.model.regionCode=this.projMainData().regionCode,this.$refs.addPlanModal.model.communityName=this.projMainData().communityName,this.$refs.addPlanModal.model.regionId=this.projMainData().regionId,this.$refs.addPlanModal.regionInfo.id=this.projMainData().regionId,this.$refs.addPlanModal.model.pid=this.projMainData().id,this.$refs.addPlanModal.model.sysOrgCode=this.projMainData().sysOrgCode,this.$refs.addPlanModal.model.reqPhone=this.projMainData().reqPhone,this.$refs.addPlanModal.model.reqMan=this.projMainData().reqMan,this.$refs.addPlanModal.model.endTime=this.projMainData().endTime,this.$refs.addPlanModal.model.startTime=this.projMainData().startTime,this.$refs.addPlanModal.add(!0)},tableChoose:function(t,e,i){var o=JSON.parse(JSON.stringify(t));if(i)"01"==e.planType?o["title"]=e["describe"]+"第"+t["orderNum"]+"条计划，计划维修日期："+t["startTime"]+"【年度计划】":o["title"]=e["describe"]+"【备用金计划】",o["planListId"]=t["id"],o["planId"]=e["id"],o["communityName"]=e["communityName"],o["regionCode"]=e["regionCode"],o["isReserve"]=e["isReserve"],o["reserveRate"]=e["reserveRate"],o["allotMode"]=e["allotMode"],o["sharedHousings"]=e["sharedHousings"],o["planCostList"]=t["costList"],o["costLists"]=e["costs"],o["sharedHousings"]=e["sharedHousings"],o["planType"]=e["planType"],o["planCost"]=e["countCost"],o["planListCost"]=o["cost"],o["planAllotList"]=e["freezeAllotLists"],o["planList"]=e["projPlanLists"],o["costList"]=null,o["describe"]=null,o["id"]=null,this.projMainData().isHasChild&&"1"==this.projMainData().isHasChild?o["voteId"]=this.projMainData().children[0].voteId:o["voteId"]=this.projMainData().voteId,this.selectRows.push(o);else{var s=this.selectRows.findIndex((function(t){return t.id===o.id}));this.selectRows.splice(s,1)}},delMiniProj:function(t){var e=this,i=this.url.delMiniProj+t.id;Object(a["j"])(i).then((function(t){var i=t.success,o=t.result,s=t.message;i&&o?(e.getListById(e.parentModel.id),e.$forceUpdate()):e.$message.warning(s)}))},proManager:function(t){this.childInfo=JSON.parse(JSON.stringify(t)),this.$refs.childProManager.open()},getCostType:function(t){var e=this.costTypeMenu.find((function(e){return e.type==t.baseType}));return e?e.label:""},startProj:function(){this.selectRows.length>0?this.$refs.startProj.open(this.selectRows,this.planObj.sysOrgCode):this.$message.info("请选中至少一条明细")},checkStartFlag:function(t,e){var i=g()(t.startTime).isBefore(new Date)&&g()(t.endTime).isAfter(new Date),o=g()(e.startTime).isBefore(new Date);return i&&o}}},O=_,M=(i("743d"),i("2877")),P=Object(M["a"])(O,o,s,!1,null,"78e27310",null);e["default"]=P.exports},8083:function(t,e,i){"use strict";i("2df5")},"834e":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[i("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[i("span",{staticClass:"collapseTitle"},[t._v("\n          "+t._s(t.headerTitle)+"\n        ")])]},proxy:!0}])},[i("div",[i("a-space",{staticClass:"methodButton"},t._l(t.dictOptions,(function(e,o){return i("a-button",{key:o,attrs:{type:"primary",ghost:t.pageNum!==e.value,shape:"round"},on:{click:function(i){return t.changeMethod(e.value)}}},[t._v(t._s(e.title))])})),1),i("bid-negotiation",{directives:[{name:"show",rawName:"v-show",value:"01"===t.pageNum,expression:"pageNum==='01'"}],ref:"bidForm",attrs:{disabled:t.isDetail}}),"02"===t.pageNum?[i("div",{staticStyle:{"margin-top":"20px"}},[t._v("1234123412412")])]:t._e(),"03"===t.pageNum?[i("vxe-grid",{staticStyle:{"margin-top":"20px"},attrs:{border:""}})]:t._e()],2)])],1)],1)},s=[],r=i("9bbe"),a=i("dc9a"),n=i("eccd"),l=i("4ec3"),c={name:"BiddingMethod",components:{ContentView:a["default"],BidNegotiation:r["default"],JDDictSelectTag:n["default"]},props:{isDetail:{type:Boolean,default:!1}},inject:["projMainData"],computed:{projObj:function(){return this.projMainData()}},watch:{"formModel.selectTrees":function(t){this.setTableBySelectTree(t)}},data:function(){return{pageNum:"01",headerTitle:"招标方式",activeKey:["1"],dictOptions:[]}},methods:{changeMethod:function(t){this.pageNum=t},checkData:function(){var t=this;return new Promise((function(e,i){t.$refs.bidForm.checkData().then((function(t){e()})).catch((function(t){i()}))}))},initData:function(t){this.$refs.bidForm.initData(),this.initBidType()},initBidType:function(){var t=this,e=Object(l["C"])("bid_type");e?this.dictOptions=e:Object(l["i"])(this.dictCode,null).then((function(e){e.success&&(t.dictOptions=e.result)}))}}},u=c,d=(i("8b7a"),i("2877")),p=Object(d["a"])(u,o,s,!1,null,"76ba8a75",null);e["default"]=p.exports},"8b7a":function(t,e,i){"use strict";i("11b9")},"8c56":function(t,e,i){"use strict";i("29b1")},"8e6e":function(t,e,i){},"8f26":function(t,e,i){},"9bbe":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.modelCost,disabled:t.disabled,border:!0}},[i("a-row",{ref:"rowContent",staticClass:"bidNegotiationFormRow",attrs:{slot:"detail",type:"flex"},slot:"detail"},[i("a-col",{attrs:{span:3}},[t.disabled?t._e():i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("施工单位\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"constructionCode"}},[i("div",{staticClass:"row_col_flexDiv"},[i("j-select-corp",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择施工单位",baseType:"03",multi:!1,disabled:t.disabled},on:{afterChoose:t.afterChoose},model:{value:t.modelCost.constructionCode,callback:function(e){t.$set(t.modelCost,"constructionCode",e)},expression:"modelCost.constructionCode"}})],1)]),i("a-col",{attrs:{span:3}},[i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("施工方案\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"constructionPlanFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"row_col_flexDiv"},[t.getItemByName("施工方案").fileList&&0!==t.getItemByName("施工方案").fileList.length?i("div",[i("a",{staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:"",href:t.getFirstFileByName("施工方案").filePath}},[t._v(t._s(t.getFirstFileByName("施工方案").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"clearButton",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("施工方案"))}}})],1):[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.constructionPlanEreUrl,e,t.getItemByName("施工方案"))}}},[i("a-button",{attrs:{icon:"upload"}},[t._v("上传文件")])],1),i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])]],2):t._e()]),i("a-col",{attrs:{span:3}},[i("span",{staticClass:"requiredText"},[t._v("*")]),t._v("工程预算书\n      ")]),i("a-col",{attrs:{span:9,"data-prop":"projectBudgetFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"row_col_flexDiv"},[t.getItemByName("工程预算书").fileList&&0!==t.getItemByName("工程预算书").fileList.length?i("div",[i("a",{staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:"",href:t.getFirstFileByName("工程预算书").filePath}},[t._v(t._s(t.getFirstFileByName("工程预算书").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"clearButton",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("工程预算书"))}}})],1):[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.projectbudgetEreUrl,e,t.getItemByName("工程预算书"))}}},[i("a-button",{attrs:{icon:"upload"}},[t._v("上传文件")])],1),i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf")])]],2):t._e()]),i("a-col",{attrs:{span:3}},[i("span",[t._v("工程款")])]),i("a-col",{attrs:{span:9}},[i("a-input",{attrs:{readOnly:"",placeholder:"自动核算总价"},model:{value:t.engAmount,callback:function(e){t.engAmount=e},expression:"engAmount"}})],1),i("a-col",{attrs:{span:3}},[i("span",[t._v("审价单位")])]),i("a-col",{attrs:{span:9,"data-prop":"priceReviewCode"}},[i("div",{staticClass:"row_col_flexDiv"},[i("div"),i("j-select-corp",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择审价单位",baseType:"06",multi:!1,disabled:t.disabled},on:{afterChoose:t.priceReviewChoose},model:{value:t.modelCost.priceReviewCode,callback:function(e){t.$set(t.modelCost,"priceReviewCode",e)},expression:"modelCost.priceReviewCode"}})],1)]),i("a-col",{attrs:{span:3}},[i("span",[t._v("审价费")])]),i("a-col",{attrs:{span:9}},[i("amount-input",{attrs:{placeholder:"请输入审价费"},on:{change:t.setPriceReviewAmount},model:{value:t.modelCost.priceReviewAmount,callback:function(e){t.$set(t.modelCost,"priceReviewAmount",e)},expression:"modelCost.priceReviewAmount"}})],1),i("a-col",{attrs:{span:3}},[i("span",[t._v("监理单位")])]),i("a-col",{attrs:{span:9,"data-prop":"supervisorCode"}},[i("div",{staticClass:"row_col_flexDiv"},[i("span"),i("j-select-corp",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择监理单位",baseType:"05",multi:!1,disabled:t.disabled},on:{afterChoose:t.supervisorChoose},model:{value:t.modelCost.supervisorCode,callback:function(e){t.$set(t.modelCost,"supervisorCode",e)},expression:"modelCost.supervisorCode"}})],1)]),i("a-col",{attrs:{span:3}},[i("span",[t._v("监理费")])]),i("a-col",{attrs:{span:9}},[i("amount-input",{attrs:{placeholder:"请输入监理费"},on:{change:t.setSupAmount},model:{value:t.modelCost.supervisorAmount,callback:function(e){t.$set(t.modelCost,"supervisorAmount",e)},expression:"modelCost.supervisorAmount"}})],1),i("a-col",{attrs:{span:3}}),i("a-col",{attrs:{span:9}}),i("a-col",{attrs:{span:3}},[i("span",[t._v("预算总额")])]),i("a-col",{attrs:{span:9}},[i("a-input",{attrs:{readOnly:"",placeholder:"自动核算总价（工程款、审价费、监理费）"},model:{value:t.budgetAmount,callback:function(e){t.budgetAmount=e},expression:"budgetAmount"}})],1)],1)],1)],1)},s=[],r=i("4aae"),a=i("eb36"),n=i("d8a5"),l={name:"BidNegotiation",components:{AmountInput:r["default"]},mixins:[a["a"]],props:{disabled:{type:Boolean,default:!1}},inject:["projMainData"],computed:{projObj:function(){return this.projMainData()}},watch:{projObj:{deep:!0,handler:function(t){this.caculateAmount()}}},created:function(){var t=this;Object(n["e"])("construction_plan_ere_id").then((function(e){t.constructionPlanEreUrl=t.url.constructionPlanUrl+e})),Object(n["e"])("project_budget_ere_id").then((function(e){t.projectbudgetEreUrl=t.url.projectBudgetUrl+e}))},data:function(){var t=this;return{modelCost:{},engAmount:null,budgetAmount:null,rules:{regionCode:[{required:!0,message:"请输入物业区域名称",trigger:"change"}],constructionPlanFile:[{required:!0,message:"请上传施工方案",trigger:"change"}],projectBudgetFile:[{required:!0,message:"请上传工程预算书",trigger:"change"}],constructionCode:[{required:!0,message:"请选择施工单位",trigger:"change"}],priceReviewCode:[{validator:function(e,i,o){return!t.modelCost.priceReviewAmount||""===t.modelCost.priceReviewAmount||0===Number(t.modelCost.priceReviewAmount)||i&&""!==i?o():o("请选择审价单位")}}],supervisorCode:[{validator:function(e,i,o){return!t.modelCost.supervisorAmount||""===t.modelCost.supervisorAmount||0===Number(t.modelCost.supervisorAmount)||i&&""!==i?o():o("请选择监理单位")}}]},url:{constructionPlanUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId=",projectBudgetUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId="},constructionPlanEreUrl:"",projectbudgetEreUrl:""}},methods:{checkData:function(){var t=this;return new Promise((function(e,i){var o=t.$refs.formRow.validaRowMsg(t.$refs.rowContent);o?e():i()}))},onFileChange:function(t,e,i){var o=this.getFirstFileByName("施工方案"),s=this.getFirstFileByName("工程预算书");this.projObj.constructionPlanFile=o,this.modelCost.constructionPlanFile=o&&Object.keys(o).length>0?o:void 0,this.projObj.projectBudgetFile=s,this.modelCost.projectBudgetFile=s&&Object.keys(s).length>0?s:void 0},caculateAmount:function(){this.showEngAmount(),this.showBudgetAmount()},showEngAmount:function(){this.engAmount=this.projObj.construction&&this.projObj.construction.cost&&!isNaN(this.projObj.construction.cost)?this.projObj.construction.cost:0},showBudgetAmount:function(){this.budgetAmount=0,this.budgetAmount=Number(this.projObj.construction?this.projObj.construction.cost:0)+Number(this.projObj.priceReview?this.projObj.priceReview.cost:0)+Number(this.projObj.supervisor?this.projObj.supervisor.cost:0)+Number(this.projObj.biddingCost?this.projObj.biddingCost.cost:0)+Number(this.projObj.inspectionCost?this.projObj.inspectionCost.cost:0)+Number(this.projObj.makeCost?this.projObj.makeCost.cost:0),this.budgetAmount=Number(this.budgetAmount).toFixed(2),this.projObj.budgetCost=this.budgetAmount,this.$set(this.projObj,"budgetCost",this.budgetAmount)},afterChoose:function(t){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.projObj.construction.projId=this.projObj.id,this.projObj.construction.chargeCorpCode=t[0].code,this.projObj.construction.chargeCorpMan=t[0].linkMan,this.projObj.construction.chargeCorpPhone=t[0].phone},priceReviewChoose:function(t){this.projObj.priceReview||this.$set(this.projObj,"priceReview",{}),this.projObj.priceReview.projId=this.projObj.id,this.projObj.priceReview.chargeCorpCode=t[0].code,this.projObj.priceReview.chargeCorpMan=t[0].linkMan,this.projObj.priceReview.stage="01",this.projObj.priceReview.baseType="02",this.projObj.priceReview.chargeCorpPhone=t[0].phone,this.projObj.priceReview.cost=this.modelCost.priceReviewAmount?this.modelCost.priceReviewAmount:0},setPriceReviewAmount:function(){this.projObj.priceReview||this.$set(this.projObj,"priceReview",{}),this.$set(this.projObj.priceReview,"cost",this.modelCost.priceReviewAmount?this.modelCost.priceReviewAmount:0),this.caculateAmount()},supervisorChoose:function(t){this.projObj.supervisor||this.$set(this.projObj,"supervisor",{}),this.projObj.supervisor.projId=this.projObj.id,this.projObj.supervisor.chargeCorpCode=t[0].code,this.projObj.supervisor.chargeCorpMan=t[0].linkMan,this.projObj.supervisor.stage="01",this.projObj.supervisor.baseType="03",this.projObj.supervisor.chargeCorpPhone=t[0].phone,this.projObj.supervisor.cost=this.modelCost.supervisorAmount?this.modelCost.supervisorAmount:0},setSupAmount:function(){this.projObj.supervisor||this.$set(this.projObj,"supervisor",{}),this.$set(this.projObj.supervisor,"cost",this.modelCost.supervisorAmount?this.modelCost.supervisorAmount:0),this.caculateAmount()},initData:function(){this.projObj.supervisor&&(this.modelCost.supervisorCode=this.projObj.supervisor.chargeCorpCode,this.modelCost.supervisorAmount=this.projObj.supervisor.cost),this.projObj.priceReview&&(this.modelCost.priceReviewCode=this.projObj.priceReview.chargeCorpCode,this.modelCost.priceReviewAmount=this.projObj.priceReview.cost),this.modelCost.constructionCode=this.projObj.construction?this.projObj.construction.chargeCorpCode:"",this.caculateAmount();var t=[{name:"施工方案",fileList:this.projObj.constructionPlanFile?[this.projObj.constructionPlanFile]:[]},{name:"工程预算书",fileList:this.projObj.projectBudgetFile?[this.projObj.projectBudgetFile]:[]}];this.initUploadFile(t)}},mounted:function(){var t=this;this.$bus.$on("updateReviewAmount",(function(e){t.modelCost.priceReviewAmount=e,t.caculateAmount()})),this.$bus.$on("updateSupervisorAmount",(function(e){t.modelCost.supervisorAmount=e,t.caculateAmount()}))}},c=l,u=(i("5aac5"),i("1449"),i("2877")),d=Object(u["a"])(c,o,s,!1,null,"40d315ac",null);e["default"]=d.exports},a8fe:function(t,e,i){"use strict";i("0cae")},ad30:function(t,e,i){},ad6a:function(t,e,i){},b148:function(t,e,i){"use strict";i("ad30")},b1b8:function(t,e,i){"use strict";i("0e68")},b22d:function(t,e,i){"use strict";i("0a33")},d31b:function(t,e,i){},d35e:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-collapse",{attrs:{bordered:!1,expandIconPosition:"right"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[t.hasEnablePageConfigByKey("hideConstructionPlan")?t._e():i("a-collapse-panel",{key:"1",staticStyle:{"background-color":"#fff"},scopedSlots:t._u([{key:"header",fn:function(){return[i("span",{staticClass:"collapseTitle"},[t._v("\n          "+t._s(t.headerTitle)+"\n        ")])]},proxy:!0}],null,!1,2497286502)},[i("div",[i("j-form-container",{ref:"formRow",attrs:{rules:t.rules,model:t.modelCost,disabled:t.disabled,border:!0}},[i("a-row",{ref:"rowContent",staticClass:"bidNegotiationFormRow",attrs:{slot:"detail",type:"flex"},slot:"detail"},[i("a-col",{attrs:{span:3}},[[i("span",{class:{required:!t.hasEnablePageConfigByKey("constructionPlanFileNotRequired")}},[t._v("施工方案")])],i("a-popover",{staticStyle:{"margin-left":"6px"}},[i("template",{slot:"content"},[i("upload-file-comp",{attrs:{size:160,busiType:"20",busiTypeDetail:"202A","ere-code":"construction_plan_ere_id"},on:{ok:function(e){return t.webShow("施工方案",e)},click:function(t){t.stopPropagation()}}})],1),i("a-icon",{staticStyle:{color:"#ff7e24"},attrs:{type:"qrcode"}})],2)],2),i("a-col",{attrs:{span:9,"data-prop":t.hasEnablePageConfigByKey("constructionPlanFileNotRequired")?"":"constructionPlanFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"uploadFormModelItem width100"},[!t.getItemByName("施工方案").fileList||0===t.getItemByName("施工方案").fileList.length||t.getItemByName("施工方案").loading?[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.constructionPlanEreUrl,e,t.getItemByName("施工方案"))}},on:{change:function(e){return t.uploadChange(e,t.getItemByName("施工方案"))}}},[i("a-button",{attrs:{loading:t.getItemByName("施工方案").loading,icon:"upload"}},[t._v("上传文件")])],1),t.getItemByName("施工方案").loading?t._e():i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf 图片")])]:t._e(),t.getItemByName("施工方案").loading?i("a-progress",{attrs:{width:32,type:"circle",percent:t.getItemByName("施工方案").percent}}):t._e(),t.getItemByName("施工方案").fileList&&t.getItemByName("施工方案").fileList.length>0&&!t.getItemByName("施工方案").loading?i("div",{staticClass:"div_upload_show"},[i("a",{staticClass:"a_upload_fileName",staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:"",href:t.getFirstFileByName("施工方案").filePath,title:t.getFirstFileByName("施工方案").originalName}},[t._v(t._s(t.getFirstFileByName("施工方案").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"button_upload_delete",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("施工方案"))}}})],1):t._e()],2):t._e()]),i("a-col",{attrs:{span:3}},[[i("span",{class:{required:!t.hasEnablePageConfigByKey("projectBudgetFileNotRequired")}},[t._v("工程预算书")])],i("a-popover",{staticStyle:{"margin-left":"6px"}},[i("template",{slot:"content"},[i("upload-file-comp",{attrs:{size:160,busiType:"20",busiTypeDetail:"202A","ere-code":"project_budget_ere_id"},on:{ok:function(e){return t.webShow("工程预算书",e)},click:function(t){t.stopPropagation()}}})],1),i("a-icon",{staticStyle:{color:"#ff7e24"},attrs:{type:"qrcode"}})],2)],2),i("a-col",{attrs:{span:9,"data-prop":t.hasEnablePageConfigByKey("projectBudgetFileNotRequired")?"":"projectBudgetFile"}},[-1!==t.fileUploadState?i("div",{staticClass:"uploadFormModelItem width100"},[!t.getItemByName("工程预算书").fileList||0===t.getItemByName("工程预算书").fileList.length||t.getItemByName("工程预算书").loading?[i("a-upload",{attrs:{showUploadList:!1,customRequest:function(e){return t.uploadFile(t.projectbudgetEreUrl,e,t.getItemByName("工程预算书"))}},on:{change:function(e){return t.uploadChange(e,t.getItemByName("工程预算书"))}}},[i("a-button",{attrs:{loading:t.getItemByName("工程预算书").loading,icon:"upload"}},[t._v("上传文件")])],1),t.getItemByName("工程预算书").loading?t._e():i("span",{staticClass:"placeholder"},[t._v("支持格式：.rar .zip .doc .docx .pdf 图片")])]:t._e(),t.getItemByName("工程预算书").loading?i("a-progress",{attrs:{width:32,type:"circle",percent:t.getItemByName("工程预算书").percent}}):t._e(),t.getItemByName("工程预算书").fileList&&t.getItemByName("工程预算书").fileList.length>0&&!t.getItemByName("工程预算书").loading?i("div",{staticClass:"div_upload_show"},[i("a",{staticClass:"a_upload_fileName",staticStyle:{"line-height":"32px","pointer-events":"auto"},attrs:{allowClick:!0,href:t.getFirstFileByName("工程预算书").filePath,title:t.getFirstFileByName("工程预算书").originalName}},[t._v(t._s(t.getFirstFileByName("工程预算书").originalName))]),t.disabled?t._e():i("a-button",{staticClass:"button_upload_delete",attrs:{shape:"circle",icon:"close"},on:{click:function(e){t.clearFileItem(t.getItemByName("工程预算书"))}}})],1):t._e()],2):t._e()])],1)],1)],1)]),i("a-collapse-panel",{key:"2",attrs:{title:""},scopedSlots:t._u([{key:"header",fn:function(){return[i("span",{staticClass:"collapseTitle"},[t._v("\n          预算费用明细\n          "),t.isChild?t._e():i("a-dropdown",[i("a-menu",{staticClass:"amountButtonMenu",attrs:{slot:"overlay"},slot:"overlay"},t._l(t.costTypeMenu,(function(e){return i("a-menu-item",{key:e.value},[i("div",{staticClass:"amountButtonItem",on:{click:function(i){return i.stopPropagation(),t.chooseAmount(e)}}},[t._v("\n                  "+t._s(e.label)+"\n                  "),t.costType_choose.find((function(t){return t.value===e.value}))?i("a-icon",{attrs:{type:"check"}}):t._e()],1)])})),1),i("a-button",{staticStyle:{margin:"0","pointer-events":"auto"},attrs:{size:"small",type:"primary"},on:{click:function(t){t.stopPropagation()}}},[t._v("添加费用")])],1),t._v("\n          预算总费用："+t._s(t.formatterAmount(t.budgetAmount))+"元\n        ")],1)]},proxy:!0}])},[i("j-form-container",{ref:"detailForm",attrs:{disabled:t.disabled,border:!0,rules:t.rules,model:t.modelCost}},[i("a-row",{ref:"detail",staticClass:"houseInfo",attrs:{slot:"detail",type:"flex"},slot:"detail"},[i("a-col",{attrs:{span:3}},[t._v("施工单位")]),i("a-col",{attrs:{span:9,"data-prop":"constructionCode"}},[i("input-search-modal",{attrs:{disabled:t.disabled,width:"100%",placeholder:"请选择施工单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:"03",corpAddShow:!0,extraFlag:"1"},"is-custom-modal":!1},on:{change:function(e,i){return t.afterChoose([i])}},scopedSlots:t._u([{key:"button",fn:function(){return[i("a-button",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}]},[t._v("选择单位")])]},proxy:!0}]),model:{value:t.modelCost.constructionCode,callback:function(e){t.$set(t.modelCost,"constructionCode",e)},expression:"modelCost.constructionCode"}})],1),t.isChild?t._e():[i("a-col",{attrs:{span:3}},[i("span",{staticClass:"required"},[t._v("工程款")])]),i("a-col",{attrs:{span:9,"data-prop":"constructionAmount"}},[i("amount-input",{attrs:{min:0,placeholder:"请输入工程款"},on:{change:t.setConstructionAmount},model:{value:t.modelCost.constructionAmount,callback:function(e){t.$set(t.modelCost,"constructionAmount",e)},expression:"modelCost.constructionAmount"}})],1),t._l(t.costType_choose,(function(e){return[i("a-col",{key:e.value+"unitLabel",attrs:{span:3}},[i("span",[t._v(t._s(e.label)+"单位")])]),i("a-col",{key:e.value+"unitValue",attrs:{span:9,"data-prop":e.value+"Code"}},[i("input-search-modal",{attrs:{disabled:t.disabled,width:"100%",placeholder:"请选择"+e.label+"单位",action:"/base/rCorpInfo/getCorpInfoByBaseType",options:{value:"code",label:"name",search:"name"},"page-fields":{current:"pageNo",size:"pageSize"},columns:t.columns,otherParams:{field:"id,name,address,linkMan",order:"desc",column:"createTime",baseType:e.corpType,extraFlag:"1"},"is-custom-modal":!1},on:{change:function(i,o){return t.costUnitChoose(e,o)}},scopedSlots:t._u([{key:"button",fn:function(){return[i("a-button",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}]},[t._v("选择单位")])]},proxy:!0}],null,!0),model:{value:t.modelCost[e.value+"Code"],callback:function(i){t.$set(t.modelCost,e.value+"Code",i)},expression:"modelCost[costItem.value + 'Code']"}})],1),i("a-col",{key:e.value+"amountLabel",attrs:{span:3}},[i("span",{staticClass:"required"},[t._v(t._s(e.label)+"费")])]),i("a-col",{key:e.value+"amountValue",attrs:{span:9,"data-prop":e.value+"Amount"}},[i("amount-input",{attrs:{min:0,placeholder:"请输入审价费"},on:{change:function(i){return t.setCostAmount(e)}},model:{value:t.modelCost[e.value+"Amount"],callback:function(i){t.$set(t.modelCost,e.value+"Amount",i)},expression:"modelCost[costItem.value+'Amount']"}})],1)]}))]],2)],1)],1)],1)],1)},s=[],r=i("9bbe"),a=i("dc9a"),n=i("eccd"),l=i("2d54"),c=i("4aae"),u=i("eb36"),d=i("aa2d"),p=i("3ed7"),h=i("d8a5"),m=i("0fea"),f=i("4ec3"),g=i("d9a4"),b=i("ca1b"),v={name:"BiddingMethodComp",components:{BidNegotiationModal:l["default"],ContentView:a["default"],BidNegotiation:r["default"],JDDictSelectTag:n["default"],InputSearchModal:d["default"],AmountInput:c["default"],UploadFileComp:b["default"]},mixins:[u["a"]],props:{isDetail:{type:Boolean,default:!1},isChild:{type:Boolean,default:!1}},inject:{projMainData:{default:function(){return{}}},costMsg:{default:function(){return{}}}},computed:{projObj:function(){return this.projMainData()}},watch:{"formModel.selectTrees":function(t){this.setTableBySelectTree(t)},projObj:{deep:!0,handler:function(t){this.caculateAmount()}}},created:function(){var t=this;Object(h["e"])("construction_plan_ere_id").then((function(e){t.constructionPlanEreUrl=t.url.constructionPlanUrl+e})),Object(h["e"])("project_budget_ere_id").then((function(e){t.projectbudgetEreUrl=t.url.projectBudgetUrl+e})),Object(h["e"])("no_required_construction_plan_file").then((function(e){t.noRequestConstructionPlanFile="1"==e})),Object(h["e"])("no_required_project_budget_file").then((function(e){t.noRequiredProjectBudgetFile="1"==e}))},mounted:function(){var t=this;this.$bus.$on("updateReviewAmount",(function(e){t.modelCost.priceReviewAmount=e,t.caculateAmount()})),this.$bus.$on("updateSupervisorAmount",(function(e){t.modelCost.supervisorAmount=e,t.caculateAmount()}))},data:function(){var t=function(t,e,i){Number(e)>0?i():i(new Error("金额应大于0").message)};return{noRequestConstructionPlanFile:!1,noRequiredProjectBudgetFile:!1,headerTitle:"施工方案",activeKey:["1","2"],dictOptions:[],costTypeMenu:[{value:"priceReview",label:"审价",type:"02",corpType:"06"},{value:"supervisor",label:"监理",type:"03",corpType:"05"},{value:"biddingCost",label:"招标",type:"04",corpType:"07"},{value:"inspectionCost",label:"检测",type:"05",corpType:"08"},{value:"makeCost",label:"造价",type:"06",corpType:"09"}],costType_choose:[],engAmount:null,budgetAmount:null,disabled:!1,constructionPlanEreUrl:"",projectbudgetEreUrl:"",columns:[{title:"单位名称",align:"left",field:"name"},{title:"地址",align:"left",field:"address"},{title:"联系人",align:"center",field:"linkMan"}],modelCost:{constructionCode:"",constructionAmount:""},rules:{regionCode:[{required:!0,message:"请输入物业区域名称",trigger:"change"}],constructionPlanFile:[{required:!0,message:"请上传施工方案",trigger:"change"}],projectBudgetFile:[{required:!0,message:"请上传工程预算书",trigger:"change"}],constructionCode:[{required:!1,message:"请选择施工单位",trigger:"change"}],constructionAmount:[{required:!0,message:"请输入工程款",trigger:"change"},{validator:t}]},url:{synchronizeProject:"/use/serviceProj/synchronizeProject",constructionPlanUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId=",projectBudgetUrl:window._CONFIG["domianURL"]+"/control/file/uploadImg?parenPath=&uploadType=5&busiType=20&busiTypeDetail=202A&orderNo=1&erecordId="},formatterAmount:p["g"],validaAmount:t}},methods:{hasEnablePageConfigByKey:g["a"],synchronizeProject:function(){var t=this;Object(m["j"])(this.url.synchronizeProject,this.projObj).then((function(e){e.success?t.$message.success("同步成功"):t.$message.error("同步失败")}))},checkData:function(){return{valida:this.$refs.rowContent?this.$refs.formRow.validaRowMsg(this.$refs.rowContent).valida&&this.$refs.detailForm.validaRowMsg(this.$refs.detail).valida:this.$refs.detailForm.validaRowMsg(this.$refs.detail).valida}},initData:function(){this.projObj.supervisor&&(this.modelCost.supervisorCode=this.projObj.supervisor.chargeCorpCode,this.modelCost.supervisorAmount=this.projObj.supervisor.cost),this.projObj.priceReview&&(this.modelCost.priceReviewCode=this.projObj.priceReview.chargeCorpCode,this.modelCost.priceReviewAmount=this.projObj.priceReview.cost),this.projObj.construction&&(this.modelCost.constructionAmount=this.projObj.construction.cost),this.modelCost.constructionCode=this.projObj.construction?this.projObj.construction.chargeCorpCode:"",this.caculateAmount();var t=[{name:"施工方案",fileList:this.projObj.constructionPlanFile?[this.projObj.constructionPlanFile]:[],fileType:["rar","zip","doc","docx","pdf","bmp","jpg","png","gif","jpeg","BMP","JPG","PNG","GIF","JPEG"]},{name:"工程预算书",fileList:this.projObj.projectBudgetFile?[this.projObj.projectBudgetFile]:[],fileType:["rar","zip","doc","docx","pdf","bmp","jpg","png","gif","jpeg","BMP","JPG","PNG","GIF","JPEG"]}];this.initUploadFile(t),this.initBidType()},initBidType:function(){var t=this,e=Object(f["C"])("bid_type");e?this.dictOptions=e:Object(f["i"])(this.dictCode,null).then((function(e){e.success&&(t.dictOptions=e.result)}))},chooseAmount:function(t){var e=this.costType_choose.findIndex((function(e){return t.value===e.value}));-1===e?this.addCost(t):this.removeCost(t)},addCost:function(t){this.projObj[t.value]||this.$set(this.projObj,t.value,{}),this.rules[t.value+"Amount"]=[{required:!0,message:"请输入".concat(t.label,"费"),trigger:"change"},{validator:this.validaAmount}],this.rules[t.value+"Code"]=[{required:!1,message:"请选择".concat(t.label,"单位"),trigger:"change"}],this.costType_choose.push(t)},removeCost:function(t){this.$set(this.projObj,t.value,void 0),this.$set(this.modelCost,t.value,""),this.$set(this.modelCost,t.value+"Code",""),this.$set(this.modelCost,t.value+"Amount",0),this.$delete(this.rules,t.label+"Code"),this.$delete(this.rules,t.label+"Amount");var e=this.costType_choose.findIndex((function(e){return e.value===t.value}));e>=0&&this.costType_choose.splice(e,1)},costUnitChoose:function(t,e){e&&(this.projObj[t.value].projId=this.projObj.id,this.projObj[t.value].chargeCorpCode=e.code,this.projObj[t.value].chargeCorpMan=e.linkMan,this.projObj[t.value].stage="01",this.projObj[t.value].baseType=t.type,this.projObj[t.value].chargeCorpPhone=e.phone,this.projObj[t.value].cost=this.modelCost[t.value+"Amount"]?this.modelCost[t.value+"Amount"]:0)},onFileChange:function(t,e,i){var o=this.getFirstFileByName("施工方案"),s=this.getFirstFileByName("工程预算书");this.projObj.constructionPlanFile=o,this.$set(this.modelCost,"constructionPlanFile",o&&Object.keys(o).length>0?o:void 0),this.projObj.projectBudgetFile=s,this.$set(this.modelCost,"projectBudgetFile",s&&Object.keys(s).length>0?s:void 0)},caculateAmount:function(){this.showEngAmount(),this.showBudgetAmount()},showEngAmount:function(){this.engAmount=this.projObj.construction&&this.projObj.construction.cost&&!isNaN(this.projObj.construction.cost)?this.projObj.construction.cost:0},showBudgetAmount:function(){this.budgetAmount=0,this.budgetAmount=Number(this.projObj.construction&&this.projObj.construction.cost?this.projObj.construction.cost:0)+Number(this.projObj.priceReview&&this.projObj.priceReview.cost?this.projObj.priceReview.cost:0)+Number(this.projObj.supervisor&&this.projObj.supervisor.cost?this.projObj.supervisor.cost:0)+Number(this.projObj.biddingCost&&this.projObj.biddingCost.cost?this.projObj.biddingCost.cost:0)+Number(this.projObj.inspectionCost&&this.projObj.inspectionCost.cost?this.projObj.inspectionCost.cost:0)+Number(this.projObj.makeCost&&this.projObj.makeCost.cost?this.projObj.makeCost.cost:0),this.budgetAmount=Number(this.budgetAmount).toFixed(2),this.$set(this.projObj,"budgetCost",this.budgetAmount)},afterChoose:function(t){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.projObj.construction.projId=this.projObj.id,this.projObj.construction.chargeCorpCode=t[0].code,this.projObj.construction.chargeCorpMan=t[0].linkMan,this.projObj.construction.chargeCorpPhone=t[0].phone,this.projObj.construction.describe=this.projObj.describe+"工程总费用"},setConstructionAmount:function(){this.projObj.construction||this.$set(this.projObj,"construction",{}),this.$set(this.projObj.construction,"cost",this.modelCost.constructionAmount?this.modelCost.constructionAmount:0),this.caculateAmount()},setCostAmount:function(t){this.$set(this.projObj[t.value],"stage","01"),this.$set(this.projObj[t.value],"cost",this.modelCost[t.value+"Amount"]?this.modelCost[t.value+"Amount"]:0),this.caculateAmount()}}},j=v,y=(i("482c"),i("34c6"),i("2877")),C=Object(y["a"])(j,o,s,!1,null,"724f4773",null);e["default"]=C.exports},d748:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("content-view",{key:"3",staticClass:"connetItem",attrs:{showIcon:!1,title:"附件列表","body-style":{flex:1,height:0}}},[o("div",{ref:"drawFileInfo",staticClass:"drawFileInfo"},[o("a-row",{staticClass:"outDiv_content itemInfo",attrs:{type:"flex"}},[o("a-col",{staticClass:"typeTree"},[o("div",{staticClass:"leftHeader"},[t._v("\n            项目附件\n          ")]),o("div",{ref:"fileTypeContent",staticClass:"typeTree_content"},[o("a-menu",{staticClass:"fileTypeMenu",attrs:{selectedKeys:t.selectedKeys,mode:"inline"}},t._l(t.drawFileInfo,(function(e,s){return o("a-sub-menu",{key:s},[o("span",{attrs:{slot:"title"},slot:"title"},[o("a-icon",{attrs:{type:"file"}}),o("a-tooltip",{attrs:{placement:"topLeft",title:e.reqDescribe?e.reqDescribe:e.drawName}},[o("span",[t._v(t._s(e.reqDescribe?e.reqDescribe:e.drawName))])])],1),t._l(e.fileCategory,(function(s){return o("a-menu-item",{key:s.id},[o("div",{staticClass:"typeItem"},[o("div",{staticClass:"typeItem_title",on:{click:function(i){return t.onSelect(s,e.busiNo)}}},[o("img",{staticClass:"typeItemTitle_icon",attrs:{src:s.isValid?i("f736"):i("de60"),alt:"必传项"}}),o("a-tooltip",{attrs:{destroyTooltipOnHide:"",getPopupContainer:function(){return t.$refs.drawFileInfo},placement:"topLeft",title:s.name}},[t._v("\n                        "+t._s(s.name)+"\n                      ")])],1),s.fileManageList?o("span",{staticClass:"typeItem_nums"},[t._v(t._s(s.fileManageList.length))]):o("span",{staticClass:"typeItem_nums notFile"},[t._v("未上传")])])])}))],2)})),1)],1),o("div",{staticClass:"leftHeader"},[t._v("\n            项目资料\n          ")]),o("div",{staticClass:"typeTree_content"},[o("a-menu",{staticClass:"fileTypeMenu",attrs:{mode:"inline"},model:{value:t.reportSelectKeys,callback:function(e){t.reportSelectKeys=e},expression:"reportSelectKeys"}},[t.hasChild?[t._l(t.hasChildProReportData.mainProFiles.data,(function(e,i){return o("a-menu-item",{key:"mainProFiles"+i},[o("ReportMenuItem",{attrs:{selectedKeys:t.reportSelectKeys,item:e,getPopupContainer:function(){return t.$refs.drawFileInfo}},on:{click:function(i){return t.onSelectReport(e)}}})],1)})),t._l(t.hasChildProReportData.childProFiles,(function(e){return o("a-sub-menu",{key:e.projId,attrs:{title:"子项目："+e.title}},t._l(e.data,(function(i,s){return o("a-menu-item",{key:"child"+e.projId+s},[o("ReportMenuItem",{attrs:{selectedKeys:t.reportSelectKeys,item:i,getPopupContainer:function(){return t.$refs.drawFileInfo}},on:{click:function(e){return t.onSelectReport(i)}}})],1)})),1)}))]:t._l(t.reportData,(function(e,i){return o("a-menu-item",{key:i},[o("ReportMenuItem",{attrs:{selectedKeys:t.reportSelectKeys,item:e,getPopupContainer:function(){return t.$refs.drawFileInfo}},on:{click:function(i){return t.onSelectReport(e)}}})],1)}))],2)],1)]),o("a-col",{staticClass:"typeUpload"},["file"===t.currentType?o("div",{staticClass:"rightHeader"},[o("a-space",[0!==t.pageNum?o("a-icon",{attrs:{type:"arrow-left"},on:{click:function(e){t.pageNum-=1}}}):t._e(),o("span",[t._v("上传文件")]),t.fileTypeChecked&&t.fileTypeChecked.describe?o("a-popover",{attrs:{trigger:"click",destroyTooltipOnHide:!0,title:"附件描述",autoAdjustOverflow:!1}},[o("template",{slot:"content"},[o("div",{style:{maxWidth:"600px"}},[t._v(t._s(t.fileTypeChecked.describe))])]),o("a-icon",{staticClass:"rightHeaderDescribeIcon",attrs:{type:"question-circle",theme:"twoTone"}})],2):t._e()],1)],1):t._e(),"file"===t.currentType?[o("div",{staticClass:"rightContent"},[0===t.pageNum?o("div",{staticClass:"rightContent_showList"},[t.showList&&t.showList.length?o("div",{staticClass:"fileShowList"},[o("a-spin",{staticClass:"deleteSpin",attrs:{spinning:t.deleteLoading,tip:t.deleteTip}},["allFile"!==t.checkTypeId?o("a-upload",{staticClass:"uploadButtonStyle fileShowUpload",attrs:{"file-list":t.showList,disabled:t.isDetail||t.WhetherThePermissionPasses("projList:postGrantNoDelImg")&&["0","1","N","X"].includes(t.projMainData().state),remove:t.deleteFile,"list-type":"picture-card"},on:{preview:function(e){return t.handlePreview(e)}}}):o("div",{staticClass:"isAllDrawFiles"},t._l(t.allTypeList.typeList,(function(e){return o("div",{key:"type"+e.id},[e.fileManageList.length>0?[o("p",{staticClass:"allTypeItem_title"},[t._v(t._s(e.name))]),o("a-upload",{staticClass:"uploadButtonStyle fileShowUpload",attrs:{disabled:t.isDetail,"list-type":"picture-card",showUploadList:!1}},[o("div",{staticClass:"uploadList isAll"},t._l(e.fileManageList,(function(i){return o("div",{key:i.id,staticClass:"uploadListItem"},[o("img",{staticClass:"typeListImg",attrs:{src:i.filePath,alt:i.fileName}}),o("div",{staticClass:"typeListAction"},[o("div",{staticClass:"actionButton",on:{click:function(o){return o.stopPropagation(),t.handlePreview(i,e.fileManageList)}}},[o("a-icon",{attrs:{type:"eye"}})],1),o("div",{staticClass:"actionButton",on:{click:function(o){return o.stopPropagation(),t.deleteFile(i,e)}}},[o("a-icon",{attrs:{type:"close-circle",theme:"filled"}})],1)])])})),0)])]:t._e()],2)})),0)],1)],1):o("a-empty",{attrs:{description:"暂无附件信息"}})],1):t._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:1===t.pageNum,expression:"pageNum===1"}],staticClass:"typeUpload_content"},[o("div",{staticClass:"typeUpload_content_left"},[o("a-upload-dragger",{staticClass:"uploadButtonStyle",attrs:{customRequest:t.uploadFile,"before-upload":t.onBeforeUploadImage,multiple:!0,"file-list":t.showList,action:t.url.fileUploadImg,headers:t.headers,showUploadList:!1},on:{preview:function(e){return t.handlePreview(e)}}},[o("div",[o("img",{staticClass:"typeUpload_content_left_icon",attrs:{src:i("23cd"),alt:"选择图片"}}),o("br"),o("p",{staticClass:"typeUpload_content_left_label"},[t._v("将文件拖到此处或"),o("a",[t._v("点击上传")])]),o("p",{staticClass:"typeUpload_content_left_describe"},[t._v("\n                        支持上传jpg、png、pdf、word、excel等格式文件\n                        单个文件不能超过500kb")])])])],1),o("div",{staticClass:"typeUpload_content_right",on:{click:t.toCamera}},[o("div",{staticClass:"typeUpload_content_right_con"},[o("div",[o("img",{staticClass:"typeUpload_content_right_icon",attrs:{src:i("1e0c"),alt:"高拍仪上传"}}),o("p",{staticClass:"typeUpload_content_right_label"},[t._v("\n                        高拍仪拍照\n                      ")]),o("p",{staticClass:"typeUpload_content_right_describe"},[t._v("\n                        可连续拍照，自动上传\n                      ")])])])])]),o("div",{directives:[{name:"show",rawName:"v-show",value:2===t.pageNum,expression:"pageNum===2"}],staticClass:"typeUpload_scanner"},[o("scanner-modal",{ref:"ScannerModal",on:{onUpload:t.onUpload}})],1)]),1!==t.pageNum&&!t.isDetail&&t.checkTypeId&&"allFile"!==t.checkTypeId?o("div",{staticClass:"footerButton"},[0===t.pageNum?o("div",[t.fileList&&t.fileList.length?o("a-button",{attrs:{icon:"cloud-upload",type:"primary"},on:{click:t.addFile}},[t._v("\n                  继续添加\n                ")]):o("a-button",{attrs:{icon:"cloud-upload",type:"primary"},on:{click:t.addFile}},[t._v("开始上传")])],1):t._e(),2===t.pageNum?o("div",[o("a-button",{attrs:{type:"primary",icon:"cloud-upload"},on:{click:t.scannerHandOk}},[t._v("开始上传")])],1):t._e()]):t._e()]:t._e(),"report"===t.currentType?[o("print-report-comp",{ref:"PrintReportComp",attrs:{height:600}})]:t._e()],2)],1),t.previewVisible?o("div",{staticClass:"outer_box",style:{zIndex:t.zIndex+1}},[o("previewPicture",{ref:"previewPicture",attrs:{fileNum:t.previewNum,fileList:t.previewFileList},on:{cancel:function(e){t.previewVisible=!1}}})],1):t._e()],1)])},s=[],r=i("fdcf"),a=i("b7a8"),n=i("bd56"),l=i("0fea"),c=i("b5a0"),u=i("5745"),d=i("dc9a"),p=i("9bed"),h=i("2b0e");function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach((function(e){b(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function b(t,e,i){return(e=v(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function v(t){var e=j(t,"string");return"symbol"==m(e)?e:e+""}function j(t,e){if("object"!=m(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=m(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var y=h["default"].extend({props:{item:{type:Object,default:function(){}},getPopupContainer:Function,selectedKeys:{type:Array,default:function(){return[]}}},render:function(t){var e=this;return t("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},[t("div",{style:{flex:1,width:0,overflow:"hidden",textOverflow:"ellipsis"},on:{click:function(){return e.$emit("click")}}},[t("a-icon",{props:{type:"file"}}),t("a-tooltip",{props:{destroyTooltipOnHide:!0,autoAdjustOverflow:!1,getPopupContainer:this.getPopupContainer,placement:"topLeft",title:this.item.rname}},[this.item.rname])])])}}),C={name:"DrawFileInfo",components:{PrintReportComp:p["default"],ContentView:d["default"],PreviewPicture:a["default"],ScannerModal:n["default"],myCollposeTransition:c["a"],ReportMenuItem:y},mixins:[u["a"]],props:{isLoadInitData:{type:Boolean,default:!0},proInfo:{type:Object,default:null},zIndex:{type:Number,default:1001}},data:function(){return{currentType:"file",reportData:[],hasChildProReportData:{childProFiles:[],mainProFiles:{}},drawFileInfo:{},url:{queryDrawInfo:"/use/serviceProj/queryDrawInfo",queryProjReport:"/use/serviceProj/queryProjReport"},deleteLoading:!1,deleteTip:"",defaultOpenKeys:[],reportSelectKeys:[]}},computed:{allTypeList:function(){var t=[],e=0;for(var i in this.drawFileInfo)this.drawFileInfo[i].forEach((function(i){i.fileManageList=i.fileManageList||[],t.push(i),e+=i.fileManageList.length}));return{typeList:t,fileNums:e}},selectedKeys:function(){return this.checkTypeId?[this.checkTypeId]:[]},hasChild:function(){return"1"==this.projMainData().isHasChild}},inject:["projMainData"],methods:{WhetherThePermissionPasses:r["a"],isShowUpload:function(){this.uploadVisible=!this.uploadVisible},initData:function(){var t,e=this;this.resetData(),this.proInfo?(this.bId=this.proInfo.id,t=this.proInfo.completionFlag):(this.bId=this.projMainData().id,t=this.projMainData().completionFlag),this.reportData=[],this.$set(this.hasChildProReportData,"mainProFiles",{}),this.$set(this.hasChildProReportData,"childProFiles",[]),Object(l["j"])(this.url.queryProjReport,this.projMainData()).then((function(t){if(t.success){if(e.hasChild){var i=e.projMainData().children,o=e.projMainData().id,s={isMain:!0,data:[]},r=[];return t.result.forEach((function(t){if(t.projId===o)s.data.push(t);else{var e=r.findIndex((function(e){return e.projId===t.projId}));if(e>-1)r[e].data.push(t);else{var a=i.find((function(e){return e.id===t.projId}));a&&r.push({title:a.describe,projId:t.projId,data:[t]})}}})),e.reportData=t.result,e.$set(e.hasChildProReportData,"mainProFiles",s),e.proInfo&&e.proInfo.id&&(r=r.filter((function(t){return t.projId===e.proInfo.id}))),void e.$set(e.hasChildProReportData,"childProFiles",r)}e.reportData=t.result}})),Object(l["j"])(this.url.queryDrawInfo,{id:this.bId,completionFlag:t}).then((function(t){if(t.success&&0!==t.result.length)for(var i in e.drawFileInfo=t.result,e.drawFileInfo){var o=e.drawFileInfo[i];return void(o&&o.length>0&&e.onSelect(o[0]))}else e.$emit("fileTypeIsNull")}))},showAllFile:function(){this.checkTypeId="allFile"},onSelect:function(t,e){this.currentType="file",this.bId=e||this.projMainData().id,this.bType=t.busiType?t.busiType:this.busiType,this.bTypeDetail=t.busiTypeDetail?t.busiTypeDetail:this.busiTypeDetail,this.pageNum=0,this.fileTypeChecked=t,this.checkTypeId=t.id,this.previewFileList=[],"allFile"!==t.id&&(t.fileManageList=t.fileManageList?t.fileManageList:[],this.fileList=t.fileManageList),this.buildShowList()},onSelectReport:function(t){var e=this;this.currentType="report",this.$nextTick((function(){e.$refs.PrintReportComp.type="page",e.$refs.PrintReportComp.print(t.formType,g(g({},t),{},{id:t.projId}))}))},deleteFile:function(t,e){var i,o=this,s=this.showList,r=this.fileList;t=t||i,this.deleteTip="删除附件".concat(t.name||t.fileName,"中，请稍后..."),this.deleteLoading=!0,Object(l["a"])(this.url.fileDeleteImg,{id:t.uid||t.id}).then((function(){var i;if(i=t.response?t.response.result.id:t.uid||t.id,!e){if(r)for(var a=0;a<r.length;a++)if(r[a].id===i){r.splice(a,1);break}if(s)for(var n=0;n<o.showList.length;n++)if(s[n].uid===i){s.splice(n,1);break}return o.getFileValueByColumnId(),!0}for(var l=0;l<e.fileManageList.length;l++)if(e.fileManageList[l].id===i){e.fileManageList.splice(l,1);break}})).catch((function(){return!1})).finally((function(){o.deleteLoading=!1}))},handleChangeImage:function(t,e){var i=this,o=t.file,s=this.fileList;if("done"===o.status)if(o.response&&o.response.success){var r={};r.id=t.file.response.result.id,r.filePath=t.file.response.result.filePath,r.fileName=t.file.response.result.originalName,r.thumPath=t.file.response.result.thumPath,s.push(r),this.buildShowList(t,e)}else i.$message.error(o.response.message?o.response.message:"上传失败");else"error"===o.status&&this.buildShowList(t,e)},getFileValueByColumnId:function(){var t=this;this.fileValue=[];for(var e=[],i=0;i<this.showTypeList.length;i++)if(0!==i)for(var o=0;o<this.showTypeList[i].typeList.length;o++)this.showTypeList[i].typeList[o].fileManageList&&(e=e.concat(this.showTypeList[i].typeList[o].fileManageList));e.forEach((function(e){var i={};t.columnId.forEach((function(t){i[t]=e[t]})),t.fileValue.push(i)})),this.$emit("change",this.fileValue)},checkData:function(){var t=!0;if(this.showList&&this.showList.length>0)for(var e=0;e<this.showList.length;e++)if(this.showList[e].status&&"uploading"===this.showList[e].status)return this.$message.warning("请等待图片或附件处理完成！"),!1;for(var i=0;i<this.showTypeList[1].typeList.length;i++){var o=this.showTypeList[1].typeList[i];if(o.fileManageList.length<o.fileNum){var s=this.$message;s.config({duration:2,maxCount:1}),s.warning("".concat(o.name,"至少上传").concat(o.fileNum,"份附件")),t=!1;break}}return t}}},w=C,_=(i("212c"),i("2877")),O=Object(_["a"])(w,o,s,!1,null,"790cb135",null);e["default"]=O.exports},d9e8:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.searchLoading,expression:"searchLoading"}],staticClass:"childPro",attrs:{"element-loading-text":"正在查询子项目，请稍后"}},[i("div",{staticClass:"childPro_header"},[i("div",{staticClass:"header_search"},[i("a-input",{staticClass:"width-200",attrs:{"allow-clear":!0,placeholder:"请输入项目描述"},model:{value:t.projDescribe,callback:function(e){t.projDescribe=e},expression:"projDescribe"}}),i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getListById(t.parentModel.id,"search")}}},[t._v("搜索")])],1),i("div",{staticClass:"header_rightAction"},[i("a-icon",{class:{active:"card"===t.showType},attrs:{type:"appstore"},on:{click:function(e){t.showType="card"}}}),i("a-icon",{class:{active:"list"===t.showType},attrs:{type:"unordered-list"},on:{click:function(e){t.showType="list"}}}),t.isDetail?t._e():i("a-button",{attrs:{type:"primary"},on:{click:t.addChild}},[t._v("新增")])],1)]),i("div",{staticClass:"childPro_content"},[t.lists.length>0?["card"===t.showType?i("cards",{attrs:{pageType:t.pageType,zIndex:t.zIndex,lists:t.pageList,biddingCorpCode:t.biddingCorpCode,comparAble:t.comparAble,isDetail:t.isDetail},on:{refresh:function(e){return t.getListById(t.parentModel.id)}}}):t._e(),"list"===t.showType?i("vxe-grid",{ref:"childTable",attrs:{"edit-config":t.isDetail?null:{},height:"auto",border:"",data:t.lists,columns:"1"!=t.comparAble||t.biddingCorpCode&&""!=t.biddingCorpCode?t.columns:t.columnsCompar},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[i("get-table-action-buttons",[i("a",{on:{click:function(e){return t.proManager(o)}}},[t._v("项目管理")]),t.isDetail?t._e():i("a-popconfirm",{attrs:{title:"是否确定删除？"},on:{confirm:function(e){return t.delMiniProj(o)}}},[i("a",[t._v("删除")])]),t.isDetail?t._e():i("a",{on:{click:function(e){return t.addChild(o)}}},[t._v("复制")])],1)]}}],null,!1,664724619)}):t._e()]:i("a-empty")],2),"card"===t.showType&&t.lists&&t.lists.length>0?i("div",{staticClass:"childPro_footer"},[i("a-pagination",t._b({attrs:{pageSize:t.cardPagination.pageSize,total:t.lists.length},on:{"update:pageSize":function(e){return t.$set(t.cardPagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.cardPagination,"pageSize",e)}},model:{value:t.cardPagination.current,callback:function(e){t.$set(t.cardPagination,"current",e)},expression:"cardPagination.current"}},"a-pagination",t.cardPagination,!1))],1):t._e(),i("create-pro-modal",{ref:"createProModal",attrs:{zIndex:t.zIndex+1},on:{ok:function(e){return t.getListById(t.parentModel.id)}}}),i("child-pro-manager",{ref:"childProManager",attrs:{pageType:t.pageType,indexNum:t.zIndex+1,"pro-info":t.childInfo,isDetail:t.isDetail},on:{ok:function(){return t.getListById(t.parentModel.id)}}})],1)},s=[],r=i("b88f"),a=i("4da9"),n=i("0fea"),l=i("4aae"),c=i("d8a5"),u=i("362e"),d=i("2d4c"),p=i("bed7"),h=i("3ed7"),m={name:"ChildPro",components:{GetTableActionButtons:d["default"],CostSetter:u["default"],AmountInput:l["default"],CreateProModal:a["default"],cards:r["default"],ChildProManager:p["default"]},inject:["projMainData"],provide:function(){var t=this;return{costMsg:function(){return t.childCostMsg}}},props:{biddingCorpCode:{type:String,default:""},comparAble:{type:String,default:"0"},isDetail:{type:Boolean,default:!1},allotMode:{type:[String,Number],default:""},pageType:{type:Boolean,default:!0},zIndex:{type:Number,default:1e3}},data:function(){return{showType:"card",projDescribe:"",lists:[],url:{queryMinProj:"/use/serviceProj/queryMinProj",delMiniProj:"/use/serviceProj/delMiniProj/"},parentModel:{},priceReviewFlag:0,modelCost:{},childCostMsg:{},columns:[{title:"项目编号",field:"code",width:140},{title:"项目描述",field:"describe"},{title:"预算金额（元）",field:"budgetCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"决算金额（元）",field:"finalCost",align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e)}},{title:"审价费（元）",field:"priceReview",editRender:{},align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e?e.cost:"0")}},{title:"监理费（元）",field:"supervisor",editRender:{},align:"right",formatter:function(t){var e=t.cellValue;return Object(h["g"])(e?e.cost:"0")}},{title:"分摊户数",field:"allotLists",align:"right",formatter:function(t){var e=t.cellValue;return e?e.length:0}},{title:"残值回收（元）",field:"scrapValue",align:"right",formatter:function(t){t.cellValue;return"0.00"}},{title:"操作",slots:{default:"action"},align:"center",width:180}],columnsCompar:[{title:"项目编号",field:"code",width:140},{title:"项目描述",field:"describe"},{title:"分摊户数",field:"allotLists",align:"right",formatter:function(t){var e=t.cellValue;return e?e.length:0}},{title:"残值回收（元）",field:"scrapValue",align:"right",formatter:function(t){t.cellValue;return"0.00"}},{title:"操作",slots:{default:"action"},align:"center",width:180}],costTypeMenu:[{value:"priceReview",label:"审价",type:"02"},{value:"supervisor",label:"监理",type:"03"},{value:"biddingCost",label:"招标",type:"04"},{value:"inspectionCost",label:"检测",type:"05"},{value:"makeCost",label:"造价",type:"06"}],childInfo:{},cardPagination:{current:1,defaultPageSize:6,pageSize:6,showSizeChanger:!1,pageSizeOptions:["6","12","18","24"]},searchLoading:!1}},computed:{projObj:function(){return this.projMainData()},pageList:{get:function(){var t=(this.cardPagination.current-1)*this.cardPagination.pageSize,e=this.cardPagination.pageSize*this.cardPagination.current;return this.lists.slice(t,e)},set:function(){}}},mounted:function(){var t=this;Object(c["e"])("allot_mode").then((function(e){t.modelCost.allotMode=e})),this.parentModel=this.projMainData(),"1"==this.projObj.isHasChild&&this.pageType?this.getListById(this.parentModel.id):"1"==this.projObj.isHasChild&&(this.lists=this.projMainData().children)},methods:{checkData:function(){var t=this;return new Promise((function(e,i){t.lists&&0!==t.lists.length||(t.$message.warning("请创建一个子项目！"),i(new Error("请创建一个子项目！")));for(var o=0;o<t.lists.length;o++){var s=t.lists[o];s.baseType=t.projMainData().baseType,s.allotMode=t.projMainData().allotMode}if(t.priceReviewFlag)if(t.modelCost&&t.modelCost.supervisorCode&&t.modelCost.supervisorAmount&&t.modelCost.priceReviewCode&&t.modelCost.priceReviewAmount){t.projMainData().construction.cost=0;for(var r=0;r<t.lists.length;r++){var a=JSON.parse(JSON.stringify(t.projMainData().priceReview));a.cost=t.lists[r].priceReview.cost,a.describe=t.lists[r].priceReview.describe,t.lists[r].priceReview=a;var n=JSON.parse(JSON.stringify(t.projMainData().supervisor));n.cost=t.lists[r].supervisor.cost,n.describe=t.lists[r].supervisor.describe,t.lists[r].supervisor=n,t.projMainData().construction.cost=Object(h["c"])(t.projMainData().construction.cost,t.lists[r].construction.cost)}e()}else t.$message.warning("请填写审价费监理费信息"),i(new Error("请填写审价费监理费信息！"));else e()}))},getListById:function(t,e){var i=this;this.lists=[];var o={id:t};e&&"search"==e&&(o.describe=this.projDescribe),this.searchLoading=!0,Object(n["e"])(this.url.queryMinProj,o,{"tenant-id":this.projMainData().sysOrgCode}).then((function(t){var e=t.success,o=t.result,s=t.message;e&&o?(i.lists=o,i.setCostMsg(),i.setBgCost(),i.projMainData().children=i.lists,i.projMainData().comparAble&&"1"==i.projMainData().comparAble&&i.lists.forEach((function(t){t.comparAble=i.projMainData().comparAble,t.biddingCorpCode=i.projMainData().biddingCorpCode})),i.$emit("setBgCost")):i.$message.warning(s)})).finally((function(){i.searchLoading=!1}))},addChild:function(t){var e=JSON.parse(JSON.stringify(this.modelCost));if(0==this.allotMode&&(this.modelCost.supervisorAmount&&(e.supervisorAmount=Number(Number(e.supervisorAmount)/(this.lists.length+1)).toFixed(2)),this.modelCost.priceReviewAmount&&(e.priceReviewAmount=Number(Number(e.priceReviewAmount)/(this.lists.length+1)).toFixed(2))),this.childCostMsg=e,this.$refs.createProModal.model.baseType=this.projMainData().baseType,this.$refs.createProModal.model.allotMode=this.projMainData().allotMode,this.$refs.createProModal.model.regionCode=this.projMainData().regionCode,this.$refs.createProModal.model.communityName=this.projMainData().communityName,this.$refs.createProModal.model.regionId=this.projMainData().regionId,this.$refs.createProModal.model.pid=this.projMainData().id,this.$refs.createProModal.model.sysOrgCode=this.projMainData().sysOrgCode,this.$refs.createProModal.model.reqMan=this.projMainData().reqMan,this.$refs.createProModal.model.reqPhone=this.projMainData().reqPhone,this.$refs.createProModal.model.construction=JSON.parse(JSON.stringify(this.projMainData().construction)),this.$refs.createProModal.model.construction.cost&&(this.$refs.createProModal.model.construction.cost=0),t&&t.id){this.$set(this.$refs.createProModal.model,"describe",t.describe);var i=JSON.parse(JSON.stringify(t.costLists));i.map((function(t){t.partDesc=t.remark,t.id=void 0,t.materialList.map((function(t){t.costListId=void 0,t.id=void 0}))})),this.$set(this.$refs.createProModal.model,"choosePart",i),this.$set(this.$refs.createProModal.model,"reqMan",t.reqMan),this.$set(this.$refs.createProModal.model,"reqPhone",t.reqPhone);var o=[],s=JSON.parse(JSON.stringify(t.sharedHousings));s.map((function(t){o.push({id:t})})),this.$set(this.$refs.createProModal.model,"apportionFloors",o),this.$set(this.$refs.createProModal.model,"construction",{cost:t.construction.cost,chargeCorpCode:t.construction.chargeCorpCode})}this.$refs.createProModal.open(!1)},setConstruction:function(t){var e=this;this.projMainData().construction||this.$set(this.projMainData(),"construction",{}),this.projMainData().construction.cost=0,this.lists.forEach((function(t){e.projMainData().construction.cost=Object(h["c"])(e.projMainData().construction.cost,Number(t.construction.cost))})),this.projMainData().construction.describe=this.projMainData().describe+"工程总费用"},setCostMsg:function(){var t=this;this.costTypeMenu.forEach((function(e){t.projMainData()[e.value]&&(t.unitChoose(e),t.setChooseAmount(e))}))},setBgCost:function(){for(var t=0;t<this.lists.length;t++)this.lists[t].budgetCost=Object(h["c"])(Number(this.lists[t].construction.cost),Number(this.lists[t].priceReview&&this.lists[t].priceReview.cost?this.lists[t].priceReview.cost:0),Number(this.lists[t].supervisor&&this.lists[t].supervisor.cost?this.lists[t].supervisor.cost:0),Number(this.lists[t].biddingCost&&this.lists[t].biddingCost.cost?this.lists[t].biddingCost.cost:0),Number(this.lists[t].inspectionCost&&this.lists[t].inspectionCost.cost?this.lists[t].inspectionCost.cost:0),Number(this.lists[t].makeCost&&this.lists[t].makeCost.cost?this.lists[t].makeCost.cost:0));this.$refs.childTable&&this.$refs.childTable.loadData(this.lists)},unitChoose:function(t){var e=t.value,i=JSON.parse(JSON.stringify(this.projMainData()[e]));i.cost=i.cost?i.cost:0;for(var o=0;o<this.lists.length;o++)this.lists[o][e]||this.$set(this.lists[o],e,{cost:0}),this.lists[o][e].projId=this.lists[o].id,this.lists[o][e].chargeCorpCode=i.chargeCorpCode,this.lists[o][e].chargeCorpMan=i.chargeCorpMan,this.lists[o][e].stage="01",this.lists[o][e].baseType=i.baseType,this.lists[o][e].chargeCorpPhone=i.chargeCorpPhone,this.lists[o][e].describe=this.lists[o].describe+t.label},setChooseAmount:function(t){for(var e=t.value,i=0;i<this.lists.length;i++)this.lists[i][e].projId=this.lists[i].id,this.lists[i][e].stage="01",this.lists[i][e].baseType=t.type,this.lists[i][e].describe=this.lists[i].describe+t.label;this.setBgCost()},allotmentAmount:function(t){for(var e=t.value,i=this.projMainData()[e].cost,o=0,s=0;s<this.lists.length;s++)this.lists[s][e]||this.$set(this.lists[s],e,{cost:0}),"0"===this.allotMode?this.lists[s][e].cost=Number(Object(h["d"])(i,this.lists.length)).toFixed(2):this.lists[s][e].cost=Number(Object(h["e"])(Object(h["d"])(this.lists[s].construction.cost,this.projMainData().construction.cost),i)).toFixed(2),o=Object(h["c"])(o,this.lists[s][e].cost),this.lists[s][e].projId=this.lists[s].id,this.lists[s][e].stage="01",this.lists[s][e].baseType=t.type,this.lists[s][e].describe=this.lists[s].describe+t.label;if(o!=i&&this.lists[0]){var r=Object(h["f"])(i,o);this.lists[0][e].cost=Object(h["c"])(this.lists[0][e].cost,r)}this.setBgCost()},delCost:function(t){for(var e=0;e<this.lists.length;e++)this.$set(this.lists[e],t,null);this.setBgCost()},addCost:function(t){for(var e=0;e<this.lists.length;e++)this.$set(this.lists[e],t,{});this.setBgCost()},delMiniProj:function(t){var e=this,i=this.url.delMiniProj+t.id;Object(n["j"])(i).then((function(t){var i=t.success,o=t.result,s=t.message;i&&o?(e.getListById(e.parentModel.id),e.$forceUpdate()):e.$message.warning(s)}))},proManager:function(t){this.childInfo=JSON.parse(JSON.stringify(t)),this.$refs.childProManager.open()}}},f=m,g=(i("df99"),i("2877")),b=Object(g["a"])(f,o,s,!1,null,"5874b6d6",null);e["default"]=b.exports},df99:function(t,e,i){"use strict";i("2a50")},ef22:function(t,e,i){"use strict";i("ad6a")},f3db:function(t,e,i){}}]);